// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),function(l,e,g,m,h,n,k,p,q,r,s,t,u){return l(q,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(d){return 1<d.features.length},onExecute:function(d,b){var c,a;c={layerDefinition:{geometryType:b.geometryType,fields:e.clone(b.fields),
objectIdField:b.objectIdField},featureSet:d.toJson()};c=new n(c);(a=b._json?m.parse(b._json):null)&&a.drawingInfo&&a.drawingInfo.renderer?(a=a.drawingInfo.renderer,a=k.fromJson(a)):a=k.fromJson(b.renderer.toJson());c.setRenderer(a);(a=b.getSelectionSymbol())&&c.setSelectionSymbol(p.fromJson(a.toJson()));this._popupAddLayer(c)},_popupAddLayer:function(d){var b,c=g.create("div",{style:"padding: 0 10px 0 10px;"}),a=(new s({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(c);g.setStyle(a.searchBtn,
"display","none");var f=new r({content:c,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:e.hitch(this,function(){d.name=u.stripHTML(a.getValue());this._addLayerToMap(d);f.close();b&&b.remove&&b.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:e.hitch(this,function(){f.close();b&&b.remove&&b.remove()})}]});a.inputSearch.focus();f.disableButton(0);b=h(a.inputSearch,"keyup",function(){a.getValue()?
f.enableButton(0):f.disableButton(0)})},_addLayerToMap:function(d){var b=t.getInstanceSync(),c=h(b,"layerInfosChanged",e.hitch(this,function(a){d.id===a.id&&a.loadInfoTemplate().then(e.hitch(this,function(){a.enablePopup();c.remove()}))}));this.map.addLayer(d)}})});