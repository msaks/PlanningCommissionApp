// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/LoadingIndicator esri/config esri/tasks/GeometryService".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p){function t(b){var a=e.clone(b),f=c.widgetProperties;delete a.mode;c.visitElement(a,function(b,u){b.widgets?(delete b.isOnScreen,delete b.gid,"jimu.js/images/group_icon.png"===
b.icon&&delete b.icon,delete b.openType,u.isOnScreen&&b.panel&&c.isEqual(b.panel,a.widgetOnScreen.panel)&&delete b.panel):(b.icon&&b.icon===b.amdFolder+"images/icon.png"&&delete b.icon,delete b.panel,delete b.folderUrl,delete b.amdFolder,delete b.thumbnail,delete b.configFile,delete b.gid,delete b.isOnScreen,delete b.isRemote,f.forEach(function(c){delete b[c]}),b.visible&&delete b.visible,delete b.manifest,b.isDefaultConfig&&(delete b.config,delete b.isDefaultConfig))});delete a.rawAppConfig;delete a._ssl;
delete a.getConfigElementById;delete a.getConfigElementsByName;delete a.processNoUriWidgets;delete a.addElementId;delete a.getCleanConfig;delete a.visitElement;delete a.agolConfig;delete a._itemData;delete a.oldWabVersion;return a}var b=null,v;v=m(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(b){this.urlParams=b||{};this.listenBuilderEvents();this.versionManager=new a;this.widgetManager=g.getInstance();this.configLoader=s.getInstance(this.urlParams,
{versionManager:this.versionManager});"config"===this.urlParams.mode&&(window.parent.setConfigViewerTopic&&e.isFunction(window.parent.setConfigViewerTopic))&&window.parent.setConfigViewerTopic(d);"preview"===this.urlParams.mode&&(window.parent.setPreviewViewerTopic&&e.isFunction(window.parent.setPreviewViewerTopic))&&window.parent.setPreviewViewerTopic(d);c.isMobileUa()||n(window,"resize",e.hitch(this,this._onWindowResize));n(window,"orientationchange",e.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){d.subscribe("builder/widgetChanged",
e.hitch(this,this._onWidgetChanged));d.subscribe("builder/groupChanged",e.hitch(this,this._onGroupChanged));d.subscribe("builder/widgetPoolChanged",e.hitch(this,this._onWidgetPoolChanged));d.subscribe("builder/openAtStartChange",e.hitch(this,this._onOpenAtStartChanged));d.subscribe("builder/mapChanged",e.hitch(this,this._onMapChanged));d.subscribe("builder/mapOptionsChanged",e.hitch(this,this._onMapOptionsChanged));d.subscribe("builder/appAttributeChanged",e.hitch(this,this._onAppAttributeChanged));
d.subscribe("builder/setAppConfig",e.hitch(this,this._onAppConfigSet));d.subscribe("builder/themeChanged",e.hitch(this,this._onThemeChanged));d.subscribe("builder/layoutChanged",e.hitch(this,this._onLayoutChanged));d.subscribe("builder/styleChanged",e.hitch(this,this._onStyleChanged));d.subscribe("builder/syncExtent",e.hitch(this,this._onSyncExtent));d.subscribe("builder/loadingPageChanged",e.hitch(this,this._onLoadingPageChanged));d.subscribe("builder/templateConfigChanged",e.hitch(this,this._onTemplateConfigChanged));
d.subscribe("builder/appProxyForMapChanged",e.hitch(this,this._onAppProxyForMapChanged));d.subscribe("builder/appProxyForUrlChanged",e.hitch(this,this._onAppProxyForUrlChanged))},loadConfig:function(){if(!("preview"===this.urlParams.mode||"config"===this.urlParams.mode)){var b=new q;b.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(e.hitch(this,function(c){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(c);window.appInfo.isRunInMobile=
this._isRunInMobile();console.timeEnd("Load Config");c=this.getAppConfig();b.destroy();d.publish("appConfigLoaded",c);return c}),e.hitch(this,function(b){console.error(b);b&&(b.message&&"string"===typeof b.message)&&this._showErrorMessage(b.message)}))}},_showErrorMessage:function(b){k.create("div",{"class":"app-error",innerHTML:b},document.body)},getAppConfig:function(){var b;window.appInfo.isRunInMobile?(b=e.clone(this._getMobileConfig(this.appConfig)),b._originConfig=e.clone(this.appConfig)):b=
e.clone(this.appConfig);b.getConfigElementById=function(b){return c.getConfigElementById(this,b)};b.getConfigElementsByName=function(b){return c.getConfigElementsByName(this,b)};b.getCleanConfig=function(){return this._originConfig?t(this._originConfig):t(this)};b.visitElement=function(b){c.visitElement(this,b)};return b},_onOrientationChange:function(){this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var b=this._isRunInMobile();window.appInfo.isRunInMobile!==
b&&(window.appInfo.isRunInMobile=b,this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var b=k.getMarginBox(window.jimuConfig.layoutId);if(b.w<=window.jimuConfig.breakPoints[0]||b.h<=window.jimuConfig.breakPoints[0])return k.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;k.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(b){return c.mixinAppConfigPosition(b,b.mobileLayout)},_onWidgetChanged:function(b){var a=
c.reCreateObject(b);b=c.getConfigElementById(this.appConfig,b.id);!1===a.inPanel&&!b.uri&&(a.closeable=!0);for(var f in a)b[f]=a[f];delete b.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetChange",a)},_onGroupChanged:function(b){var a=c.reCreateObject(b);b=c.getConfigElementById(this.appConfig,b.id);for(var f in a)b[f]=a[f];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
d.publish("appConfigChanged",this.getAppConfig(),"groupChange",a)},_onWidgetPoolChanged:function(b){var a=c.reCreateObject(b);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=a.widgets,this.appConfig.widgetPool.groups=a.groups):(b=c.getConfigElementById(this.appConfig,a.controllerId),h.forEach(b.controlledWidgets,function(b){this._removeWidgetOrGroupFromPoolById(this.appConfig,b)},this),h.forEach(b.controlledGroups,function(b){this._removeWidgetOrGroupFromPoolById(this.appConfig,
b)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?a.widgets:this.appConfig.widgetPool.widgets.concat(a.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?a.groups:this.appConfig.widgetPool.groups.concat(a.groups),this.configLoader.addNeedValues(this.appConfig),b.controlledWidgets=h.map(a.widgets,function(b){return b.id}),b.controlledGroups=h.map(a.groups,function(b){return b.id}));this.configLoader.addNeedValues(this.appConfig);
this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(e.hitch(this,function(b){this.appConfig=b;this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",a)}))},_removeWidgetOrGroupFromPoolById:function(b,a){h.some(b.widgetPool.widgets,function(c,f){if(c.id===a)return b.widgetPool.widgets.splice(f,1),!0});h.some(b.widgetPool.groups,function(c,f){if(c.id===a)return b.widgetPool.groups.splice(f,1),!0})},_onOpenAtStartChanged:function(b){var a=
c.reCreateObject(b),f=this.appConfig;b.isOnScreen?(f=f.widgetOnScreen&&f.widgetOnScreen.widgets)&&0<f.length&&h.forEach(f,e.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})):((f=f.widgetPool)&&(f.groups&&0<f.groups.length)&&h.forEach(f.groups,e.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})),f&&(f.widgets&&0<f.widgets.length)&&h.forEach(f.widgets,e.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})));
d.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",a)},_onAppAttributeChanged:function(b){b=c.reCreateObject(b);e.mixin(this.appConfig,b);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"attributeChange",b)},_onLoadingPageChanged:function(b){b=c.reCreateObject(b);var a;"backgroundColor"in b?this.appConfig.loadingPage.backgroundColor=b.backgroundColor:
"backgroundImage"in b?(a=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=e.mixin(a,b.backgroundImage)):"loadingGif"in b&&(a=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=e.mixin(a,b.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",b)},_onAppProxyForMapChanged:function(b){b=c.reCreateObject(b);"appProxy"in
this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==b.mapItemId?this.appConfig.map.appProxy=b:h.forEach(b.proxyItems,e.hitch(this,function(b){h.some(this.appConfig.map.appProxy.proxyItems,function(a){if(a.sourceUrl===b.sourceUrl)return a.useProxy=b.useProxy,a.proxyUrl=b.proxyUrl||"",a.proxyId=b.proxyId||"",!0})})):this.appConfig.map.appProxy=b;d.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",b)},_onAppProxyForUrlChanged:function(b){b=c.reCreateObject(b);this.appConfig.appProxies=
b;d.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",b)},_onTemplateConfigChanged:function(b){b=c.reCreateObject(b);this.appConfig.templateConfig=b;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",b)},_onMapChanged:function(b){var a=c.reCreateObject(b);this.appConfig.map.mapOptions&&c.deleteMapOptions(this.appConfig.map.mapOptions);e.mixin(this.appConfig.map,a);this.configLoader.addNeedValues(this.appConfig);
this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(e.hitch(this,function(b){this.appConfig=b;this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"mapChange",a)}))},_onMapOptionsChanged:function(b){b=c.reCreateObject(b);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});e.mixin(this.appConfig.map.mapOptions,b);d.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",b)},_onThemeChanged:function(b){this._getAppConfigFromTheme(b).then(e.hitch(this,
function(a){this.appConfig=a;d.publish("appConfigChanged",this.getAppConfig(),"themeChange",b.getName())}))},_onLayoutChanged:function(b){this.appConfig=c.mixinAppConfigPosition(this.appConfig,b.layoutConfig);this._addDefaultPanelAndPosition(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"layoutChange",b.name)},_onStyleChanged:function(b){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,b.name);b.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:b.styleColor}:
delete this.appConfig.theme.customStyles;d.publish("appConfigChanged",this.getAppConfig(),"styleChange",b.name)},_onSyncExtent:function(b){d.publish("syncExtent",b)},_genStyles:function(b,a){var c=[];c.push(a);h.forEach(b,function(b){0>c.indexOf(b)&&c.push(b)});return c},_getAppConfigFromTheme:function(b){var a=new l,c,f=[],f=this.getAppConfig().getCleanConfig();f.mode=this.urlParams.mode;h.forEach(f.widgetPool.groups,function(b){delete b.panel},this);if(b.appConfig)c=e.clone(b.appConfig),c.map=f.map,
c.map.position=b.appConfig.map.position,this._copyPoolToThemePool(f,c),c.links=f.links,c.title=f.title,c.subtitle=f.subtitle,c.logo=f.logo;else{var g=b.getCurrentLayout(),p=b.getCurrentStyle();c=e.clone(f);g=e.clone(g.layoutConfig);c.widgetOnScreen=g.widgetOnScreen;g.widgetPool&&(h.forEach(g.widgetPool.widgets,function(b){b.isPreconfiguredInTheme=!0}),h.forEach(g.widgetPool.groups,function(b){b.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(f,g);c.widgetPool=g.widgetPool;g.map&&g.map.position&&
(c.map.position=g.map.position);c.mobileLayout=g.mobileLayout;f=this._genStyles(h.map(b.getStyles(),function(b){return b.name}),p.name);c.theme={name:b.getName(),styles:f,version:b.getVersion()}}this.configLoader.addNeedValues(c);this.configLoader.loadWidgetsManifest(c).then(e.hitch(this,function(b){return this.configLoader.loadAndUpgradeAllWidgetsConfig(b)})).then(e.hitch(this,function(){this._addDefaultValues(c);a.resolve(c)}));return a},_copyPoolToThemePool:function(b,a){var c=b.widgetPool;a.widgetPool||
(a.widgetPool={});var f=a.widgetPool,g=h.filter(f.widgets,function(b){if(b.isPreconfiguredInTheme||!h.some(c.widgets,function(a){return a.name===b.name}))return!0}),p=h.filter(f.groups,function(b){return b.isPreconfiguredInTheme}),d=h.filter(c.widgets,function(b){return!b.isPreconfiguredInTheme}),t=h.filter(c.groups,function(b){return!b.isPreconfiguredInTheme}),d=this._getPoolWidgetsWithoutDuplicated(d,a.widgetOnScreen.widgets||[]);f.widgets=d.concat(g);f.groups=t.concat(p)},_getPoolWidgetsWithoutDuplicated:function(b,
a){for(var f=e.clone(b),g=this.getAppConfig(),p=b.length-1;0<=p;p--)for(var d=a.length-1;0<=d;d--)if(a[d].uri){var t=a[d].name;t||(t=c.getWidgetNameFromUri(a[d].uri));var q=g.getConfigElementById(b[p].id);b[p]&&(b[p].name===t&&!1===q.supportMultiInstance)&&(console.log("Widget",b[p].name,"is not copied to new theme because this widget exists in new theme."),f.splice(p,1))}return f},_onAppConfigSet:function(b){b=c.reCreateObject(b);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(b);
this.configLoader.addNeedValues(b);this.configLoader.loadAndUpgradeAllWidgetsConfig(b).then(e.hitch(this,function(b){this._addDefaultValues(b);r.setPortalUrl(b.portalUrl);this.appConfig?(c.deleteMapOptions(b.map.mapOptions),this.appConfig=b,d.publish("appConfigChanged",this.getAppConfig(),"resetConfig",b)):(this.appConfig=b,d.publish("appConfigLoaded",this.getAppConfig()))}))},_addDefaultValues:function(b){this._addDefaultPortalUrl(b);this._addDefaultGeometryService(b);this._addDefaultStyle(b);this._addDefaultMap(b);
this._addDefaultVisible(b);"undefined"===typeof b.widgetOnScreen&&(b.widgetOnScreen={});"undefined"===typeof b.widgetPool&&(b.widgetPool={});this._addDefaultPanelAndPosition(b);this._addDefaultOfWidgetGroup(b);(b.widgetPool.widgets&&0<b.widgetPool.widgets.length&&void 0===b.widgetPool.widgets[0].index||b.widgetPool.groups&&0<b.widgetPool.groups.length&&void 0===b.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(b);return b},_addDefaultPortalUrl:function(b){"undefined"===typeof b.portalUrl&&
(b.portalUrl="http://www.arcgis.com/");b.portalUrl&&"/"!==b.portalUrl.substr(b.portalUrl.length-1)&&(b.portalUrl+="/")},_addDefaultGeometryService:function(b){var a=b&&b.geometryService,a=a&&"string"===typeof a&&e.trim(a)?e.trim(a):this.portalSelf.helperServices.geometry.url;b.geometryService=a;f.defaults.geometryService=new p(b.geometryService)},_addDefaultStyle:function(b){if(b.theme&&(!b.theme.styles||0===b.theme.styles.length))b.theme.styles=["default"]},_addDefaultMap:function(b){b.map.id="map";
"undefined"===typeof b.map["3D"]&&"undefined"===typeof b.map["2D"]&&(b.map["2D"]=!0);"undefined"===typeof b.map.position&&(b.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof b.map.portalUrl&&(b.map.portalUrl=b.portalUrl)},_addDefaultVisible:function(b){c.visitElement(b,function(b){void 0===b.visible&&(b.visible=!0)})},_addDefaultPanelAndPosition:function(b){this._addOnScreenDefaultPanelAndPosition(b);this._addPoolDefaultPanelAndPosition(b)},_addOnScreenDefaultPanelAndPosition:function(b){var a,
c;if(b=b.widgetOnScreen){a=b.panel&&b.panel.positionRelativeTo?b.panel.positionRelativeTo:"map";"undefined"===typeof b.panel||"undefined"===typeof b.panel.uri?b.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:"undefined"===typeof b.panel.position?b.panel.position={relativeTo:a}:"undefined"===typeof b.panel.position.relativeTo&&(b.panel.position.relativeTo=a);if(b.widgets)for(a=0;a<b.widgets.length;a++)b.widgets[a].position||(b.widgets[a].position={}),b.widgets[a].position.relativeTo||
(b.widgets[a].position.relativeTo=b.widgets[a]&&b.widgets[a].positionRelativeTo?b.widgets[a].positionRelativeTo:"map"),!0===b.widgets[a].inPanel&&!b.widgets[a].panel&&(b.widgets[a].panel=e.clone(b.panel),b.widgets[a].panel.position=b.widgets[a].position,b.widgets[a].panel.position.relativeTo=b.widgets[a].position.relativeTo);if(b.groups)for(a=0;a<b.groups.length;a++){b.groups[a].panel||(b.groups[a].panel=b.panel);b.groups[a].panel&&!b.groups[a].panel.position&&(b.groups[a].panel.position={});b.groups[a].panel.position.relativeTo||
(b.groups[a].panel.position.relativeTo=b.groups[a].panel.positionRelativeTo?b.groups[a].panel.positionRelativeTo:"map");b.groups[a].widgets||(b.groups[a].widgets=[]);for(c=0;c<b.groups[a].widgets.length;c++)b.groups[a].widgets[c].panel=b.groups[a].panel}}},_addPoolDefaultPanelAndPosition:function(b){var a,c,f=b.widgetPool;if(f){a=f.panel&&f.panel.positionRelativeTo?f.panel.positionRelativeTo:"map";"undefined"===typeof f.panel||"undefined"===typeof f.panel.uri?f.panel={uri:"jimu/OnScreenWidgetPanel",
position:{relativeTo:a}}:"undefined"===typeof f.panel.position?f.panel.position={relativeTo:a}:"undefined"===typeof f.panel.position.relativeTo&&(f.panel.position.relativeTo=a);if(f.groups)for(a=0;a<f.groups.length;a++){f.groups[a].panel?f.groups[a].panel.position.relativeTo||(f.groups[a].panel.position.relativeTo=f.groups[a].panel.positionRelativeTo?f.groups[a].panel.positionRelativeTo:"map"):f.groups[a].panel=f.panel;f.groups[a].widgets||(f.groups[a].widgets=[]);for(c=0;c<f.groups[a].widgets.length;c++)f.groups[a].widgets[c].panel=
f.groups[a].panel}if(f.widgets)for(a=0;a<f.widgets.length;a++)!1===f.widgets[a].inPanel?(c=f.widgets[a].positionRelativeTo?f.widgets[a].positionRelativeTo:"map",f.widgets[a].position?f.widgets[a].position.relativeTo||(f.widgets[a].position.relativeTo=c):f.widgets[a].position={relativeTo:c}):f.widgets[a].panel||(f.widgets[a].panel=b.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(b){c.visitElement(b,e.hitch(this,function(b,a){b.isOnScreen=a.isOnScreen;b.widgets?(b.gid=b.id,1===b.widgets.length?
(b.label||(b.label=b.widgets[0].label?b.widgets[0].label:"Group"),b.icon||(b.icon=b.widgets[0].uri?this._getDefaultIconFromUri(b.widgets[0].uri):"jimu.js/images/group_icon.png")):(b.icon=b.icon?b.icon:"jimu.js/images/group_icon.png",b.label=b.label?b.label:"Group_"+a.index)):(b.gid=a.groupId,b.uri&&c.widgetJson.processWidgetJson(b))}))},_getDefaultIconFromUri:function(b){b=b.split("/");b.pop();return b.join("/")+"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(b){var a=
0,f,c;if(b.widgetPool.widgets)for(f=0;f<b.widgetPool.widgets.length;f++)b.widgetPool.widgets[f].index=a,a++;if(b.widgetPool.groups)for(f=0;f<b.widgetPool.groups.length;f++){b.widgetPool.groups[f].index=a;a++;for(c=0;c<b.widgetPool.groups[f].widgets.length;c++)b.widgetPool.groups[f].widgets[c].index=c}}});v.getInstance=function(a){null===b?b=new v(a):a&&(b.urlParams=a,b.configLoader&&(b.configLoader.urlParams=a));window.getAppConfig=e.hitch(b,b.getAppConfig);return b};return v})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/graphicsUtils jimu/portalUrlUtils ./shared/utils".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z,A,C,w,F,D,B,G,I,K,Q,N,O,J){function H(b,a){b=b||"";for(var f=0,c=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!y.file.isEnabledFlash(),failure:[b+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){f++;f===c.length&&a()}}],g=0;g<c.length;g++)testLoad(c[g])}function P(b,a){var f=b.match(/url\([^)]+\)/gi),c,g;if(null===f||""===a)return b;for(c=0;c<f.length;c++)if(g=f[c].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=g.length){var p=
g[2];a.endWith("/")||(a+="/");b=b.replace(g[1]+p+g[3],g[1]+a+p+g[3])}return b}function L(b,a){var f=Array.isArray(a),c=f&&[]||{};f?(b=b||[],c=c.concat(b),a.forEach(function(a,f){"undefined"===typeof b[f]?c[f]=a:"object"===typeof a?c[f]=L(b[f],a):-1===b.indexOf(a)&&c.push(a)})):(b&&"object"===typeof b&&Object.keys(b).forEach(function(a){c[a]=b[a]}),Object.keys(a).forEach(function(f){c[f]="object"!==typeof a[f]||!a[f]?a[f]:b[f]?L(b[f],a[f]):a[f]}));return c}function M(b,a,f){a=function(b){var a=[];
b.split("_").forEach(function(b){var f=!1,c;"--"===b.slice(b.length-2)&&(f=!0,b=b.slice(0,b.length-2));c=b.search(/\[[0-9]+\]/);-1===c&&(c=b.length);a.push({key:b.slice(0,c),index:Number(b.slice(c+1,-1)),deleteFlag:f})});return a}(a);for(var c=1;c<a.length-1;c++)if(b=m.isArray(b[a[c].key])?b[a[c].key][a[c].index]:b[a[c].key],!b)return;if(a[a.length-1].deleteFlag)!0===f&&(m.isArray(b[a[a.length-1].key])?delete b[a[a.length-1].key][a[a.length-1].index]:delete b[a[a.length-1].key]);else if(m.isArray(b[a[a.length-
1].key])){if(void 0===f)return b[a[a.length-1].key][a[a.length-1].index];b[a[a.length-1].key][a[a.length-1].index]=f}else{if(void 0===f)return b[a[a.length-1].key];b[a[a.length-1].key]=f}}function E(b,a,f){function c(f){f=y.template.getSearchRange(a,f,"]");var g=a.slice(f.firstPos,f.lastPos);return-1!==f.firstPos?(g=a.slice(f.firstPos+g.indexOf("[")+1,f.lastPos-1),f=a.slice(f.lastPos+1),(g=y.getConfigElementById(b,g))?{object:g,key:"section_"+f,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}
var g=b,p=a=a.replace(/\//g,"_"),d=c("groups\\[.+\\]");if("deleted"!==d.state&&("isSection"===d.state&&(g=d.object,p=d.key),d=c("widgets\\[.+\\]"),"delete"!==d.state))return"isSection"===d.state&&(g=d.object,p=d.key),M(g,p,f)}var y={},T={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};m.mixin(y,J);window.atob||(window.atob=function(b){b=t.decode(b);for(var a="",f=0,c=b.length;f<c;f++)a+=String.fromCharCode(b[f]);return a});window.btob||(window.btob=
function(b){for(var a=[],f=0,c=b.length;f<c;f++)a.push(String.charCodeAt(b[f]));return t.encode(a)});var S="unload",$=[];require.on("error",function(b){e.forEach($,function(a){b.info[0]&&-1<b.info[0].indexOf(a.resKey)&&a.def.reject(b);for(var f in b.info)-1<f.indexOf(a.resKey)&&a.def.reject(b)})});y.checkError=function(b,a){$.push({resKey:b,def:a})};y.replacePlaceHolder=function(b,a){var f=s.stringify(b),c=f.match(/\$\{(\w)+\}/g),g;if(null===c)return b;for(g=0;g<c.length;g++){var p=c[g].match(/(\w)+/g)[0];
a[p]&&(f=f.replace(c[g],a[p]))}return s.parse(f)};y.changeUnit=function(b){var a=Math.abs(b),f;b=Math.floor(a);f=Math.floor(60*(a-b));a=(60*(60*(a-b)-f)).toFixed(2);return b+"\u00b0"+(10>f?"0"+f:f)+"'"+(10>a?"0"+a:a)+'"'};y.formatTime=function(b){var a=b/1E3;b=Math.floor(a/60);a=Number(a-60*b).toFixed(1);return(10>b?"0"+b:b)+":"+(10>a?"0"+a:a)};y.parseTime=function(b){var a=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!a.test(b))return console.log("wrong time format."),-1;b=b.match(a);return 1E3*(60*parseInt(b[1],
10)+parseInt(b[2],10)+parseInt(b[3],10)/10)};y.preloadImg=function(b,a){var f=[],f="string"===typeof b?[b]:b;e.forEach(f,function(b){(new Image).src=a?a+b:b})};var W=null;y.getImagesSize=function(b){var f=new g;if(!b||0!==b.indexOf("http"))return f.reject(),f;null===W&&(W=h.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var c=a(W,"load",function(){clearTimeout(p);p=null;c.remove();var b=h.getContentBox(W);1===b.w&&1===b.h||0===b.w||0===
b.h?f.reject():f.resolve([b.w,b.h])},{}),p=setTimeout(function(){clearTimeout(p);p=null;f.reject()},5E3);h.setAttr(W,"src",b);return f};y.getPositionStyle=function(b){var a={};if(!b)return a;b=m.clone(b);if(window.isRTL){var f;"undefined"!==typeof b.left&&"undefined"!==typeof b.right?(f=b.left,b.left=b.right,b.right=f):"undefined"!==typeof b.left?(b.right=b.left,delete b.left):"undefined"!==typeof b.right&&(b.left=b.right,delete b.right);"undefined"!==typeof b.paddingLeft&&"undefined"!==typeof b.paddingRight?
(f=b.paddingLeft,b.paddingLeft=b.paddingRight,b.paddingRight=f):"undefined"!==typeof b.paddingLeft?(b.paddingRight=b.paddingLeft,delete b.paddingLeft):"undefined"!==typeof b.paddingRight&&(b.paddingLeft=b.paddingRight,delete b.paddingRight)}f="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var c=0;c<f.length;c++){var g=f[c];"number"===typeof b[g]?a[g]=b[g]+"px":"undefined"!==typeof b[g]?a[g]=b[g]:"padding"===g.substr(0,7)?a[g]=0:a[g]="auto"}a.zIndex=
"undefined"===typeof b.zIndex?"auto":b.zIndex;return a};y.isEqual=function(b,a){function f(b,a){var p;if(null===b&&null===a||"undefined"===typeof b&&"undefined"===typeof a)return!0;if(null===b&&null!==a||null===a&&null!==b||"undefined"===typeof b&&"undefined"!==typeof a||"undefined"===typeof a&&"undefined"!==typeof b)return!1;if(isNaN(b)&&isNaN(a)&&"number"===typeof b&&"number"===typeof a||b===a)return!0;if("function"===typeof b&&"function"===typeof a||b instanceof Date&&a instanceof Date||b instanceof
RegExp&&a instanceof RegExp||b instanceof String&&a instanceof String||b instanceof Number&&a instanceof Number)return b.toString()===a.toString();if(-1<c.indexOf(b)||-1<g.indexOf(a))return!1;if(null!==a){for(p in a)if(a.hasOwnProperty(p)!==b.hasOwnProperty(p)||typeof a[p]!==typeof b[p])return!1;for(p in b){if(a.hasOwnProperty(p)!==b.hasOwnProperty(p)||typeof a[p]!==typeof b[p])return!1;switch(typeof b[p]){case "object":case "function":c.push(b);g.push(a);if(!f(b[p],a[p]))return!1;c.pop();g.pop();
break;default:if(isNaN(b[p])&&isNaN(a[p])&&"number"===typeof b[p]&&"number"===typeof a[p])return!0;if(b[p]!==a[p])return!1}}}return!0}var c,g;c=[];g=[];return!f(b,a)?!1:!0};y.file={loadFileAPI:function(){var b=new g;if("unload"===S){var a=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:a+"libs/polyfills/fileAPI/",flashUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};H(a,m.hitch(this,function(){S="loaded";
b.resolve()}));S="loading"}else"loaded"===S&&b.resolve();return b},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return k("safari")&&6>k("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var b=null;if(document.all)try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(a){b=null}else navigator.plugins&&0<navigator.plugins.length&&(b=navigator.plugins["Shockwave Flash"]);return!!b},
containSeparator:function(b){return 0<=b.indexOf("/")?!0:0<=b.indexOf("\\")?!0:!1},getNameFromPath:function(b){var a="",a=0<=b.indexOf("/")?"/":"\\";b=b.split(a);return 0<b.length?b[b.length-1]:null},getFolderFromPath:function(b){return b.substr(0,b.length-y.file.getNameFromPath(b).length)},readFile:function(b,a,f,c){if(this.supportHTML5()){var g=b.target.files[0];g&&(g.type.match(a)?g.size>=f?c({errCode:"exceed"}):(b=new FileReader,b.onload=function(b){c(null,g.name,b.target.result)},b.readAsDataURL(g)):
c({errCode:"invalidType"}))}else if(this.supportFileAPI()){var p=window.FileAPI.getFiles(b);p[0].type.match(a)?p[0].size>=f?c({errCode:"exceed"}):window.FileAPI.readAsDataURL(p[0],function(b){b&&b.result?c(null,p[0].name,b.result):c({errCode:"readError"})}):c({errCode:"invalidType"})}}};y.widgetJson=function(){function b(a){var f,c={};f=a.indexOf("/");a.substring(0,f);a=a.substring(0,a.lastIndexOf("/")+1);c.folderUrl=require(y.getRequireConfig()).toUrl(a);c.amdFolder=a;return c}return{processWidgetJson:function(a){if(!a.uri)return a;
a.uri.toLowerCase().startWith("http")&&(a.isRemote=!0,a.uri.toLowerCase().endWith(".js")||(a.uri+=".js"));m.mixin(a,b(a.uri));a.icon||(a.icon=a.amdFolder+"images/icon.png?wab_dv\x3d"+window.deployVersion);a.thumbnail||(a.thumbnail=a.amdFolder+"images/thumbnail.png");return a},addManifest2WidgetJson:function(b,a){m.mixin(b,a.properties);b.name=a.name;b.label||(b.label=a.label);b.manifest=a;a.featureActions&&(b.featureActions=a.featureActions)},removeManifestFromWidgetJson:function(b){if(b.manifest){for(var a in b.manifest.properties)b[a]=
void 0;b.name=void 0;b.label=void 0;b.featureActions=void 0;b.manifest=void 0}}}}();y.getRequireConfig=function(){if(jimuConfig){var b=[];jimuConfig.widgetsPackage&&(b=b.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(b=b.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(b=b.concat(jimuConfig.configsPackage));return{packages:b}}return{}};y.getTypeByGeometryType=function(b){var a="",f="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),
c=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(b)?a="point":0<=f.indexOf(b)?a="polyline":0<=c.indexOf(b)&&(a="polygon");return a};y.getSymbolTypeByGeometryType=function(b){var a=null;b=y.getTypeByGeometryType(b);"point"===b?a="marker":"polyline"===b?a="line":"polygon"===b&&(a="fill");return a};y.getServices=function(){return T};y.getArcGISDefaultGeometryService=function(){return new D(T.geometryService)};y.restoreToDefaultWebMapExtent=
function(b,a,f){var c=new g;if(!(b&&"esri.Map"===b.declaredClass))return setTimeout(function(){c.reject("Invalid map.")},0),c;a=a&&a.itemInfo;if(!a)return setTimeout(function(){c.reject("Invalid itemInfo")},0),c;a=a.item&&a.item.extent;if(!a)return setTimeout(function(){c.reject("Invalid itemInfo.item.extent")}),c;var p=new x({wkid:4326}),p=new z(a[0][0],a[0][1],a[1][0],a[1][1],p);if(4326===parseInt(b.spatialReference.wkid,10))return b.setExtent(p);if(b.spatialReference.isWebMercator())return p=F.geographicToWebMercator(p),
b.setExtent(p);a=new B;a.geometries=[p];a.outSR=b.spatialReference;p=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;p&&"esri.tasks.GeometryService"===p.declaredClass||(f&&"string"===typeof f&&m.trim(f)?(f=m.trim(f),p=new D(f)):p=y.getArcGISDefaultGeometryService());p.project(a).then(function(a){if(a=a&&a[0])return b.setExtent(a);c.reject("Invalid projected geometry.");return c},function(b){console.error(b);c.reject(b);return c});return c};y.getAncestorWindow=function(){for(var b=
window;b&&b.parent&&b!==b.parent;)b=b.parent;return b};y.getAncestorDom=function(b,a,f){if(b&&1===b.nodeType&&a&&"function"===typeof a){var c=100,g=document.body;f&&("number"===typeof f?(f=parseInt(f,10),0<f&&(c=f)):1===f.nodeType&&(g=f));for(f=0;b.parentNode&&f<c&&h.isDescendant(b.parentNode,g);){if(a(b.parentNode))return b.parentNode;b=b.parentNode;f++}}return null};y.bindClickAndDblclickEvents=function(b,f,c,g){var p=null;if(b&&1===b.nodeType&&f&&"function"===typeof f&&c&&"function"===typeof c){var d=
200;g&&"number"===typeof g&&(g=parseInt(g,10),0<g&&(d=g));var t=0,p=a(b,"click",function(b){t++;1===t?setTimeout(function(){1===t&&(t=0,f(b))},d):2===t&&(t=0,c(b))})}return p};y.isScrollToBottom=function(b){var a=h.getContentBox(b);return 1>b.scrollHeight-(b.scrollTop+a.h)};y.getAllItemTypes=function(){var b=[],b=b.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return b=b.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};y.getItemQueryStringByTypes=function(b){var a="",f=y.getAllItemTypes();if(b&&0<b.length&&0<b.length){var c="";e.forEach(b,function(a,f){c+=' type:"'+a+'" ';f!==b.length-1&&(c+=" OR ")});a=" ( "+c+" ) ";f=b.concat(f);f=e.filter(f,function(a){return e.every(b,
function(b){return 0>b.toLowerCase().indexOf(a.toLowerCase())})});e.forEach(f,function(b){a+=' -type:"'+b+'" '})}return a};y.getItemQueryStringByTypeKeywords=function(b){var a="";b&&0<b.length&&(a=' typekeywords:"'+b.join(",")+'" ');return a};y.isNotEmptyString=function(b,a){var f=b&&"string"===typeof b;return f?a?f&&m.trim(b):!0:!1};y.isValidNumber=function(b){return"number"===typeof b&&!isNaN(b)};y.isObject=function(b){return b&&"object"===typeof b};y.createWebMap=function(b,a,f,c){b=O.getStandardPortalUrl(b);
b=O.getBaseItemUrl(b);v.arcgisUrl=b;return v.createMap(a,f,c)};y.getRandomString=function(){var b=Math.random().toString();return b=b.slice(2,b.length)};y._getDomainsByServerName=function(b){var a=b.split("."),f=a.length;return e.map(a,m.hitch(this,function(b,c){var g=a.slice(c,f),p="",d=g.length-1;e.forEach(g,m.hitch(this,function(b,a){p+=b;a!==d&&(p+=".")}));return p}))};y.removeCookie=function(b,a){var f=this._getDomainsByServerName(window.location.hostname);e.forEach(f,m.hitch(this,function(f){r(b,
null,{expires:-1,path:a});r(b,null,{expires:-1,path:a,domain:f});r(b,null,{expires:-1,path:a,domain:"."+f})}))};y.isLocaleChanged=function(b,a){return!b.startWith(a)};y.hashToObject=function(b){b=b.replace("#","");b=l.queryToObject(b);for(var a in b)if(b.hasOwnProperty(a))try{b[a]=s.parse(b[a])}catch(f){}return b};y.reCreateObject=function(b){function a(b){var c=[];b.forEach(function(b){Array.isArray(b)?c.push(a(b)):"object"===typeof b?c.push(f(b)):c.push(b)});return c}function f(b){var c={},g;for(g in b)b.hasOwnProperty(g)&&
(null===b[g]?c[g]=null:Array.isArray(b[g])?c[g]=a(b[g]):c[g]="object"===typeof b[g]?f(b[g]):b[g]);return c}return Array.isArray(b)?a(b):f(b)};y.setVerticalCenter=function(b){setTimeout(function(){var a=n(".jimu-vcenter-text",b),f,c;e.forEach(a,function(b){f=h.getContentBox(b).h;h.setStyle(b,{lineHeight:f+"px"})},this);a=n(".jimu-vcenter",b);e.forEach(a,function(b){f=h.getContentBox(b).h;c=h.getContentBox(n(b).parent()[0]).h;h.setStyle(b,{marginTop:(c-f)/2+"px"})},this)},10)};y.merge=L;y.loadStyleLink=
function(b,f,c){var p=new g,d,t=require(y.getRequireConfig()).toUrl(f);if(require.cache["url:"+t]){d=require.cache["url:"+t];var u=t.split("/").pop(),t=t.substr(0,t.length-u.length);d=P(d,t);b=c?h.create("style",{id:b,type:"text/css"},h.byId(c),"before"):h.create("style",{id:b,type:"text/css"},document.getElementsByTagName("head")[0]);b.styleSheet&&!b.sheet?b.styleSheet.cssText=d:b.appendChild(h.toDom(d));p.resolve("load");return p}d=c?h.create("link",{id:b,rel:"stylesheet",type:"text/css",href:t+
"?wab_dv\x3d"+window.deployVersion},h.byId(c),"before"):h.create("link",{id:b,rel:"stylesheet",type:"text/css",href:t+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);a(d,"load",function(){p.resolve("load")});var q=setInterval(function(){var b;if(e.some(document.styleSheets,function(a){if(a.href&&a.href.substr(a.href.indexOf(f),a.href.length)===f)return b=a,!0}))try{!p.isFulfilled()&&(b.cssRules&&b.cssRules.length||b.rules&&b.rules.length)&&p.resolve("load"),clearInterval(q)}catch(a){}},
50);return p};y.changeLocation=function(b){window.history.pushState&&window.history.pushState({path:b},"",b)};y.urlToObject=function(b){var a=null;-1===b.indexOf("#")?(a=K.urlToObject(b),a.hash=null):(b=b.split("#"),a=K.urlToObject(b[0]),a.hash=b[1]?-1<b[1].indexOf("\x3d")?l.queryToObject(b[1]):b[1]:null);return a};y.manifest=function(){function b(a){a.panels.forEach(function(b){b.uri="panels/"+b.name+"/Panel.js"});a.styles.forEach(function(b){b.uri="styles/"+b.name+"/style.css"});a.layouts.forEach(function(b){b.uri=
"layouts/"+b.name+"/config.json";b.icon="layouts/"+b.name+"/icon.png";b.RTLIcon="layouts/"+b.name+"/icon_rtl.png"})}return{addManifestProperies:function(a){a.icon=a.url+"images/icon.png?wab_dv\x3d"+window.deployVersion;"theme"===a.category?b(a):("undefined"!==typeof a["2D"]&&(a.support2D=a["2D"]),"undefined"!==typeof a["3D"]&&(a.support3D=a["3D"]),"undefined"===typeof a["2D"]&&"undefined"===typeof a["3D"]&&(a.support2D=!0),delete a["2D"],delete a["3D"],"undefined"===typeof a.properties&&(a.properties=
{}),J.processWidgetProperties(a))},processManifestLabel:function(b,a){var f=a.split("-")[0];b.label=b.i18nLabels&&(b.i18nLabels[a]||b.i18nLabels[f]||b.i18nLabels.defaultLabel)||b.label||b.name;b.layouts&&e.forEach(b.layouts,function(f){var c="i18nLabels_layout_"+f.name;f.label=b[c]&&(b[c][a]||b[c].defaultLabel)||f.label||f.name});b.styles&&e.forEach(b.styles,function(f){var c="i18nLabels_style_"+f.name;f.label=b[c]&&(b[c][a]||b[c].defaultLabel)||f.label||f.name})},addI18NLabel:function(b){var a=new g;
if(b.i18nLabels)return a.resolve(b),a;b.i18nLabels={};if(b.properties&&!1===b.properties.hasLocale)return a.resolve(b),a;var f;f=b.amdFolder.toLowerCase().startWith("http")?b.amdFolder+"nls/strings.js":b.amdFolder+"nls/strings";require(y.getRequireConfig(),["dojo/i18n!"+f],function(f){var c={};c[dojoConfig.locale]=f;J.addI18NLabelToManifest(b,null,c);a.resolve(b)});return a}}}();y.getUniqueValues=function(b,a){var f=new g,c=b.replace(/\/*$/g,"")+"/generateRenderer",p=s.stringify({type:"uniqueValueDef",
uniqueValueFields:[a]});Q({url:c,content:{classificationDef:p,f:"json"},handleAs:"json",callbackParamName:"callback"}).then(m.hitch(this,function(b){var a=[];(b=b&&b.uniqueValueInfos)&&0<b.length&&(a=e.map(b,m.hitch(this,function(b){return b.value})));f.resolve(a)}),m.hitch(this,function(b){f.reject(b)}));return f};y.combineRadioCheckBoxWithLabel=function(b,a){var f=!1;if(b&&1===b.nodeType&&"input"===b.tagName.toLowerCase()){var c=b.getAttribute("type")||"",c=c.toLowerCase();if("radio"===c||"checkbox"===
c)f=!0}c=!1;a&&(1===a.nodeType&&"label"===a.tagName.toLowerCase())&&(c=!0);f&&c&&(f=b.getAttribute("id"),f||(f="input_"+y.getRandomString(),b.setAttribute("id",f)),a.setAttribute("for",f),h.setStyle(a,"cursor","pointer"))};y.groupRadios=function(b,f){var c=[],g="radiogroup_"+y.getRandomString();e.forEach(b,function(b){b.name=g;f&&(b=a(b,"change",f),c.push(b))});return c};y.convertExtentToPolygon=function(b){var a=b.xmin,f=b.xmax,c=b.ymin,g=b.ymax;return new w({rings:[[[a,g],[f,g],[f,c],[a,c],[a,g]]],
spatialReference:b.toJson()})};y.combineGeometries=function(b){function a(b){var f={points:[],spatialReference:b[0].spatialReference.toJson()};e.forEach(b,function(b){"point"===b.type?f.points=f.points.concat([[b.x,b.y]]):"multipoint"===b.type&&(f.points=f.points.concat(b.points))});return new A(f)}function f(b){var a={paths:[],spatialReference:b[0].spatialReference.toJson()};e.forEach(b,function(b){a.paths=a.paths.concat(b.paths)});return new C(a)}function c(b){var a={rings:[],spatialReference:b[0].spatialReference.toJson()};
e.forEach(b,function(b){"polygon"===b.type?a.rings=a.rings.concat(b.rings):"extent"===b.type&&(b=y.convertExtentToPolygon(b),a.rings=a.rings.concat(b.rings))});return new w(a)}var g=null;if(b&&0<b.length)if(1===b.length)g=b[0];else{for(var p=null,d=null,t=null,u=null,q=0;q<b.length;q++){p=b[q];switch(p.type){case "point":case "multipoint":u="point";break;case "polyline":u="polyline";break;case "polygon":case "extent":u="polygon";break;default:return null}if(0===q)t=u;else if(t!==u)return null;if(q!==
b.length-1&&(d=b[q+1],!p.spatialReference.equals(d.spatialReference)))return null}"point"===u?g=a(b):"polyline"===u?g=f(b):"polygon"===u&&(g=c(b))}return g};y.combineGeometriesByGraphics=function(b){var a=null;b&&0<b.length&&(b=e.map(b,function(b){return b.geometry}),a=y.combineGeometries(b));return a};y.isFeaturelayerUrlSupportQuery=function(b,a){var f=!1,c=/\/featureserver\//gi.test(b),g=/\/mapserver\//gi.test(b);a=(a||"").toLowerCase();c?f=0<=a.indexOf("query"):g&&(f=0<=a.indexOf("data"));return f};
y.isImageServiceSupportQuery=function(b){return 0<=(b||"").toLowerCase().indexOf("catalog")};y.isStringEndWith=function(b,a){return b.lastIndexOf(a)+a.length===b.length};y.localizeNumber=function(b,a){var f=(b.toString().split(".")[1]||"").length,c="",c=a&&isFinite(a.places)&&a.places,c=0<c||0<f?"#,###,###,##0.0"+Array.prototype.join.call({length:0<c?c+1:f},"0"):"#,###,###,##0",f={locale:d.locale,pattern:c};m.mixin(f,a||{});try{return q.format(b,f)}catch(g){return console.error(g),b.toLocaleString()}};
y.parseNumber=function(b,a){var f={locale:d.locale};m.mixin(f,a||{});try{return q.parse(b,f)}catch(c){return console.error(c),b}};y.localizeDate=function(b,a){var c={locale:d.locale,fullYear:!0};m.mixin(c,a||{});try{return f.format(b,c)}catch(g){return console.error(g),"date"===c.selector?b.toLocaleDateString():"time"===c.selector?b.toLocaleTimeString():b.toLocaleString()}};y.localizeNumberByFieldInfo=function(b,a){var f=null,f=m.exists("format.places",a)&&a.format.places,f=y.localizeNumber(b,{places:f});
return m.exists("format.digitSeparator",a)&&!a.format.digitSeparator?f.toString().replace(RegExp("\\"+p.group,"g"),""):f};y.localizeDateByFieldInfo=function(a,f){var c=null;try{var g={date:a instanceof Date?a.getTime():a},p=m.exists("format.dateFormat",f)?f.format.dateFormat:"longMonthDayYear",c=b.substitute(g,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+u.prototype._dateFormats[p]}})}catch(d){console.error(d),c=a}return c};y.fieldFormatter={getFormattedUrl:function(b){if(b&&
"string"===typeof b){var a=b.indexOf("http:");-1===a&&(a=b.indexOf("https:"));if(-1<a&&-1===b.indexOf("href\x3d")){var f=b.indexOf(" ",a);-1===f&&(f=b.length);var c=b.substring(a,f);b=b.substring(0,a)+'\x3cA href\x3d"'+c+'" target\x3d"_blank"\x3e'+c+"\x3c/A\x3e"+b.substring(f,b.length)}}return b||""},getFormattedNumber:function(b,a){if("number"===typeof b){var f=(b.toString().split(".")[1]||"").length;b=y.localizeNumberByFieldInfo(b,{format:{places:a&&"number"===typeof a.places?parseInt(a.places,
10):f,digitSeparator:a&&a.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(b||"")+"\x3c/span\x3e"}return b},getFormattedDate:function(b,a){if("number"===typeof b||b instanceof Date)b=y.localizeDateByFieldInfo(b,{format:a});return b||""},getCodedValue:function(a,f){if(a&&a.codedValues){for(var c=0,g=a.codedValues.length;c<g;c++){var p=a.codedValues[c];if(b.isDefined(f)&&m.exists("code",p)&&f.toString()===p.code.toString())return p.name}return f}return f||null},getTypeName:function(b,
a){for(var f=a.length,c=0;c<f;c++)if(b===a[c].id)return a[c].name;return b}};y.addRelativePathInCss=P;y.url={isAbsolute:function(b){return!b?!1:b.startWith("http")||b.startWith("/")},removeQueryParamFromUrl:function(b,a){var f=K.urlToObject(b);f.query&&delete f.query[a];var c=f.path,g;for(g in f.query)c=c===f.path?c+"?"+g+"\x3d"+f.query[g]:c+"\x26"+g+"\x3d"+f.query[g];return c},addQueryParamToUrl:function(b,a,f){b=K.urlToObject(b);b.query||(b.query={});b.query[a]=f;a=b.path;for(var c in b.query)a=
a===b.path?a+"?"+c+"\x3d"+b.query[c]:a+"\x26"+c+"\x3d"+b.query[c];return a}};y.processUrlInWidgetConfig=function(b,a){if(b)return b.startWith("data:")||b.startWith("http")||b.startWith("/")?b:b.startWith("${appPath}")?b.replace("${appPath}",window.appInfo.appPath):a+b};y.processUrlInAppConfig=function(b){if(b)return b.startWith("data:")||b.startWith("http")||b.startWith("/")?b:window.appInfo.appPath+b};y.getLocationUrlWithoutHashAndQueryParams=function(){var b=window.location,a=b.protocol+"//"+b.host+
b.pathname,b=K.urlToObject(b.href);b.query&&b.query.apiurl&&(a=y.url.addQueryParamToUrl(a,"apiurl",b.query.apiurl));return a};y.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};y.invertColor=function(b){b=b.substring(1);3===b.length&&(b=b.slice(0,1)+b.slice(0,1)+b.slice(1,1)+b.slice(1,1)+b.slice(2,1)+b.slice(2,1));b=parseInt(b,16);return 7829367<b?"#000000":"#ffffff"};y.mixinAppConfigPosition=function(b,a){var f=m.clone(b);if(!a)return f;a=m.clone(a);var c=f.widgetOnScreen,
g=a.widgetOnScreen;g&&g.widgets&&("[object Object]"===Object.prototype.toString.call(g.widgets)?e.forEach(c.widgets,function(b,a){var f;f=b.uri?b.uri:"ph_"+a;g.widgets[f]&&g.widgets[f].position&&(g.widgets[f].position.relativeTo||(g.widgets[f].position.relativeTo="map"),b.position=g.widgets[f].position)},this):e.forEach(g.widgets,function(b,a){b.position&&!b.position.relativeTo&&(b.position.relativeTo="map");c.widgets[a]&&b.position&&(c.widgets[a].position=b.position)}));g&&g.groups&&("[object Object]"===
Object.prototype.toString.call(g.groups)?e.forEach(c.groups,function(b,a){var f;f=b.label?b.label:"g_"+a;g.groups[f]&&(g.groups[f].panel&&g.groups[f].panel.position)&&(g.groups[f].panel.position.relativeTo||(g.groups[f].panel.position.relativeTo="map"),b.panel.position=g.groups[f].panel.position)},this):e.forEach(g.groups,function(b,a){b.panel&&(b.panel.position&&!b.panel.position.relativeTo)&&(b.panel.position.relativeTo="map");c.groups[a]&&b.panel.position&&(c.groups[a].panel.position=b.panel.position)}));
a.map&&a.map.position&&(f.map?f.map.position=a.map.position:f.map={position:a.map.position});a.widgetPool&&a.widgetPool.panel&&(a.widgetPool.panel.position&&!a.widgetPool.panel.position.relativeTo&&(a.widgetPool.panel.position.relativeTo="map"),f.widgetPool.panel.position=a.widgetPool.panel.position);a.mobileLayout&&(f.mobileLayout=a.mobileLayout);return f};y.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(b,a,f){var c=-1;a=b.search(RegExp(a));
0<=a&&(b=b.slice(a,b.length),b=b.indexOf(f),c=a+b+f.length);return{firstPos:a,lastPos:c}},setConfigValue:function(b,a,f){M(b,a,f)},getConfigValue:function(b,a){return M(b,a)},setConfigValueWithId:function(b,a,f){E(b,a,f)},getConfigValueWithId:function(b,a){return E(b,a)},getKeyInfo:function(b){var a=this.getWidgetIdByKey(b);if(null!==a)return{type:"widget",id:a};b=this.getGroupIdByKey(b);return null!==b?{type:"group",id:b}:{type:"unknow",id:null}},getWidgetIdByKey:function(b){var a=y.template.getSearchRange(b,
y.template.widgetIdentification,"]");if(-1===a.firstPos)b=null;else{var f=b.slice(a.firstPos,a.lastPos);b=b.slice(a.firstPos+f.indexOf("[")+1,a.lastPos-1)}return b},getGroupIdByKey:function(b){var a=y.template.getSearchRange(b,y.template.groupIdentification,"]");if(-1===a.firstPos)b=null;else{var f=b.slice(a.firstPos,a.lastPos);b=b.slice(a.firstPos+f.indexOf("[")+1,a.lastPos-1)}return b},getConfigedWidgetsByTemplateConfig:function(b){var a=[],f=y.template.widgetIdentification+"_config",c;e.forEach(b.configurationSettings,
function(b){e.forEach(b.fields,function(b){b.fieldName&&(c=y.template.getSearchRange(b.fieldName,f,"]"),0<=c.firstPos&&(b=y.template.getWidgetIdByKey(b.fieldName),-1===a.indexOf(b)&&a.push(b)))},this)},this);return a},mergeTemplateAppConfigToAppConfig:function(b,a,f){function c(b){var a=[];e.forEach(b,function(b){b&&a.push(b)},this);return a}var g=b.widgetOnScreen,p=b.portalUrl;a.values.webmap&&(b.map.itemId=a.values.webmap);f&&(b.map.mapOptions&&y.deleteMapOptions(b.map.mapOptions),b.map.portalUrl=
p,a.values.app_title||(a.values.app_title=f.title),a.values.app_subtitle||(a.values.app_subtitle=f.snippet));for(var d in a.values)"webmap"!==d&&y.template.setConfigValueWithId(b,d,a.values[d]);b.widgetPool.widgets=c(b.widgetPool.widgets);g.widgets=c(g.widgets);if(b.widgetPool.groups)for(a=0;a<b.widgetPool.groups.length;a++)b.widgetPool.groups[a].widgets=c(b.widgetPool.groups[a].widgets);if(g.groups)for(a=0;a<g.groups.length;a++)g.groups[a].widgets=c(g.groups[a].widgets);return b}};y.deleteMapOptions=
function(b){b&&(delete b.extent,delete b.lods,delete b.center,delete b.scale,delete b.zoom,delete b.maxScale,delete b.maxZoom,delete b.minScale,delete b.minZoom)};y.graphicsExtent=function(b,a){var f=null;try{0<b.length&&(f=N.graphicsExtent(b))&&"number"===typeof a&&0<a&&(f=f.expand(a))}catch(c){console.error(c)}return f};y.sanitizeHTML=function(b){return html_sanitize(b,function(b){return b},function(b){return b})};y.stripHTML=function(b){return!b?b:-1<b.indexOf("\x3c")&&-1<b.indexOf("\x3e")?b.replace(/<(?:.|\s)*?>/g,
""):b};y.removeSuffixSlashes=function(b){return b.replace(/\/*$/g,"")};y.getBestDisplayAttributes=function(b,a){var f={},c=null,g;for(g in b)c=y.getBestDisplayValue(g,b,a),f[g]=c;return f};y.getBestDisplayValue=function(b,a,f){var c="",g=null;m.isArrayLike(f)?g=y.getFieldInfoByFieldName(f,b):"object"===typeof f&&f.name===b&&(g=f);g&&(c=a[b],"esriFieldTypeDate"===g.type?c&&(b=new Date(parseInt(c,10)),c=y._tryLocaleDate(b)):"number"===typeof c&&(g.domain&&"codedValue"===g.domain.type?e.some(g.domain.codedValues,
function(b){if(b.code===c)return c=b.name,!0}):c=y._tryLocaleNumber(c)));if(null===c||void 0===c)c="";return c};y.getDefaultPortalFieldInfo=function(b){var a=b.name,a={fieldName:a,label:b.alias||a,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(b.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":a.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":a.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":a.format=
{dateFormat:"longMonthDayYear"}}return a};y._tryLocaleNumber=function(b){var a=y.localizeNumber(b);if(null===a||void 0===a)a=b;return a};y._tryLocaleDate=function(b){var a=y.localizeDate(b);a||(a=b.toLocaleDateString());return a};y.getFieldInfoByFieldName=function(b,a){var f=null;b&&0<b.length&&e.some(b,m.hitch(this,function(b){return b.name===a?(f=b,!0):!1}));return f};y.containsNonLatinCharacter=function(b){for(var a=0;a<b.length;a++)if(255<b.charCodeAt(a))return!0;return!1};y.has=function(b){var a=
k(b);if(a)return a;if("ie"===b.toLowerCase()){b=0;var f=/MSIE (\d+\.\d+);/.test(navigator.userAgent),c=!!navigator.userAgent.match(/Trident\/7.0/),g=navigator.userAgent.indexOf("rv:11.0");f&&(b=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(b=10);c&&-1!==g&&(b=11);return 11===b&&11||a}if("edge"===b.toLowerCase())return navigator.userAgent.split("Edge/")[1]||a};y.detectUserAgent=function(){var b={},a={},f=navigator.userAgent,c=navigator.platform,g=f.match(/Web[kK]it[\/]{0,1}([\d.]+)/),
p=f.match(/(Android);?[\s\/]+([\d.]+)?/),d=!!f.match(/\(Macintosh\; Intel /),t=f.match(/(iPad).*OS\s([\d_]+)/),u=f.match(/(iPod)(.*OS\s([\d_]+))?/),q=!t&&f.match(/(iPhone\sOS)\s([\d_]+)/),r=f.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),c=/Win\d{2}|Windows/.test(c),e=f.match(/Windows Phone ([\d.]+)/),s=r&&f.match(/TouchPad/),v=f.match(/Kindle\/([\d.]+)/),l=f.match(/Silk\/([\d._]+)/),n=f.match(/(BlackBerry).*Version\/([\d.]+)/),k=f.match(/(BB10).*Version\/([\d.]+)/),h=f.match(/(RIM\sTablet\sOS)\s([\d.]+)/),
w=f.match(/PlayBook/),x=f.match(/Chrome\/([\d.]+)/)||f.match(/CriOS\/([\d.]+)/),C=f.match(/Firefox\/([\d.]+)/),z=f.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),A=f.match(/MSIE\s([\d.]+)/)||f.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),F=!x&&f.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),m=F||f.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);a.webkit=!!g;a.webkit&&(a.version=g[1]);p&&(b.android=!0,b.version=p[2]);q&&!u&&(b.ios=b.iphone=!0,b.version=q[2].replace(/_/g,
"."));t&&(b.ios=b.ipad=!0,b.version=t[2].replace(/_/g,"."));u&&(b.ios=b.ipod=!0,b.version=u[3]?u[3].replace(/_/g,"."):null);e&&(b.wp=!0,b.version=e[1]);r&&(b.webos=!0,b.version=r[2]);s&&(b.touchpad=!0);n&&(b.blackberry=!0,b.version=n[2]);k&&(b.bb10=!0,b.version=k[2]);h&&(b.rimtabletos=!0,b.version=h[2]);w&&(a.playbook=!0);v&&(b.kindle=!0,b.version=v[1]);l&&(a.silk=!0,a.version=l[1]);!l&&(b.android&&f.match(/Kindle Fire/))&&(a.silk=!0);x&&(a.chrome=!0,a.version=x[1]);C&&(a.firefox=!0,a.version=C[1]);
z&&(b.firefoxos=!0,b.version=z[1]);A&&(a.ie=!0,a.version=A[1]);if(m&&(d||b.ios||c))a.safari=!0,b.ios||(a.version=m[1]);F&&(a.webview=!0);b.tablet=!(!t&&!w&&!(p&&!f.match(/Mobile/)||C&&f.match(/Tablet/)||A&&!f.match(/Phone/)&&f.match(/Touch/)));b.phone=!(b.tablet||b.ipod||!p&&!q&&!r&&!n&&!k&&!(x&&f.match(/Android/)||x&&f.match(/CriOS\/([\d.]+)/)||C&&f.match(/Mobile/)||A&&f.match(/Touch/)));return{os:b,browser:a}};y.isMobileUa=function(){var b=y.detectUserAgent();return!0===b.os.phone||!0===b.os.tablet?
!0:!1};y.getObjectIdField=function(b){if(b.objectIdField)return b.objectIdField;b=b.fields;for(var a=0;a<b.length;a++){var f=b[a];if("esriFieldTypeOID"===f.type)return f.name}return null};y.isNeedHttpsButNot=function(){return window.hasOwnProperty("isSecureContext")&&!window.isSecureContext?!0:!1};y.toFeatureSet=function(b){var a=new G;"[object Object]"===Object.prototype.toString.call(b)&&(b=[b]);a.features=b;if(0<b.length){var f;e.some(b,function(b){if(b.geometry)return f=b,!0});if(f){b=f.getLayer();
var c={};b&&(a.displayFieldName=b.displayField,e.forEach(b.fields,m.hitch(this,function(b){var a=b.name;c[a]=b.alias||a})),a.fieldAliases=c);a.geometryType=f.geometry.type;a.spatialReference=f.geometry.spatialReference}}return a};y.showValidationErrorTipForFormDijit=function(b){try{!b.validate()&&b.domNode&&b.focusNode&&(b.focusNode.focus(),setTimeout(m.hitch(this,function(){b.focusNode.blur()}),100))}catch(a){console.error(a)}};y.getFeatureLayerDefinition=function(b){var a=null,f=b.graphics;b.graphics=
[];var c=b.toJson();b.graphics=f;c&&(a=c.layerDefinition);return a};y.simulateClickEvent=function(b){if(k("safari")){var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0);b.dispatchEvent(a)}else b.click()};y.getFeatureSetByLayerAndFeatures=function(b,a){var f=new G;f.fields=m.clone(b.fields);f.features=a;f.geometryType=b.geometryType;f.fieldAliases={};e.forEach(f.fields,m.hitch(this,function(b){var a=b.name;f.fieldAliases[a]=b.alias||a}));return f};y.featureAction=function(){return{zoomTo:function(b,
a,f){f||(f={});f.hasOwnProperty("extentFactor")||(f.extentFactor=1.2);if(b&&a&&0<a.length){var c=e.every(a,function(b){return b&&b.spatialReference&&b.type});if(e.every(a,function(b){return b&&b.geometry&&b.geometry.spatialReference&&b.geometry.type})||c)c&&(a=e.map(a,function(b){return{geometry:b}})),1===a.length&&"point"===a[0].type?(f=15,f=-1<b.getMaxZoom()?b.getMaxZoom():0.1,b.centerAndZoom(a[0].geometry,f)):(a=N.graphicsExtent(a),b.setExtent(a.expand(f.extentFactor)))}},flash:function(b,a){function f(b,
a){e.forEach(g,function(f,c){f.setSymbol(a?b:d[c]||t)})}function c(b){return function(){setTimeout(function(){f(u,!0);g[0]&&a&&a.redraw();setTimeout(function(){f(null,!1);g[0]&&a&&a.redraw();b()},200)},200)}}if(e.every(b||[],function(b){return b&&b.geometry})){var g=b,p=g[0],d=e.map(g,function(b){return b.symbol}),t=p.symbol||m.getObject("renderer.symbol",!1,a),u=null;a&&"esriGeometryPoint"===a.geometryType?u=new I(require.toUrl("jimu")+"/images/flash.gif",20,20):(u=m.clone(t))&&(u.outline?u.outline.setColor("#ffc500"):
u.setColor("#ffc500"));p&&(t&&u&&a)&&("esriGeometryPoint"===a.geometryType?(f(u,!0),a.redraw(),setTimeout(function(){f(null,!1);a.redraw()},2E3)):c(c(c(function(){})))())}},panTo:function(b,a){if(e.every(a||[],function(b){return b&&b.geometry})){var f;0<a.length?f=N.graphicsExtent(a).getCenter():(f=a[0].geometry,f="polyline"===f.type||"polygon"===f.type?f.getExtent().getCenter():"extent"===f.type?f.getCenter():"multipoint"===f.type?1<f.points.length?f.getExtent().getCenter():f.getPoint(0):f);b.centerAt(f)}},
showPopup:function(b,a){if(e.every(a||[],function(b){return b&&b.geometry})){var f=b.infoWindow;f.setFeatures(a);var c=a[0];"point"===c.geometry.type?f.show(c.geometry,{closetFirst:!0}):f.show(c.geometry.getExtent().getCenter(),{closetFirst:!0})}}}}();return y})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(m,e,h){var k=m.NodeList;e.extend(k,{_buildArrayFromCallback:function(d){for(var e=[],n=0;n<this.length;n++){var c=d.call(this[n],this[n],e);c&&
(e=e.concat(c))}return e},_getUniqueAsNodeList:function(d){for(var e=[],n=0,c;c=d[n];n++)1==c.nodeType&&-1==h.indexOf(e,c)&&e.push(c);return this._wrap(e,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(d,e){var n=this._getUniqueAsNodeList(d),n=e?m._filterResult(n,e):n;return n._stash(this)},_getRelatedUniqueNodes:function(d,e){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(e),d)},children:function(d){return this._getRelatedUniqueNodes(d,function(d,n){return e._toArray(d.childNodes)})},
closest:function(d,e){return this._getRelatedUniqueNodes(null,function(n,c){do if(m._filterResult([n],d,e).length)return n;while(n!=e&&(n=n.parentNode)&&1==n.nodeType);return null})},parent:function(d){return this._getRelatedUniqueNodes(d,function(d,e){return d.parentNode})},parents:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var c=[];d.parentNode;)d=d.parentNode,c.push(d);return c})},siblings:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var c=[],g=d.parentNode&&
d.parentNode.childNodes,a=0;a<g.length;a++)g[a]!=d&&c.push(g[a]);return c})},next:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var c=d.nextSibling;c&&1!=c.nodeType;)c=c.nextSibling;return c})},nextAll:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var c=[],g=d;g=g.nextSibling;)1==g.nodeType&&c.push(g);return c})},prev:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var c=d.previousSibling;c&&1!=c.nodeType;)c=c.previousSibling;return c})},
prevAll:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var c=[],g=d;g=g.previousSibling;)1==g.nodeType&&c.push(g);return c})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(d,e){return 0!=e%2})},odd:function(){return this.filter(function(d,e){return 0==e%2})}});return k})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],
function(m){m=m.getObject("dojox.encoding.base64",!0);m.encode=function(e){for(var h=[],k=e.length,d=k%3,k=k-d,l=0;l<k;){var n=e[l++]<<16|e[l++]<<8|e[l++];h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>18&63));h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>12&63));h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>6&63));h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n&
63))}switch(d){case 2:n=e[l++]<<16|e[l++]<<8;h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>18&63));h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>12&63));h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>6&63));h.push("\x3d");break;case 1:n=e[l++]<<16,h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>18&63)),h.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>
12&63)),h.push("\x3d"),h.push("\x3d")}return h.join("")};m.decode=function(e){e=e.split("");for(var h=[],k=e.length;"\x3d"==e[--k];);for(var d=0;d<k;){var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[d++])<<18;d<=k&&(l|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[d++])<<12);d<=k&&(l|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[d++])<<6);d<=k&&(l|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[d++]));
h.push(l>>>16&255);h.push(l>>>8&255);h.push(l&255)}for(;0==h[h.length-1];)h.pop();return h};return m})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(m,e,h,k,d,l,n,c){return m(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var g=h.map(this.geometries,function(a){return a.toJson()}),
a={};a.outSR=this.outSR.wkid||k.toJson(this.outSR.toJson());a.inSR=this.geometries[0].spatialReference.wkid||k.toJson(this.geometries[0].spatialReference.toJson());a.geometries=k.toJson({geometryType:c.getJsonType(this.geometries[0]),geometries:g});this.transformation&&(a.transformation=this.transformation.wkid||k.toJson(this.transformation));n.isDefined(this.transformForward)&&(a.transformForward=this.transformForward);return a}})})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],
function(m,e){var h=m.clone(e);h.declaredClass="jimu.portalUrlUtils";h.getPortalUrlFromLocation=function(){return h.getPortalServerFromLocation()+h.getDeployContextFromLocation()};h.getPortalSignInUrlFromLocation=function(){var e=h.getPortalUrlFromLocation()+"home/signin.html";return e=h.setHttpsProtocol(e)};h.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};h.getDeployContextFromLocation=function(){var e=window.location.href.split("?")[0],d=e.indexOf("/home");
0>d&&(d=e.indexOf("/apps"));e=e.substring(e.indexOf(window.location.host)+window.location.host.length+1,d);"/"!==e&&(e="/"+e+"/");return e};h.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+h.getDeployContextFromLocation()+"sharing/rest/"};return h})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var m={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,
"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(e){return this.substr(0,e.length)===e});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(e){return this.substr(this.length-e.length,e.length)===e});m.getServerByUrl=function(e){e=(e||"").trim();e=e.replace(/^(http(s?):?)\/\//gi,"");0===e.indexOf("//")&&(e=e.slice(2));return e.split("/")[0]};m.getServerWithProtocol=function(e){var h="";if(e=(e||"").trim()){var k=
m.getServerByUrl(e);if(!k)return h;var d=m.getProtocol(e);d?h=d+"://"+k:0===e.indexOf("//")&&(h="//"+k)}return h};m.isSameServer=function(e,h){e=m.getServerByUrl(e)||"";h=m.getServerByUrl(h)||"";return e.toLowerCase()===h.toLowerCase()};m.getDomain=function(e){var h="";if(e=m.getServerByUrl(e))e=e.replace(/:\d+$/,""),e=e.match(/[^.]\w+\.\w+$/),null!==e&&(h=e[0],/^\d+\.\d+$/.test(h)&&(h=""));return h};m.isSameDomain=function(e,h){var k=m.getDomain(e),d=m.getDomain(h);return""!==k&&k===d};m.isOnline=
function(e){return 0<=m.getServerByUrl(e).toLowerCase().indexOf(".arcgis.com")};m.isArcGIScom=function(e){e=m.getServerByUrl(e).toLowerCase();return"www.arcgis.com"===e||"arcgis.com"===e};m.getStandardPortalUrl=function(e){var h=m.getServerByUrl(e);if(""===h)return"";m.isOnline(h)?(m.isArcGIScom(h)&&(h="www.arcgis.com"),e=m.addProtocol(e),e=m.getProtocol(e)+"://"+h):(e=(e||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),e=m.addProtocol(e),e.replace(RegExp("http(s?)://"+h,"g"),"")||(e+=
"/arcgis"));return e};m.isSamePortalUrl=function(e,h){var k=/^http(s?):\/\//gi,d=/^\/\//gi;e=m.getStandardPortalUrl(e).toLowerCase().replace(k,"").replace(d,"");h=m.getStandardPortalUrl(h).toLowerCase().replace(k,"").replace(d,"");return e===h};m.addProtocol=function(e){if(-1>=e.toLowerCase().indexOf("http://")&&-1>=e.toLowerCase().indexOf("https://")){var h="";"undefined"!==typeof window&&window.location?(h=window.location.protocol,e=e.startWith("//")?h+e:e.startWith("/")?h+"//"+window.location.host+
e:h+"//"+e):(h="http:",e=e.startWith("//")?h+e:h+"//"+e)}return e};m.getProtocol=function(e){var h="";e=e.toLowerCase();0===e.indexOf("https://")?h="https":0===e.indexOf("http://")&&(h="http");return h};m.updateUrlProtocolByOtherUrl=function(e,h){h=h.toLowerCase();0===h.indexOf("https://")?e=m.setHttpsProtocol(e):0===h.indexOf("http://")&&(e=m.setHttpProtocol(e));return e};m.removeProtocol=function(e){return e.replace(/^http(s?):\/\//i,"//")};m.setHttpProtocol=function(e){e=m.addProtocol(e);return e.replace(/^https:\/\//,
"http://")};m.setHttpsProtocol=function(e){e=m.addProtocol(e);return e.replace(/^http:\/\//,"https://")};m.setProtocol=function(e,h){return 0<=h.indexOf("https")?m.setHttpsProtocol(e):0<=h.indexOf("http")?m.setHttpProtocol(e):e};m.getSharingUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/sharing/rest");return h};m.getOAuth2Url=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/sharing/rest/oauth2");return h};m.getAppIdUrl=function(e,h){var k="",d=m.getStandardPortalUrl(e);d&&
(k=d+"/sharing/rest/oauth2/apps/"+h);return k};m.getSignInUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/home/signin.html");return h};m.getBaseSearchUrl=function(e){var h="";e=m.getStandardPortalUrl(e);(e=e.replace(/\/*$/g,""))&&(h=e+"/sharing/rest/search");return h};m.getBaseItemUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/sharing/rest/content/items");return h};m.getItemUrl=function(e,h){var k="",d=m.getBaseItemUrl(e);d&&h&&(k=d+"/"+h);return k};m.getItemDataUrl=
function(e,h){var k="",d=m.getItemUrl(e,h);d&&(k=d+"/data");return k};m.getGenerateTokenUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/sharing/rest/generateToken");return h};m.getItemDetailsPageUrl=function(e,h){var k="";e&&h&&(e=m.getStandardPortalUrl(e),k=e+"/home/item.html?id\x3d"+h);return k};m.getUserProfilePageUrl=function(e,h){var k="";e&&h&&(e=m.getStandardPortalUrl(e),k=e+"/home/user.html?user\x3d"+h);return k};m.getBaseGroupUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&
(h=e+"/sharing/rest/community/groups");return h};m.getPortalSelfInfoUrl=function(e){var h="";(e=m.getStandardPortalUrl(e||""))&&(h=e+"/sharing/rest/portals/self");return h};m.getCommunitySelfUrl=function(e){var h="";(e=m.getStandardPortalUrl(e||""))&&(h=e+"/sharing/rest/community/self");return h};m.getBaseUserUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/sharing/rest/community/users");return h};m.getUserUrl=function(e,h){var k="",d=m.getBaseUserUrl(e);e&&h&&(k=d+"/"+h);return k};
m.getUserTagsUrl=function(e,h){var k="",d=m.getUserUrl(e,h);e&&h&&(k=d+"/tags");return k};m.getUserThumbnailUrl=function(e,h,k){var d="";(e=m.getUserUrl(e,h))&&k&&(d=e+"/info/"+k);return d};m.getContentUrl=function(e){var h="";e&&(e=m.getStandardPortalUrl(e),h=e+"/sharing/rest/content");return h};m.getUserContentUrl=function(e,h,k){var d="",d="";e&&h&&(d=m.getContentUrl(e),d=k?d+"/users/"+h+"/"+k:d+"/users/"+h);return d};m.getAddItemUrl=function(e,h,k){var d="",d="";e&&h&&(d=m.getUserContentUrl(e,
h,k),d+="/addItem");return d};m.getDeleteItemUrl=function(e,h,k){var d="";(e=m.getUserItemsUrl(e,h))&&(d=e+"/"+k+"/delete");return d};m.getUserItemsUrl=function(e,h,k){var d="",d="";e&&h&&(d=m.getUserContentUrl(e,h,k),d+="/items");return d};m.getUpdateItemUrl=function(e,h,k,d){var l="",l="";e&&h&&(l=m.getUserItemsUrl(e,h,d),l=l+"/"+k+"/update");return l};m.shareItemUrl=function(e,h,k,d){var l="",l="";e&&h&&(l=m.getUserItemsUrl(e,h,d),l=l+"/"+k+"/share");return l};m.getHomeIndexUrl=function(e){var h=
"";(e=m.getStandardPortalUrl(e))&&(h=e+"/home/index.html");return h};m.getHomeMapViewerUrl=function(e,h){var k="",d=m.getStandardPortalUrl(e);d&&(k=d+"/home/webmap/viewer.html",k=h?k+("?webmap\x3d"+h):k+"?useExisting\x3d1");return k};m.getHomeSceneViewerUrl=function(e,h){var k="",d=m.getStandardPortalUrl(e);d&&(k=d+"/home/webscene/viewer.html",h&&(k+="?webscene\x3d"+h));return k};m.getHomeGalleryUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/home/gallery.html");return h};m.getHomeGroupsUrl=
function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/home/groups.html");return h};m.getHomeMyContentUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/home/content.html");return h};m.getHomeMyOrganizationUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/home/organization.html");return h};m.getHomeUserUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/home/user.html");return h};m.getPortalHelpUrl=function(e,h){var k="",d=m.getStandardPortalUrl(e);d&&(k=d+
"/portalhelp/"+(h||"en")+"/website/help/");return k};m.getPortalAdminHelpUrl=function(e,h){var k="",d=m.getStandardPortalUrl(e);d&&(k=d+"/portalhelp/"+(h||"en")+"/admin/help/");return k};m.getPortalProxyUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/sharing/proxy");return h};m.getOAuth2SignOutUrl=function(e){var h="";(e=m.getStandardPortalUrl(e))&&(h=e+"/sharing/rest/oauth2/signout");return h};m.getNewPrintUrl=function(e){var h="";if(e=m.getStandardPortalUrl(e))e=m.setHttpProtocol(e),
h=e+"/sharing/tools/newPrint";return h};return m})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(m){function e(d,e){function n(c,g){var a,e,r,q,f="widgetOnScreen"===c;if(d[c]){if(d[c].groups)for(a=0;a<d[c].groups.length;a++)if(r=d[c].groups[a],g(r,{index:a,isWidget:!1,groupId:r.id,isThemeWidget:!1,isOnScreen:f}),d[c].groups[a].widgets)for(e=0;e<d[c].groups[a].widgets.length;e++)q=d[c].groups[a].widgets[e],g(q,{index:e,isWidget:!0,groupId:r.id,isThemeWidget:q.uri&&-1<q.uri.indexOf("themes/"+
d.theme.name),isOnScreen:f});if(d[c].widgets)for(a=0;a<d[c].widgets.length;a++)q=d[c].widgets[a],g(d[c].widgets[a],{index:a,isWidget:!0,groupId:c,isThemeWidget:q.uri&&-1<q.uri.indexOf("themes/"+d.theme.name),isOnScreen:f})}}n("widgetOnScreen",e);n("widgetPool",e)}var h={},k="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");h.visitElement=
e;h.getConfigElementById=function(d,l){var n;if("map"===l)return d.map;e(d,function(c){if(c.id===l)return n=c,!0});return n};h.getConfigElementByLabel=function(d,l){var n;if("map"===l)return d.map;e(d,function(c){if(c.label||c.name===l)return n=c,!0});return n};h.getConfigElementsByName=function(d,l){var n=[];if("map"===l)return[d.map];e(d,function(c){c.name===l&&n.push(c)});return n};h.getWidgetNameFromUri=function(d){d=d.split("/");d.pop();return d.pop()};h.getAmdFolderFromUri=function(d){d=d.split("/");
d.pop();return d.join("/")+"/"};h.widgetProperties=k;h.processWidgetProperties=function(d){"undefined"===typeof d.properties.isController&&(d.properties.isController=!1);"undefined"===typeof d.properties.isThemeWidget&&(d.properties.isThemeWidget=!1);"undefined"===typeof d.properties.hasVersionManager&&(d.properties.hasVersionManager=!1);k.forEach(function(e){"undefined"===typeof d.properties[e]&&(d.properties[e]=!0)})};h.getControllerWidgets=function(d){var e=[];d.visitElement(function(d){d.isController&&
e.push(d)});return e};h.addI18NLabelToManifest=function(d,e,n){function c(a,c){c[g]&&(d.i18nLabels[a]=c[g]);"theme"===d.category&&(d.layouts&&d.layouts.forEach(function(g){d["i18nLabels_layout_"+g.name]||(d["i18nLabels_layout_"+g.name]={});d["i18nLabels_layout_"+g.name][a]=c["_layout_"+g.name]}),d.styles&&d.styles.forEach(function(g){d["i18nLabels_style_"+g.name]||(d["i18nLabels_style_"+g.name]={});d["i18nLabels_style_"+g.name][a]=c["_style_"+g.name]}));"widget"===d.category&&d.featureActions&&d.featureActions.forEach(function(g){d["i18nLabels_featureAction_"+
g.name]||(d["i18nLabels_featureAction_"+g.name]={});d["i18nLabels_featureAction_"+g.name][a]=c["_featureAction_"+g.name]})}d.i18nLabels={};var g="widget"===d.category?"_widgetLabel":"_themeLabel";e&&(e.root&&e.root[g])&&(d.i18nLabels.defaultLabel=e.root[g],"theme"===d.category&&(d.layouts&&d.layouts.forEach(function(a){d["i18nLabels_layout_"+a.name]={};d["i18nLabels_layout_"+a.name].defaultLabel=e.root["_layout_"+a.name]}),d.styles&&d.styles.forEach(function(a){d["i18nLabels_style_"+a.name]={};d["i18nLabels_style_"+
a.name].defaultLabel=e.root["_style_"+a.name]})),"widget"===d.category&&d.featureActions&&d.featureActions.forEach(function(a){d["i18nLabels_featureAction_"+a.name]={};d["i18nLabels_featureAction_"+a.name].defaultLabel=e.root["_featureAction_"+a.name]}));for(var a in n)c(a,n[a])};h.isHostedService=function(d){var e=m.getServerByUrl(d)+"/[^/]+/[^/]+/rest/services";return RegExp(e,"gi").test(d)};return h})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t){var b=null,v=m(n,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(l.subscribe("app/mapLoaded",e.hitch(this,this._onMapLoaded)),l.subscribe("app/mapChanged",e.hitch(this,this._onMapChanged))):(l.subscribe("mapLoaded",e.hitch(this,this._onMapLoaded)),l.subscribe("mapChanged",e.hitch(this,this._onMapChanged)));window.isBuilder?(l.subscribe("app/sceneViewLoaded",e.hitch(this,this._onSceneViewLoaded)),l.subscribe("app/sceneViewChanged",
e.hitch(this,this._onSceneViewChanged))):(l.subscribe("sceneViewLoaded",e.hitch(this,this._onSceneViewLoaded)),l.subscribe("sceneViewChanged",e.hitch(this,this._onSceneViewChanged)));window.isBuilder?(l.subscribe("app/appConfigLoaded",e.hitch(this,this._onAppConfigLoaded)),l.subscribe("app/appConfigChanged",e.hitch(this,this._onAppConfigChanged))):(l.subscribe("appConfigLoaded",e.hitch(this,this._onAppConfigLoaded)),l.subscribe("appConfigChanged",e.hitch(this,this._onAppConfigChanged)));l.subscribe("userSignIn",
e.hitch(this,this._onUserSignIn));l.subscribe("userSignOut",e.hitch(this,this._onUserSignOut));l.subscribe("builder/actionTriggered",e.hitch(this,this._onActionTriggered));l.subscribe("/dnd/move/start",e.hitch(this,this._onMoveStart))},loadWidget:function(b){var a=new d,c;b=e.clone(b);b.folderUrl||f.widgetJson.processWidgetJson(b);(c=this.getWidgetById(b.id))?a.resolve(c):q([this.loadWidgetClass(b),this.loadWidgetManifest(b)]).then(e.hitch(this,function(b){var f=b[0],c=b[1];this.loadWidgetResources(c).then(e.hitch(this,
function(b){try{var g=this.createWidget(c,f,b);k.setAttr(g.domNode,"data-widget-name",c.name);console.log("widget ["+c.uri+"] created.")}catch(p){console.log("create ["+c.uri+"] error:"+p.stack),new t({message:window.jimuNls.widgetManager.createWidgetError+": "+c.uri}),a.reject(p)}setTimeout(e.hitch(this,function(){a.resolve(g);this.emit("widget-created",g);l.publish("widgetCreated",g)}),50)}),function(b){a.reject(b)})}),function(b){a.reject(b)});return a},loadWidgetClass:function(b){var a=new d;
require(f.getRequireConfig(),[b.uri],e.hitch(this,function(b){a.resolve(b)}));f.checkError(b.uri,a);return a},loadWidgetResources:function(b){var a=new d,f,c,g,p=[];g=e.clone(b);b=this.tryLoadWidgetConfig(g);f=this._tryLoadResource(g,"i18n");c=this._tryLoadResource(g,"style");g=this._tryLoadResource(g,"template");p.push(b);p.push(f);p.push(g);p.push(c);q(p).then(e.hitch(this,function(b){var f={};f.config=b[0];f.i18n=b[1];f.template=b[2];f.style=b[3];a.resolve(f)}),function(b){a.reject(b)});return a},
loadWidgetManifest:function(b){var a=new d,c=b.folderUrl+"manifest.json";if(b.manifest)return a.resolve(b),a;r(c,{handleAs:"json",headers:{"X-Requested-With":null}}).then(e.hitch(this,function(c){c.amdFolder=b.amdFolder;c.category="widget";f.manifest.addI18NLabel(c).then(e.hitch(this,function(){this._processManifest(c);f.widgetJson.addManifest2WidgetJson(b,c);a.resolve(b)}))}),function(b){a.reject(b)});return a},getWidgetMarginBox:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return{};
if(b._marginBox)return b._marginBox;b.setPosition({left:-9999,top:-9999,relativeTo:b.position.relativeTo});this.openWidget(b);b._marginBox=b.getMarginBox();this.closeWidget(b);return b._marginBox},_processManifest:function(b){f.manifest.addManifestProperies(b);f.manifest.processManifestLabel(b,window.dojoConfig.locale)},createWidget:function(b,a,p){if(this.getWidgetById(b.id))return this.getWidgetById(b.id);p.config&&p.i18n&&(p.config=f.replacePlaceHolder(p.config,p.i18n));b.rawConfig=b.config;b.config=
p.config||{};this.appConfig._appData&&this._mergeAgolConfig(b);b.nls=p.i18n||{};p.template&&(b.templateString=p.template);b["class"]="jimu-widget";b.label||(b.label=b.name);this.map&&(b.map=this.map);b.appConfig=this.appConfig;p={};for(var d in b)b.hasOwnProperty(d)&&(p[d]=b[d]);p.widgetManager=this;b=new a(p);b.clazz=a;g.after(b,"startup",e.hitch(this,this._postWidgetStartup,b));g.before(b,"destroy",e.hitch(this,this._onDestroyWidget,b));c(b.domNode,"click",e.hitch(this,this._onClickWidget,b));this.loaded.push(b);
return b},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var b=h.map(this.loaded,function(b){return b.id});h.forEach(b,function(b){this.destroyWidget(b)},this);this.loaded=[]},loadWidgetSettingPage:function(b){var a=new d;b=e.clone(b);b.id+="_setting";q([this.loadWidgetSettingClass(b)]).then(e.hitch(this,function(f){var c=f[0];this.loadWidgetSettingPageResources(b).then(e.hitch(this,function(f){var p;f={nls:f.i18n,templateString:f.template,appConfig:this.appConfig,"class":"jimu-widget-setting"};
"HTML3D"===window.appInfo.appType?f.sceneView=this.sceneView:f.map=this.map;for(var d in b)b.hasOwnProperty(d)&&(f[d]=b[d]);try{p=new c(f),k.setAttr(p.domNode,"data-widget-name-setting",f.name),g.before(p,"destroy",e.hitch(this,this._onDestroyWidgetSetting,p)),a.resolve(p)}catch(q){new t({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+b.uri}),a.reject(q)}}),function(b){console.log(b)})}),function(b){a.reject(b)});return a},loadWidgetSettingClass:function(b){var a=new d;require(f.getRequireConfig(),
[b.folderUrl+"setting/Setting.js"],e.hitch(this,function(b){a.resolve(b)}));f.checkError(b.folderUrl+"setting/Setting.js",a);return a},loadWidgetSettingPageResources:function(b){var a=new d,f,c,g=[];b=e.clone(b);f=this._tryLoadResource(b,"settingI18n");c=this._tryLoadResource(b,"settingTemplate");b=this._tryLoadResource(b,"settingStyle");g.push(f);g.push(c);g.push(b);q(g).then(e.hitch(this,function(b){var f={};f.i18n=b[0]||{};f.template=b[1];f.style=b[2];a.resolve(f)}),function(b){console.log(b)});
return a},getWidgetById:function(b){var a;h.some(this.loaded,function(f){if(f.id===b)return a=f,!0},this);return a},getWidgetByLabel:function(b){var a;h.some(this.loaded,function(f){if(f.label===b)return a=f,!0},this);return a},getWidgetsByName:function(b){var a=[];h.some(this.loaded,function(f){f.name===b&&a.push(f)},this);return a},changeWindowStateTo:function(b,a){"normal"===a?this.normalizeWidget(b):"minimized"===a?this.minimizeWidget(b):"maximized"===a?this.maximizeWidget(b):console.log("error state: "+
a)},closeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;if("closed"!==b.state){this.activeWidget&&this.activeWidget.id===b.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);k.setStyle(b.domNode,"display","none");b.setState("closed");try{b.onClose()}catch(a){console.log(console.error("fail to close widget "+b.name+". "+a.stack))}}},openWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;if(!b.started)try{b.started=!0,b.startup()}catch(a){console.error("fail to startup widget "+
b.name+". "+a.stack)}if("closed"===b.state){k.setStyle(b.domNode,"display","");b.setState("opened");try{b.onOpen()}catch(f){console.error("fail to open widget "+b.name+". "+f.stack)}}},activateWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"opened"===b.state&&this._activeWidget(b)},maximizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&this.openWidget(b);b.setWindowState("maximized");try{b.onMaximize()}catch(a){console.log(console.error("fail to maximize widget "+
b.name+". "+a.stack))}},minimizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&this.openWidget(b);b.setWindowState("minimized");try{b.onMinimize()}catch(a){console.log(console.error("fail to minimize widget "+b.name+". "+a.stack))}},normalizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&this.openWidget(b);b.setWindowState("normal");try{b.onNormalize()}catch(a){console.log(console.error("fail to normalize widget "+
b.name+". "+a.stack))}},destroyWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;this._removeWidget(b);try{b.destroy()}catch(a){console.log(console.error("fail to destroy widget "+b.name+". "+a.stack))}},tryLoadWidgetConfig:function(b){return this._tryLoadWidgetConfig(b).then(e.hitch(this,function(a){return this._upgradeWidgetConfig(b,a).then(function(a){return b.config=a})}))},triggerWidgetOpen:function(b){function a(b){var c=g.after(b,"onOpen",function(){c.remove();
f.resolve(b)})}var f=new d,c=this.getWidgetById(b);if(c){if("closed"!==c.state)return f.resolve(c),f;a(c)}else var p=l.subscribe("widgetCreated",e.hitch(this,function(a){a.id===b&&(p.remove(),f.resolve(a))}));l.publish("openWidget",b);return f},_tryLoadWidgetConfig:function(b){var c=new d;if(b.config&&e.isObject(b.config))return c.resolve(b.config),c;if(b.config){if(require.cache["url:"+b.config])return c.resolve(a.parse(require.cache["url:"+b.config])),c;c=f.processUrlInAppConfig(b.config);c=c.split("/");
c[c.length-1]=encodeURIComponent(c[c.length-1]);c=c.join("/");return r(c,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(b,"config").then(function(a){b.isDefaultConfig=!0;return a})},_upgradeWidgetConfig:function(b,a){var c=new d,g=b.manifest.version,p=b.version,t;if(g===p)return c.resolve(a),c;if(!1===b.hasVersionManager)return b.version=g,c.resolve(a),c;require(f.getRequireConfig(),[b.amdFolder+"VersionManager"],e.hitch(this,function(f){f=new f;var d=f.getVersionIndex(p),
e=f.getVersionIndex(g);if(d>e)c.reject("Bad widget version number, "+b.name+","+p);else try{t=f.upgrade(a,p,g),b.version=g,c.resolve(t)}catch(q){console.log("Read widget ["+b.name+"] old config error,"+q.stack),c.resolve(a)}}));return c},loadWidgetStyle:function(b){var a="widget/style/"+b.uri,c=new d,a=this._replaceId(a);return k.byId(a)?(c.resolve("load"),c):f.loadStyleLink(a,b.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(b){var a="widget/style/"+
b.uri+"/setting",c=new d,a=this._replaceId(a);return k.byId(a)?(c.resolve("load"),c):f.loadStyleLink(a,b.settingStyleFile)},loadWidgetConfig:function(b){b=require(f.getRequireConfig()).toUrl(b.configFile);if(require.cache["url:"+b]){var c=new d;c.resolve(a.parse(require.cache["url:"+b]));return c}return r(b,{handleAs:"json",headers:{"X-Requested-With":null}})},loadWidgetI18n:function(b){var a=new d;require(f.getRequireConfig(),["dojo/i18n!"+b.i18nFile],function(b){a.resolve(b)});return a},loadWidgetSettingI18n:function(b){var a=
new d;require(f.getRequireConfig(),["dojo/i18n!"+b.settingI18nFile],function(b){a.resolve(b)});return a},loadWidgetTemplate:function(b){var a=new d;require(f.getRequireConfig(),["dojo/text!"+b.templateFile],function(b){a.resolve(b)});f.checkError(b.templateFile,a);return a},loadWidgetSettingTemplate:function(b){var a=new d;require(f.getRequireConfig(),["dojo/text!"+b.settingTemplateFile],function(b){a.resolve(b)});f.checkError(b.settingTemplateFile,a);return a},removeWidgetStyle:function(b){k.destroy(this._replaceId("widget/style/"+
b.uri))},removeWidgetSettingStyle:function(b){k.destroy(this._replaceId("widget/style/"+b.uri+"/setting"))},getControllerWidgets:function(){return h.filter(this.loaded,function(b){return b.isController})},getOffPanelWidgets:function(){return h.filter(this.loaded,function(b){return!b.inPanel})},getOnScreenOffPanelWidgets:function(){return h.filter(this.loaded,function(b){return b.isOnScreen&&!b.inPanel})},closeOtherWidgetsInTheSameGroup:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),
!b))return;for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===b.gid&&this.loaded[a].id!==b.id&&this.closeWidget(this.loaded[a])},closeAllWidgetsInGroup:function(b){for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===b&&this.closeWidget(this.loaded[a])},_mergeAgolConfig:function(b){var a=this.appConfig._appData.values,c="widgets["+b.id+"]",g;for(g in a){var p=g.replace(/\//g,"_").indexOf(c+"_config");0<=p&&f.template.setConfigValue(b,g.replace(/\//g,"_").substr(p,g.length).replace(c,"widget"),
a[g])}},_onUserSignIn:function(b){h.forEach(this.loaded,function(a){a.onSignIn(b)},this)},_onUserSignOut:function(){h.forEach(this.loaded,function(b){b.onSignOut()},this)},_activeWidget:function(b){if(this.activeWidget){if(this.activeWidget.id===b.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&k.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&k.setStyle(b.domNode,
"zIndex","zIndex"in b.position?b.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=b;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&k.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),l.publish("widgetActived",b))},_onClickWidget:function(b,a){var f=s(".jimu-widget",b.domNode);if(0<f.length)for(var c=0;c<f.length;c++)if(a.target===f[c]||k.isDescendant(a.target,
f[c]))return;this._activeWidget(b)},_onMoveStart:function(b){h.forEach(this.loaded,function(a){a.domNode===b.node&&this._activeWidget(a)},this)},_onAppConfigLoaded:function(b){this.appConfig=b=e.clone(b);p.setPortalUrl(b.portalUrl)},_onMapLoaded:function(b){this.map=b},_onMapChanged:function(b){this.map=b},_onSceneViewLoaded:function(b){this.sceneView=b},_onSceneViewChanged:function(b){this.sceneView=b},_onAppConfigChanged:function(b,a,f,c){var g=e.clone(b);this.appConfig=g;h.forEach(this.loaded,
function(b){b&&(b.onAppConfigChanged(g,a,f,c),"widgetChange"===a&&this._onConfigChanged(f.id,f.config,c))},this)},_onConfigChanged:function(b,a){var f=this.getWidgetById(b);f&&(f.onConfigChanged(a),e.mixin(f.config,a))},_onActionTriggered:function(b){if(!("map"===b.elementId||"app"===b.elementId)){var a=this.getWidgetById(b.elementId);if(a)a.onAction(b.action,b.data);else this.missedActions.push({id:b.elementId,action:{name:b.action,data:b.data}});h.forEach(this.getControllerWidgets(),function(a){if(a.widgetIsControlled(b.elementId))a.onAction(b.action,
{widgetId:b.elementId,data:b.data})},this)}},_postWidgetStartup:function(b){b.started=!0;f.setVerticalCenter(b.domNode);g.after(b,"resize",e.hitch(this,f.setVerticalCenter,b.domNode));this.openWidget(b);var a=p.getPortalCredential(this.appConfig.portalUrl);if(a)b.onSignIn(a);else b.onSignOut();this._triggerMissedAction(b)},_triggerMissedAction:function(b){this.missedActions.forEach(function(a){if(a.id===b.id)b.onAction(a.action.name,a.action.data)})},_remove:function(b){return h.some(this.loaded,
function(a,f){if(a.id===b)return this.loaded.splice(f,1),!0},this)},_tryLoadResource:function(b,a){var f,c=new d;if("config"===a)f=b.amdFolder+"config.json",b.configFile=f,f="hasConfig";else if("style"===a)f=b.amdFolder+"css/style.css",b.styleFile=f,f="hasStyle";else if("i18n"===a)f=b.amdFolder+"nls/strings.js",b.i18nFile=b.isRemote?f:b.amdFolder+"nls/strings",f="hasLocale";else if("template"===a)f=b.amdFolder+"Widget.html",b.templateFile=f,f="hasUIFile";else if("settingTemplate"===a)f=b.amdFolder+
"setting/Setting.html",b.settingTemplateFile=f,f="hasSettingUIFile";else if("settingI18n"===a)f=b.amdFolder+"setting/nls/strings.js",b.settingI18nFile=b.amdFolder+"setting/nls/strings",f="hasSettingLocale";else if("settingStyle"===a)f=b.amdFolder+"setting/css/style.css",b.settingStyleFile=f,f="hasSettingStyle";else return c;b[f]?function(){var f;if("config"===a)f=this.loadWidgetConfig(b);else if("style"===a)f=this.loadWidgetStyle(b);else if("i18n"===a)f=this.loadWidgetI18n(b);else if("template"===
a)f=this.loadWidgetTemplate(b);else if("settingTemplate"===a)f=this.loadWidgetSettingTemplate(b);else if("settingStyle"===a)f=this.loadWidgetSettingStyle(b);else if("settingI18n"===a)f=this.loadWidgetSettingI18n(b);else return c;f.then(function(b){c.resolve(b)},function(a){new t({message:window.jimuNls.widgetManager.loadWidgetResourceError+": "+b.uri});c.reject(a)})}.apply(this):c.resolve(null);return c},_replaceId:function(b){return b.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(b){"closed"!==
b.state&&this.closeWidget(b);this._removeWidget(b);this.emit("widget-destroyed",b.id);l.publish("widgetDestroyed",b.id);console.log("destroy widget ["+b.uri+"].")},_onDestroyWidgetSetting:function(b){this.removeWidgetSettingStyle(b)},_removeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;this.activeWidget&&this.activeWidget.id===b.id&&(this.activeWidget=null);this._remove(b.id);0===this.getWidgetsByName(b.name).length&&this.removeWidgetStyle(b)}});v.getInstance=function(a){null===
b&&(b=new v(a),window._widgetManager=b);return b};return v})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t){"function"!==typeof d.getAll&&(d.getAll=function(b){var a=[];(b=d(b))&&a.push(b);return a});q={portalUrl:null,cookiePath:"/",
_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){var b=!1;try{b=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(a){console.log(a),b=!1}return!!b},isStringStartWith:function(b,a){return b.substr(0,a.length)===a},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(b){(b=p.getStandardPortalUrl(b))&&(b+="/");this.portalUrl=b},getPortalUrl:function(){return this.portalUrl},
isWebTierPortal:function(b){var f=new k,d=p.getStandardPortalUrl(b);b=d+"/sharing";var t=p.setHttpsProtocol(d+"/sharing/rest/generateToken?f\x3djson"),e=p.setHttpsProtocol(b);c.get(t,{jsonp:"callback"}).then(m.hitch(this,function(b){b.token?(this.webTierPortalUrls.push(d),this.removeWabAuthCookie(),g.id.getCredential(e).then(m.hitch(this,function(c){c.token||(c.token=b.token);c=r.canUseXhr(c.server,!0);-1<c&&a.defaults.io.corsEnabledServers.splice(c,1);this._pushCorsEnabledServerInfo({host:p.getServerByUrl(d),
withCredentials:!0});f.resolve(!0)}),m.hitch(this,function(){f.resolve(!0)}))):f.resolve(!1)}),m.hitch(this,function(b){console.error(b);f.reject(b)}));return f},addAuthorizedCrossOriginDomains:function(b){if(b&&0<b.length)for(var a=0;a<b.length;a++)this.addWithCredentialDomain(b[a])},addWithCredentialDomain:function(b){if(b&&"string"===typeof b){var f=a.defaults.io.corsEnabledServers,c=p.getServerByUrl(b);(b=p.getServerWithProtocol(b))||(b="http://"+c);b=r.canUseXhr(b,!0);-1<b&&f.splice(b,1);this._pushCorsEnabledServerInfo({host:c,
withCredentials:!0})}},_pushCorsEnabledServerInfo:function(b){if(b){var f=a.defaults.io.corsEnabledServers,c="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof b&&"string"===typeof b.host){for(var g in b.host)b[g]="function"===typeof b.host[g]?function(){return b.host[g].apply(b.host,arguments)}:
b.host[g];b.length=b.host.length;e.forEach(c,function(a){"function"===typeof b.host[a]&&(b[a]=function(){return b.host[a].apply(b.host,arguments)})})}f.push(b)}},tryRegisterCredential:function(b){return!this.isValidCredential(b)?!1:!e.some(g.id.credentials,m.hitch(this,function(a){return b.token===a.token}))?(g.id.credentials.push(b),!0):!1},registerToken:function(b){var a=p.getSharingUrl(this.portalUrl);g.id.findCredential(a)&&e.some(g.id.credentials,m.hitch(this,function(b,a){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,
b))return g.id.credentials.splice(a,1),!0}));return this._getTokenInfo(b).then(function(b){g.id.registerToken(b)})},_getTokenInfo:function(b){var a=p.getPortalSelfInfoUrl(this.portalUrl);return c.get(a+("?f\x3djson\x26token\x3d"+b),{jsonp:"callback"}).then(m.hitch(this,function(a){if(a.user)return{server:p.getSharingUrl(this.portalUrl),ssl:a.allSSL,token:b,userId:a.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(b){console.error(b);throw Error(window.jimuNls.urlParams.validateTokenError);
})},_isInvalidPortalUrl:function(b){return b&&"string"===typeof b&&m.trim(b)},signInPortal:function(b){var a=new k;if(this._isInvalidPortalUrl(b)){b=p.getStandardPortalUrl(b);var f=p.getSharingUrl(b),c=this.getPortalCredential(b);c?setTimeout(m.hitch(this,function(){a.resolve(c)}),0):a=g.id.getCredential(f)}else setTimeout(m.hitch(this,function(){a.reject("Invalid portalurl.")}),0);return a},_loadPortalSelfInfo:function(b){b=p.getPortalSelfInfoUrl(b);return s({url:b,handleAs:"json",content:{f:"json"},
callbackParamName:"callback"})},registerOAuthInfo:function(b,a){if(!b||!("string"===typeof b&&a&&"string"===typeof a))return null;var c=g.id.findOAuthInfo(b);c||(c=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",c=new f({appId:a,expiration:20160,portalUrl:b,authNamespace:"/",popup:!0,popupCallbackUrl:c}),g.id.registerOAuthInfos([c]));c.appId=a;return c},signOutAll:function(){var b=p.getStandardPortalUrl(this.portalUrl),a=!!g.id.findCredential(b+"/sharing/rest");
window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();g.id.destroyCredentials();g.id._oAuthHash=null;a&&this._publishCurrentPortalUserSignOut(b)},userHaveSignInPortal:function(b){return!!this.getPortalCredential(m.trim(b||""))},isValidCredential:function(b){var a=!1;if(b){var a=b.token,f=b.server,c=b.scope,a=a&&"string"===typeof a&&m.trim(a),f=f&&"string"===typeof f&&m.trim(f),c="portal"===c||"server"===c,g=!0;b.expires&&(b=parseInt(b.expires,10),g=(new Date).getTime(),
g=b>g);a=a&&f&&c&&g}return a},isValidPortalCredentialOfPortalUrl:function(b,a){var f=!1;if(this.isValidCredential(a))var f="portal"===a.scope,c=p.isSameServer(b,a.server),f=f&&c;return f},getPortalCredential:function(b){var a=null;b=m.trim(b||"");if(!b)return null;b=p.getStandardPortalUrl(b);return a=this._filterPortalCredential(b,g.id.credentials)},saveAndRegisterCookieToCredential:function(b){b=m.clone(b);b.referer=window.location.host;b.scope="portal";b.isAdmin=!!b.isAdmin;this.saveWabCookie(b);
var a=b.server+"/sharing/rest";b.server=a;g.id.registerToken(b);return g.id.findCredential(a,b.userId)},registerAuth2Hash:function(b){b=m.clone(b);var a=1E3*parseInt(b.expires_in,10),a=(new Date).getTime()+a,f=p.getStandardPortalUrl(b.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:f,token:b.access_token,expires:a,userId:b.username,scope:"portal",isAdmin:!!b.isAdmin})},saveWabCookie:function(b){this.removeCookie("wab_auth");d("wab_auth",l.stringify(b),
{expires:new Date(b.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(b,a){var f=null;if(a&&0<a.length){var c=e.filter(a,m.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<c.length&&(f=c[c.length-
1])}return f},_removePortalCredential:function(b){var a=m.trim(b||"");if(a){a=p.getStandardPortalUrl(a);for(b=e.filter(g.id.credentials,m.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)}));0<b.length;)b[0].destroy(),b.splice(0,1);g.id.credentials=e.filter(g.id.credentials,m.hitch(this,function(b){return!this.isValidPortalCredentialOfPortalUrl(a,b)}))}},getUserIdByToken:function(b,a){var f=new k;if(b&&"string"===typeof b&&a&&"string"===typeof a){var c=p.getStandardPortalUrl(a),
d=e.filter(g.id.credentials,m.hitch(this,function(a){var f=a.token===b&&a.userId;a=p.isSameServer(c,a.server);return f&&a}));if(0<d.length){var t=d[0];setTimeout(m.hitch(this,function(){f.resolve(t.userId)}),0);return f}d=p.getCommunitySelfUrl(c);s({url:d,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(m.hitch(this,function(b){f.resolve(b&&b.username||"")}),m.hitch(this,function(b){console.error(b);f.reject("fail to get userId by token")}))}else setTimeout(m.hitch(this,function(){f.reject("invalid parameters")}),
0);return f},xtGetCredentialFromCookie:function(b){var a=d("wab_auth"),f=null;if(a)try{f=l.parse(a)}catch(c){console.error(c)}if(!(f&&"object"===typeof f)||!p.isSameServer(b,f.server)||window.location.host!==f.referer)return null;f.expires=parseInt(f.expires,10);a=(new Date).getTime();if(!(f.expires>a))return this.removeCookie("wab_auth"),null;b+="/sharing/rest";f.server=b;(a=g.id.findCredential(b))||g.id.registerToken(f);return a=g.id.findCredential(b)},removeCookie:function(b){var a=this.getCookiePath();
t.removeCookie(b,a)},_getDomainsByServerName:function(b){var a=b.split("."),f=a.length;return e.map(a,m.hitch(this,function(b,c){var g=a.slice(c,f),p="",d=g.length-1;e.forEach(g,m.hitch(this,function(b,a){p+=b;a!==d&&(p+=".")}));return p}))},_publishCurrentPortalUserSignIn:function(b){if(this.isValidCredential(b))try{n.publish("userSignIn",b)}catch(a){console.error(a)}},_publishAnyUserSignIn:function(b){if(this.isValidCredential(b))try{n.publish("anyUserSignIn",b)}catch(a){console.error(a)}},_publishCurrentPortalUserSignOut:function(b){try{n.publish("userSignOut",
b)}catch(a){console.error(a)}},_signInSuccess:function(b){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,b)&&this._publishCurrentPortalUserSignIn(b),this._publishAnyUserSignIn(b)}catch(a){console.error(a)}},_bindEvents:function(){h.after(g.id,"signIn",m.hitch(this,function(b,a){console.log(a[1]);h.after(b,"callback",m.hitch(this,function(b,a){this._signInSuccess(a[0],!1)}));return b}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var b=
window.parent;if(b){var a=b.esri&&b.esri.id;a&&(g.id=a,a=window.esriConfig.defaults.io,b=b.esriConfig.defaults.io,a.corsEnabledServers=b.corsEnabledServers,a.webTierAuthServers=b.webTierAuthServers,a._processedCorsServers=b._processedCorsServers,a.corsStatus=b.corsStatus)}}this._bindEvents();this._started=!0}}};q.startup();return q})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(m,e,h,k,d,l){return m(l,
{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=h.create("div",{"class":"title"},this.domNode),this.titleLabeNode=h.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=h.create("div",{"class":"close-btn jimu-float-trailing"},
this.titleNode),this.own(d(this.closeBtnNode,"click",e.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:"OK",key:k.ENTER,onClick:e.hitch(this,this.close)})},_increaseZIndex:function(){h.setStyle(this.domNode,"zIndex",501);h.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r){var q=0;return m(s,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();
this._positioning();k.place(this.domNode,this.container);setTimeout(e.hitch(this,function(){this._moveToMiddle()}),50);this.own(l(window,"resize",e.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=k.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();d.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===
typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=k.create("div",{"class":"title"},this.domNode);this.titleLabeNode=k.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=k.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var a=null,a="ontouchstart"in document?c.press:"click";this.own(l(this.closeBtnNode,
a,e.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=k.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&k.place(this.content,this.contentContainerNode));this.buttonContainer=k.create("div",{"class":"button-container"},this.domNode);0===
this.buttons.length&&k.setStyle(this.buttonContainer,"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var c=k.getContentBox(this.buttonContainer),g=k.getMarginExtents(this.enabledButtons[0]),b=k.getPadBorderExtents(this.enabledButtons[0]),d=0,b=8===n("ie")?b.l+b.r:0,d=(c.w-(g.l+g.r+b)*a)/a;0<d&&(h.forEach(this.enabledButtons,e.hitch(this,
function(b){k.setStyle(b,"maxWidth",d+"px")})),h.forEach(this.disabledButtons,e.hitch(this,function(b){k.setStyle(b,"maxWidth",d+"px")})))}},_moveableNode:function(f,c){this.moveable&&(this.moveable.destroy(),this.moveable=null);var g=k.getMarginBox(this.container);g.l=g.l-f+c;g.w+=2*(f-c);this.moveable=new a.boxConstrainedMoveable(this.domNode,{box:g,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(l(this.moveable,"Moving",e.hitch(this,this.onMoving)));this.own(l(this.moveable,
"MoveStop",e.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===g("#header").length?{t:0,l:0,w:0,h:0}:k.getMarginBox("header")},_getFooterBox:function(){return 0===g(".footer",this.container).length?{t:0,l:0,w:0,h:0}:k.getMarginBox(g(".footer",this.container)[0])},_calculatePosition:function(){var a=k.getContentBox(this.container),c=this._getHeaderBox(),g=this._getFooterBox(),g=a.h-c.h-g.h-40,b=0;b=this._fixedHeight?this.height:this.autoHeight?g-200:this.height=g>this.maxHeight?this.maxHeight:
g;g=(g-b)/2+c.h+20;g=g<c.h?c.h:g;this.width=this.width||this.maxWidth;k.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:g+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(k.setStyle(this.domNode,"height","auto"),k.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&k.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(k.setStyle(this.domNode,"height",this.height+"px"),k.addClass(this.contentContainerNode,"content-absolute"),k.addClass(this.buttonContainer,
"button-container-absolute"),0===this.buttons.length&&k.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=k.getMarginBox(this.domNode),c=k.getContentBox(this.container),g=this._getHeaderBox(),b=this._getFooterBox(),b=c.h-g.h-b.h-40,d=0,d=a.h||b-200,a=(b-d)/2+g.h+20,a=a<g.h?g.h:a;k.setStyle(this.domNode,{left:(c.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();
this._calculateHeight()},_increaseZIndex:function(){k.setStyle(this.domNode,"zIndex",q+200+1);k.setStyle(this.overlayNode,"zIndex",q+200);q++},setTitleLabel:function(a){this.titleNode.innerHTML=r.stripHTML(a)},onMoving:function(a){k.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){k.setStyle(a.node,"opacity",1)},close:function(){if(!(this.onClose&&!1===this.onClose())){var a=this.domNode.parentNode,c=e.clone(this.domNode);k.setStyle(this.domNode,"display","none");k.destroy(this.overlayNode);
this.destroy();this.moveable.destroy();k.place(c,a);d.animateProperty({node:c,properties:{opacity:0},duration:200,onEnd:function(){k.destroy(c)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var c=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(c+=a.classNames.join(" "));var g=k.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+c,innerHTML:a.label,title:a.title||a.label},this.buttonContainer);this.enabledButtons.unshift(g);
c=k.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+c,title:a.title||a.label,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(c);this.own(l(g,"click",e.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})))},setButtonProps:function(a,c){"number"===typeof a&&isFinite(a)||(c=a,a=0);if(c&&0!==this.enabledButtons.length)for(var g in c)"title"===g?(k.setAttr(this.enabledButtons[a],"title",c[g]),
k.setAttr(this.disabledButtons[a],"title",c[g])):"label"===g&&(k.setProp(this.enabledButtons[a],"innerHTML",c[g]),k.setProp(this.disabledButtons[a],"innerHTML",c[g]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(k.setStyle(this.enabledButtons[a],"display","inline-block"),k.setStyle(this.disabledButtons[a],"display","none")):(h.forEach(this.enabledButtons[a],e.hitch(this,function(a){k.setStyle(a,"display","inline-block")})),h.forEach(this.disabledButtons[a],
e.hitch(this,function(a){k.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(k.setStyle(this.disabledButtons[a],"display","inline-block"),k.setStyle(this.enabledButtons[a],"display","none")):(h.forEach(this.disabledButtons,e.hitch(this,function(a){k.setStyle(a,"display","inline-block")})),h.forEach(this.enabledButtons,e.hitch(this,function(a){k.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},
hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(k.setStyle(this.disabledButtons[a],"display","none"),k.setStyle(this.enabledButtons[a],"display","none")):(h.forEach(this.disabledButtons,e.hitch(this,function(a){k.setStyle(a,"display","none")})),h.forEach(this.enabledButtons,e.hitch(this,function(a){k.setStyle(a,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),
function(m,e,h,k,d,l){k=m("dojo.dnd.move.constrainedMoveable",l,{constraints:function(){},within:!1,constructor:function(d,c){c||(c={});this.constraints=c.constraints;this.within=c.within},onFirstMove:function(d){var c=this.constraintBox=this.constraints.call(this,d);c.r=c.l+c.w;c.b=c.t+c.h;this.within&&(d=e.getMarginSize(d.node),c.r-=d.w,c.b-=d.h)},onMove:function(d,c){var g=this.constraintBox,a=d.node.style;this.onMoving(d,c);c.l=c.l<g.l?g.l:g.r<c.l?g.r:c.l;c.t=c.t<g.t?g.t:g.b<c.t?g.b:c.t;a.left=
c.l+"px";a.top=c.t+"px";this.onMoved(d,c)}});d=m("dojo.dnd.move.boxConstrainedMoveable",k,{box:{},constructor:function(d,c){var g=c&&c.box;this.constraints=function(){return g}}});m=m("dojo.dnd.move.parentConstrainedMoveable",k,{area:"content",constructor:function(d,c){var g=c&&c.area;this.constraints=function(){var a=this.node.parentNode,c=h.getComputedStyle(a),d=e.getMarginBox(a,c);if("margin"==g)return d;var q=e.getMarginExtents(a,c);d.l+=q.l;d.t+=q.t;d.w-=q.w;d.h-=q.h;if("border"==g)return d;
q=e.getBorderExtents(a,c);d.l+=q.l;d.t+=q.t;d.w-=q.w;d.h-=q.h;if("padding"==g)return d;q=e.getPadExtents(a,c);d.l+=q.l;d.t+=q.t;d.w-=q.w;d.h-=q.h;return d}}});return{constrainedMoveable:k,boxConstrainedMoveable:d,parentConstrainedMoveable:m}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(m,e){function h(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(e){return e},compatible:!0},{version:"1.1",
description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(e){if(e.widgetOnScreen&&e.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===e.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===e.widgetOnScreen.panel.uri))e.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel";return e},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(e){var d=0;if(e.widgetOnScreen&&e.widgetOnScreen.widgets){for(var l=
!1,d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/Splash/Widget"===e.widgetOnScreen.widgets[d].uri&&(l=!0);l||e.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});l=!1;for(d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/TimeSlider/Widget"===e.widgetOnScreen.widgets[d].uri&&(l=!0);l||e.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});l=!1;for(d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/Swipe/Widget"===
e.widgetOnScreen.widgets[d].uri&&(l=!0);l||e.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return e},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(h){(function(d){e.visitElement(d,function(d){d.positionRelativeTo&&(d.position?d.position.relativeTo=d.positionRelativeTo:d.position={relativeTo:d.positionRelativeTo},d.panel&&(d.panel.position?d.panel.position.relativeTo=d.panel.positionRelativeTo:
d.panel.position={relativeTo:d.panel.positionRelativeTo}))});var l=d.widgetOnScreen;l&&(l.panel&&l.panel.positionRelativeTo)&&(l.panel.position?l.panel.position.relativeTo=l.panel.positionRelativeTo:l.panel.position={relativeTo:l.panel.positionRelativeTo});if((l=d.widgetPool)&&l.panel&&l.panel.positionRelativeTo)l.panel.position?l.panel.position.relativeTo=l.panel.positionRelativeTo:l.panel.position={relativeTo:l.panel.positionRelativeTo}})(h);h.widgetOnScreen&&(h.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===
h.widgetOnScreen.panel.uri)&&(h.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(d){if(d.widgetOnScreen&&d.widgetOnScreen.widgets&&d.theme&&"FoldableTheme"===d.theme.name){var e=null,n=null;if(e=d.widgetOnScreen.widgets[4])void 0!==e.position.top?(e={position:{left:205,top:45}},n={position:{left:255,top:45}}):(e={position:{left:205,bottom:55}},n={position:{left:255,bottom:55}}),d.widgetOnScreen.widgets.splice(7,0,e,n)}})(h);(function(){for(var d=0,e=0,n=!1,d=0;d<h.widgetOnScreen.widgets.length;d++)if("widgets/Geocoder/Widget"===
h.widgetOnScreen.widgets[d].uri){n=!0;break}for(var c=!1,e=0;e<h.widgetOnScreen.widgets.length;e++)if("widgets/Search/Widget"===h.widgetOnScreen.widgets[e].uri){c=!0;break}!c&&n&&(d=h.widgetOnScreen.widgets[d],d.uri="widgets/Search/Widget",d.name="Search")})(h);(function(d){for(var e=0,e=d.widgetOnScreen.widgets.length-1;0<=e;e--){var n=d.widgetOnScreen.widgets[e];if("widgets/Swipe/Widget"===n.uri&&!n.closeable&&(d.widgetOnScreen.widgets.splice(e,1),!1!==n.visible)){n.closeable=!0;var c;a:{for(c=
c=0;c<d.widgetOnScreen.widgets.length;c++)if(!d.widgetOnScreen.widgets[c].uri)break a;c=-1}0<=c&&(n.position=d.widgetOnScreen.widgets[c].position,d.widgetOnScreen.widgets[c]=n)}"widgets/TimeSlider/Widget"===n.uri&&(!1===n.visible?d.widgetOnScreen.widgets.splice(e,1):n.closeable=!0)}})(h);h.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});h.loadingPage||(h.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,
uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return h},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(e){if(e.theme){var d=e.theme.name;if(("FoldableTheme"===d||"JewelryBoxTheme"===d)&&e.widgetOnScreen){var l=e.widgetOnScreen.widgets;if(l&&0<l.length)for(var d="themes/"+d+"/widgets/HeaderController/Widget",n=null,c=0;c<l.length;c++)if((n=l[c])&&n.uri===d&&n.position&&310===n.position.paddingRight)n.position.paddingRight=
275}}return e},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(e){e.keepAppState=!0;return e},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(e){return e},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(e){return e},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(e){return e},compatible:!0}];this.isCompatible=
function(e,d){for(var l=this.getVersionIndex(e),n=this.getVersionIndex(d),l=l+1;l<=n;l++)if(!1===this.versions[l].compatible)return!1;return!0}}h.prototype=new m;return h.prototype.constructor=h})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(m,e,h){e=this.getVersionIndex(e);h=this.getVersionIndex(h);if(e>h)throw Error("New version should higher than old version.");for(e+=1;e<=h;e++)this.versions[e].upgrader&&(m=this.versions[e].upgrader(m));
return m};this.getVersionIndex=function(m){m=this.fixVersion(m);var e,h;for(h=0;h<this.versions.length;h++)this.versions[h].version===m&&(e=h);null===m&&(e=-1);void 0===e&&(e=this.versions.length-1);return e};this.fixVersion=function(m){return!m?null:m}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x){var z=null,A;A=m(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(b,a){this._removeHash(b);this.urlParams=b||{};this.widgetManager=s.getInstance();e.mixin(this,a)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(e.hitch(this,function(b){var c=this.checkConfig(b);if(c)throw Error(c);this.rawAppConfig=e.clone(b);t.getInstance().setRawAppConfig(this.rawAppConfig);
b=this._upgradeAppConfig(b);this._processAfterTryLoad(b);this.appConfig=b;if(this.urlParams.id)return this.loadWidgetsManifest(b).then(e.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(b)})).then(e.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(b);return this.getAppConfig()}));q.setPortalUrl(b.portalUrl);x.arcgisUrl=p.getBaseItemUrl(b.portalUrl);return this._proesssWebTierAndSignin(b).then(e.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?
this._getAppConfigFromTemplateAppId(b.portalUrl,this.urlParams.appid).then(e.hitch(this,function(b){this._tryUpdateAppConfigByLocationUrl(b);return this._processInPortalAppProtocol(b)})):this._processNotInPortalAppProtocol(b).then(e.hitch(this,function(b){return this._getAppDataAddTemplateDataFromTemplateAppId(b.portalUrl,this.urlParams.appid).then(e.hitch(this,function(a){a.appData.appConfig&&(b=a.appData.appConfig);b._appData=a.appData;b.templateConfig=a.templateData;b.isTemplateApp=!0;return b}))})):
this._processNotInPortalAppProtocol(b)})).then(e.hitch(this,function(b){this._processAfterTryLoad(b);this.appConfig=b;return b.map.itemId?b:(b.map["3D"]?f.getDefaultWebScene(b.portalUrl):f.getDefaultWebMap(b.portalUrl)).then(function(a){b.map.itemId=a;return b})})).then(e.hitch(this,function(b){return this.loadWidgetsManifest(b)})).then(e.hitch(this,function(b){return b._appData?b._appData.values&&b._appData.values.webmap?f.getPortal(b.portalUrl).getItemById(b._appData.values.webmap).then(e.hitch(this,
function(f){return a.template.mergeTemplateAppConfigToAppConfig(b,b._appData,f)})):a.template.mergeTemplateAppConfigToAppConfig(b,b._appData):b})).then(e.hitch(this,function(b){return this.loadAndUpgradeAllWidgetsConfig(b)})).then(e.hitch(this,function(b){this._configLoaded=!0;this._setDocumentTitle(b);return this.getAppConfig()}))}),e.hitch(this,function(b){this.showError(b)}))},_setDocumentTitle:function(b){!window.isBuilder&&(b&&b.title)&&(document.title=a.stripHTML(b.title))},getAppConfig:function(){var b=
e.clone(this.appConfig);b.getConfigElementById=function(b){return a.getConfigElementById(this,b)};b.getConfigElementsByName=function(b){return a.getConfigElementsByName(this,b)};b.visitElement=function(b){a.visitElement(this,b)};this._addAuthorizedCrossOriginDomains(this.portalSelf,b);return b},_addAuthorizedCrossOriginDomains:function(b,a){b&&b.authorizedCrossOriginDomains&&q.addAuthorizedCrossOriginDomains(b.authorizedCrossOriginDomains);a&&a.authorizedCrossOriginDomains&&q.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains)},
checkConfig:function(b){return(b=this._getRepeatedId(b))?"repeated id:"+b:null},processProxy:function(b){v.defaults.io.alwaysUseProxy=b.httpProxy&&b.httpProxy.useProxy&&b.httpProxy.alwaysUseProxy;v.defaults.io.proxyUrl="";v.defaults.io.proxyRules=[];b.httpProxy&&(b.httpProxy.useProxy&&b.httpProxy.url)&&(v.defaults.io.proxyUrl=b.httpProxy.url);b.httpProxy&&(b.httpProxy.useProxy&&b.httpProxy.rules)&&h.forEach(b.httpProxy.rules,function(b){u.addProxyRule(b)})},addNeedValues:function(b){this._processNoUriWidgets(b);
this._addElementId(b);this._processWidgetJsons(b)},showError:function(b){b&&b.message&&k.create("div",{"class":"app-error",innerHTML:b.message},document.body)},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,g(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(e.hitch(this,function(b){q.setPortalUrl(b.portalUrl);
return this.urlParams.token?q.registerToken(this.urlParams.token).then(function(){return b}):b}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var b=p.getPortalUrlFromLocation(),a=new n;q.setPortalUrl(b);x.arcgisUrl=p.getBaseItemUrl(b);var c;this.urlParams.token?c=q.registerToken(this.urlParams.token):(c=new n,c.resolve());c.then(e.hitch(this,function(){f.getPortal(b).loadSelfInfo().then(e.hitch(this,function(f){this.portalSelf=f;f.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),
window.location.href=p.setHttpsProtocol(window.location.href),a.reject()):this._processSignIn(b).then(e.hitch(this,function(){this._getAppConfigFromAppId(b,this.urlParams.id).then(e.hitch(this,function(b){this._tryUpdateAppConfigByLocationUrl(b);return this._processInPortalAppProtocol(b)})).then(function(b){a.resolve(b)},function(b){a.reject(b)})}))}))}),e.hitch(this,function(b){this.showError(b)}));return a}this.configFile="config.json";return g(this.configFile,{handleAs:"json"}).then(e.hitch(this,
function(b){q.setPortalUrl(b.portalUrl);return this.urlParams.token?q.registerToken(this.urlParams.token).then(function(){return b}):b}))},_upgradeAppConfig:function(b){var a=window.wabVersion,f=b.wabVersion;if(a===f)return b;var c=this.versionManager.getVersionIndex(f),g=this.versionManager.getVersionIndex(a);if(c>g)throw Error("Bad version number, "+f);b=this.versionManager.upgrade(b,f,a);b.wabVersion=a;return b},loadAndUpgradeAllWidgetsConfig:function(b){var a=new n,f=[];r.visitElement(b,e.hitch(this,
function(b){b.uri&&(b=this.widgetManager.tryLoadWidgetConfig(b),f.push(b))}));c(f).then(e.hitch(this,function(){a.resolve(b)}),function(b){a.reject(b)});return a},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);b.tokenValidity=10080;return a},_tryUpdateAppConfigByLocationUrl:function(b){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var a=
p.getPortalUrlFromLocation(),a=p.getStandardPortalUrl(a);p.isOnline(a)&&(a=p.updateUrlProtocolByOtherUrl(a,b.portalUrl),b.map.portalUrl&&p.isSamePortalUrl(b.portalUrl,b.map.portalUrl)&&(b.map.portalUrl=a),b.portalUrl=a,b.httpProxy&&b.httpProxy.url&&(b.httpProxy.url=p.getPortalProxyUrl(a)))}},_processWidgetJsons:function(b){r.visitElement(b,function(b,f){f.isWidget&&b.uri&&a.widgetJson.processWidgetJson(b)})},_processNoUriWidgets:function(b){var a=0;r.visitElement(b,function(b,f){f.isWidget&&!b.uri&&
(a++,b.placeholderIndex=a)})},_addElementId:function(b){var a=0,f;r.visitElement(b,function(b){if(b.id){b.id=b.id.replace(/\//g,"_");var c=b.id.lastIndexOf("_");-1<c&&(f=b.id.substr(c+1),a=Math.max(a,f))}});r.visitElement(b,function(b){b.id||(a++,b.id=b.uri?b.uri.replace(/\//g,"_")+"_"+a:"_"+a)})},_setPortalUrl:function(b){if(b.portalUrl){var a=p.getPortalUrlFromLocation(),f=p.isOnline(a);!p.isSamePortalUrl(b.portalUrl,a)&&!f&&(window.appInfo.isRunInPortal=!1)}else window.isXT&&l("wab_portalurl")?
b.portalUrl=l("wab_portalurl"):(window.appInfo.isRunInPortal=!0,b.portalUrl=p.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(b,a){b.portalUrl=p.setProtocol(b.portalUrl,a);b.map.portalUrl&&(b.map.portalUrl=p.setProtocol(b.map.portalUrl,a));b.httpProxy&&(b.httpProxy.url=p.setProtocol(b.httpProxy.url,a),b.httpProxy&&b.httpProxy.rules&&h.forEach(b.httpProxy.rules,e.hitch(this,function(b){b.proxyUrl=p.setProtocol(b.proxyUrl,a)})))},_processInPortalAppProtocol:function(b){var a=new n,c=
f.getPortal(b.portalUrl),g=e.hitch(this,function(f){if("https:"===window.location.protocol)this._changePortalUrlProtocol(b,"https");else{if(f){console.log("redirect from http to https");window.location.href=p.setHttpsProtocol(window.location.href);a.reject();return}this._changePortalUrlProtocol(b,"http")}this._checkLocale();a.resolve(b)});c.loadSelfInfo().then(e.hitch(this,function(a){"private"===a.access?(a=0===b.portalUrl.toLowerCase().indexOf("https://"),g(a)):g(a.allSSL)}),e.hitch(this,function(b){a.reject(b)}));
return a},_processNotInPortalAppProtocol:function(b){var a=new n;b.portalUrl?f.getPortal(b.portalUrl).loadSelfInfo().then(e.hitch(this,function(f){var c="https:"===window.location.protocol;(f.allSSL||c)&&this._changePortalUrlProtocol(b,"https");0===b.portalUrl.toLowerCase().indexOf("https://")&&!c&&!q.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=p.setHttpsProtocol(window.location.href),a.reject()):a.resolve(b)}),e.hitch(this,function(b){a.reject(b)})):
a.resolve(b);return a},_proesssWebTierAndSignin:function(b){var a=new n,c=!1,g=b.portalUrl;this._processWebTier(b).then(e.hitch(this,function(b){c=b;return f.getPortal(g).loadSelfInfo()})).then(e.hitch(this,function(b){this.portalSelf=b;return this._processSignIn(g,c)})).then(e.hitch(this,function(){a.resolve()}),function(b){a.reject(b)});return a},_processWebTier:function(b){var a=new n,f=b.portalUrl;b.isWebTier?(q.addAuthorizedCrossOriginDomains([f]),q.isWebTierPortal(f).then(e.hitch(this,function(){var c=
q.getPortalCredential(f);c&&c.ssl&&"http:"===window.location.protocol&&!q.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=p.setHttpsProtocol(window.location.href)):a.resolve(b.isWebTier)}),e.hitch(this,function(b){a.reject(b)}))):a.resolve(!1);return a},_processSignIn:function(a,c){var g=new n,d=f.getPortal(a),t=p.getSharingUrl(a);window.appInfo.isRunInPortal?(t=b.checkSignInStatus(t),t.promise.always(e.hitch(this,function(){g.resolve()}))):(!q.isInBuilderWindow()&&
(!q.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig.appId&&!c)&&q.registerOAuthInfo(a,this.rawAppConfig.appId),t=b.checkSignInStatus(t),t.promise.always(e.hitch(this,function(){q.xtGetCredentialFromCookie(a);d.loadSelfInfo().then(e.hitch(this,function(b){this.portalSelf=b;this._checkLocale();g.resolve()}))})));return g},_checkLocale:function(){if(!q.isInConfigOrPreviewWindow()){var b=this.portalSelf.user&&this.portalSelf.user.culture||d.locale,b=b.toLowerCase();!this.urlParams.locale&&
a.isLocaleChanged(d.locale,b)&&(l("wab_app_locale",b),window.location.reload())}},_getAppConfigFromTemplateAppId:function(b,a){var g=f.getPortal(b);return this._getWabAppIdAndDataFromTemplateAppId(b,a).then(e.hitch(this,function(a){var f=a.appData;return c([this._getAppConfigFromAppId(b,a.appId),g.getItemData(f.source)]).then(e.hitch(this,function(b){var a;f.appConfig?(a=f.appConfig,delete f.appConfig):a=b[0];a=this._upgradeAppConfig(a);b=b[1];a._appData=f;a.templateConfig=b;a.isTemplateApp=!0;return a}))}))},
_getAppDataAddTemplateDataFromTemplateAppId:function(b,a){var c=f.getPortal(b);return c.getItemData(a).then(function(b){return c.getItemData(b.source).then(function(a){return{appData:b,templateData:a}})})},_getWabAppIdAndDataFromTemplateAppId:function(b,a){var c=new n,g=f.getPortal(b);g.getItemData(a).then(e.hitch(this,function(b){g.getItemById(b.source).then(e.hitch(this,function(a){a=u.urlToObject(a.url);c.resolve({appId:a.query.id,appData:b})}))}),function(b){c.reject(b)});return c},_getAppConfigFromAppId:function(b,
a){return f.getPortal(b).getItemData(a)},_removeHash:function(b){for(var a in b)b[a]&&(b[a]=b[a].replace("#",""))},loadWidgetsManifest:function(b){var f=[],g=new n;b._buildInfo&&b._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(e.hitch(this,function(d){r.visitElement(b,e.hitch(this,function(b){!b.widgets&&b.uri&&(d[b.uri]?(this._addNeedValuesForManifest(d[b.uri]),a.widgetJson.addManifest2WidgetJson(b,d[b.uri])):f.push(this.widgetManager.loadWidgetManifest(b)))}));c(f).then(function(){g.resolve(b)})})):
(r.visitElement(b,e.hitch(this,function(b){!b.widgets&&b.uri&&f.push(this.widgetManager.loadWidgetManifest(b))})),c(f).then(function(){g.resolve(b)}));setTimeout(function(){function a(b){function f(a){b[a]&&b[a].widgets&&(b[a].widgets=b[a].widgets.filter(function(b){b.uri&&!b.manifest&&console.error("Widget is removed because it is not loaded successfully.",b.uri);return b.manifest}));b[a]&&b[a].groups&&b[a].groups.forEach(function(b){b.widgets&&(b.widgets=b.widgets.filter(function(b){b.uri&&!b.manifest&&
console.error("Widget is removed because it is not loaded successfully.",b.uri);return b.manifest}))})}f("widgetOnScreen");f("widgetPool")}g.isResolved()||(a(b),g.resolve(b))},6E4);return g},_addNeedValuesForManifest:function(b){a.manifest.addManifestProperies(b);a.manifest.processManifestLabel(b,d.locale)},_loadMergedWidgetManifests:function(){return g(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(b){var a=[],f;r.visitElement(b,function(b){if(0<=
a.indexOf(b.id))return f=b.id,!0;a.push(b.id)});return f},_processUrlParams:function(b){var f=this.urlParams.itemid||this.urlParams.webmap;f&&b.map.itemId!==f&&(b.map.mapOptions&&a.deleteMapOptions(b.map.mapOptions),b.map.itemId=f);this.urlParams.mode&&(b.mode=this.urlParams.mode);b.map.mapOptions||(b.map.mapOptions={});this.urlParams.scale&&(b.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)b.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});
A.getInstance=function(b,a){null===z?z=new A(b,a):(z.urlParams=b,z.options=a);return z};return A})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(m,e,h,k,d,l,n,c,g,a,s){var r=m([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(b){this.portalUrl=a.getStandardPortalUrl(b);
this.selfUrl=a.getPortalSelfInfoUrl(b)},loadSelfInfo:function(){var b=new d,a={url:this.selfUrl,content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};this.isValidCredential()&&(a.content.token=this.credential.token);c(a).then(e.hitch(this,function(a){var f=a.user;delete a.user;e.mixin(this,a);a.user=f;b.resolve(a)}),e.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_checkCredential:function(){var b=s.isValidCredential(this.credential);b||this.clearCredentialAndUser();
return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=s.getPortalCredential(this.portalUrl))},signIn:function(){var b=new d;this.updateCredential();this.isValidCredential()?setTimeout(e.hitch(this,function(){b.resolve(this.credential)}),0):b=s.signInPortal(this.portalUrl);return b},haveSignIn:function(){return s.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=
this.credential=null},getUser:function(){this.updateCredential();var b=new d;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(e.hitch(this,function(){this.user.updateCredential();b.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(e.hitch(this,function(a){this.user=a;b.resolve(this.user)}),e.hitch(this,function(a){console.error(a);b.reject(a)})):s.getUserIdByToken(this.credential.token,this.portalUrl).then(e.hitch(this,
function(a){this.credential.userId=a;this._getUser(this.credential.userId).then(e.hitch(this,function(a){this.user=a;b.resolve(this.user)}),e.hitch(this,function(a){console.error(a);b.reject(a)}))}),e.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(e.hitch(this,function(){b.reject("credential is null.")}),0);return b},queryItems:function(b){this.updateCredential();var f=new d,g=a.getBaseSearchUrl(this.portalUrl),t={f:"json"};b&&(t=e.mixin(t,b));this.isValidCredential()&&(t.token=
this.credential.token);!t.sortField&&!t.sortOrder&&(t.sortField="title",t.sortOrder="asc");c({url:g,handleAs:"json",content:t,callbackParamName:"callback"}).then(e.hitch(this,function(b){b.results=h.map(b.results,e.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;return new p(b)}));f.resolve(b)}),e.hitch(this,function(b){console.error(b);f.reject(b)}));return f},getItemData:function(b){this.updateCredential();b={url:a.getItemDataUrl(this.portalUrl,b),handleAs:"json",
content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return c(b)},getItemById:function(b){var f=new d;this.updateCredential();b={url:a.getItemUrl(this.portalUrl,b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);c(b).then(e.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;b=new p(b);f.resolve(b)}),e.hitch(this,
function(b){console.error(b);f.reject(b)}));return f},getAppById:function(b){var f=new d;this.updateCredential();this.isValidCredential()?(b=a.getAppIdUrl(this.portalUrl,b),f=c({url:b,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(e.hitch(this,function(){f.reject("token is null.")}),0);return f},queryGroups:function(b){this.updateCredential();var g=new d,p=a.getBaseGroupUrl(this.portalUrl),t={f:"json"};b&&(t=e.mixin(t,b));this.isValidCredential()&&(t.token=this.credential.token);
c({url:p,handleAs:"json",content:t,callbackParamName:"callback"}).then(e.hitch(this,function(b){b.results=h.map(b.results,e.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;return new f(b)}));g.resolve(b)}),e.hitch(this,function(b){console.error(b);g.reject(b)}));return g},registerApp:function(b,f,g){var p=new d;this.updateCredential();if(this.isValidCredential())var t=this.credential&&this.credential.token,q=a.getOAuth2Url(this.portalUrl),p=c({url:q+"/registerApp",
content:{itemId:b,appType:f,redirect_uris:n.stringify(g),token:t,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(e.hitch(this,function(){p.reject("token is null.")}),0);return p},createAndRegisterApp:function(b){var a=new d;this.updateCredential();this.isValidCredential()?this.getUser().then(e.hitch(this,function(f){f.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(e.hitch(this,function(f){f.success?this.registerApp(f.id,
"browser",b).then(e.hitch(this,function(b){a.resolve(b)}),e.hitch(this,function(b){console.error(b);a.reject(b)})):a.reject("create app failed")}),e.hitch(this,function(b){console.error(b);a.reject(b)}))}),e.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(e.hitch(this,function(){a.reject("token is null.")}),0);return a},_getUser:function(b){this.updateCredential();var f=new d;b={url:a.getUserUrl(this.portalUrl,b),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&
(b.content.token=this.credential&&this.credential.token);c(b).then(e.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;this.user=new q(b);f.resolve(this.user)}),e.hitch(this,function(b){console.error(b);f.reject(b)}));return f}}),q=m([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(b){b&&e.mixin(this,b)},_checkCredential:function(){var b=s.isValidCredential(this.credential);b||(this.credential=null);return b},
isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var b=[];this.groups&&(b=h.map(this.groups,e.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this.portal;return new f(b)})));return b},getItemsByKeywords:function(b,a){return this.portal.queryItems({start:a||1,num:100,q:"owner:"+
this.username+' AND typekeywords:"'+b+'"'})},getContent:function(){this.updateCredential();var b={url:a.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(b.content.token=this.credential.token);return c(b)},getTags:function(){this.updateCredential();var b={url:a.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=
this.credential.token);return c(b)},addItem:function(b,f){this.updateCredential();var g=new d;if(this.isValidCredential()){var p={f:"json",token:this.credential.token};b&&(p=e.mixin(p,b));c({url:a.getAddItemUrl(this.portalUrl,this.username,f),handleAs:"json",callbackParamName:"callback",content:p},{usePost:!0}).then(e.hitch(this,function(b){g.resolve(b)}),e.hitch(this,function(b){console.error(b);g.reject(b)}))}else setTimeout(e.hitch(this,function(){g.reject("token is null.")}),0);return g},deleteItem:function(b){this.updateCredential();
var f=new d;this.isValidCredential()?(b=a.getDeleteItemUrl(this.portalUrl,this.username,b),f=c({url:b,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(e.hitch(this,function(){f.reject("token is null.")}),0);return f},getItemById:function(b,f){this.updateCredential();var g=new d,t={url:a.getUserItemsUrl(this.portalUrl,this.username,f)+"/"+b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(t.content.token=this.credential.token);
c(t).then(e.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;b=new p(b);g.resolve(b)}),e.hitch(this,function(b){console.error(b);g.reject(b)}));return g},shareItem:function(b,f,g){this.updateCredential();var p=new d;this.isValidCredential()?(f={url:a.shareItemUrl(this.portalUrl,this.username,f,g),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},b&&(f.content=e.mixin(f.content,b)),c(f,{usePost:!0}).then(e.hitch(this,
function(b){p.resolve(b)}),e.hitch(this,function(b){console.error(b);p.reject(b)}))):setTimeout(e.hitch(this,function(){p.reject("token is null.")}),0);return p},updateItem:function(b,f){this.updateCredential();var g=new d;this.isValidCredential()?this.portal.getItemById(b).then(e.hitch(this,function(p){var d={f:"json",token:this.credential.token};f&&(d=e.mixin(d,f));c({url:a.getUpdateItemUrl(this.portalUrl,this.username,b,p.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:d},
{usePost:!0}).then(e.hitch(this,function(b){g.resolve(b)}),e.hitch(this,function(b){console.error(b);g.reject(b)}))}),e.hitch(this,function(b){console.error(b);g.reject(b)})):setTimeout(e.hitch(this,function(){g.reject("token is null.")}),0);return g},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),
f=m([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(b){b&&e.mixin(this,b)},_checkCredential:function(){var b=s.isValidCredential(this.credential);b||(this.credential=null);return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(b){b.q="group:"+this.id+" AND "+b.q;
return this.portal.queryItems(b)}}),p=m([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(b){b&&e.mixin(this,b);this.itemUrl=a.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&(this.thumbnail&&this.itemUrl)&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);
this.portalUrl&&this.id&&(this.detailsPageUrl=a.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=a.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var b=s.isValidCredential(this.credential);b||(this.credential=null);return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},
getItemData:function(){return this.portal.getItemData(this.id)}}),t={portals:[],webMapQueryStr:" "+g.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+g.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(b){for(var f=0;f<this.portals.length;f++){var c=this.portals[f];if(a.isSamePortalUrl(b,c.portalUrl))return c.updateCredential(),c}return null},getPortal:function(b){if(!b||!("string"===typeof b&&e.trim(b)))return null;b=a.getStandardPortalUrl(b);var f=this._findPortal(b);
f||(f=new r(b),f.credential=s.getPortalCredential(f.portalUrl),f.updateCredential(),this.portals.push(f));return f},getPortalSelfInfo:function(b){return this.getPortal(b).loadSelfInfo()},getBasemapGalleryGroup:function(b){return this._getPortalSelfGroup(b,"basemapGalleryGroupQuery")},getTemplatesGroup:function(b){return this._getPortalSelfGroup(b,"templatesGroupQuery")},getUnits:function(b){var a="english",f="",c=new d;this.getPortal(b).getUser().then(e.hitch(this,function(b){b&&b.units?a=b.units:
(f=k.locale,a=f.startWith("en")?"english":"metric");c.resolve(a)}),e.hitch(this,function(g){console.warn(g);this.getPortalSelfInfo(b).then(e.hitch(this,function(b){var a=null;b&&b.units?a=b.units:(f=b&&b.culture||k.locale,a=f.startWith("en")?"english":"metric");c.resolve(a)}),e.hitch(this,function(b){console.warn(b);f=k.locale;a=f.startWith("en")?"english":"metric";c.resolve(a)}))}));return c.promise},_getPortalSelfGroup:function(b,a){var c=new d,g=this.getPortal(b);g||setTimeout(e.hitch(this,function(){c.reject()}),
0);this.getPortalSelfInfo(b).then(e.hitch(this,function(b){g.queryGroups({f:"json",q:b[a]}).then(e.hitch(this,function(b){0<b.results.length?(b=b.results[0],b.portalUrl=g.portalUrl,b.credential=g.credential,b.portal=g,b=new f(b),c.resolve(b)):c.reject("Can't find portal self group.")}),e.hitch(this,function(b){console.error(b);c.reject(b)}))}),e.hitch(this,function(b){console.error(b);c.reject(b)}));return c},getWebMapsFromBasemapGalleryGroup:function(b){var a=new d;this.getBasemapGalleryGroup(b).then(e.hitch(this,
function(b){b?b.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(e.hitch(this,function(b){a.resolve(b)}),e.hitch(this,function(b){console.error(b);a.reject(b)})):a.reject()}),e.hitch(this,function(b){console.error(b);a.reject(b)}));return a},getDefaultWebScene:function(b){var f=a.getStandardPortalUrl(b);return this._searchWABDefaultWebScene(f).then(e.hitch(this,function(b){return b?b:this._createWABDefaultWebScene(f).then(e.hitch(this,function(b){return this.getPortal(f).getUser().then(e.hitch(this,
function(a){var f=!1;a&&(a.privileges&&0<a.privileges.length)&&(f=h.some(a.privileges,function(b){return 0<=b.indexOf("shareToPublic")}));return f?a.shareItem({everyone:!0},b).then(e.hitch(this,function(){return b}),e.hitch(this,function(){return b})):b}),e.hitch(this,function(a){console.error(a);return b}))}))}))},_searchWABDefaultWebScene:function(b){var f=new d;b=a.getStandardPortalUrl(b);this.getPortal(b).queryItems({q:'typekeywords:"WABDefaultWebScene" access:public '+this.webSceneQueryStr}).then(e.hitch(this,
function(b){b&&b.results&&0<b.results.length?f.resolve(b.results[0].id):f.resolve(null)}),e.hitch(this,function(b){console.error("_searchWABDefaultWebScene error:",b);f.reject(b)}));return f},_createWABDefaultWebScene:function(b){var f=new d;b=a.getStandardPortalUrl(b);this.getPortal(b).getUser().then(e.hitch(this,function(b){var a={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:n.stringify({operationalLayers:[],baseMap:{id:"151b431fe65-basemap-0",
title:"Topographic",baseMapLayers:[{id:"defaultBasemap",url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer"}],elevationLayers:[{id:"globalElevation",url:"http://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}]},version:"1.3",authoringApp:"WebSceneViewer",authoringAppVersion:"3.10.0.0",spatialReference:{wkid:102100,latestWkid:3857},viewingMode:"global",
initialState:{viewpoint:{scale:4.5188197847224146E7,rotation:0,targetGeometry:{x:144770.99872895706,y:3232837.215000455,spatialReference:{wkid:102100,latestWkid:3857},z:-127.7412482528016},camera:{position:{x:144770.99767624016,y:3182557.105058348,spatialReference:{wkid:102100,latestWkid:3857},z:2.551254800000001E7},heading:0,tilt:0.0999986601088944}},environment:{lighting:{datetime:1426420488E3,displayUTCOffset:0}}},presentation:{slides:[]}}),snippet:""};b.addItem(a,"").then(e.hitch(this,function(b){b.success?
f.resolve(b.id):(console.error("Can't create default web scene:",b),f.reject())}))}),e.hitch(this,function(b){console.error("Can't create default web scene");f.reject(b)}));return f},getDefaultWebMap:function(b){var a=new d;this.getPortalSelfInfo(b).then(e.hitch(this,function(f){var c=f.defaultBasemap&&f.defaultBasemap.id;c?a.resolve(c):this._getDefaultWebMapByBasemapGallery(b,f).then(e.hitch(this,function(f){f?a.resolve(f):this._getMostNumViewsWebMap(b).then(e.hitch(this,function(b){b?a.resolve(b):
a.reject()}),e.hitch(this,function(b){console.error(b);a.reject(b)}))}),e.hitch(this,function(b){console.error(b);a.reject(b)}))}),e.hitch(this,function(b){console.error(b);a.reject(b)}));return a},_getDefaultWebMapByBasemapGallery:function(b,a){var f=new d,c=this.getPortal(b),g=a.defaultBasemap&&a.defaultBasemap.title;c.queryGroups({f:"json",q:a.basemapGalleryGroupQuery}).then(e.hitch(this,function(b){b=b.results;0<b.length?c.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+
b[0].id+" AND title:"+g}).then(e.hitch(this,function(b){b=b.results;b=h.filter(b,e.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));0<b.length?f.resolve(b[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),c.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+g}).then(e.hitch(this,function(b){b=b.results;b=h.filter(b,e.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));if(0<b.length){var a=b[0];c.getItemData(a.id).then(e.hitch(this,
function(b){b&&(b.operationalLayers||b.baseMap||b.version)?f.resolve(a.id):f.resolve(null)}),e.hitch(this,function(){f.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),f.resolve(null)}),e.hitch(this,function(b){console.error(b);f.reject(b)})))}),e.hitch(this,function(b){console.error(b);f.reject(b)})):(console.log("Can't find group by basemapGalleryGroupQuery."),f.resolve(null))}),e.hitch(this,function(b){console.error(b);f.reject(b)}));return f},_getMostNumViewsWebMap:function(b){var a=
new d;this.getPortal(b).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(e.hitch(this,function(b){b=b.results;b=h.filter(b,e.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));0<b.length?a.resolve(b[0].id):a.reject("Can't find most-num-views web map.")}),e.hitch(this,function(b){console.error(b);a.reject(b)}));return a},comparePortalVersion:function(b,a){var f=b.split("."),c=parseInt(f[0],
10),f=1<f.length?parseInt(f[1],10):0,g=a.split("."),p=parseInt(g[0],10),g=1<g.length?parseInt(g[1],10):0;return c>p?1:c<p?-1:f>g?1:f<g?-1:0}};l.subscribe("userSignOut",function(b){(b=t._findPortal(b))&&b.clearCredentialAndUser()});return t})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(m,e,h,k,d,l,n,c,g){var a=null,s=m(null,{rawAppConfig:null,
mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var a=k.stringify(this.rawAppConfig.map);this.mapMd5=c(a)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new h,c={};if(g.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(c),
a;var f=this._getAppStateKey(),p=n.get(f);p&&p.appStateMd5===this._getAppStateMd5()?(f=p.map&&p.map.extent,p=p.map&&p.map.layers,f&&(c.extent=new d(f.xmin,f.ymin,f.xmax,f.ymax,new l(f.spatialReference))),p&&(c.layers=p)):n.remove(f);a.resolve(c);return a},saveWabAppState:function(a,c){if(a&&!g.isInConfigOrPreviewWindow()){var f=this._getAppStateKey(),p={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},
layers:{}};c&&c.traversal&&c.traversal(e.hitch(this,function(a){p.layers[a.id]={visible:a.isVisible()}}));n.set(f,{map:p,appStateMd5:this._getAppStateMd5()})}}});s.getInstance=function(c){null===a&&(a=new s);a.urlParams=c;return a};return s})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(m,e,h,k){return m(e,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);
(this.hidden=!0===this.hidden)&&h.set(this.domNode,{display:"none"});h.set(this.domNode,{width:"100%",height:"100%"});var d='\x3cdiv class\x3d"loading-section"\x3e\x3cimg class\x3d"jimu-loading" src\x3d"'+require.toUrl("jimu")+'/images/loading2.gif"\x3e\x3c/div\x3e';k.place(d,this.domNode)},show:function(){this.domNode&&h.set(this.domNode,"display","block")},hide:function(){this.domNode&&h.set(this.domNode,"display","none")}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/dom-construct dojo/dom-geometry dojo/Deferred dojo/promise/all dojo/when require ./WidgetManager ./PanelManager ./MapManager ./utils ./OnScreenWidgetIcon ./WidgetPlaceholder ./dijit/LoadingShelter".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z){var A=null,C;C=m([d],{constructor:function(b,a){this.widgetManager=p.getInstance();this.panelManager=t.getInstance();this.own(l.subscribe("appConfigLoaded",e.hitch(this,this.onAppConfigLoaded)));this.own(l.subscribe("appConfigChanged",e.hitch(this,this.onAppConfigChanged)));this.own(l.subscribe("mapLoaded",e.hitch(this,this.onMapLoaded)));this.own(l.subscribe("mapChanged",e.hitch(this,this.onMapChanged)));this.own(l.subscribe("beforeMapDestory",
e.hitch(this,this.onBeforeMapDestory)));this.own(l.subscribe("preloadModulesLoaded",e.hitch(this,this._onPreloadModulesLoaded)));this.own(l.subscribe("builder/actionTriggered",e.hitch(this,this.onActionTriggered)));this.own(l.subscribe("openWidget",e.hitch(this,this._onOpenWidgetRequest)));this.widgetPlaceholders=[];this.preloadWidgetIcons=[];this.preloadGroupPanels=[];this.invisibleWidgetIds=[];this.own(n(window,"resize",e.hitch(this,this.resize)));this.id=a;this.preloadModulesLoadDef=new s},postCreate:function(){this.containerNode=
this.domNode},map:null,mapId:"map",hlDiv:null,animTime:500,resize:function(){h.forEach(this.widgetManager.getAllWidgets(),function(b){!1===b.inPanel&&b.resize()},this)},onAppConfigLoaded:function(b){this.appConfig=e.clone(b);this._loadMap();this.preloadModulesLoadDef.then(e.hitch(this,function(){this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},onAppConfigChanged:function(b,a,f){b=e.clone(b);switch(a){case "themeChange":this._onThemeChange(b);
break;case "styleChange":this._onStyleChange(b);break;case "layoutChange":this._onLayoutChange(b);break;case "widgetChange":this._onWidgetChange(b,f);break;case "groupChange":this._onGroupChange(b,f);break;case "widgetPoolChange":this._onWidgetPoolChange(b,f);break;case "resetConfig":this._onResetConfig(b);break;case "loadingPageChange":this._onLoadingPageChange(b,f)}this.appConfig=b},onMapLoaded:function(b){this.map=b;this.panelManager.setMap(b);this.preloadModulesLoadDef.then(e.hitch(this,function(){this._loadPreloadWidgets(this.appConfig)}))},
onMapChanged:function(b){this.map=b;this.panelManager.setMap(b);this._loadPreloadWidgets(this.appConfig)},onBeforeMapDestory:function(){this.panelManager.destroyAllPanels();this._destroyOffPanelWidgets();this._destroyWidgetPlaceholders();this._destroyPreloadWidgetIcons()},onActionTriggered:function(b){"highLight"===b.action&&(h.forEach(this.widgetPlaceholders,function(a){a.configId===b.elementId&&this._highLight(a)},this),h.forEach(this.preloadWidgetIcons,function(a){a.configId===b.elementId&&this._highLight(a)},
this),h.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.configId===b.elementId&&this._highLight(a)},this),h.forEach(this.preloadGroupPanels,function(a){a.configId===b.elementId&&this._highLight(a)},this));"removeHighLight"===b.action&&this._removeHighLight();"showLoading"===b.action&&(k.setStyle(jimuConfig.loadingId,"display","block"),k.setStyle(jimuConfig.mainPageId,"display","none"));"showApp"===b.action&&(k.setStyle(jimuConfig.loadingId,"display","none"),k.setStyle(jimuConfig.mainPageId,
"display","block"))},_highLight:function(b){if(b.domNode){this.hlDiv&&this._removeHighLight(b);var f=a.getMarginBox(b.domNode);this.hlDiv=g.create("div",{style:{position:"absolute",left:f.l+"px",top:f.t+"px",width:f.w+"px",height:f.h+"px"},"class":"icon-highlight"},b.domNode,"before")}},_removeHighLight:function(){this.hlDiv&&(g.destroy(this.hlDiv),this.hlDiv=null)},_onWidgetChange:function(b,a){a=b.getConfigElementById(a.id);a.isController?this._reloadControllerWidget(b,a.id):(h.forEach(this.widgetPlaceholders,
function(f){f.configId===a.id&&(f.destroy(),this._loadPreloadWidget(a,b))},this),this._removeDestroyed(this.widgetPlaceholders),h.forEach(this.preloadWidgetIcons,function(f){if(f.configId===a.id){var c=f.state;f.destroy();this._loadPreloadWidget(a,b).then(function(b){if(a.uri&&"opened"===c)b.onClick()})}},this),this._removeDestroyed(this.preloadWidgetIcons),h.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(f){f.configId===a.id&&(f.destroy(),!1===a.visible?0>this.invisibleWidgetIds.indexOf(a.id)&&
this.invisibleWidgetIds.push(a.id):this._loadPreloadWidget(a,b))},this),h.forEach(this.preloadGroupPanels,function(b){b.reloadWidget(a)},this),this._updatePlaceholder(b),h.forEach(this.invisibleWidgetIds,function(f){f===a.id&&!1!==a.visible&&(this._loadPreloadWidget(a,b),f=this.invisibleWidgetIds.indexOf(a.id),this.invisibleWidgetIds.splice(f,1))},this),a.isOnScreen||h.forEach(this.widgetManager.getControllerWidgets(),function(f){f.widgetIsControlled(a.id)&&this._reloadControllerWidget(b,f.id)},this))},
_onGroupChange:function(b,a){a=b.getConfigElementById(a.id);a.isOnScreen?(this.panelManager.destroyPanel(a.id+"_panel"),this._removeDestroyed(this.preloadGroupPanels),this._loadPreloadGroup(a,b)):(h.forEach(this.widgetManager.getControllerWidgets(),function(f){f.isControlled(a.id)&&this._reloadControllerWidget(b,f.id)},this),h.forEach(this.panelManager.panels,function(b){b.config.id===a.id&&b.updateConfig(a)},this))},_updatePlaceholder:function(b){h.forEach(this.widgetPlaceholders,function(a){a.setIndex(b.getConfigElementById(a.configId).placeholderIndex)},
this)},_onWidgetPoolChange:function(b,a){this._reloadControllerWidget(b,a.controllerId)},_reloadControllerWidget:function(b,a){var f=this.widgetManager.getWidgetById(a);if(f){var c=f.getOpenedIds(),g=f.windowState;h.forEach(f.getAllConfigs(),function(b){if(b.widgets)this.panelManager.destroyPanel(b.id+"_panel"),h.forEach(b.widgets,function(b){this.panelManager.destroyPanel(b.id+"_panel")},this);else{var a=this.widgetManager.getWidgetById(b.id);a&&(b.inPanel?this.panelManager.destroyPanel(a.getPanel()):
this.widgetManager.destroyWidget(a))}},this);this.widgetManager.destroyWidget(f);f=b.getConfigElementById(a);!1!==f.visible&&this._loadPreloadWidget(f,b).then(e.hitch(this,function(b){this.widgetManager.changeWindowStateTo(b,g);c&&b.setOpenedIds(c)}))}},_removeDestroyed:function(b){var a=[];h.forEach(b,function(b){b._destroyed&&a.push(b)});h.forEach(a,function(a){a=b.indexOf(a);b.splice(a,1)})},_destroyPreloadWidgetIcons:function(){h.forEach(this.preloadWidgetIcons,function(b){b.destroy()},this);
this.preloadWidgetIcons=[]},_destroyOffPanelWidgets:function(){h.forEach(this.widgetManager.getOffPanelWidgets(),function(b){this.widgetManager.destroyWidget(b)},this)},_destroyWidgetPlaceholders:function(){h.forEach(this.widgetPlaceholders,function(b){b.destroy()},this);this.widgetPlaceholders=[]},_destroyPreloadGroupPanels:function(){h.forEach(this.preloadGroupPanels,function(b){this.panelManager.destroyPanel(b)},this);this.preloadGroupPanels=[]},_changeMapPosition:function(b){this.map&&(v.isEqual(this.mapManager.getMapPosition(),
b.map.position)||this.mapManager.setMapPosition(b.map.position))},_onThemeChange:function(b){this._destroyPreloadWidgetIcons();this._destroyWidgetPlaceholders();this._destroyOffPanelWidgets();this._destroyPreloadGroupPanels();this.panelManager.destroyAllPanels();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();f(["themes/"+b.theme.name+"/main"],e.hitch(this,function(){this._loadThemeCommonStyle(b.theme);this._loadThemeCurrentStyle(b.theme);
this._addCustomStyle(b.theme);this._changeMapPosition(b);this._loadPreloadWidgets(b)}))},_onResetConfig:function(b){var a=this.appConfig;l.publish("appConfigChanged",b,"mapChange",b);this.appConfig=a;this._updateCommonStyle(b);this._onStyleChange(b);this._changeMapPosition(b)},_onLoadingPageChange:function(b,a){if("backgroundColor"in a)k.setStyle(jimuConfig.loadingId,"background-color",b.loadingPage.backgroundColor);else if("backgroundImage"in a){var f=b.loadingPage.backgroundImage;f.visible&&f.uri?
(k.setStyle(jimuConfig.loadingImageId,"background-image","url('"+f.uri+"')"),k.setStyle(jimuConfig.loadingImageId,"width",f.width+"px"),k.setStyle(jimuConfig.loadingImageId,"height",f.height+"px")):(k.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),k.setStyle(jimuConfig.loadingImageId,"width","0px"),k.setStyle(jimuConfig.loadingImageId,"height","0px"))}else"loadingGif"in a&&(f=b.loadingPage.loadingGif,f.visible&&f.uri?(k.setStyle(jimuConfig.loadingGifId,"background-image","url('"+
f.uri+"')"),k.setStyle(jimuConfig.loadingGifId,"width",f.width+"px"),k.setStyle(jimuConfig.loadingGifId,"height",f.height+"px")):(k.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),k.setStyle(jimuConfig.loadingGifId,"width","0px"),k.setStyle(jimuConfig.loadingGifId,"height","0px")))},_updateCommonStyle:function(b){this._removeThemeCommonStyle(this.appConfig.theme);this._loadThemeCommonStyle(b.theme)},_onStyleChange:function(b){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(b.theme);
this._removeCustomStyle();this._addCustomStyle(b.theme)},_onLayoutChange:function(b){this._changeMapPosition(b);h.forEach(this.widgetPlaceholders,function(a){a.moveTo(b.getConfigElementById(a.configId).position)},this);h.forEach(this.preloadWidgetIcons,function(a){a.moveTo(b.getConfigElementById(a.configId).position)},this);h.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){if(!a.closeable){var f=b.getConfigElementById(a.id).position;a.setPosition(f)}},this);h.forEach(this.preloadGroupPanels,
function(a){var f=b.getConfigElementById(a.config.id).panel.position;a.setPosition(f)},this)},_loadTheme:function(b){f(["themes/"+b.name+"/main"],e.hitch(this,function(){this._loadThemeCommonStyle(b);this._loadThemeCurrentStyle(b);this._addCustomStyle(b)}))},_loadThemeCommonStyle:function(b){v.loadStyleLink(this._getThemeCommonStyleId(b),"themes/"+b.name+"/common.css");k.addClass(this.domNode,b.name)},_removeThemeCommonStyle:function(b){k.removeClass(this.domNode,b.name);k.destroy(this._getThemeCommonStyleId(b))},
_loadThemeCurrentStyle:function(b){v.loadStyleLink(this._getThemeCurrentStyleId(b),"themes/"+b.name+"/styles/"+b.styles[0]+"/style.css");k.addClass(this.domNode,b.styles[0])},_removeThemeCurrentStyle:function(b){k.removeClass(this.domNode,b.styles[0]);k.destroy(this._getThemeCurrentStyleId(b))},_addCustomStyle:function(b){var a=e.getObject("customStyles",!1,b);if(a){var f=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(b=this._getFixedThemeStyles(b))&&(f+=b);f=e.replace(f,
a,/\$\{([^\}]+)\}/g);a=k.create("style",{type:"text/css"});try{a.appendChild(document.createTextNode(f))}catch(c){a.styleSheet.cssText=f}a.setAttribute("source","custom");document.head.appendChild(a)}},_getFixedThemeStyles:function(b){var a=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===b.name?(a+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}",
a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out{background-color: ${mainBackgroundColor} !important;}",a+=".jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}",a+=".jimu-panel{border-color: ${mainBackgroundColor} !important;}",a+=
".jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}"):"BillboardTheme"===b.name?(a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out{background-color: ${mainBackgroundColor} !important;}",a+=".jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}"):"BoxTheme"===b.name?a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out{background-color: ${mainBackgroundColor} !important;}":
"TabTheme"===b.name&&(a+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}");return a},_removeCustomStyle:function(){c('style[source\x3d"custom"]',document.head).forEach(function(b){k.destroy(b)})},_getThemeCommonStyleId:function(b){return"theme_"+b.name+"_style_common"},_getThemeCurrentStyleId:function(b){return"theme_"+b.name+"_style_"+b.styles[0]},_loadMap:function(){k.create("div",{id:this.mapId,style:e.mixin({position:"absolute",backgroundColor:"#EEEEEE",overflow:"hidden",
minWidth:"1px",minHeight:"1px"})},this.id);this.mapManager=b.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},this.mapId);this.mapManager.setMapPosition(this.appConfig.map.position);this.mapManager.showMap()},_createPreloadWidgetPlaceHolder:function(b){var a;a="map"===b.position.relativeTo?this.mapId:this.id;var f=e.clone(b);f.position.width=40;f.position.height=40;var c=v.getPositionStyle(f.position);b=new x({index:f.placeholderIndex,configId:b.id});k.setStyle(b.domNode,c);k.place(b.domNode,
a);this.widgetPlaceholders.push(b);return b},_createPreloadWidgetIcon:function(b){var a=new u({panelManager:this.panelManager,widgetManager:this.widgetManager,widgetConfig:b,configId:b.id,map:this.map});"map"===b.position.relativeTo?k.place(a.domNode,this.mapId):k.place(a.domNode,this.id);k.setStyle(a.domNode,v.getPositionStyle({top:b.position.top,left:b.position.left,right:b.position.right,bottom:b.position.bottom,width:40,height:40}));a.startup();!this.openAtStartWidget&&b.openAtStart&&(a.switchToOpen(),
this.openAtStartWidget=b.name);this.preloadWidgetIcons.push(a);return a},_loadPreloadWidgets:function(b){console.time("Load widgetOnScreen");var a=new z,f=[];a.placeAt(this.id);a.startup();h.forEach(b.widgetOnScreen.widgets,function(a){!1===a.visible?this.invisibleWidgetIds.push(a.id):f.push(this._loadPreloadWidget(a,b))},this);h.forEach(b.widgetOnScreen.groups,function(a){f.push(this._loadPreloadGroup(a,b))},this);r(f).then(e.hitch(this,function(){a&&(a.destroy(),a=null);console.timeEnd("Load widgetOnScreen");
l.publish("preloadWidgetsLoaded");this._doPostLoad()}),e.hitch(this,function(){a&&(a.destroy(),a=null);console.timeEnd("Load widgetOnScreen");l.publish("preloadWidgetsLoaded");this._doPostLoad()}))},_doPostLoad:function(){f(["dynamic-modules/postload"])},_loadPreloadWidget:function(b,a){var f=new s;if("config"===a.mode&&!b.uri){var c=this._createPreloadWidgetPlaceHolder(b);f.resolve(c);return f}if(!b.uri)return f.resolve(null),f;b.inPanel||b.closeable?(c=this._createPreloadWidgetIcon(b),f.resolve(c)):
this.widgetManager.loadWidget(b).then(e.hitch(this,function(a){try{a.setPosition(a.position),this.widgetManager.openWidget(a)}catch(c){console.log(console.error("fail to startup widget "+a.name+". "+c.stack))}a.configId=b.id;f.resolve(a)}),function(b){f.reject(b)});return f},_loadPreloadGroup:function(b,a){return!a.mode&&(!b.widgets||0===b.widgets.length)?q(null):this.panelManager.showPanel(b).then(e.hitch(this,function(a){a.configId=b.id;this.preloadGroupPanels.push(a);return a}))},_onOpenWidgetRequest:function(b){h.forEach(this.preloadWidgetIcons,
function(a){a.configId===b&&a.switchToOpen()},this);h.forEach(this.widgetManager.getControllerWidgets(),function(a){a.widgetIsControlled(b)&&a.setOpenedIds([b])},this)}});C.getInstance=function(b,a){null===A&&(A=new C(b,a),window._layoutManager=A);return A};return C})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(m,
e,h,k,d,l,n,c,g,a,s,r,q){var f,p=null;f=m(null,{constructor:function(){this.panels=[];this.widgetManager=q.getInstance();c(window,"resize",e.hitch(this,this.onWindowResize));this.activePanel=null;g.subscribe("/dnd/move/start",e.hitch(this,this._onMoveStart));g.subscribe("widgetActived",e.hitch(this,this._onWidgetActived))},showPanel:function(a){var b=new l,f=this.getPanelById(a.id+"_panel");f?("closed"===f.state&&this.openPanel(f),b.resolve(f)):n({Panel:this._loadPanelClass(a.panel.uri),nls:this._loadThemeI18N(a.panel.uri)}).then(e.hitch(this,
function(f){var g=a.id+"_panel",p=this.getPanelById(g),d={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:g,gid:a.gid,nls:f.nls};e.mixin(d,a.panel.options);try{p=new f.Panel(d),console.log("panel ["+g+"] created.")}catch(q){console.log("create panel error: "+q+", panelId: "+g);b.reject(q);return}p.setPosition(a.panel.position);r.setVerticalCenter(p.domNode);this.openPanel(p);this.panels.push(p);c(p.domNode,"click",
e.hitch(this,this._onPanelClick,p));b.resolve(p)}));return b},setMap:function(a){this.map=a;c(this.map,"resize",e.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=
new l;if("string"===typeof a&&(a=this.getPanelById(a),!a))return b.reject(),b;if(!a.started)try{a.started=!0,a.startup()}catch(f){console.error("fail to startup panel "+a.id+". "+f.stack)}if("opened"===a.state)return b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(e.hitch(this,function(){k.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new l;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===
a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&k.setStyle(a.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(b){console.log(console.error("fail to minimize panel "+a.id+". "+
b.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(b){console.log(console.error("fail to maximize panel "+a.id+". "+b.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(b){console.log(console.error("fail to noralize panel "+a.id+
". "+b.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(b){console.log(console.error("fail to destroy panel "+a.id+". "+b.stack))}}},destroyAllPanels:function(){var a=h.map(this.panels,function(b){return b.id});
h.forEach(a,function(b){this.destroyPanel(b)},this);this.panels=[]},playOpenPanelAnimation:function(f){if("string"===typeof f&&(f=this.getPanelById(f),!f)||!f.openAnimation||0===f.animationDuration)return a();var b=new l;"string"===typeof f.openAnimation?"fadeIn"===f.openAnimation?(k.setStyle(f.domNode,{opacity:0,display:""}),d.fadeIn({node:f.domNode,duration:f.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(f){if("string"===
typeof f&&(f=this.getPanelById(f),!f)||!f.closeAnimation||0===f.animationDuration)return a();var b=new l;"string"===typeof f.closeAnimation&&("fadeOut"===f.closeAnimation?d.fadeOut({node:f.domNode,duration:f.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=k.getMarginBox(window.jimuConfig.layoutId),f=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/
2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:b.h>b.w?{left:0,right:0,top:f,bottom:0,width:"auto",height:"auto",contentHeight:b.h-f-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-f-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&
k.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),k.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&("active"===b.state&&b.getPanel()!==a)&&(b.setState("opened"),!1===b.inPanel&&k.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:
"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&k.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){h.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},
this)},_onWidgetActived:function(a){this.activePanel&&("active"===this.activePanel.state&&a.getPanel()!==this.activePanel)&&(this.activePanel.setState("opened"),k.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new l;s([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new l;a.startWith("themes")?(a=
a.split("/"),s(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});return b}});f.getInstance=function(){null===p&&(p=new f,window._panelManager=p);return p};return f})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/aspect dojo/keys esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/geometry/Extent esri/geometry/Point require ./utils ./dijit/LoadingShelter jimu/LayerInfos/LayerInfos jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z,A,C){var w=null,F=m(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(b,a){this.appConfig=b.appConfig;this.urlParams=b.urlParams;this.id=this.mapDivId=a;this.appStateManager=z.getInstance(this.urlParams);this.popupManager=A.getInstance(this);this.filterManager=C.getInstance();this.nls=window.jimuNls;d.subscribe("appConfigChanged",e.hitch(this,this.onAppConfigChanged));
d.subscribe("changeMapPosition",e.hitch(this,this.onChangeMapPosition));d.subscribe("syncExtent",e.hitch(this,this.onSyncExtent));l(window,"resize",e.hitch(this,this.onWindowResize));l(window,"beforeunload",e.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");this.loading=new b;this.loading.placeAt(this.mapDivId);this.loading.startup();a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?
this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(b){b&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&
this._mapMobileInfoWindow.destroy(),this._mapMobileInfoWindow=new a(null,k.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onChangeMapPosition:function(b){var a=e.clone(this.mapPosition);
e.mixin(a,b);this.setMapPosition(a)},setMapPosition:function(b){this.mapPosition=b;b=t.getPositionStyle(b);k.setStyle(this.mapDivId,b);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncExtent:function(b){this.map&&(b=new q(b.extent),this.map.setExtent(b))},_visitConfigMapLayers:function(b,a){h.forEach(b.map.basemaps,function(b,f){b.isOperationalLayer=!1;a(b,f)},this);h.forEach(b.map.operationallayers,function(b,f){b.isOperationalLayer=!0;a(b,f)},
this)},_show3DLayersMap:function(b){p(["esri3d/Map"],e.hitch(this,function(a){var f;f=new a(this.mapDivId,{camera:b.map.mapOptions.camera});this._visitConfigMapLayers(b,e.hitch(this,function(b){this.createLayer(f,"3D",b)}));f.usePlugin=a.usePlugin;this._publishMapEvent(f)}))},_show3DWebScene:function(b){this._getWebsceneData(b.map.itemId).then(e.hitch(this,function(a){p(["esri3d/Map"],e.hitch(this,function(f){var c=new f(this.mapDivId,b.map.mapOptions);h.forEach(a.itemData.operationalLayers,function(b){this.createLayer(c,
"3D",b)},this);h.forEach(a.itemData.baseMap.baseMapLayers,function(b){b.type="tile";this.createLayer(c,"3D",b)},this);h.forEach(a.itemData.baseMap.elevationLayers,function(b){b.type="elevation";this.createLayer(c,"3D",b)},this);c.toc=a.itemData.toc;c.bookmarks=a.itemData.bookmarks;c.tours=a.itemData.tours}))}))},_publishMapEvent:function(b){window._viewerMap=b;x.postProcessUrlParams(this.urlParams,b);console.timeEnd("Load Map");this.map?(this.map=b,this.resetInfoWindow(!0),console.log("map changed."),
d.publish("mapChanged",this.map)):(this.map=b,this.resetInfoWindow(!0),d.publish("mapLoaded",this.map))},_getWebsceneData:function(b){return r({url:"http://184.169.133.166/sharing/rest/content/items/"+b+"/data",handleAs:"json"})},_show2DWebMap:function(b){b.map.mapOptions||(b.map.mapOptions={});var a=this._processMapOptions(b.map.mapOptions)||{};a.isZoomSlider=!1;var f=b.map.portalUrl,g=b.map.itemId,a={mapOptions:a,bingMapsKey:b.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!b.mode&&b.map.appProxy&&
b.map.appProxy.mapItemId===b.map.itemId){var p=[];h.forEach(b.map.appProxy.proxyItems,function(b){b.useProxy&&b.proxyUrl&&p.push({url:b.sourceUrl,mixin:{url:b.proxyUrl}})});0<p.length&&(a.layerMixins=p)}t.createWebMap(f,g,this.mapDivId,a).then(e.hitch(this,function(a){var f=a.map;f.hideZoomSlider();f.infoWindow.resize(270,316);f.itemId=b.map.itemId;f.itemInfo=a.itemInfo;f.webMapResponse=a;f.enableSnapping({snapKey:c.copyKey});k.setStyle(f.root,"zIndex",0);f._initialExtent=f.extent;v.getInstance(f,
f.itemInfo).then(e.hitch(this,function(b){this.layerInfosObj=b;this._publishMapEvent(f);setTimeout(e.hitch(this,this._checkAppState),500);this.loading.hide();this._addDataLoadingOnMapUpdate(f)}))}),e.hitch(this,function(){this._destroyLoadingShelter();d.publish("mapCreatedFailed")}))},_addDataLoadingOnMapUpdate:function(b){var a=k.toDom('\x3cdiv class\x3d"load-container"\x3e\x3cdiv class\x3d"loader"\x3eLoading...\x3c/div\x3e\x3c/div\x3e');k.place(a,b.root);l(b,"update-start",e.hitch(this,function(){k.setStyle(a,
"display","")}));l(b,"update-end",e.hitch(this,function(){k.setStyle(a,"display","none")}));l(b,"unload",e.hitch(this,function(){k.destroy(a);a=null;this._destroyLoadingShelter()}))},_destroyLoadingShelter:function(){this.loading&&(this.loading.destroy(),this.loading=null)},_checkAppState:function(){var b="extent center marker find query scale level".split(" "),a=this.appConfig.keepAppState;a&&h.forEach(b,function(b){b in this.urlParams&&(a=!1)},this);a&&this.appStateManager.getWabAppState().then(e.hitch(this,
function(b){if(b.extent||b.layers){var a=new u({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});a.placeAt("main-page");l(a,"applyAppState",e.hitch(this,function(){this._applyAppState(b,this.map)}));a.startup();a.show()}}))},_applyAppState:function(b,a){this.layerInfosObj.restoreState({layerOptions:b.layers||null});b.extent&&a.setExtent(b.extent);this._publishMapEvent(a)},_processMapOptions:function(b){if(b)return b.lods||delete b.lods,b.lods&&0===b.lods.length&&delete b.lods,
b=e.clone(b),b.extent&&(b.extent=new q(b.extent)),b.center&&!e.isArrayLike(b.center)&&(b.center=new f(b.center)),b.infoWindow&&(b.infoWindow=new g(b.infoWindow,k.create("div",{},this.mapDivId))),b},createLayer:function(b,a,f){p([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer",
"2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[a+"_"+f.type]],e.hitch(this,function(a){var c,g={};c="label url type icon infoTemplate isOperationalLayer".split(" ");for(var p in f)0>
c.indexOf(p)&&(g[p]=f[p]);f.infoTemplate?(c=new s(f.infoTemplate.title,f.infoTemplate.content),g.infoTemplate=c,a=new a(f.url,g),f.infoTemplate.width&&f.infoTemplate.height&&n.after(a,"onClick",e.hitch(this,function(){b.infoWindow.resize(f.infoTemplate.width,f.infoTemplate.height)}),!0)):a=new a(f.url,g);a.isOperationalLayer=f.isOperationalLayer;a.label=f.label;a.icon=f.icon;b.addLayer(a)}))},onAppConfigChanged:function(b,a,f){this.appConfig=b;"mapChange"===a?this._recreateMap(b):"mapOptionsChange"===
a&&f.lods&&this._recreateMap(b)},_recreateMap:function(b){this.map&&(d.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(b)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});F.getInstance=function(b,a){null===w&&(w=new F(b,a));return w};return F})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u){var x=m([v,r,q,f,b],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:u,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(b){this.inherited(arguments);a.place(this.domNode,b.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[x.ANCHOR_UPPERRIGHT,x.ANCHOR_LOWERRIGHT,x.ANCHOR_LOWERLEFT,x.ANCHOR_UPPERLEFT];
if(7>l("ie")){var b="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+s.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",f=a.create("div",null,k.body());s.set(f,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:b});var c=setTimeout(function(){a.destroy(f);clearTimeout(c);c=f=null},100);d.query(".sprite",this.domNode).forEach(function(a){a.style.backgroundImage="none";a.style.filter=
b})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(b,a){if(b&&a){var f=s.set;f(this._topleft,{height:a+"px",marginLeft:b+"px"});f(this._topright,{width:b+"px",height:a+"px"});f(this._user,"width",b-8+"px");f(this._hide,"marginLeft",b-22+"px");f(this._title,"width",b-25+
"px");f(this._content,"height",a-37+"px");f(this._bottomleft,{marginLeft:b+"px",marginTop:a+"px"});f(this._bottomright,{width:b-5+"px",marginTop:a+"px"});this.width=b;this.height=a;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(b,a)}},_adjustPosition:function(b,a){var f=s.set;f(this._infowindow,{left:Math.round(b.x)+"px",top:Math.round(b.y)+"px"});a===x.ANCHOR_UPPERLEFT?f(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):a===x.ANCHOR_UPPERRIGHT?
f(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):a===x.ANCHOR_LOWERRIGHT?f(this._window,{left:"6px",right:null,top:"43px",bottom:null}):a===x.ANCHOR_LOWERLEFT&&f(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(b){var a=this.map;return a&&b?(b.y<a.height/2?"lower":"upper")+(b.x<a.width/2?"right":"left"):"upperright"},show:function(b,a,f){if(b){b.spatialReference?(this.mapCoords=b,b=this.coords=this.map.toScreen(b,!0)):(this.mapCoords=
null,this.coords=b);var c=this.map._getFrameWidth();if(-1!==c&&(b.x%=c,0>b.x&&(b.x+=c),this.map.width>c))for(var p=(this.map.width-c)/2;b.x<p;)b.x+=c;if(!a||-1===h.indexOf(this._ANCHORS,a))a=this._getAnchor(b);g.remove(this._pointer,this.anchor);a=this.anchor=this.fixedAnchor||a;this._adjustPosition(b,a);g.add(this._pointer,a);t.show(this.domNode);this.isShowing=!0;if(!f)this.onShow()}},hide:function(b,a){t.hide(this.domNode);this.isShowing=!1;if(!a)this.onHide()},showTitleBar:function(){t.show(this._titlebar);
t.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){t.hide(this._titlebar);t.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){t.show(this._content);t.show(this._border);this.isContentShowing=!0},hideContent:function(){t.hide(this._content);t.hide(this._border);this.isContentShowing=!1},move:function(b,a){a?b=this.coords.offset(b.x,b.y):(this.coords=b,this.mapCoords&&(this.mapCoords=this.map.toMap(b)));s.set(this._infowindow,{left:Math.round(b.x)+"px",top:Math.round(b.y)+
"px"})},setFixedAnchor:function(b){b&&-1===h.indexOf(this._ANCHORS,b)||(this.fixedAnchor=b,this.isShowing&&this.show(this.mapCoords||this.coords,b),this.onAnchorChange(b))},setTitle:function(b){this.destroyDijits(this._title);this.__setValue("_title",b);return this},setContent:function(b){this.destroyDijits(this._content);this.__setValue("_content",b);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});e.mixin(x,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});return x})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z,A){return e([t,b],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:m.toUrl("./images/whitex.png"),dArrowIcon:m.toUrl("./images/whitedown.png"),lArrowIcon:m.toUrl("./images/whitel.png"),rArrowIcon:m.toUrl("./images/whiter.png"),constructor:function(b,f){this.initialize();h.mixin(this,b);this.domNode=a.byId(f);this._nls=h.mixin({},
A.widgets.popup);var c=this.domNode;r.add(c,"esriPopupMobile");s.set(c,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var g=n.query(".titlePane",c)[0];this._arrowButton=n.query(".arrow",g)[0];this._pointerTop=n.query(".top",c)[0];this._pointerBottom=n.query(".bottom",c)[0];this._title=n.query(".title",g)[0];this._footer=n.query(".footer",g)[0];this._prev=n.query(".prev",g)[0];this._next=n.query(".next",g)[0];this._spinner=n.query(".spinner",g)[0];this._eventConnections=[k.connect(n.query(".close",g)[0],"onclick",this,this.hide),k.connect(this._arrowButton,"onclick",this,this._toggleView),k.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),k.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();z.hide(c);this.isShowing=!1},setMap:function(b){this.inherited(arguments);q.place(this.domNode,b.root);this.highlight&&this.enableHighlight(b)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(b,a){this.destroyDijits(this._title);this.place(b,this._title);
this.destroyDijits(this._footer);this.place(a,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(b){this.destroyDijits(this._contentPane);this.place(b,this._contentPane);this.startupDijits(this._contentPane)},show:function(b){if(b){var a=this.map;b.spatialReference?(this.location=b,b=a.toScreen(b)):this.location=a.toMap(b);this._maximized?this.restore():this._setPosition(b);this.isShowing||(z.show(this.domNode),this.isShowing=!0,this.onShow())}else z.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(z.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);d.forEach(this._eventConnections,k.disconnect);q.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");r.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var b=this.selectedIndex;this._updateUI();0<=b&&(this.setContent(this.features[b].getContent()),this.updateHighlight(this.map,this.features[b]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var b=this.map;this._handles=[k.connect(b,"onPanStart",this,this._onPanStart),k.connect(b,"onPan",this,this._onPan),k.connect(b,"onZoomStart",this,this._onZoomStart),k.connect(b,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var b=this._handles;b&&(d.forEach(b,k.disconnect),this._handles=null)},_onPanStart:function(){var b=this.domNode.style;this._panOrigin={left:b.left,top:b.top,right:b.right,
bottom:b.bottom}},_onPan:function(b,a){var f=this._panOrigin,c=a.x,g=a.y,d=f.left,e=f.top,q=f.right,f=f.bottom;d&&(d=parseFloat(d)+c+"px");e&&(e=parseFloat(e)+g+"px");q&&(q=parseFloat(q)-c+"px");f&&(f=parseFloat(f)-g+"px");p.set(this.domNode,{left:d,top:e,right:q,bottom:f})},_onZoomStart:function(){z.hide(this.domNode)},_onExtentChange:function(b,a,f){f&&(z.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(b){var a=b.x;b=b.y;var c=
f.getContentBox(this.map.container),g=c.w,c=c.h,d=0,e=b+10,q=118,t=g-18;18<a&&a<t?(d=a-130,0>d?d=0:d>g-260&&(d=g-260)):18>=a?d=a-18:a>=t&&(d=g-260+(a-t));118<a&&a<g-130?q=118:118>=a?18<a?q=a-12:18>=a&&(q=6):a>=g-130&&(a<t?q=118+a-(g-130):a>=t&&(q=118+t-(g-130)));b<=c/2?(p.set(this.domNode,{left:d+"px",top:e+"px",bottom:null}),p.set(this._pointerTop,{left:q+"px"}),r.add(this._pointerBottom,"hidden"),r.remove(this._pointerTop,"hidden")):(p.set(this.domNode,{left:d+"px",top:e-64+"px",bottom:null}),p.set(this._pointerBottom,
{left:q+"px"}),r.add(this._pointerTop,"hidden"),r.remove(this._pointerBottom,"hidden"))},_showPointer:function(b){d.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(a){a===b?n.query(".pointer."+a,this.domNode).removeClass("hidden"):n.query(".pointer."+a,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();z.show(this.popupNavigationBar.container);z.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(b){this.popupInfoView.animateTo(0);switch(b.name){case "CloseButton":z.hide(this.popupNavigationBar.container);z.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":z.hide(this.popupNavigationBar.container);z.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var b={};b.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new u(b,q.create("div",{},l.body()));k.connect(this.popupNavigationBar,"onCreate",this,function(b){this._prevFeatureButton=b[3]._node;this._nextFeatureButton=b[4]._node});k.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);k.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();z.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},q.create("div",{},l.body()));r.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();k.connect(this.popupInfoView,"onCreate",this,function(b){this._contentPane=b[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});k.connect(this.popupInfoView,"onSwipeLeft",this,function(){});k.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var b="\x26nbsp;",a="\x26nbsp;",f=this.selectedIndex,c=this.features,g=this.deferreds,p=this._prevFeatureButton.parentNode,d=this._nextFeatureButton.parentNode,e=this._spinner,q=this._nls;c&&1<=c.length?(b=c[f].getTitle(),a=f+1+" of "+c.length,r.remove(this._arrowButton,"hidden"),0===f?(r.add(p,"hidden"),r.add(this._prev,"hidden")):(r.remove(p,"hidden"),r.remove(this._prev,"hidden")),f===c.length-1?(r.add(d,"hidden"),
r.add(this._next,"hidden")):(r.remove(d,"hidden"),r.remove(this._next,"hidden"))):(r.add(this._arrowButton,"hidden"),r.add(p,"hidden"),r.add(d,"hidden"),r.add(this._prev,"hidden"),r.add(this._next,"hidden"));this.setTitle(b,a);this.popupNavigationBar.getItems()[1]._node.innerHTML=a;g&&g.length?(r.remove(e,"hidden"),this.setTitle(q.NLS_searching+"...","\x26nbsp;")):(r.add(e,"hidden"),(!c||!c.length)&&this.setTitle("No Information","\x26nbsp;"))}})})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q){return m(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(f,p){var d;this.container=c.byId(p);this._touchBase=q(this.container,null);this._slideDiv=a.create("div",null,this.container,"first");this.events=[];this._items=f.items;f.sections&&(this._sections=f.sections);g.add(this.container,"esriMobileInfoView");if(0===this._sections.length)a.create("div",{},this._slideDiv);else for(d=0;d<this._sections.length;d++){var b=
a.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);a.create("div",{innerHTML:this._sections[d].title},b)}for(d=0;d<this._items.length;d++){var e,b=0;this._items[d].section&&(b=this._items[d].section);switch(this._items[d].type){case "div":e=a.create("div",{"class":"esriMobileInfoViewItem",style:this._items[d].style},this._slideDiv.childNodes[b]),e=a.create("div",{innerHTML:this._items[d].text},e)}this._items[d].className&&g.add(e,this._items[d].className);e._index=d;e._item=this._items[d];
this._items[d]._node=e}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){h.forEach(this.events,k.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(f){f._index=null;f._item=null;a.destroy(f)});this._items=null;a.destroy(this._slideDiv);a.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);
this.events.push(k.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(k.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(k.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){k.disconnect(this.events.pop());k.disconnect(this.events.pop());k.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);
this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},
_onTouchMoveHandler:function(a){this._moveDirection||(Math.abs(a.curY)>Math.abs(a.curX)?this._moveDirection="vertical":this._moveDirection="horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===
this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return 0.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,c;a=s.getContentBox(this.container);var g=0>this._velocity?0.0010:-0.0010;c=-(this._velocity*this._velocity)/(2*g);var b=-this._velocity/g,g=3*0.6-0,d=1-g,e=0,q=0;if(a.h>
this._slideDiv.scrollHeight)this.contentOffsetY=0,q=300;else if(0<this.contentOffsetY+c){a=0;for(c=Math.floor(b/20);a<c;a++)if(e=(d*20*a^3)+(g*20*a^2)+0*20*a+0,e=0>this._velocity?-e:e,0<this.contentOffsetY+e){q=20*a;break}0===q&&(q=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+c)+a.h>this._slideDiv.scrollHeight){this.contentOffsetY=a.h-this._slideDiv.scrollHeight;a=0;for(c=Math.floor(b/20);a<c;a++)if(e=(d*20*a^3)+(g*20*a^2)+0*20*a+0,e=0>this._velocity?-e:e,Math.abs(this.contentOffsetY+
e)>this._slideDiv.scrollHeight){q=20*a;break}}else q=b,this.contentOffsetY+=c;this._slideDiv.style.webkitTransition="-webkit-transform "+q+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=s.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration=
"0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,c){"ON"===c.toggleState?(c.toggleState=
"OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c)):(c.toggleState="ON",c.srcAlt&&(a.src=c.srcAlt),this.onSelect(c))}})})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),function(m,e,h,k,d,l){return m(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(d,c){this.domNode=k.byId(d);this.events=[h.connect(this.domNode,"touchstart",this,this._touchStartHandler),
h.connect(this.domNode,"touchmove",this,this._touchMoveHandler),h.connect(this.domNode,"touchend",this,this._touchEndHandler),h.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(d){this._preventDefault=d},disableOnClick:function(){h.disconnect(this.events.pop())},_clickHandler:function(d){if(this._moved)d.preventDefault();else this.onclick(d)},_touchStartHandler:function(d){this._moved=!1;this.client_x=d.targetTouches[0].clientX;this.client_y=d.targetTouches[0].clientY;
this.down_x=d.targetTouches[0].pageX;this.down_y=d.targetTouches[0].pageY;d.downX=this.down_x;d.downY=this.down_y;this.onTouchStart(d)},_touchMoveHandler:function(d){this._preventDefault&&d.preventDefault();this._moved=!0;this.up_x=d.targetTouches[0].pageX;this.cur_x=d.targetTouches[0].pageX-this.down_x;this.cur_y=d.targetTouches[0].pageY-this.down_y;d.curX=this.cur_x;d.curY=this.cur_y;this.onTouchMove(d)},_touchEndHandler:function(d){this._moved?(d.curX=this.cur_x,d.curY=this.cur_y,this.down_x-this.up_x>
this._swipeThreshold?d.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(d.swipeDirection="right")):(d.clientX=this.client_x,d.clientY=this.client_y);this.onTouchEnd(d)},onTouchStart:function(d){},onTouchMove:function(d){},onTouchEnd:function(d){},onclick:function(d){}})})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r){return m(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(d,f){var p;this.container=c.byId(f);this._touchBase=s(this.container,null);this._slideDiv=a.create("div",{},this.container,"first");this.events=[h.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=d.items;g.add(this.container,"esriMobileNavigationBar");var e=a.create("div",{},this._slideDiv);for(p=0;p<this._items.length;p++){var b,r;switch(this._items[p].type){case "img":r=
a.create("div",{"class":"esriMobileNavigationItem"},e);b=a.create("img",{src:this._items[p].src.toString(),style:{width:"100%",height:"100%"}},r);break;case "span":r=a.create("div",{"class":"esriMobileNavigationItem"},e);b=a.create("span",{innerHTML:this._items[p].text},r);break;case "div":r=a.create("div",{"class":"esriMobileNavigationInfoPanel"},e),b=a.create("div",{innerHTML:this._items[p].text},r)}g.add(r,this._items[p].position);this._items[p].className&&g.add(b,this._items[p].className);b._index=
p;b._item=this._items[p];this._items[p]._node=b}},startup:function(){this.onCreate(this._items)},destroy:function(){k.forEach(this.events,h.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(c){c._index=null;c._item=null;a.destroy(c)});this._items=null;a.destroy(this._slideDiv);a.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},
onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var f=a.target,c=f._item;d.query("img",this.container).forEach(function(a){a!==f&&a._item.toggleGroup===c.toggleGroup&&this._markUnSelected(a,a._item)},this);this._toggleNode(f,c)}},_toggleNode:function(a,f){"ON"===f.toggleState?(f.toggleState="OFF",f.src&&(a.src=f.src.toString()),this.onUnSelect(f)):(f.toggleState="ON",f.srcAlt&&(a.src=f.srcAlt),this.onSelect(f))},_markSelected:function(a,f){f.toggleState=
"ON";f.srcAlt&&(a.src=f.srcAlt);this.onSelect(f)},_markUnSelected:function(a,f){"ON"===f.toggleState&&(f.toggleState="OFF",f.src&&(a.src=f.src.toString()),this.onUnSelect(f))}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(m,e,h,k,d){return m([e,h],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:k,loadingText:null,
hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&d.setStyle(this.domNode,"display","none");d.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading2.gif";this.showLoading||d.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(e){this.domNode&&this.hidden&&
("string"===typeof e&&(this.textNode.innerHTML=e),d.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(d.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(m,e,h,k,d,l,n,c,g){var a=m([n],{map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,
_tableInfos:null,_finalTableInfos:null,_basemapLayers:null,constructor:function(a,f){this._basemapLayers=f.baseMap.baseMapLayers;this._operLayers=f.operationalLayers;this._tables=f.tables;this.map=a;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._layerInfos);this._initFinalTableInfos();this._initFinalLayerInfos(this._layerInfos);this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var a=
[];e.forEach(this.getLayerInfoArray(),function(f){for(var b=0;b<this._operLayers.length;b++)if(f.id===this._operLayers[b].id){a.push(f);break}b===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(f.id)&&a.push(f)},this);return a},getLayerInfoArray:function(){return this._finalLayerInfos},getTableInfoArray:function(){return this._finalTableInfos},addFeatureCollection:function(a,f){var b=this._getUniqueTopLayerInfoId(f),c={layers:[]};e.forEach(a,function(a,f){a.id=b+
"_"+f;c.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var d;try{d=g.getInstance().create({featureCollection:c,title:f||b,id:b},this.map),d.init()}catch(q){console.warn(q.message),d=null}d&&(d._extraOfWebmapLayerInfo=!0,this._layerInfos.push(d),this.update(),this._onUpdated())},addTable:function(a){var f=[];a=this._addTable(a,this._finalTableInfos);this._tableInfos.push(a);f.push(a);this._onTableChange(f,"added");return a},removeTable:function(a){var f=-1,b=!1;e.forEach(this._tableInfos,
function(b,c){a.id===b.id&&(f=c)});0<=f&&(this._tableInfos.splice(f,1),b=!0);f=-1;e.forEach(this._finalTableInfos,function(b,c){a.id===b.id&&(f=c)});0<=f&&(this._finalTableInfos.splice(f,1),b=!0);b&&this._onTableChange([a],"removed")},_addTable:function(a,f){var b;try{a.layerObject={url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),a.selfType="table",b=g.getInstance().create(a),b.init()}catch(c){console.warn(c.message),b=null}b&&f&&f.push(b);return b},
_getUniqueTableId:function(a){var f=this._tableInfos.concat(this._finalTableInfos||[]);return this._getUniqueLayerOrTableId(a,f)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,f){var b=1,c;a||(a="table");for(c=a;;){for(var g=0;g<f.length&&f[g].id!==c;g++);if(g===f.length)return c;c=a+"_"+b.toString();b++}},_traversal:function(a,f){for(var b=0;b<f.length;b++)if(f[b].traversal(a))return!0;return!1},traversal:function(a){var f=
this.getLayerInfoArray();return this._traversal(a,f)},traversalLayerInfosOfWebmap:function(a){var f=this.getLayerInfoArrayOfWebmap();return this._traversal(a,f)},traversalAll:function(a){var f=this.getLayerInfoArray(),b=this.getTableInfoArray();return this._traversal(a,f.concat(b))},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getTableInfoById:function(a){var f=null;e.some(this.getTableInfoArray(),function(b){if(b.id===a)return f=b,!0});return f},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},
moveUpLayer:function(a,f){var b=null;f=f?f:1;var c=this._getTopLayerInfoIndexById(a.id);0<=c-f&&(b=this._finalLayerInfos[c-f].obtainLayerIndexesInMap().length,this._finalLayerInfos[c].moveLayerByIndex(this._finalLayerInfos[c-f].obtainLayerIndexesInMap()[b-1].index),b=this._finalLayerInfos[c-f],l.publish("layerInfos/layerReorder",c,f,"moveup"));return b},_reorderLayerInfosArray:function(a,f,b){"moveup"===b?(b=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-
f,0,b)):(b=this._finalLayerInfos[a],this._finalLayerInfos.splice(a+f+1,0,b),this._finalLayerInfos.splice(a,1));this._markFirstOrLastNode()},moveDownLayer:function(a,f){var b=null;f=f?f:1;var c=this._getTopLayerInfoIndexById(a.id);c+f<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[c].moveLayerByIndex(this._finalLayerInfos[c+f].obtainLayerIndexesInMap()[0].index),b=this._finalLayerInfos[c+f],l.publish("layerInfos/layerReorder",c,f,"movedown"));return b},getBasemapLayers:function(){var a=[];
e.forEach(this.map.layerIds,function(f){f=this.map.getLayer(f);("basemap"===f._basemapGalleryLayerType||"reference"===f._basemapGalleryLayerType)&&a.push(f)},this);0===a.length&&(a=this._basemapLayers);return a},getMapNotesLayerInfoArray:function(){return e.filter(this.getLayerInfoArray(),function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){var f=a&&a.layerOptions?a.layerOptions:null;e.forEach(this.getLayerInfoArray(),function(b){b.resetLayerObjectVisibility(f)},this)},_initLayerInfos:function(){var a;
this._layerInfos=[];e.forEach(this._operLayers,function(f){try{a=g.getInstance().create(f),a.init()}catch(b){console.warn(b.message),a=null}a&&this._layerInfos.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=[];e.forEach(this._layerInfos,function(a,f){var b;if("esri.layers.GeoRSSLayer"===a.layerObject.declaredClass||"esri.layers.KMLLayer"===a.layerObject.declaredClass){try{b=g.getInstance().create(a.originOperLayer),b.init()}catch(c){console.warn(c.message),
b=null}b&&(a.destroyLayerInfo(),this._layerInfos[f]=b)}else if(a.originOperLayer.featureCollection){var d=[];e.forEach(a.getSubLayers(),function(b){d.push(b.id)});e.forEach(d,function(b){this.map.getLayer(b)||a.removeSubLayerById(b)},this);1===a.getSubLayers().length&&(b=a.getSubLayers()[0],this.map.getLayer(b.id).title=a.title,a.removeSubLayerById(b.id),this._removedLayerInfoIdsFromFeatureCollection.push(b.id))}},this)},_initFinalLayerInfos:function(a){var f,b;this._finalLayerInfos=[];for(f=this.map.graphicsLayerIds.length-
1;0<=f;f--)b=this.map.graphicsLayerIds[f],this._isBasemap(b)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(b,a),b,!0);for(f=this.map.layerIds.length-1;0<=f;f--)b=this.map.layerIds[f],this._isBasemap(b)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(b,a),b,!1)},_isBasemap:function(a){for(var f=!1,b=this.getBasemapLayers(),c=0;c<b.length;c++)b[c].id===a&&(f=!0);return f},_addToFinalLayerInfos:function(a,f,b){var c;if(a)!a._addedFlag&&a.isGraphicLayer()===
b&&(this._finalLayerInfos.push(a),a._addedFlag=!0);else{a=this.map.getLayer(f);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"labels"!==a.id){try{c=g.getInstance().create({layerObject:a,title:this._getLayerTitle(a),id:a.id||" "},this.map),c.init()}catch(d){console.warn(d.message),c=null}c&&this._finalLayerInfos.push(c)}("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&c&&c._getLayerDefinition().then(h.hitch(this,function(b){var a=
[];e.forEach(b.tables,function(b){b.url=c.getUrl()+"/"+b.id;b.id=c.id+"_"+b.id;b.title=this._getLayerTitle(b);(b=this._addTable(b,this._finalTableInfos))&&a.push(b)},this);this._onTableChange(a,"added")}))}},_getLayerTitle:function(a){if(a.title)return a.title;var f=a.label||a.name||"";if(a.url){var b;b=a.url.indexOf("rest/services/");-1<b&&(b=a.url.substring(b+14).split("/")[0],f=f?b+" - "+f:b)}return f||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,f){var b,c=null;f||(f=this._finalLayerInfos);
for(b=0;b<f.length;b++)if(c=f[b].findLayerInfoById(a)){c=f[b];break}return c},_findLayerInfoById:function(a,f){var b,c=null;f||(f=this._finalLayerInfos);for(b=0;b<f.length&&!(c=f[b].findLayerInfoById(a));b++);return c},_findTopLayerInfoById:function(a){var f,b=null,c=this._finalLayerInfos;for(f=0;f<c.length;f++)if(c[f].id===a){b=c[f];break}return b},_getTopLayerInfoIndexById:function(a){var f,b=-1;for(f=0;f<this._finalLayerInfos.length;f++)if(this._finalLayerInfos[f].id===a){b=f;break}return b},_clearAddedFlag:function(a){e.forEach(a,
function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,
f,b){"BasemapGallery"===a&&(this._basemapLayers.length=0,e.forEach(b,h.hitch(this,function(b){this._basemapLayers.push({layerObject:b,id:b.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var f;for(f=this._basemapLayers.length=0;f<a.layers.length;f++)this._basemapLayers.push({layerObject:a.layer[f],id:a.layers[f].id})},_destroyLayerInfos:function(){e.forEach(this.getLayerInfoArray(),h.hitch(this,function(a){a.destroyLayerInfo()}))},_bindEvents:function(){var a,
f,b,c,g,e,q,r;a=d(this.map,"layer-add-result",h.hitch(this,this._onLayersChange,"added"));f=d(this.map,"layer-remove",h.hitch(this,this._onLayersChange,"removed"));q=l.subscribe("layerInfos/layerReorder",h.hitch(this,this._onLayerReorder));c=l.subscribe("layerInfos/layerInfo/isShowInMapChanged",h.hitch(this,this._onShowInMapChanged));g=l.subscribe("layerInfos/layerInfo/visibleChanged",h.hitch(this,this._onVisibleChanged));e=l.subscribe("layerInfos/layerInfo/filterChanged",h.hitch(this,this._onFilterChanged));
r=l.subscribe("layerInfos/layerInfo/rendererChanged",h.hitch(this,this._onRendererChanged));b=d(this.map,"before-unload",h.hitch(this,function(){a.remove();f.remove();q.remove();c.remove();g.remove();e.remove();r.remove();b.remove();this._destroyLayerInfos()}))},_onLayersChange:function(a,f){var b=null,c;!f.error&&("esri.layers.GraphicsLayer"!==f.layer.declaredClass&&!f.layer._basemapGalleryLayerType)&&("added"===a?(this.update(),b=this._findTopLayerInfoById(f.layer.id),c=this._findLayerInfoById(f.layer.id)):
(b=this._findTopLayerInfoById(f.layer.id),c=this._findLayerInfoById(f.layer.id),this.update()),this.emit("layerInfosChanged",b,a,c))},_onShowInMapChanged:function(a){this.emit("layerInfosIsShowInMapChanged",a)},_onVisibleChanged:function(a){this.emit("layerInfosIsVisibleChanged",a)},_onFilterChanged:function(a){this.emit("layerInfosFilterChanged",a)},_onLayerReorder:function(a,f,b){this._reorderLayerInfosArray(a,f,b);this.emit("layerInfosReorder")},_onRendererChanged:function(a){this.emit("layerInfosRendererChanged",
a)},_initTablesInfos:function(){this._tableInfos=[];e.forEach(this._tables&&this._tables.reverse(),function(a){this._addTable(a,this._tableInfos)},this)},_initFinalTableInfos:function(){this._finalTableInfos=[];e.forEach(this._tableInfos,function(a){this._finalTableInfos.push(a)},this)},_onTableChange:function(a,f){this.emit("tableInfosChanged",a,f)},_onUpdated:function(){this.emit("updated")}});a.getLayerInfoArrayByType=function(f,g){var b=new k,d=[],q=[];a.getInstance(f,f.iteminfo).then(function(a){a.traversal(function(b){var a=
b.getLayerType();a.layerInfo=b;d.push(a)});c(d).then(function(a){e.forEach(a,function(b,a){g===b&&q.push(d[a].layerInfo)});b.resolve(q)})});return b};var s=!0,r=null,q=null,f=new k;a.getInstance=function(c,d){r&&r!==c&&(s=!0,q=r=null,f=new k);q?f.resolve(q):s&&(s=!1,g.getInstance(c).init().then(h.hitch(this,function(){var b=new a(c,d.itemData);r=c;q=b;f.resolve(b)})));return f};a.getInstanceSync=function(){return q};return a})},"jimu/LayerInfos/LayerInfoFactory":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/Deferred"],function(m,e,h){var k=null,d=m(null,{constructor:function(){},init:function(){var d=new h;require("jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForGroup jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream".split(" "),
e.hitch(this,function(e,c,g,a,s,r,q,f,p,h,b,k,u){this.LayerInfoForCollection=e;this.LayerInfoForMapService=c;this.LayerInfoForKML=g;this.LayerInfoForGeoRSS=a;this.LayerInfoForDefault=s;this.LayerInfoForWMS=r;this.LayerInfoForGroup=q;this.LayerInfoForDefaultDynamic=f;this.LayerInfoForDefaultTile=p;this.LayerInfoForDefaultWMS=h;this.LayerInfoForDefaultTable=b;this.LayerInfoForDefaultImage=k;this.LayerInfoForDefaultStream=u;d.resolve()}));return d},create:function(d){if(d.featureCollection)return new this.LayerInfoForCollection(d,
this.map);if("esri.layers.KMLLayer"===d.layerObject.declaredClass)return new this.LayerInfoForKML(d,this.map);if("esri.layers.GeoRSSLayer"===d.layerObject.declaredClass)return new this.LayerInfoForGeoRSS(d,this.map);if("esri.layers.WMSLayer"===d.layerObject.declaredClass&&!d.selfType)return new this.LayerInfoForWMS(d,this.map);if("esri.layers.ArcGISDynamicMapServiceLayer"===d.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===d.layerObject.declaredClass)return new this.LayerInfoForMapService(d,
this.map);if("esri.layers.ArcGISImageServiceLayer"===d.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===d.layerObject.declaredClass)return new this.LayerInfoForDefaultImage(d,this.map);if("esri.layers.StreamLayer"===d.layerObject.declaredClass)return new this.LayerInfoForDefaultStream(d,this.map);"Table"===d.layerObject.type&&(d.selfType="table");switch(d.selfType){case "mapservice_dynamic_group":return new this.LayerInfoForGroup(d,this.map);case "mapservice_tiled_group":return new this.LayerInfoForGroup(d,
this.map,!0);case "mapservice_dynamic":return new this.LayerInfoForDefaultDynamic(d,this.map);case "mapservice_tiled":return new this.LayerInfoForDefaultTile(d,this.map);case "wms":return new this.LayerInfoForDefaultWMS(d,this.map);case "table":return new this.LayerInfoForDefaultTable(d,this.map);default:return new this.LayerInfoForDefault(d,this.map)}}});d.getInstance=function(e){null===k&&(k=new d);e&&(k.map=e);return k};return d})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/Evented".split(" "),
function(m,e,h,k,d,l,n,c){var g=1E3,a=1E4;return m([e,c],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(c){this.inherited(arguments);"animationDuration"in c&&(g=c.animationDuration);"autoCloseInterval"in c&&(a=c.autoCloseInterval)},postCreate:function(){window.appInfo.isRunInMobile&&k.addClass(this.domNode,"mobile");var c=k.create("div",{"class":"appstate-header"});k.create("div",{"class":"appstate-title",innerHTML:this.nls.title},
c);var g=k.create("div",{"class":"appstate-close"},c);k.place(c,this.domNode);c=k.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});k.place(c,this.domNode);this.own(d(c,"click",h.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(d(g,"click",h.hitch(this,function(){this.hide()})));this.own(d(this.domNode,l.enter,h.hitch(this,function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)})));this.own(d(this.domNode,l.leave,
h.hitch(this,function(){1===this.currentState&&!this.timeoutHandler&&(this.timeoutHandler=setTimeout(h.hitch(this,this.hide),a))})))},show:function(){n.animateProperty({node:this.domNode,duration:g,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:h.hitch(this,function(){this.currentState=1})}).play();this.timeoutHandler=setTimeout(h.hitch(this,this.hide),a)},hide:function(){0!==this.currentState&&n.animateProperty({node:this.domNode,duration:g,properties:window.appInfo.isRunInMobile?
{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:h.hitch(this,function(){this.currentState=0;k.setStyle(this.domNode,"display","none")})}).play()}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v){function u(b,a){var f=b.center.split(";");1===f.length&&(f=b.center.split(","));if(2===f.length||3===f.length){var g=parseFloat(f[0]),e=parseFloat(f[1]);if(isNaN(g)||isNaN(e))g=parseFloat(f[0]),e=parseFloat(f[1]);if(!isNaN(g)&&!isNaN(e)){var p=4326;3===f.length&&!isNaN(f[2])&&(p=parseInt(f[2],10));f=new d(g,e,new c(p));K(f.spatialReference,a.spatialReference)?a.centerAt(f):I(f,a.spatialReference,function(b){a.centerAt(b[0])},function(){console.error("Project center point error.")})}}}
function x(b,a){var f=b.extent.split(";");1===f.length&&(f=b.extent.split(","));if(4===f.length||5===f.length){var g=parseFloat(f[0]),d=parseFloat(f[1]),e=parseFloat(f[2]),p=parseFloat(f[3]);if(isNaN(g)||isNaN(g)||isNaN(g)||isNaN(g))g=parseFloat(f[0]),d=parseFloat(f[1]),e=parseFloat(f[2]),p=parseFloat(f[3]);if(!isNaN(g)&&!isNaN(d)&&!isNaN(e)&&!isNaN(p)){var q=4326;5===f.length&&!isNaN(f[4])&&(q=parseInt(f[4],10));f=new l(g,d,e,p,new c({wkid:q}));K(a.spatialReference,f.spatialReference)?a.setExtent(f):
I(f,a.spatialReference,function(b){a.setExtent(b[0])},function(){console.error("Project extent error.")})}else console.error("Wrong extent parameters.")}else console.error("Wrong extent parameters.")}function z(b,a){var f=b.marker.split(";");1===f.length&&(f=b.marker.split(","));if(2<=f.length&&6>=f.length&&f[0].length&&!isNaN(f[0])&&f[1].length&&!isNaN(f[1])){var g=parseFloat(f[0]),e=parseFloat(f[1]),p=4326;3<=f.length&&(f[2].length&&!isNaN(f[2]))&&(p=parseInt(f[2],10));var q="";4<=f.length&&(q=
f[3]);var s=null;5<=f.length&&0===f[4].indexOf("http")&&(s=f[4]);var h=null;6===f.length&&(h=f[5]);var l=r.fromJson({type:"esriPMS",url:s,contentType:"image/png"}),n=null;h&&(n=r.fromJson({color:[0,0,0,255],type:"esriTS",verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:h}));C(l).then(function(){var b=new d(g,e,new c({wkid:p}));K(b.spatialReference,a.spatialReference)?A(b,l,n,q,
a):I(b,a.spatialReference,function(b){A(b[0],l,n,q,a)},function(){console.error("Project center point error.")})})}}function A(b,a,c,g,e){var r;r=new p("",g);g=new f;e.addLayer(g);r=new q(b,a,null,r);g.add(r);c&&(c.xoffset=a.width/2,c.yoffset=a.height/2+a.yoffset,a=new q(new d(b.toJson()),c),g.add(a));e.centerAt(b)}function C(a){var f=new e;a.url?b.getImagesSize(a.url).then(function(b){a.width=b[0];a.height=b[1];f.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";
a.width=26;a.height=26;a.setOffset(0,a.height/2);f.resolve(a)}):(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",a.width=26,a.height=26,a.setOffset(0,a.height/2),f.resolve(a));return f}function w(b,a){var f=b.query.split(";");1===f.length&&(f=b.query.split(","));if(2!==f.length&&3!==f.length)console.error("query URL parameter is not correct.");else{var c=f[0];G("name",c,a).then(function(b){null===b?G("id",c,a).then(function(b){null===b?console.error("Invalid layer name or id."):F(a,
b,f)}):F(a,b,f)})}}function F(a,f,c){var g=new t,d="";if(2===c.length)g.where=c[1];else if(3===c.length&&(f.layerObject.url&&(b.isHostedService(f.layerObject.url)&&b.containsNonLatinCharacter(c[2]))&&(d="N"),m.forEach(f.layerObject.fields,function(b){b.alias.toLowerCase()!==c[1].toLowerCase()&&b.name.toLowerCase()!==c[1].toLowerCase()||(-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(b.type)?g.where=b.name+"\x3d"+c[2]:-1<["esriFieldTypeString",
'"esriFieldTypeOID"'].indexOf(b.type)&&(g.where=c[1]+"\x3d"+d+"'"+c[2].replace(/\'/g,"''")+"'"))},this),!g.where)){console.error("Invalid field name or type in query URL parameter.");return}f.layerObject.selectFeatures(g).then(function(c){if(0===c.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===f.layerObject.geometryType&&1===c.length)a.setExtent(n.getExtentForScale(a,1E3)),a.centerAt(c[0].geometry);else{var g=b.graphicsExtent(c);a.setExtent(g)}D(a,f,c)}},function(b){console.error(b)})}
function D(b,a,c){function g(d){var e=new f;e.setRenderer(a.layerObject.renderer);b.addLayer(e);m.forEach(c,function(b){b.setInfoTemplate(d);e.add(b)})}function d(){b.infoWindow.setFeatures(c);b.infoWindow.show(B(c[0]))}if(b.getLayer(a.layerInfo.id))d();else{var e=a.layerInfo.getInfoTemplate();e?(g(e),d()):a.layerInfo.loadInfoTemplate().then(function(b){g(b);d()})}}function B(b){b=b.geometry;if("point"!==b.type)if("multipoint"===b.type)b=b.getPoint(0);else if("polyline"===b.type)b=b.getExtent().getCenter();
else if("polygon"===b.type)b=b.getExtent().getCenter();else if("extent"===b.type)b=b.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return b}function G(b,a,f){var c=new e,g=[];v.getInstance(f,f.itemInfo).then(function(f){f.traversal(function(f){if(c.isResolved())return!0;("id"===b&&f.id.toLowerCase()===a.toLowerCase()||"name"===b&&f.title.toLowerCase()===a.toLowerCase())&&g.push(k({layerType:f.getLayerType(),layerObject:f.getLayerObject()}).then(function(b){"FeatureLayer"===
b.layerType&&c.resolve({layerInfo:f,layerObject:b.layerObject})},function(b){console.error("Find layer error from query URL parameter",b);c.resolve(null)}))});k(g).then(function(){c.isResolved()||c.resolve(null)})});return c}function I(b,f,c,d){var e=[102113,102100,3857],p;if(4326===b.spatialReference.wkid&&Q(e,f.wkid)){b.ymin=Math.max(b.ymin,-89.99);b.ymax=Math.min(b.ymax,89.99);b=s.geographicToWebMercator(b);if((d=b.spatialReference._getInfo())&&b.xmin>b.xmax)e=d.valid[1]-b.xmin,p=b.xmax-d.valid[0],
e>p?b.xmax=d.valid[1]+p:b.xmin=d.valid[0]-e;b.spatialReference.wkid=f.wkid;c([b],null)}else if(Q(e,b.spatialReference.wkid)&&4326===f.wkid){b=s.webMercatorToGeographic(b);if((d=b.spatialReference._getInfo())&&b.xmin>b.xmax)e=d.valid[1]-b.xmin,p=b.xmax-d.valid[0],e>p?b.xmax=d.valid[1]+p:b.xmin=d.valid[0]-e;c([b],null)}else e=new g,e.geometries=[b],e.outSR=f,a.defaults.geometryService.project(e,function(b){b&&0<b.length&&b[0]&&"extent"===b[0].type&&!isNaN(b[0].xmin)&&!isNaN(b[0].ymin)&&!isNaN(b[0].xmax)&&
!isNaN(b[0].ymax)?c(b,null):b&&(0<b.length&&b[0]&&"point"===b[0].type&&!isNaN(b[0].x)&&!isNaN(b[0].y))&&c(b,null)},d)}function K(b,a){var f=[102113,102100,3857];return b&&a&&b.wkt===a.wkt&&(b.wkid===a.wkid||b.latestWkid&&b.latestWkid===a.wkid||a.latestWkid&&b.wkid===a.latestWkid||b.latestWkid&&b.latestWkid===a.latestWkid)||b&&a&&b.wkid&&a.wkid&&Q(f,b.wkid)&&Q(f,a.wkid)?!0:!1}function Q(b,a){for(var f=b.length;f--;)if(b[f]===a)return!0;return!1}return{postProcessUrlParams:function(b,a){if("extent"in
b)return x(b,a);if("center"in b)return u(b,a);if("marker"in b)return z(b,a);if("find"in b)h.publish("publishData","framework","framework",{searchString:b.find},!0);else if("query"in b)return w(b,a)}}})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/PopupMenu".split(" "),function(m,e,h,k,d,l,n,c,g){var a=null,s=m(null,{mapManager:null,popupUnion:null,constructor:function(a){e.mixin(this,
a);this.popupMenu=g.getInstance();this.isInited=!1;this.featureActionManager=n.getInstance();k.subscribe("mapLoaded",e.hitch(this,this.onMapLoadedOrChanged));k.subscribe("mapChanged",e.hitch(this,this.onMapLoadedOrChanged));k.subscribe("appConfigChanged",e.hitch(this,this._onAppConfigChanged));k.subscribe("widgetsActionsRegistered",e.hitch(this,this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&(this.popupUnion.mobile&&
this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode)&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop=h.create("span",{"class":"popup-menu-button"},l(".actionList",this.popupUnion.bigScreen.domNode)[0]);var a=l(".esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],a=h.create("div",{"class":"esriMobileInfoViewItem"},a);this.popupMenuButtonMobile=h.create("span",{"class":"popup-menu-button"},
a);d(this.popupMenuButtonMobile,"click",e.hitch(this,this._onPopupMenuButtonClick));d(this.popupMenuButtonDesktop,"click",e.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(a){a=h.position(a.target);this.popupMenu.show(a)},_bindSelectionChangeEvent:function(){d(this.popupUnion.bigScreen,"selection-change",e.hitch(this,this._onSelectionChange));d(this.popupUnion.mobile,"selection-change",e.hitch(this,this._onSelectionChange))},_onSelectionChange:function(a){(this.selectedFeature=
a.target.getSelectedFeature())?this._initPopupMenu():(h.addClass(this.popupMenuButtonDesktop,"disabled"),h.addClass(this.popupMenuButtonMobile,"disabled"))},_initPopupMenu:function(){this.featureActionManager.getSupportedActions(this.selectedFeature).then(e.hitch(this,function(a){a=a.filter(e.hitch(this,function(a){return 0>["ZoomTo","ShowPopup","Flash"].indexOf(a.name)}));0===a.length?(h.addClass(this.popupMenuButtonDesktop,"disabled"),h.addClass(this.popupMenuButtonMobile,"disabled")):(h.removeClass(this.popupMenuButtonDesktop,
"disabled"),h.removeClass(this.popupMenuButtonMobile,"disabled"));a=a.map(e.hitch(this,function(a){a.data=c.toFeatureSet(this.selectedFeature);return a}));this.popupMenu.setActions(a)}))},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},
_onWidgetsActionsRegistered:function(){this.init()}});s.getInstance=function(c){null===a&&(a=new s({mapManager:c}));return a};return s})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),function(m,e,h,k,d,l,n,c){var g=null,a=m(null,{constructor:function(){this._actions=[];window.isBuilder?(k.subscribe("app/mapLoaded",e.hitch(this,this._onMapLoaded)),k.subscribe("app/mapChanged",
e.hitch(this,this._onMapChanged))):(k.subscribe("mapLoaded",e.hitch(this,this._onMapLoaded)),k.subscribe("mapChanged",e.hitch(this,this._onMapChanged)));window.isBuilder?(k.subscribe("app/appConfigLoaded",e.hitch(this,this._onAppConfigLoaded)),k.subscribe("app/appConfigChanged",e.hitch(this,this._onAppConfigChanged))):(k.subscribe("appConfigLoaded",e.hitch(this,this._onAppConfigLoaded)),k.subscribe("appConfigChanged",e.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},
getSupportedActions:function(a){a=this._getFeatureSet(a);var c=[];h.forEach(this._actions,function(g){var f=this.testActionSupportFeature(g,a);f.action=g;c.push(f)},this);return l(c).then(e.hitch(this,function(a){return a.map(e.hitch(this,function(a,c){return{result:a,action:this._actions[c]}})).filter(function(a){return a.result}).map(function(a){return a.action})}))},testActionSupportFeature:function(a,c){c=this._getFeatureSet(c);var g;c.features&&0<c.features.length&&(g=c.features[0].getLayer());
g=a.isFeatureSupported(c,g);var f=new d;g&&"function"===typeof g.then?g.then(function(a){f.resolve(a)},function(a){console.error(a);f.resolve(!1)}):f.resolve(g);return f},registerAction:function(a){var c=new d;require([a.uri],e.hitch(this,function(g){var f=new g({map:this.map,appConfig:this.appConfig,label:a.label,name:a.name,widgetId:a.widgetId});h.some(this._actions,function(a){return f.name===a.name&&f.widgetId===a.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",f.name),
c.reject("Feature/FeatureSet action has been registered.",f.name)):(this._actions.push(f),c.resolve(f))}));return c},removeActionsByWidgetId:function(a){this._actions=h.filter(this._actions,function(c){return c.widgetId!==a},this)},getActionsByWidgetId:function(a){return h.filter(this._actions,function(c){return c.widgetId===a},this)},getActionsByActionName:function(a){return h.filter(this._actions,function(c){return c.name===a},this)},registerWidgetFeatureActions:function(a){var c=new d;if(!a.featureActions||
!a.uri)return c.resolve(),c;var g=[];h.forEach(a.featureActions,function(f){g.push(this.registerAction({uri:a.amdFolder+f.uri,widgetId:a.id,name:f.name,label:a.manifest["i18nLabels_featureAction_"+f.name][window.dojoConfig.locale]||a.manifest["i18nLabels_featureAction_"+f.name].defaultLabel}))},this);return l(g)},registerAllWidgetFeatureActions:function(a){var c=[];a.visitElement(e.hitch(this,function(a){a.uri&&a.visible&&c.push(this.registerWidgetFeatureActions(a))}));return l(c).then(function(){k.publish("widgetsActionsRegistered")})},
_reRegisterWidgetActions:function(a){var c=[];h.forEach(this.getAllActions(),function(c){var f=a.getConfigElementById(c.widgetId);"framework"!==c.widgetId&&(!f||!f.uri||!1===f.visible)&&this.removeActionsByWidgetId(c.widgetId)},this);a.visitElement(e.hitch(this,function(a){a.uri&&(a.visible&&0===this.getActionsByWidgetId(a.id).length)&&c.push(this.registerWidgetFeatureActions(a))}));0<c.length&&l(c).then(function(){k.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){h.forEach(n,
function(a){this.registerAction({uri:a.uri,widgetId:"framework",label:window.jimuNls.featureActions[a.name],name:a.name})},this)},_getFeatureSet:function(a){return"[object Object]"===Object.prototype.toString.call(a)?a.features?a:c.toFeatureSet([a]):c.toFeatureSet(a)},_onAppConfigLoaded:function(a){this.appConfig=a=e.clone(a);this._setActionsAppConfig(a);this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(a){this.appConfig=a=e.clone(a);this._reRegisterWidgetActions(this.appConfig);
this._setActionsAppConfig(a)},_onMapLoaded:function(a){this.map=a;this._setActionsMap(a)},_onMapChanged:function(a){this.map=a;this._setActionsMap(a)},_setActionsMap:function(a){h.forEach(this._actions,function(c){c.setMap(a)},this)},_setActionsAppConfig:function(a){h.forEach(this._actions,function(c){c.setAppConfig(a)},this)}});a.getInstance=function(){null===g&&(g=new a,window._featureActionManager=g);return g};return a})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer".split(" "),
function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",
uri:"jimu/featureActions/CreateLayer"}]})},"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(m,e,h){return m(e,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(e){return 0<e.features.length&&e.features[0].geometry},onExecute:function(e){h.featureAction.zoomTo(this.map,e.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(m,e){return m(null,{name:void 0,label:void 0,
iconFormat:"svg",iconClass:"",map:null,appConfig:{},widgetId:null,constructor:function(h){e.mixin(this,h)},isFeatureSupported:function(e,k){return!0},onExecute:function(e,k){},setMap:function(e){this.map=e},setAppConfig:function(e){this.appConfig=e},getIcon:function(e){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+this.name+"_"+e+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+e+"."+this.iconFormat}})})},
"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(m,e,h){return m(e,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(e){return 0<e.features.length&&e.geometryType},onExecute:function(e){h.featureAction.panTo(this.map,e.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare","dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(m,e,h,k){return m([h],{name:"Flash",iconClass:"icon-flash",
isFeatureSupported:function(d,h){if(1>d.features.length||!h)return!1;var n=d.features[0],c=e.getObject("renderer.symbol",!1,h);return n&&n.geometry&&(n.symbol||c)&&this.map.getLayer(h.id)},onExecute:function(d,e){k.featureAction.flash(d&&d.features,e)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(m,e,h){return m([e],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(e,d){return e&&e.features&&1===
e.features.length&&d&&d.infoTemplate},onExecute:function(e){h.featureAction.showPopup(this.map,e.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(m,e,h){return m(e,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(e){return 1<e.features.length},onExecute:function(e){e=h.createDataSource({type:h.TYPE_FEATURESET,filename:"features",data:e});e.setFormat(h.FORMAT_CSV);e.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask ./jsonConverters".split(" "),
function(m,e,h,k,d,l,n,c){function g(a,c){var g="",b=c.length,d=a.length,e="",q="",r;try{h.forEach(a,function(b){g="string"===typeof b?g+e+b:g+e+(b.alias||b.name);e=","});for(var g=g+"\r\n",s=0;s<b;s++){e="";r=c[s];for(var l=0;l<d;l++){var n=a[l],q=r["string"===typeof n?n:n.name];!q&&"number"!==typeof q&&(q="");q&&/[",\r\n]/g.test(q)&&(q='"'+q.replace(/(")/g,'""')+'"');g=g+e+q;e=","}g+="\r\n"}return g}catch(k){return""}}var a={createDataSource:function(f){return f.type===a.TYPE_TABLE?new q(f):f.type===
a.TYPE_FEATURESET?new r(f):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},s=m(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,constructor:function(){this.nls=window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(a){this.format=a},download:function(){this.getExportString().then(e.hitch(this,function(a){var c=this.filename+this.suffix,g;try{g=!!new Blob}catch(b){g=
!1}g?(a=new Blob([a],{type:"text/plain;charset\x3dutf-8"}),saveAs(a,c)):saveTextAs(a,c,"utf-8")}))},exportToPortal:function(a,c){}}),r=m(s,{featureSet:null,constructor:function(a){this.inherited(arguments);this.featureSet=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===a.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===a.FORMAT_FEATURESET)return this.suffix=".json",this._getAsFeatureSetString();if(this.format===a.FORMAT_GEOJSON)return this.suffix=
".geojson",this._getAsGeoJsonString();var f=new d;f.resolve("");return f},getSupportExportFormats:function(){return[{value:a.FORMAT_CSV,label:this.nls.toCSV},{value:a.FORMAT_FEATURESET,label:this.nls.toFeatureCollection},{value:a.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},_getFeatureSet:function(){var a=new d;if(this.featureSet)a.resolve(this.featureSet);else if(this.url){var c=new l;c.returnGeometry=!0;c.outFields=["*"];this.queryTask=new n(this.url);this.queryTask.execute(c,e.hitch(this,function(c){a.resolve(c)}),
e.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getAsFeatureSetString:function(){return this._getFeatureSet().then(e.hitch(this,function(a){var c="";a&&(a=a.toJson())&&(c=k.stringify(a));return c}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(e.hitch(this,function(a){var g="";a&&(a=(new c.esriConverter).toGeoJson(a))&&(g=k.stringify(a));return g}))},_getAsCSVString:function(){return this._getFeatureSet().then(e.hitch(this,function(a){var c="";a&&(c=
this._createCSVFromFeatureSet(a));return c}))},_createCSVFromFeatureSet:function(a){var c=a.features,d=[],b;if(a.fieldAliases)for(b in a.fieldAliases)a.fieldAliases.hasOwnProperty(b)&&d.push({name:b,alias:a.fieldAliases[b]});else for(b in c=c[0].attributes,c)c.hasOwnProperty(b)&&d.push({name:b});a=h.map(a.features,function(b){return b.attributes});return g(d,a)}}),q=m(s,{table:null,constructor:function(a){this.inherited(arguments);this.table=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===
a.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();var f=new d;f.resolve("");return f},getSupportExportFormats:function(){return[{value:a.FORMAT_CSV,label:this.nls.toCSV}]},_getTableData:function(){var a=new d;if(this.table)a.resolve(this.table);else if(this.url){var c=new l;c.outFields=["*"];this.queryTask=new n(this.url);this.queryTask.execute(c,e.hitch(this,function(c){var b={};b.fields=c.fields;b.datas=h.map(c.features,function(b){return b.attributes});a.resolve(b)}),e.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);
return a},_getAsCSVString:function(){return this._getTableData().then(e.hitch(this,function(a){var c="";a&&(c="\ufeff"+g(a.fields,a.datas));return c}))}});return a})},"jimu/jsonConverters":function(){(function(){function m(d){var e=0,c=0,g=d.length,a=d[c],s;for(c;c<g-1;c++)s=d[c+1],e+=(s[0]-a[0])*(s[1]+a[1]),a=s;return 0<=e}function e(){function d(c){var g,a,e;if(c){if((c.x&&"NaN"!==c.x||0===c.x)&&(c.y&&"NaN"!==c.y||0===c.y))e="Point",a=[c.x,c.y];else if(c.points&&c.points.length)e="MultiPoint",a=
c.points;else if(c.paths&&c.paths.length)c=c.paths,1===c.length?(e="LineString",a=c[0]):(e="MultiLineString",a=c);else if(c.rings&&c.rings.length){e=[];c=c.rings;for(g=0;g<c.length;g++)a=c[g],m(a)?e.push([a]):0<e.length&&e[e.length-1].push(a);1<e.length?(a=e,e="MultiPolygon"):(a=e.pop(),e="Polygon")}g=a&&e?{type:e,coordinates:a}:null}return g}function e(c){var g=null,a,s;if(c&&(g={type:"Feature"},c.geometry&&(g.geometry=d(c.geometry)),c.attributes)){s={};for(a in c.attributes)s[a]=c.attributes[a];
g.properties=s}return g}return{toGeoJson:function(c){var g,a,s;if(c)if(c.features){g={type:"FeatureCollection",features:[]};a=c.features;for(c=0;c<a.length;c++)(s=e(a[c]))&&g.features.push(s)}else g=c.geometry?e(c):d(c);return g}}}function h(){function d(a){var c,g;if("Point"===a)c="esriGeometryPoint";else if("MultiPoint"===a)c="esriGeometryMultipoint",g="points";else if("LineString"===a||"MultiLineString"===a)c="esriGeometryPolyline",g="paths";else if("Polygon"===a||"MultiPolygon"===a)c="esriGeometryPolygon",
g="rings";return{type:c,geomHolder:g}}function e(a){var c,g,d=[],f;c=0;for(g=a.length;c<g;c++)f=a[c],0===c!==m(f)&&(f=f.reverse()),d.push(f);return d}function c(a){var c,g,q,f,p;if("GeometryCollection"===a.type){g=[a.geometries.shift()];c=d(g[0].type);for(q=0;q<a.geometries.length;q++){f=c.type;p=a.geometries[q].type;var h=!1;if(("esriGeometryPoint"===f||"esriGeometryMultipoint"===f)&&("Point"===p||"MultiPoint"===p))h=!0;else if("esriGeometryPolyline"===f&&("LineString"===p||"MultiLineString"===p))h=
!0;else if("esriGeometryPolygon"===f&&("Polygon"===p||"MultiPolygon"===p))h=!0;h&&g.push(a.geometries[q])}}else c=d(a.type),g=[a];"esriGeometryPoint"===c.type&&1<g.length&&(c=d("MultiPoint"));a={spatialReference:{wkid:4326}};if("esriGeometryPoint"===c.type)0===g[0].coordinates.length?(a.x=null,a.y=null):(a.x=g[0].coordinates[0],a.y=g[0].coordinates[1]);else{a[c.geomHolder]=[];for(q=0;q<g.length;q++){f=g[q];var b=h=p=void 0;if("MultiPoint"===f.type||"MultiLineString"===f.type)b=f.coordinates;else if("Point"===
f.type||"LineString"===f.type)b=[f.coordinates];else if("Polygon"===f.type)b=e(f.coordinates);else if("MultiPolygon"===f.type){b=[];p=0;for(h=f.coordinates.length;p<h;p++)b.push(e(f.coordinates[p])[0])}p=b;for(f=0;f<p.length;f++)a[c.geomHolder].push(p[f])}}return a}function g(a){var g,d,e;if(a&&(g={},a.geometry&&(g.geometry=c(a.geometry)),a.properties)){e={};for(d in a.properties)e[d]=a.properties[d];g.attributes=e}return g}return{toEsri:function(a){var d,e,q;if(a)if("FeatureCollection"===a.type){d=
{features:[]};e=a.features;for(a=0;a<e.length;a++)(q=g(e[a]))&&d.features.push(q)}else d="Feature"===a.type?g(a):c(a);return d}}}var k;k="undefined"!==typeof exports&&null!==exports?exports:this;if("function"===typeof define){var d={esriConverter:e,geoJsonConverter:h};define([],function(){return d})}else k.esriConverter=e,k.geoJsonConverter=h}).call(this)},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(m,e,
h){return m(e,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(e){return 1<e.features.length&&e.features[0].geometry},onExecute:function(e){e=h.createDataSource({type:h.TYPE_FEATURESET,filename:"features",data:e});e.setFormat(h.FORMAT_FEATURESET);e.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(m,e,h){return m(e,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(e){return 1<
e.features.length&&e.features[0].geometry},onExecute:function(e){e=h.createDataSource({type:h.TYPE_FEATURESET,filename:"features",data:e});e.setFormat(h.FORMAT_GEOJSON);e.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(m,e,h){return m(e,{iconClass:"icon-statistics",isFeatureSupported:function(e,d){return 1<e.features.length&&d&&0<this.getNumbericFields(d).length},onExecute:function(e,d){var l=
new h,n={featureSet:e,layer:d,fieldNames:this.getNumbericFields(d).map(function(c){return c.name})};l.showContentAsPopup(n)},getNumbericFields:function(e){return e.fields.filter(function(d){return 0<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(d.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when dijit/form/Select esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p){return m([e],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;h.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=k.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=
a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=new r({titleLabel:this.nls.statistics,content:this.domNode,width:400,height:320,buttons:[{label:this.nls.ok}]});this.showContent(a);k.addClass(this._statisticsPopup.domNode,"esri-feature-table-dialog")},_showOneFieldStatContent:function(a,b){var f;p.isStatFromServer(this.statInfo)&&(f=new q,f.placeAt(b),f.show());p.getStatisticsResult(this.statInfo).then(h.hitch(this,
function(a){f&&f.destroy();n(".esriAGOTableStatistics",b).remove();a=this._createStatContent(a);k.place(a,b)}))},_getFieldAliaseFromStatInfo:function(a){if(this.statInfo.layer){var b=d.filter(this.statInfo.layer.fields,function(b){return b.name===a});return b[0]?b[0].alias:""}return this.statInfo.featureSet.fieldAliases?this.statInfo.featureSet.fieldAliases[a]:a},_createFieldDom:function(f){var b;if(1<this.statInfo.fieldNames.length){b=k.create("div",{className:"header"},f);k.create("span",{innerHTML:this.nls.field+
": "},b);var c=new a({options:this.statInfo.fieldNames.map(h.hitch(this,function(b){return{value:b,label:this._getFieldAliaseFromStatInfo(b)}})),style:{width:"200px"}});this.own(l(c,"change",h.hitch(this,function(b){this.statInfo.fieldName=b;this._showOneFieldStatContent(this.statInfo,f)})));c.placeAt(b);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,f)}else b=k.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+
this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},f);return b},_createStatContent:function(a){var b={},f="count sum min max ave stddev".split(" "),c,g,e,p,q,r,s,h;c=k.create("div",{className:"esriAGOTableStatistics",innerHTML:""});k.create("div",{className:"hzLine",innerHTML:""},c);g=k.create("table",{className:"attrTable",innerHTML:"",style:{cellpadding:0,cellspacing:0}},c);for(q in a)a.hasOwnProperty(q)&&(b[q.toLowerCase()]=a[q]);q=b.countfield;h=b.sumfield||"";s=b.minfield||"";r=b.maxfield||
"";a=b.avgfield||"";b=b.stddevfield||"";e=k.create("tbody",{},g);var l=this;d.forEach([q,h,s,r,a,b],function(b,a){""!==b&&(p=k.create("tr",{valign:"top"},e),k.create("td",{"class":"attrName",innerHTML:l.nls[f[a]]},p),k.create("td",{"class":"attrValue",innerHTML:b},p))});k.create("div",{className:"break",innerHTML:""},c);return c}})})},"dojo/NodeList-manipulate":function(){define("./query ./_base/lang ./_base/array ./dom-construct ./dom-attr ./NodeList-dom".split(" "),function(m,e,h,k,d){function l(c){for(;c.childNodes[0]&&
1==c.childNodes[0].nodeType;)c=c.childNodes[0];return c}function n(c,a){"string"==typeof c?(c=k.toDom(c,a&&a.ownerDocument),11==c.nodeType&&(c=c.childNodes[0])):1==c.nodeType&&c.parentNode&&(c=c.cloneNode(!1));return c}var c=m.NodeList;e.extend(c,{_placeMultiple:function(c,a){for(var d="string"==typeof c||c.nodeType?m(c):c,e=[],q=0;q<d.length;q++)for(var f=d[q],p=this.length,h=p-1,b;b=this[h];h--)0<q&&(b=this._cloneNode(b),e.unshift(b)),h==p-1?k.place(b,f,a):f.parentNode.insertBefore(b,f),f=b;e.length&&
(e.unshift(0),e.unshift(this.length-1),Array.prototype.splice.apply(this,e));return this},innerHTML:function(c){return arguments.length?this.addContent(c,"only"):this[0].innerHTML},text:function(c){if(arguments.length){for(var a=0,e;e=this[a];a++)1==e.nodeType&&d.set(e,"textContent",c);return this}for(var r="",a=0;e=this[a];a++)r+=d.get(e,"textContent");return r},val:function(c){if(arguments.length){for(var a=e.isArray(c),d=0,r;r=this[d];d++){var q=r.nodeName.toUpperCase(),f=r.type,p=a?c[d]:c;if("SELECT"==
q){q=r.options;for(f=0;f<q.length;f++){var l=q[f];l.selected=r.multiple?-1!=h.indexOf(c,l.value):l.value==p}}else"checkbox"==f||"radio"==f?r.checked=r.value==p:r.value=p}return this}if((r=this[0])&&1==r.nodeType){c=r.value||"";if("SELECT"==r.nodeName.toUpperCase()&&r.multiple){c=[];q=r.options;for(f=0;f<q.length;f++)l=q[f],l.selected&&c.push(l.value);c.length||(c=null)}return c}},append:function(c){return this.addContent(c,"last")},appendTo:function(c){return this._placeMultiple(c,"last")},prepend:function(c){return this.addContent(c,
"first")},prependTo:function(c){return this._placeMultiple(c,"first")},after:function(c){return this.addContent(c,"after")},insertAfter:function(c){return this._placeMultiple(c,"after")},before:function(c){return this.addContent(c,"before")},insertBefore:function(c){return this._placeMultiple(c,"before")},remove:c.prototype.orphan,wrap:function(c){if(this[0]){c=n(c,this[0]);for(var a=0,d;d=this[a];a++){var e=this._cloneNode(c);d.parentNode&&d.parentNode.replaceChild(e,d);l(e).appendChild(d)}}return this},
wrapAll:function(c){if(this[0]){c=n(c,this[0]);this[0].parentNode.replaceChild(c,this[0]);c=l(c);for(var a=0,d;d=this[a];a++)c.appendChild(d)}return this},wrapInner:function(c){if(this[0]){c=n(c,this[0]);for(var a=0;a<this.length;a++){var d=this._cloneNode(c);this._wrap(e._toArray(this[a].childNodes),null,this._NodeListCtor).wrapAll(d)}}return this},replaceWith:function(c){c=this._normalize(c,this[0]);for(var a=0,d;d=this[a];a++)this._place(c,d,"before",0<a),d.parentNode.removeChild(d);return this},
replaceAll:function(c){c=m(c);for(var a=this._normalize(this,this[0]),d=0,e;e=c[d];d++)this._place(a,e,"before",0<d),e.parentNode.removeChild(e);return this},clone:function(){for(var c=[],a=0;a<this.length;a++)c.push(this._cloneNode(this[a]));return this._wrap(c,this,this._NodeListCtor)}});c.prototype.html||(c.prototype.html=c.prototype.innerHTML);return c})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u){function x(b){return function(a){this._isLoaded?this.inherited(b,arguments):this.loadDropDown(c.hitch(this,b,a))}}var z=e("dijit.form._SelectMenu",q,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(g(this.domNode,"selectstart",function(b){b.preventDefault();b.stopPropagation()}))},focus:function(){var b=!1,a=this.parentWidget.value;
c.isArray(a)&&(a=a[a.length-1]);a&&m.forEach(this.parentWidget._getChildren(),function(f){f.option&&a===f.option.value&&(b=!0,this.focusChild(f,!1))},this);b||this.inherited(arguments)}});d=e("dijit.form.Select"+(a("dojo-bidi")?"_NoBidi":""),[s,r,b],{baseClass:"dijitSelect dijitValidationTextBox",templateString:u,_buttonInputDisabled:a("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var b=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=b?b:0].value)}this.dropDown=new z({id:this.id+"_menu",parentWidget:this});k.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(b){if(!b.value&&!b.label)return new p({ownerDocument:this.ownerDocument});var a=c.hitch(this,"_setValueAttr",b);b=new f({option:b,label:("text"===this.labelType?(b.label||"").toString().replace(/&/g,
"\x26amp;").replace(/</g,"\x26lt;"):b.label)||this.emptyLabel,onClick:a,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:b.disabled||!1});b.focusNode.setAttribute("role","option");return b},_addOptionItem:function(b){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(b))},_getChildren:function(){return!this.dropDown?[]:this.dropDown.getChildren()},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(b){}},focusChild:function(b){b&&
this.set("value",b.option)},_getFirst:function(){var b=this._getChildren();return b.length?b[0]:null},_getLast:function(){var b=this._getChildren();return b.length?b[b.length-1]:null},childSelector:function(b){return(b=v.byNode(b))&&b.getParent()==this.dropDown},onKeyboardSearch:function(b,a,f,c){b&&this.focusChild(b)},_loadChildren:function(b){if(!0===b)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{m.forEach(this._getChildren(),
function(b){b.destroyRecursive()});var a=new f({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(a)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(b){this.inherited(arguments);h.set(this.valueNode,"value",this.get("value"));this._refreshState()},
_setNameAttr:"valueNode",_setDisabledAttr:function(b){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(b){this._set("required",b);this.focusNode.setAttribute("aria-required",b);this._refreshState()},_setOptionsAttr:function(b){this._isLoaded=!1;this._set("options",b)},_setDisplay:function(b){b=("text"===this.labelType?(b||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):b)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+b+"\x3c/span\x3e"},validate:function(b){b=this.disabled||this.isValid(b);this._set("state",b?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",b?"false":"true");var a=b?"":this._missingMsg;a&&this.focused&&this._hasBeenBlurred?t.show(a,this.domNode,this.tooltipPosition,!this.isLeftToRight()):t.hide(this.domNode);this._set("message",a);return b},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);t.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=l.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(g(this.domNode,"selectstart",function(b){b.preventDefault();b.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var b=this._keyNavCodes;delete b[n.LEFT_ARROW];delete b[n.RIGHT_ARROW]},_setStyleAttr:function(b){this.inherited(arguments);
k.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(b){this._loadChildren(!0);this._isLoaded=!0;b()},destroy:function(b){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(b),delete this.dropDown);t.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){t.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
a("dojo-bidi")&&(d=e("dijit.form.Select",d,{_setDisplay:function(b){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));d._Menu=z;d.prototype._onContainerKeydown=x("_onContainerKeydown");d.prototype._onContainerKeypress=x("_onContainerKeypress");return d})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q){return d("dijit.form._FormSelectWidget",q,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var c=this.options||[];if(null==a)return c;if(g.isArrayLike(a))return m.map(a,"return this.getOptions(item);",this);g.isString(a)&&(a={value:a});g.isObject(a)&&(m.some(c,function(c,b){for(var g in a)if(!(g in c)||c[g]!=a[g])return!1;a=b;return!0})||(a=-1));return 0<=a&&a<c.length?c[a]:null},addOption:function(a){m.forEach(g.isArrayLike(a)?a:[a],function(a){a&&g.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(g.isArrayLike(a)?
a:[a]);m.forEach(a,function(a){a&&(this.options=m.filter(this.options,function(f){return f.value!==a.value||f.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){m.forEach(g.isArrayLike(a)?a:[a],function(a){var f=this.getOptions({value:a.value}),b;if(f)for(b in a)f[b]=a[b]},this);this._loadChildren()},setStore:function(a,g,d){c.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,g,d)},_deprecatedSetStore:function(a,c,d){var b=this.store;d=d||{};if(b!==a){for(var q;q=this._notifyConnections.pop();)q.remove();a.get||(g.mixin(a,{_oldAPI:!0,get:function(b){var a=new e;this.fetchItemByIdentity({identity:b,onItem:function(b){a.resolve(b)},onError:function(b){a.reject(b)}});return a.promise},query:function(b,a){var f=new e(function(){c.abort&&c.abort()});f.total=new e;var c=this.fetch(g.mixin({query:b,onBegin:function(b){f.total.resolve(b)},
onComplete:function(b){f.resolve(b)},onError:function(b){f.reject(b)}},a));return new r(f)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[h.after(a,"onNew",g.hitch(this,"_onNewItem"),!0),h.after(a,"onDelete",g.hitch(this,"_onDeleteItem"),!0),h.after(a,"onSet",g.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);d.query&&this._set("query",d.query);d.queryOptions&&this._set("queryOptions",d.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new e,this._queryRes=a.query(this.query,this.queryOptions),s(this._queryRes,g.hitch(this,function(b){if(this.sortByLabel&&!d.sort&&b.length)if(a.getValue)b.sort(k.createSortFunction([{attribute:a.getLabelAttributes(b[0])[0]}],a));else{var e=this.labelAttr;b.sort(function(b,a){return b[e]>a[e]?1:a[e]>
b[e]?-1:0})}d.onFetch&&(b=d.onFetch.call(this,b,d));m.forEach(b,function(b){this._addOptionForItem(b)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(g.hitch(this,function(b,a,f){a==f?this._onSetItem(b):(-1!=a&&this._onDeleteItem(b),-1!=f&&this._onNewItem(b))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:c);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(b):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),g.hitch(this,function(b){console.error("dijit.form.Select: "+b.toString());this.onLoadDeferred.reject(b)})));return b},_setValueAttr:function(a,c){this._onChangeActive||(c=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=g.isArrayLike(a)?m.map(a,function(b){return g.isObject(b)?b:{value:b}}):g.isObject(a)?[a]:[{value:a}];a=m.filter(this.getOptions(a),function(b){return b&&b.value});var d=this.getOptions()||[];if(!this.multiple&&(!a[0]||!a[0].value)&&d.length)a[0]=
d[0];m.forEach(d,function(b){b.selected=m.some(a,function(a){return a.value===b.value})});d=m.map(a,function(b){return b.value});if(!("undefined"==typeof d||"undefined"==typeof d[0])){var b=m.map(a,function(b){return b.label});this._setDisplay(this.multiple?b:b[0]);this.inherited(arguments,[this.multiple?d:d[0],c]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=m.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(m.forEach(this._getChildren(),function(a){a.destroyRecursive()}),m.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var c=this;m.forEach(this._getChildren(),function(g){var b=m.some(a,function(b){return g.option&&
b===g.option.value});b&&!c.multiple&&(c.focusedChild=g);n.toggle(g.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),b);g.domNode.setAttribute("aria-selected",b?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var c=m.filter(a,function(a){return a.selected})[0];if(c&&c.value)return c.value;a[0].selected=!0;return a[0].value}return this.multiple?m.map(m.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,c){(!c||!c.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var c=this.store,g=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:c.getLabel(a);return{value:g?c.getIdentity(a):null,label:g,item:a}},_addOptionForItem:function(a){var c=this.store;c.isItemLoaded&&!c.isItemLoaded(a)?c.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);l.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?a("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+c._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);h.after(this,"onChange",g.hitch(this,"_updateSelection"));var a=this.store;if(a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"]))this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions});this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(m){var e={};m.setObject("dojo.data.util.sorter",e);e.basicComparator=function(e,k){var d=-1;null===e&&(e=void 0);null===k&&(k=void 0);if(e==k)d=0;else if(e>k||null==e)d=1;return d};e.createSortFunction=function(h,k){function d(a,c,g,d){return function(b,e){var r=d.getValue(b,a),h=d.getValue(e,
a);return c*g(r,h)}}for(var l=[],n,c=k.comparatorMap,g=e.basicComparator,a=0;a<h.length;a++){n=h[a];var s=n.attribute;if(s){n=n.descending?-1:1;var r=g;c&&("string"!==typeof s&&"toString"in s&&(s=s.toString()),r=c[s]||g);l.push(d(s,n,r,k))}}return function(a,c){for(var g=0;g<l.length;){var d=l[g++](a,c);if(0!==d)return d}return 0}};return e})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(m,e,h){var k=function(d){function l(c){d[c]=
function(){var g=arguments,a=h(d,function(a){Array.prototype.unshift.call(g,a);return k(m[c].apply(m,g))});if("forEach"!==c||n)return a}}if(!d)return d;var n=!!d.then;n&&(d=e.delegate(d));l("forEach");l("filter");l("map");null==d.total&&(d.total=h(d,function(c){return c.length}));return d};e.setObject("dojo.store.util.QueryResults",k);return k})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(m,e,h,k){return m("dijit.DropDownMenu",
k,{templateString:h,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(d){this._moveToPopup(d);d.stopPropagation();d.preventDefault()},_onLeftArrow:function(d){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else d.stopPropagation(),d.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p){return e("dijit._MenuBase",[r,p,f,q],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){d.toggle(this.domNode,"dijitMenuActive",a);d.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var b=s.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var f=this,b="string"==typeof this.childSelector?this.childSelector:l.hitch(this,"childSelector");this.own(c(this.containerNode,c.selector(b,n.enter),function(){f.onItemHover(s.byNode(this))}),c(this.containerNode,c.selector(b,n.leave),function(){f.onItemUnhover(s.byNode(this))}),c(this.containerNode,c.selector(b,a),function(b){f.onItemClick(s.byNode(this),b);b.stopPropagation()}),
c(this.containerNode,c.selector(b,"focusin"),function(){f._onItemFocus(s.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,f){this.inherited(arguments);if(a&&(-1==f||a.popup&&1==f))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||
b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var f=a.popup;f.parentMenu=this;this.own(this._mouseoverHandle=c.once(f.domNode,"mouseover",l.hitch(this,"_onPopupHover")));var g=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&
g.focusChild(a);g._cleanUp()},onExecute:l.hitch(this,"_cleanUp",!0),onClose:function(){g._mouseoverHandle&&(g._mouseoverHandle.remove(),delete g._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(k.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(m,e,h,k,d,l,n,c,g,a){return e("dijit._KeyNavContainer",[g,a,c],{connectKeyNavHandlers:function(a,c){var g=this._keyNavCodes={},f=l.hitch(this,"focusPrev"),e=l.hitch(this,"focusNext");m.forEach(a,function(a){g[a]=f});m.forEach(c,function(a){g[a]=e});g[d.HOME]=l.hitch(this,"focusFirstChild");g[d.END]=l.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){k.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);m.forEach(this.getChildren(),
l.hitch(this,"_startupChild"))},addChild:function(a,c){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
n.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(m,e,h,k,d,l,n,c){return e("dijit._KeyNavMixin",c,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);h.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var c=this._keyNavCodes={};c[k.HOME]=d.hitch(this,"focusFirstChild");c[k.END]=d.hitch(this,
"focusLastChild");c[this.isLeftToRight()?k.LEFT_ARROW:k.RIGHT_ARROW]=d.hitch(this,"_onLeftArrow");c[this.isLeftToRight()?k.RIGHT_ARROW:k.LEFT_ARROW]=d.hitch(this,"_onRightArrow");c[k.UP_ARROW]=d.hitch(this,"_onUpArrow");c[k.DOWN_ARROW]=d.hitch(this,"_onDownArrow")}var a=this,c="string"==typeof this.childSelector?this.childSelector:d.hitch(this,"childSelector");this.own(l(this.domNode,"keypress",d.hitch(this,"_onContainerKeypress")),l(this.domNode,"keydown",d.hitch(this,"_onContainerKeydown")),l(this.domNode,
"focus",d.hitch(this,"_onContainerFocus")),l(this.containerNode,l.selector(c,"focusin"),function(c){a._onChildFocus(n.getEnclosingWidget(this),c)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(c,a){c&&(this.focusedChild&&c!==this.focusedChild&&this._onChildBlur(this.focusedChild),c.set("tabIndex",this.tabIndex),c.focus(a?"end":"start"))},_onContainerFocus:function(c){c.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){h.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(c){h.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(c){c&&c!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),c.set("tabIndex",this.tabIndex),this.lastFocused=c,this._set("focusedChild",c))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(c,a,d,e){c&&this.focusChild(c)},_keyboardSearchCompare:function(c,a){var d=c.domNode,d=(c.label||(d.focusNode?
d.focusNode.label:"")||d.innerText||d.textContent||"").replace(/^\s+/,"").substr(0,a.length).toLowerCase();return a.length&&d==a?-1:0},_isFormElement:function(c){return"INPUT"===c.tagName||"TEXTAREA"===c.tagName||"SELECT"===c.tagName||"BUTTON"===c.tagName},_onContainerKeydown:function(c){if(!this._isFormElement(document.activeElement)){var a=this._keyNavCodes[c.keyCode];a?(a(c,this.focusedChild),c.stopPropagation(),c.preventDefault(),this._searchString=""):c.keyCode==k.SPACE&&(this._searchTimer&&
!c.ctrlKey&&!c.altKey&&!c.metaKey)&&(c.stopImmediatePropagation(),c.preventDefault(),this._keyboardSearch(c," "))}},_onContainerKeypress:function(c){if(!this._isFormElement(document.activeElement)&&!(c.charCode<=k.SPACE||c.ctrlKey||c.altKey||c.metaKey))c.preventDefault(),c.stopPropagation(),this._keyboardSearch(c,String.fromCharCode(c.charCode).toLowerCase())},_keyboardSearch:function(c,a){var e=null,r,q=0;d.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=a;
var c=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;r=this._searchString.substr(0,c);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var g=this.focusedChild||null;if(1==c||!g)if(g=this._getNextFocusableChild(g,1),!g)return;c=g;do{var d=this._keyboardSearchCompare(g,r);d&&0==q++&&(e=g);if(-1==d){q=-1;break}g=this._getNextFocusableChild(g,1)}while(g&&g!=c)})();this.onKeyboardSearch(e,c,r,q)},_onChildBlur:function(){},
_getNextFocusableChild:function(c,a){var d=c;do{if(c)c=this._getNext(c,a);else if(c=this[0<a?"_getFirst":"_getLast"](),!c)break;if(null!=c&&c!=d&&c.isFocusable())return c}while(c!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(c,a){if(c)for(c=c.domNode;c;)if((c=c[0>a?"previousSibling":"nextSibling"])&&"getAttribute"in c){var d=n.byNode(c);if(d)return d}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r){n=m("dijit.MenuItem"+(l("dojo-bidi")?"_NoBidi":""),[c,g,a,s],{templateString:r,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var c="",g;g=a.search(/{\S}/);if(0<=g){var c=a.charAt(g+1),d=a.substr(0,g);a=a.substr(g+3);g=d+c+a;a=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+c+"\x3c/span\x3e"+a}else g=a;this.domNode.setAttribute("aria-label",g+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",c)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);h.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&h.set(this.accelKeyNode,"id",this.id+"_accel");e.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==l("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_setSelected:function(a){k.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){d.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){d.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,h.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});l("dojo-bidi")&&(n=m("dijit.MenuItem",n,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return n})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(m,e){return m("dijit._Contained",null,{_getSibling:function(e){var k=this.getParent();return k&&k._getSiblingOfChild&&k._getSiblingOfChild(this,
"previous"==e?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var e=this.getParent();return!e||!e.getIndexOfChild?-1:e.getIndexOfChild(this)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(m,e,h,k,d,l){return m("dijit.MenuSeparator",[h,k,d],{templateString:l,
buildRendering:function(){this.inherited(arguments);e.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),function(m,e,h,k,d,l,n,c,g){function a(a){var c;c=new d;c.outFields=[a.fieldName];c.outStatistics=[];c.geometry=a.geometry;var f=r(a);m.forEach(f,function(f){var g=new h;g.statisticType=
f;g.displayFeildName=a.fieldName;g.onStatisticField=a.fieldName;g.outStatisticFieldName=b[f];c.outStatistics.push(g)});c.where=a.filterExpression?a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(c.geometry=a.geometry);return(new k(a.layer.url)).execute(c).then(function(b){return b&&b.features&&0<b.features.length?(b=b.features[0].attributes,p(a,b),b):[]})}function s(b){var a={countField:0,sumField:0},c=r(b),f=0,g=0;b.featureSet.features.forEach(function(d){var e=
d.attributes[b.fieldName];null===e||"undefined"===typeof e||c.forEach(function(b){switch(b){case "count":a.countField++;break;case "sum":a.sumField+=e;break;case "min":a.minField="undefined"===typeof a.minField?e:Math.min(a.minField,e);break;case "max":a.maxField="undefined"===typeof a.maxField?e:Math.max(a.minField,e);break;case "avg":f++,g+=e}})});if(0===f)return e({countField:0});a.avgField=0===f?"":g/f;var d=b.featureSet.features.filter(function(a){a=a.attributes[b.fieldName];return null===a||
"undefined"===typeof a?!1:!0}).map(function(a){return a.attributes[b.fieldName]});a.stddevField=q(d);p(b,a);return e(a)}function r(b){return b.statisticTypes&&0<b.statisticTypes.length?t.filter(function(a){return-1<b.statisticTypes.indexOf(a)}):t}function q(b){var a=b.length;if(1>=a)return 0;var c=0;b.forEach(function(b){c+=b});var f=c/a,g=0;b.forEach(function(b){g+=Math.pow(b-f,2)});return Math.sqrt(1/(a-1)*g)}function f(b){var a=c.getInstanceSync();return b.layer?a.getLayerInfoById(b.layer.id).loadInfoTemplate().then(function(b){var a=
{};b.info&&b.info.fieldInfos&&b.info.fieldInfos.forEach(function(b){a[b.fieldName]=b});return a}):e({})}function p(b,a){if(b.fieldInfos[b.fieldName])for(var c in a)"countField"!==c&&l.isDefined(a[c])&&(a[c]=null===a[c]||"undefined"===typeof a[c]?"":n.localizeNumberByFieldInfo(a[c],b.fieldInfos[b.fieldName]))}var t="count sum min max avg stddev".split(" "),b={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};g.getStatisticsResult=function(b){return f(b).then(function(c){b.fieldInfos=
c;if(b.featureSet)return s(b);if(b.layer){if(b.layer.url)return a(b);b.featureSet=n.toFeatureSet(b.layer.graphics);return s(b)}})};g.isStatFromServer=function(b){return b.layer&&b.layer.url};g.getStddevVal=q})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q){return m(g,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(a){return 1<a.features.length},onExecute:function(a,g){var d,b;d={layerDefinition:{geometryType:g.geometryType,fields:e.clone(g.fields),objectIdField:g.objectIdField},featureSet:a.toJson()};d=new l(d);(b=g._json?k.parse(g._json):null)&&b.drawingInfo&&b.drawingInfo.renderer?(b=b.drawingInfo.renderer,b=n.fromJson(b)):b=n.fromJson(g.renderer.toJson());d.setRenderer(b);(b=g.getSelectionSymbol())&&
d.setSelectionSymbol(c.fromJson(b.toJson()));this._popupAddLayer(d)},_popupAddLayer:function(c){var g,r=h.create("div",{style:"padding: 0 10px 0 10px;"}),b=(new s({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(r);h.setStyle(b.searchBtn,"display","none");var l=new a({content:r,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:e.hitch(this,function(){c.name=q.stripHTML(b.getValue());this._addLayerToMap(c);l.close();
g&&g.remove&&g.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:e.hitch(this,function(){l.close();g&&g.remove&&g.remove()})}]});b.inputSearch.focus();l.disableButton(0);g=d(b.inputSearch,"keyup",function(){b.getValue()?l.enableButton(0):l.disableButton(0)})},_addLayerToMap:function(a){var c=r.getInstanceSync(),g=d(c,"layerInfosChanged",e.hitch(this,function(b){a.id===b.id&&b.loadInfoTemplate().then(e.hitch(this,function(){b.enablePopup();g.remove()}))}));this.map.addLayer(a)}})})},
"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(m,e,h,k,d){return m([k,d],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&e.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return h.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(d){13===(void 0!==d.keyCode?d.keyCode:d.which)&&this.doSearch();d.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()}})})},
"jimu/dijit/PopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin ./PopupMenuItem".split(" "),function(m,e,h,k,d,l,n,c,g){var a=null,s=m([n,c],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);this.hide();this.menuItems=[];this.own(d(this.domNode,"click",h.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||e.isDescendant(a,this.menuNode)||this.hide()})));this.own(d(this.closeBtn,"click",h.hitch(this,this.hide)))},setActions:function(a){this.clearActions();k.forEach(a,h.hitch(this,this._addMenuItem))},clearActions:function(){this.menuItems=[];e.empty(this.menuContent)},_addMenuItem:function(a){a=new g({action:a});e.place(a.domNode,
this.menuContent);a.startup();this.menuItems.push(a);this.own(d(a,"click",h.hitch(this,this.hide)))},hide:function(){e.setStyle(this.domNode,"display","none")},show:function(a,c){if(0===this.menuItems.length)e.setStyle(this.domNode,"display","none");else{"string"===typeof c&&""!==c?(this.labelNode.innerHTML=c,e.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",e.setStyle(this.titleNode,"display","none"));var f,g=a.y+a.h,d;f=window.isRTL?a.x:a.x+a.w;e.setStyle(this.domNode,"display",
"");e.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});d=l.getMarginSize(this.menuNode);e.setStyle(this.menuNode,{left:(window.isRTL?f+d.w>window.innerWidth?window.innerWidth-d.w:0>f?0:f:0>f-d.w?0:f>window.innerWidth?window.innerWidth-d.w:f-d.w)+"px",top:(d.h>window.innerHeight?0:g+d.h>window.innerHeight?window.innerHeight-d.h:g+d.h+5<window.innerHeight?g+5:g)+"px"})}}});s.getInstance=function(){null===a&&(a=new s,e.place(a.domNode,document.body),a.startup());a.setActions([]);return a};
return s})},"jimu/dijit/PopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(m,e,h,k,d,l,n,c,g){return m([c,g,n],{baseClass:"popup-menu-item",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"icon jimu-float-leading"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',
action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=this.action.label,this.action.iconClass?e.addClass(this.iconNode,this.action.iconClass):e.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(d(this.domNode,l.enter,h.hitch(this,this._useHoverIcon))),this.own(d(this.domNode,l.leave,h.hitch(this,this._useNormalIcon))));this.own(d(this.domNode,"click",h.hitch(this,this._clickHandler)))},_useNormalIcon:function(){this.action.iconClass?
e.removeClass(this.iconNode,"highlight"):e.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?e.addClass(this.iconNode,"highlight"):e.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("hover")+")")},_clickHandler:function(a){k.stop(a);if(this.action){var c;this.action.data.features&&0<this.action.data.features.length&&(c=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,
c)}this.emit("click")}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./LayerInfos/LayerInfos"],function(m,e,h,k){var d=null,l=m(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(h.subscribe("app/mapLoaded",e.hitch(this,this._onMapLoaded)),h.subscribe("app/mapChanged",e.hitch(this,this._onMapChanged))):(h.subscribe("mapLoaded",e.hitch(this,this._onMapLoaded)),h.subscribe("mapChanged",e.hitch(this,this._onMapChanged)));
h.subscribe("widgetDestroyed",e.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(d,c){return e.getObject(d+".filterExprs."+c,!1,this._filters)},applyWidgetFilter:function(d,c,g){e.setObject(d+".filterExprs."+c,g,this._filters);c=this.layerInfos.getLayerInfoById(d);d=this._getFilterExp(d);null!==d&&c.setFilter(d)},_onMapLoaded:function(){this.layerInfos=k.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=k.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(d){for(var c in this._filters)if(this._filters[c]){var g=
this._filters[c];if(g)for(var a in g)a===d.id&&delete g[a]}},_traversalFilter:function(){this.layerInfos.traversal(e.hitch(this,function(d){this._filters[d.id]||(this._filters[d.id]={definitionExpression:d.getFilter(),filterExprs:{}})}))},_getFilterExp:function(d){if(!this._filters[d])return null;var c=[],g=this._filters[d].definitionExpression;d=this._filters[d].filterExprs;g&&c.push(g);for(var a in d)(g=d[a])&&c.push("("+g+")");return c.join(" AND ")}});l.getInstance=function(){if(null===d)d=new l,
window._filterManager=d;else return d};return l})},"jimu/OnScreenWidgetIcon":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetBase ./utils".split(" "),function(m,e,h,k,d,l,n){return m(l,{"class":"jimu-widget-onscreen-icon",postCreate:function(){this.inherited(arguments);this.iconNode=k.create("img",{src:this.widgetConfig.icon},this.domNode);k.setAttr(this.domNode,"title",this.widgetConfig.label);k.setAttr(this.domNode,"data-widget-name",this.widgetConfig.name);
this.own(d(this.domNode,"click",e.hitch(this,function(){this.onClick()})));this.position=e.clone(this.widgetConfig.position);"map"===this.widgetConfig.position.relativeTo&&this.own(d(this.map,"resize",e.hitch(this,function(){var c=e.clone(this.position);delete c.width;delete c.height;this.panel&&this.panel.setPosition(c)})));this.state="closed"},startup:function(){this.inherited(arguments)},onClick:function(){"closed"===this.state?this.switchToOpen():this.switchToClose()},moveTo:function(c){var g=
{left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},g=e.mixin(g,n.getPositionStyle(c));delete g.width;delete g.height;k.setStyle(this.domNode,g);this.position=e.clone(c);this.widgetConfig&&this.widgetConfig.panel&&(this.widgetConfig.panel.position=e.clone(c),this.widgetConfig.position=e.clone(c));this.panel&&this.panel.setPosition(e.clone(c));this.widget&&this.widget.setPosition(this.getOffPanelWidgetPosition(this.widget))},destroy:function(){this.panel?this.panelManager.destroyPanel(this.panel):
this.widget&&this.widgetManager.destroyWidget(this.widget);this.inherited(arguments)},switchToOpen:function(){this.state="opened";this.panelManager.closeAllPanelsInGroup(this.widgetConfig.gid);h.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(c){c.closeable&&this.widgetManager.closeWidget(c)},this);k.addClass(this.domNode,"jimu-state-selected");this._showLoading();!1===this.widgetConfig.inPanel?this.widgetManager.loadWidget(this.widgetConfig).then(e.hitch(this,function(c){this.widget=
c;c.setPosition(this.getOffPanelWidgetPosition(c));this.widgetManager.openWidget(c);this.own(d(c,"close",e.hitch(this,function(){this.switchToClose()})));this._hideLoading()})):this.panelManager.showPanel(e.clone(this.widgetConfig)).then(e.hitch(this,function(c){this.panel=c;this.own(d(c,"close",e.hitch(this,function(){this.switchToClose()})));this._hideLoading()}))},switchToClose:function(){this.state="closed";k.removeClass(this.domNode,"jimu-state-selected");!1===this.widgetConfig.inPanel?this.widgetManager.closeWidget(this.widget):
this.panelManager.closePanel(this.panel)},getOffPanelWidgetPosition:function(c){var g={relativeTo:c.position.relativeTo},a=k.getMarginBox(this.domNode);c=this.widgetManager.getWidgetMarginBox(c);var d=k.getMarginBox("map"===g.relativeTo?this.map.id:jimuConfig.layoutId),e=a.t+a.h+1;e+c.h>d.h?g.bottom=d.h-a.t+1:g.top=e;window.isRTL?g.right=0>a.l+a.w-c.w?0:a.l+a.w-c.w:a.l+c.w>d.w?g.right=0:g.left=a.l;return g},_showLoading:function(){k.setAttr(this.iconNode,"src",require.toUrl("jimu")+"/images/loading_circle.gif")},
_hideLoading:function(){k.setAttr(this.iconNode,"src",this.widgetConfig.icon)}})})},"jimu/WidgetPlaceholder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase","./utils"],function(m,e,h,k,d){return m(k,{"class":"jimu-widget-placeholder",postCreate:function(){this.inherited(arguments);this.indexNode=h.create("div",{"class":"inner",innerHTML:this.index},this.domNode);h.setAttr(this.domNode,"title",window.jimuNls.widgetPlaceholderTooltip)},moveTo:function(l){var n=
{left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},n=e.mixin(n,d.getPositionStyle(l));delete n.width;delete n.height;h.setStyle(this.domNode,n)},setIndex:function(d){this.index=d;this.indexNode.innerHTML=d}})})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(m,e,h){var k=null,d;d=m(null,{constructor:function(d){h.subscribe("publishData",e.hitch(this,this.onDataPublished));h.subscribe("fetchData",e.hitch(this,this.onFetchData));
h.subscribe("clearAllData",e.hitch(this,this.onClearAllData));h.subscribe("removeData",e.hitch(this,this.onRemoveData));h.subscribe("clearDataHistory",e.hitch(this,this.onClearDataHistory));this.widgetManager=d},_dataStore:{},onDataPublished:function(d,e,c,g){"undefined"===typeof g&&(g=!1);this._dataStore[e]?(this._dataStore[e].current=c,g&&(this._dataStore[e].history?this._dataStore[e].history.push(c):this._dataStore[e].history=[c])):(this._dataStore[e]={current:c},g&&(this._dataStore[e].history=
[c]))},onFetchData:function(d){var e;if(d)"framework"===d?this._dataStore[d]?h.publish("dataFetched","framework","framework",this._dataStore[d].current,this._dataStore[d].history):h.publish("noData","framework","framework"):(e=this.widgetManager.getWidgetById(d))?this._dataStore[d]?h.publish("dataFetched",e.name,d,this._dataStore[d].current,this._dataStore[d].history):h.publish("noData",e.name,d):h.publish("noData",void 0,d);else{for(var c in this._dataStore)(e=this.widgetManager.getWidgetById(c))&&
h.publish("dataFetched",e.name,c,this._dataStore[c].current,this._dataStore[c].history);e||h.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};h.publish("allDataCleared")},onRemoveData:function(d){delete this._dataStore[d];h.publish("dataRemoved",d)},onClearDataHistory:function(d){this._dataStore[d]&&(this._dataStore[d].history=[]);h.publish("dataHistoryCleared",d)}});d.getInstance=function(e){null===k&&(k=new d(e));return k};return d})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q){var f=null,p=m(null,{constructor:function(){window.isBuilder?(d.subscribe("app/mapLoaded",h.hitch(this,this._onMapLoaded)),d.subscribe("app/mapChanged",h.hitch(this,this._onMapChanged))):(d.subscribe("mapLoaded",h.hitch(this,this._onMapLoaded)),d.subscribe("mapChanged",h.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(c){var b=c.geometryType,f=new a("#00FFFF"),d=new s(s.STYLE_CIRCLE,16,null,f),g=new r(r.STYLE_SOLID,f,2),f=new q(q.STYLE_NULL,
g,f);"esriGeometryPoint"===b?c.setSelectionSymbol(d):"esriGeometryPolyline"===b?c.setSelectionSymbol(g):"esriGeometryPolygon"===b&&c.setSelectionSymbol(f)},updateSelectionByFeatures:function(a,b,c){a.getSelectionSymbol()||this.setSelectionSymbol(a);var f=new e;a._selectHandler({features:b},c,null,null,f);this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a));return f},setSelection:function(a,b){return this.updateSelectionByFeatures(a,
b,l.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,l.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,b,l.SELECTION_SUBTRACT)},clearSelection:function(a){this.clearDisplayLayer(a);return this.updateSelectionByFeatures(a,[],l.SELECTION_NEW)},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(a,b,f){return k.filter(a.graphics,h.hitch(this,function(a){return f?
c.contains(b,a.geometry):c.intersects(b,a.geometry)}))},getUnionGeometryBySelectedFeatures:function(a){var b=null;a=a.getSelectedFeatures();0<a.length&&(b=k.map(a,h.hitch(this,function(b){return b.geometry})),b=c.union(b));return b},_createDisplayLayer:function(a){var b=new n;b.id="displayLayer_of_"+a.id;this.map.addLayer(b);return b},_updateDisplayLayer:function(a){var b=a.getSelectedFeatures(),c=this._displayLayers[a.id];this.clearDisplayLayer(a);var f=a.getSelectionSymbol();k.forEach(b,h.hitch(this,
function(b){b.setSymbol(null);b=new g(b.toJson());b.setSymbol(f);c.add(b)}))},_isLayerNeedDisplayLayer:function(a){return!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});p.getInstance=function(){f||(f=new p,window._selectionManager=f);return f};return p})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(m,
e,h,k,d,l,n,c,g){return m([l,n],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(d.subscribe("publishData",e.hitch(this,this._onReceiveData)));this.own(d.subscribe("dataFetched",e.hitch(this,this._onReceiveData)));
this.own(d.subscribe("noData",e.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(a,g){this.position=a;var d=c.getPositionStyle(this.position);d.position="absolute";g||(g="map"===a.relativeTo?
this.map.id:window.jimuConfig.layoutId);k.place(this.domNode,g);k.setStyle(this.domNode,d);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return k.getMarginBox(this.domNode)},setMap:function(a){this.map=a},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,c,g){},onAction:function(a,c){},getPanel:function(){if(!1===this.inPanel)return null;
if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return g.getInstance().getPanelById(this.id+"_panel");var a=g.getInstance().getPanelById(this.gid+"_panel");return a?a:g.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,c){"undefined"===typeof c&&(c=!1);d.publish("publishData",this.name,this.id,a,c)},fetchData:function(a){a?d.publish("fetchData",a):0!==this.listenWidgetIds.length?h.forEach(this.listenWidgetIds,function(a){d.publish("fetchData",a)},this):d.publish("fetchData")},
fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);h.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){return this.widgetManager.triggerWidgetOpen(a)},_onReceiveData:function(a,c,g,d){if(c!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onReceiveData(a,c,g,d)},onReceiveData:function(a,c,g,d){},_onNoData:function(a,c){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onNoData(a,c)},onNoData:function(a,
c){}})})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(m,e,h,k){return m([k],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&("closed"!==this.widget.state&&
e.isFunction(this.widget.resize))&&this.widget.resize()},setLoading:function(d){this.loading=d;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(d){this.widget=d;this.loading&&this.loading.destroy();h.place(d.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(d){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+d.stack)}this.loading&&this.loading.domNode&&
this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(m,e,h,k,d,l,n,c,g){return m([d,l],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();
this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];h.forEach(a,function(a){var c,g;!1!==a.visible&&(g=new n,c=this.createFrame(a),this.addChild(c),c.setLoading(g),this.widgetManager.loadWidget(a).then(e.hitch(this,function(a){c.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(a){for(var c=
this.getChildren(),g=0;g<c.length;g++)if(c[g].getWidget()&&c[g].getWidget().id===a)return c[g].getWidget()},createFrame:function(a){return new c},setPosition:function(a,c){this.position=a;var d=g.getPositionStyle(this.position);d.position="absolute";c||(c="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(d.display="none");k.place(this.domNode,c);k.setStyle(this.domNode,d)},getPosition:function(){return this.position},setState:function(a){this.state=
a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){h.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){h.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){h.forEach(this.getChildren(),function(a){a.getWidget()&&
this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){h.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){h.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),this.getChildren().forEach(function(c){c.getWidget()&&
c.getWidget().id===a.id&&(c.getWidget().destroy(),c.setLoading(new n),this.widgetManager.loadWidget(a).then(e.hitch(this,function(a){c.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},this))},isWidgetInPanel:function(a){return h.some(this.getAllWidgetConfigs(),function(c){if(a.id===c.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var c=-1,g=0;g<this.config.widgets.length;g++)this.config.widgets[g].id===a.id&&(c=g);0<
c&&(this.config.widgets[c]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(c){console.error("destroy widget frame error."+c.stack)}});this.inherited(arguments)}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(m,e,h,k,d){return m([k,d],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(h(window,"resize",e.hitch(this,
this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),function(m,e,h,k,d,l){return{cloneSymbol:function(e){if(!e)return null;var c=null;try{var g=e.toJson(),c=d.fromJson(g)}catch(a){console.error(a)}return c},getDefaultMarkerSymbol:function(){return d.fromJson({style:"esriSMSCircle",
color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return d.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return d.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return d.fromJson({color:[255,
255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return d.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return d.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var d=
m.toUrl("jimu/css/images/grey_pin.png"),d=new l(d,16,16);d.setOffset(0,8);return d},createSymbolNode:function(l,c){var g=32,a=32,s=h.create("div",{},document.body);h.setStyle(s,"display","inline-block");if(c)g=c.width,a=c.height;else if(g=80,a=30,this.isSimpleMarkerSymbol(l))a=g=Math.min(l.size+12,125);else if(this.isPictureMarkerSymbol(l)){if(!l.url||"http://"===l.url||-1===l.url.indexOf("http://")&&-1===l.url.indexOf("https://")&&-1===l.url.indexOf("data:"))return;a=g=Math.min(Math.max(l.width,
l.height),125)}else if(this.isSimpleLineSymbol(l)||this.isCartographicLineSymbol(l))g=190,a=20;var r=k.createSurface(s,g,a);if("vml"===k.renderer){var q=r.getEventSource();h.setStyle(q,"position","relative");h.setStyle(q.parentNode,"position","relative")}var q=null,q=c?d.getShapeDescriptors(l):this.isSimpleLineSymbol(l)||this.isCartographicLineSymbol(l)?this._getLineShapeDesc(l):d.getShapeDescriptors(l),f;try{f=r.createShape(q.defaultShape),q.fill&&f.setFill(q.fill),q.stroke&&f.setStroke(q.stroke)}catch(p){r.clear();
r.destroy();return}var r=r.getDimensions(),r={dx:r.width/2,dy:r.height/2},t=f.getBoundingBox(),q=t.width,t=t.height;if(q>g||t>a)g=((g<a?g:a)-5)/(q>t?q:t),e.mixin(r,{xx:g,yy:g});f.applyTransform(r);return s},_getLineShapeDesc:function(d){var c=null;if(this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d))c={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:d.getStroke()};return c},isSimpleMarkerSymbol:function(d){return d&&"esri.symbol.SimpleMarkerSymbol"===d.declaredClass},
isPictureMarkerSymbol:function(d){return d&&"esri.symbol.PictureMarkerSymbol"===d.declaredClass},isSimpleLineSymbol:function(d){return d&&"esri.symbol.SimpleLineSymbol"===d.declaredClass},isCartographicLineSymbol:function(d){return d&&"esri.symbol.CartographicLineSymbol"===d.declaredClass},isSimpleFillSymbol:function(d){return d&&"esri.symbol.SimpleFillSymbol"===d.declaredClass},isPictureFillSymbol:function(d){return d&&"esri.symbol.PictureFillSymbol"===d.declaredClass},isTextSymbol:function(d){return d&&
"esri.symbol.TextSymbol"===d.declaredClass}}})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale esri/lang dojo/data/ItemFileWriteStore jimu/utils".split(" "),function(m,e,h,k,d,l,n){return m([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,fieldsStore:null,
isHosted:!1,constructor:function(){String.prototype.startsWith=function(c){return 0===this.indexOf(c)};String.prototype.endsWith=function(c){return this.substring(this.length-c.length)===c};String.prototype.count=function(c){return this.split(c).length-1};String.prototype.trim||(String.prototype.trim=e.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},
OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",
numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",
dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast"},prepare:function(c,d){this.isHosted=n.isHostedService(c);this.setFieldsStoreByFieldInfos(d)},isPartsObjHasError:function(c){var d=
!1;c&&(d=c.parts&&0<=c.parts.length?h.every(c.parts,e.hitch(this,function(a){return a.parts?0<a.parts.length?h.every(a.parts,e.hitch(this,function(a){return!a.error})):!1:!a.error})):!1);return!d},isAskForValues:function(c){var d=!1;return d=h.some(c.parts,e.hitch(this,function(a){return a.parts?h.some(a.parts,e.hitch(this,function(a){return!!a.interactiveObj})):!!a.interactiveObj}))},setFieldsStoreByFieldInfos:function(c){c=h.filter(c,e.hitch(this,function(c){return 0<=this._supportFieldTypes.indexOf(c.type)}));
c=h.map(c,function(c,a){var d;switch(c.type){case "esriFieldTypeString":d="string";break;case "esriFieldTypeDate":d="date";break;default:d="number"}return{id:a,label:c.name,shortType:d,alias:c.alias,editable:c.editable,name:c.name,nullable:c.nullable,type:c.type}},this);this.fieldsStore=new l({data:{identifier:"id",label:"label",items:c}});return c.length},_validatePartsObj:function(c){return c&&"object"===typeof c},_isObject:function(c){return c&&"object"===typeof c},_isString:function(c){return c&&
"string"===typeof c},containsNonLatinCharacter:function(c){for(var d=0;d<c.length;d++)if(255<c.charCodeAt(d))return!0;return!1},getExprByFilterObj:function(c){if(!h.every(c.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(c))return c.expr="",c.expr;var g="";if(0===c.parts.length)g="1\x3d1";else if(1===c.parts.length)g=this.builtFilterString(c.parts[0]);else for(var a="",e=0;e<c.parts.length;e++){var r=this.builtFilterString(c.parts[e]);if(!d.isDefined(r))return null;g+=a+
"("+r+")";a=a||" "+c.logicalOperator+" "}return c.expr=g},isPartsObjReadyToBuild:function(c){return h.every(c.parts,e.hitch(this,function(c){return c.parts?h.every(c.parts,e.hitch(this,function(a){return this._isPartReadyToBuild(a)})):this._isPartReadyToBuild(c)}))},_isPartReadyToBuild:function(c){var d=c.fieldObj.shortType,a=c.operator,e=c.valueObj;c=e.type||"value";var r=e.value,q=e.value1,e=e.value2;if("value"===c){if("string"===d)return a===this.OPERATORS.stringOperatorIsBlank||a===this.OPERATORS.stringOperatorIsNotBlank?
!0:n.isNotEmptyString(r);if("number"===d)return a===this.OPERATORS.numberOperatorIsBlank||a===this.OPERATORS.numberOperatorIsNotBlank?!0:a===this.OPERATORS.numberOperatorIsBetween||a===this.OPERATORS.numberOperatorIsNotBetween?n.isValidNumber(q)&&n.isValidNumber(e):n.isValidNumber(r);if("date"===d)return a===this.OPERATORS.dateOperatorIsBlank||a===this.OPERATORS.dateOperatorIsNotBlank?!0:a===this.OPERATORS.dateOperatorIsBetween||a===this.OPERATORS.dateOperatorIsNotBetween?n.isNotEmptyString(q)&&n.isNotEmptyString(e):
n.isNotEmptyString(r)}else{if("field"===c)return n.isNotEmptyString(r);if("unique"===c){if("string"===d)return n.isNotEmptyString(r);if("number"===d)return n.isValidNumber(r)}}return!1},builtFilterString:function(c){var g="";if(c.parts)for(var a="",e=0;e<c.parts.length;e++){var r=c.parts[e],q=this.builtSingleFilterString(r);r.expr=q.whereClause;if(!d.isDefined(q.whereClause))return null;g+=a+q.whereClause;a=" "+c.logicalOperator+" "}else g=this.builtSingleFilterString(c).whereClause;return c.expr=
g},builtSingleFilterString:function(c,g){this.isHosted&&(c.caseSensitive=!1);if(d.isDefined(c.valueObj.isValid)&&!c.valueObj.isValid)return{whereClause:null};var a=c.valueObj.value,e=c.valueObj.value1,r=c.valueObj.value2,q=!1;c.interactiveObj&&d.isDefined(g)&&(q=!0,d.isDefined(c.valueObj.value)&&(a="{"+g+"}"),d.isDefined(c.valueObj.value1)&&(e="{"+g+"}"),d.isDefined(c.valueObj.value2)&&(r="{"+(g+1)+"}"));var f="";if("string"===c.fieldObj.shortType)switch(e="",q&&this.isHosted?e="N":a&&"field"!==c.valueObj.type&&
this.isHosted&&this.containsNonLatinCharacter(a)&&(e="N"),c.operator){case this.OPERATORS.stringOperatorIs:f="field"===c.valueObj.type?c.fieldObj.name+" \x3d "+a:c.fieldObj.name+" \x3d "+e+"'"+a.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorIsNot:f="field"===c.valueObj.type?c.fieldObj.name+" \x3c\x3e "+a:c.fieldObj.name+" \x3c\x3e "+e+"'"+a.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorStartsWith:f=c.caseSensitive?c.fieldObj.name+" LIKE "+e+"'"+a.replace(/\'/g,
"''")+"%'":"UPPER("+c.fieldObj.name+") LIKE UPPER("+e+"'"+a.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorEndsWith:f=c.caseSensitive?c.fieldObj.name+" LIKE "+e+"'%"+a.replace(/\'/g,"''")+"'":"UPPER("+c.fieldObj.name+") LIKE UPPER("+e+"'%"+a.replace(/\'/g,"''")+"')";break;case this.OPERATORS.stringOperatorContains:f=c.caseSensitive?c.fieldObj.name+" LIKE "+e+"'%"+a.replace(/\'/g,"''")+"%'":"UPPER("+c.fieldObj.name+") LIKE UPPER("+e+"'%"+a.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorDoesNotContain:f=
c.caseSensitive?c.fieldObj.name+" NOT LIKE "+e+"'%"+a.replace(/\'/g,"''")+"%'":"UPPER("+c.fieldObj.name+") NOT LIKE UPPER("+e+"'%"+a.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorIsBlank:f=c.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:f=c.fieldObj.name+" IS NOT NULL"}else if("number"===c.fieldObj.shortType)switch(c.operator){case this.OPERATORS.numberOperatorIs:f=c.fieldObj.name+" \x3d "+a;break;case this.OPERATORS.numberOperatorIsNot:f=c.fieldObj.name+
" \x3c\x3e "+a;break;case this.OPERATORS.numberOperatorIsAtLeast:f=c.fieldObj.name+" \x3e\x3d "+a;break;case this.OPERATORS.numberOperatorIsLessThan:f=c.fieldObj.name+" \x3c "+a;break;case this.OPERATORS.numberOperatorIsAtMost:f=c.fieldObj.name+" \x3c\x3d "+a;break;case this.OPERATORS.numberOperatorIsGreaterThan:f=c.fieldObj.name+" \x3e "+a;break;case this.OPERATORS.numberOperatorIsBetween:f=c.fieldObj.name+" BETWEEN "+e+" AND "+r;break;case this.OPERATORS.numberOperatorIsNotBetween:f=c.fieldObj.name+
" NOT BETWEEN "+e+" AND "+r;break;case this.OPERATORS.numberOperatorIsBlank:f=c.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:f=c.fieldObj.name+" IS NOT NULL"}else switch(d.isDefined(a)&&("field"!==c.valueObj.type&&"string"===typeof a)&&(a=new Date(a)),"field"!==c.valueObj.type&&(a&&(a=new Date(a)),e&&(e=new Date(e)),r&&(r=new Date(r))),c.operator){case this.OPERATORS.dateOperatorIsOn:f="field"===c.valueObj.type?c.fieldObj.name+" \x3d "+a:q?c.fieldObj.name+" BETWEEN "+
(this.isHosted?"":"timestamp ")+"'{"+g+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(g+1)+"}'":c.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(a)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(a))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:f="field"===c.valueObj.type?c.fieldObj.name+" \x3c\x3e "+a:q?c.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+g+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(g+1)+"}'":c.fieldObj.name+
" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(a)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(a))+"'";break;case this.OPERATORS.dateOperatorIsBefore:f="field"===c.valueObj.type?c.fieldObj.name+" \x3c "+a:c.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(a)+"'";break;case this.OPERATORS.dateOperatorIsAfter:f="field"===c.valueObj.type?c.fieldObj.name+" \x3e "+a:c.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(a))+
"'";break;case this.OPERATORS.dateOperatorIsBetween:f=q?c.fieldObj.name+" BETWEEN '"+e+"' AND '"+r+"'":c.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(e)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(r))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:f=q?c.fieldObj.name+" NOT BETWEEN '"+e+"' AND '"+r+"'":c.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(e)+"' AND "+(this.isHosted?"":"timestamp ")+
"'"+this.formatDate(this.addDay(r))+"'";break;case this.OPERATORS.dateOperatorIsBlank:f=c.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:f=c.fieldObj.name+" IS NOT NULL"}return{whereClause:f}},formatDate:function(c){var d=k.format(c,{datePattern:"yyyy-MM-dd",selector:"date"});c=k.format(c,{selector:"time",timePattern:"HH:mm:ss"});return d+" "+c},addDay:function(c){return new Date(c.getTime()+this.dayInMS)},getFilterObjByExpr:function(c){if(c&&this.fieldsStore){var d=this.replaceStrings(c);
c=d.defExpr;var a=this.findParts(c,"AND");1===a.parts.length&&(a=this.findParts(c,"OR"),1===a.parts.length&&(a.logicalOperator="AND"));h.forEach(a.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var c=a.expr.substring(1,a.expr.length-1),d=c.indexOf("("),f=c.indexOf(")");if(-1===d&&-1===f||d<f)a.expr=c}c=this.findParts(a.expr,"AND");1===c.parts.length&&(c=this.findParts(a.expr,"OR"));1<c.parts.length&&(a.parts=c.parts,a.logicalOperator=c.logicalOperator)},
this);this.parseExpr(a);this.reReplaceStrings(d,a,e.hitch(this,function(){a&&a.parts&&h.forEach(a.parts,e.hitch(this,function(a){a&&(a.parts?h.forEach(a.parts,e.hitch(this,function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(a),this._addDefalutValueTypeForSinglePart(a)))}))}));this.isPartsObjHasError(a)&&(a=null);return a}},_handleParsedValuesForSinglePart:function(c){c&&(c.fieldObj&&"number"===c.fieldObj.shortType&&
c.valueObj)&&(c.valueObj.hasOwnProperty("value")&&(c.valueObj.value=parseFloat(c.valueObj.value)),c.valueObj.hasOwnProperty("value1")&&(c.valueObj.value1=parseFloat(c.valueObj.value1)),c.valueObj.hasOwnProperty("value2")&&(c.valueObj.value2=parseFloat(c.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(c){c&&c.valueObj&&!c.valueObj.type&&(c.valueObj.type="value")},replaceStrings:function(c){for(var d=c,a=function(c,b,f){var d=-1,d=c.indexOf("'",f+1);return d===f+1?(d=c.indexOf("'",d+
1),a(c,b,d)):f},e=[],r=c.indexOf("'");-1<r;){var q=r,r=c.indexOf("'",r+1),f=0,r=a(c,q,r);"%"===c[q+1]&&q++;"%"===c[r-1]&&(r-=1,f++);var p=c.substring(q+1,r);"N"===c[q-1]&&(c=c.substring(0,q-1)+c.substring(q),q-=1,r-=1);!this.isDateString(p)&&-1===p.indexOf("{")?(e.push(p),c=c.substring(0,q+1)+"#"+(e.length-1)+"#"+c.substring(r),r=c.indexOf("'",c.lastIndexOf("#")+2+f)):r=c.indexOf("'",r+1+f)}return{origDefExpr:d,defExpr:c,savedStrings:e}},reReplaceStrings:function(c,g,a){var l=c.savedStrings;if(l.length){if(l.length){var r=
function(a,c){if(void 0===a.valueObj||null===a.valueObj||(void 0===a.valueObj.value||null===a.valueObj.value)||"string"!==a.fieldObj.shortType)return!1;var g=a.valueObj.value.indexOf("#"),b=a.valueObj.value.lastIndexOf("#");return d.isDefined(a.valueObj.value)&&-1<g?(a.valueObj.value=c[parseInt(a.valueObj.value.substring(g+1,b),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},r=e.hitch(this,r),q=!1;h.forEach(g.parts,function(a){if(a.parts){var c=!1;h.forEach(a.parts,function(a){c=
r(a,l)||c});c&&(q=c,a.expr=this.builtFilterString(a))}else(q=r(a,l)||q)&&this.builtFilterString(a)},this);a&&"function"===typeof a&&a();q&&(g.expr=null,this.getExprByFilterObj(g))}}else a&&"function"===typeof a&&a()},isDateString:function(c){return 19===c.length&&"-"===c.charAt(4)&&"-"===c.charAt(7)&&" "===c.charAt(10)&&":"===c.charAt(13)&&":"===c.charAt(16)?!0:!1},findParts:function(c,d){for(var a=c.toLowerCase(),e=" "+d.toLowerCase()+" ",r=[],q=0,f=a.indexOf(e);0<f;){var p=c.substring(q,f),h=p.toLowerCase(),
b=p.count("("),l=p.count(")"),k=p.count("'");b!==l||1===k%2?f=a.indexOf(e,f+1):-1<h.indexOf(" between ")&&-1===h.indexOf(" and ")?f=a.indexOf(e,f+1):(r.push({expr:p}),q=f+e.length,f=a.indexOf(e,q))}r.push({expr:c.substring(q)});for(a=r.length-1;0<=a;a--)!this.hasOperator(r[a].expr)&&0<a&&(r[a-1].expr+=" "+d+" "+r[a].expr,r.splice(a,1));return{expr:c,parts:r,logicalOperator:d}},hasOperator:function(c){c=c.toLowerCase();return-1<c.indexOf("{")&&-1<c.indexOf("}")||-1<c.indexOf(" \x3d ")||-1<c.indexOf(" \x3c ")||
-1<c.indexOf(" \x3e ")||-1<c.indexOf(" \x3c\x3e ")||-1<c.indexOf(" \x3c\x3d ")||-1<c.indexOf(" \x3e\x3d ")||-1<c.indexOf(" like ")||-1<c.indexOf(" between ")||-1<c.indexOf(" date")||-1<c.indexOf(" is null")||-1<c.indexOf(" is not null")?!0:!1},parseExpr:function(c){h.forEach(c.parts,function(c){c.parts?this.parseExpr(c):this.parseSingleExpr(c)},this)},_preParseSingleExpr:function(c){var d=null;try{if(d=e.clone(c),d.expr=d.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(d.expr)){var a=
c="",h=d.expr.match(/^UPPER\((.*)\)\s+/i);if(h&&2<=h.length)c=h[1];else return null;var r=d.expr.match(/UPPER\(N?'(.*)'\)$/i);if(r&&2<=r.length)a="'"+r[1]+"'";else return null;d.expr=d.expr.replace(/^UPPER\((.*)\)\s+/i,c+" ");d.expr=d.expr.replace(/UPPER\(N?'(.*)'\)$/i,a);d.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(d.expr)&&(d.caseSensitive=!0)}catch(q){return console.log(q),null}d&&this.isHosted&&(d.caseSensitive=!1);return d},parseSingleExpr:function(c){var g=this._preParseSingleExpr(c);
g&&(c=e.mixin(c,g));var g=c.expr.trim(),a=g.indexOf(" "),h=g.substring(0,a);c.fieldObj={name:h};c.valueObj={};this.getFieldItemByName({name:h},function(a){c.fieldObj.shortType=a.shortType[0];c.fieldObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+h+")",code:1}});g=g.substring(a+1).trim();a=g.toLowerCase();a.startsWith("\x3d ")?(g="date"===c.fieldObj.shortType&&!this.isHosted?g.substring(12).trim():g.substring(2).trim(),this.storeValue(g,c),c.operator="date"===c.fieldObj.shortType?
this.OPERATORS.dateOperatorIsOn:"string"===c.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):a.startsWith("\x3c ")?(g="date"===c.fieldObj.shortType&&!this.isHosted?g.substring(12).trim():g.substring(2).trim(),this.storeValue(g,c),"date"===c.fieldObj.shortType?c.operator=this.OPERATORS.dateOperatorIsBefore:"number"===c.fieldObj.shortType?c.operator=this.OPERATORS.numberOperatorIsLessThan:c.error={msg:"operator ("+a+") not supported for string",code:3}):a.startsWith("\x3e ")?
(g="date"===c.fieldObj.shortType&&!this.isHosted?g.substring(12).trim():g.substring(2).trim(),this.storeValue(g,c),"date"===c.fieldObj.shortType?c.operator=this.OPERATORS.dateOperatorIsAfter:"number"===c.fieldObj.shortType?c.operator=this.OPERATORS.numberOperatorIsGreaterThan:c.error={msg:"operator ("+a+") not supported for string",code:3}):a.startsWith("\x3c\x3e ")?(g="date"===c.fieldObj.shortType&&!this.isHosted?g.substring(13).trim():g.substring(3).trim(),this.storeValue(g,c),c.operator="date"===
c.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===c.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):a.startsWith("\x3c\x3d ")?(this.storeValue(g.substring(3).trim(),c),c.operator=this.OPERATORS.numberOperatorIsAtMost):a.startsWith("\x3e\x3d ")?(this.storeValue(g.substring(3).trim(),c),c.operator=this.OPERATORS.numberOperatorIsAtLeast):a.startsWith("like ")?(g=g.substring(5).trim(),g.startsWith("N'")&&(g=g.substring(1,g.length)),g.startsWith("'%")&&
g.endsWith("%'")?(this.storeValue(g.substring(2,g.length-2),c),c.operator=this.OPERATORS.stringOperatorContains):g.startsWith("'%")&&g.endsWith("'")?(this.storeValue(g.substring(2,g.length-1),c),c.operator=this.OPERATORS.stringOperatorEndsWith):g.startsWith("'")&&g.endsWith("%'")?(this.storeValue(g.substring(1,g.length-2),c),c.operator=this.OPERATORS.stringOperatorStartsWith):c.error={msg:"value ("+a+") not supported for LIKE",code:3}):a.startsWith("not like ")?(g=g.substring(9).trim(),g.startsWith("N'")&&
(g=g.substring(1,g.length)),g.startsWith("'%")&&g.endsWith("%'")?(this.storeValue(g.substring(2,g.length-2),c),c.operator=this.OPERATORS.stringOperatorDoesNotContain):c.error={msg:"value ("+a+") not supported for NOT LIKE",code:3}):a.startsWith("between ")?(g="date"===c.fieldObj.shortType&&!this.isHosted?g.substring(18).trim():g.substring(8).trim(),a=g.toLowerCase().indexOf(" and "),-1<a?(this.storeValue1(g.substring(0,a).trim(),c),"date"===c.fieldObj.shortType&&!this.isHosted?this.storeValue2(g.substring(a+
15).trim(),c):this.storeValue2(g.substring(a+5).trim(),c)):c.error={msg:"missing AND operator for BETWEEN",code:3},"date"===c.fieldObj.shortType?"string"===typeof c.valueObj.value1?c.operator=this.OPERATORS.dateOperatorIsBetween:1E3>Math.abs(this.subtractDay(c.valueObj.value2).getTime()-c.valueObj.value1.getTime())?(c.valueObj.value=c.valueObj.value1,delete c.valueObj.value1,delete c.valueObj.value2,c.operator=this.OPERATORS.dateOperatorIsOn):c.operator=this.OPERATORS.dateOperatorIsBetween:"number"===
c.fieldObj.shortType||"oid"===c.fieldObj.shortType?c.operator=this.OPERATORS.numberOperatorIsBetween:c.error={msg:"string field not supported for BETWEEN",code:3}):a.startsWith("not between ")?(g="date"===c.fieldObj.shortType&&!this.isHosted?g.substring(22).trim():g.substring(12).trim(),a=g.toLowerCase().indexOf(" and "),-1<a?(this.storeValue1(g.substring(0,a).trim(),c),"date"===c.fieldObj.shortType&&!this.isHosted?this.storeValue2(g.substring(a+15).trim(),c):this.storeValue2(g.substring(a+5).trim(),
c)):c.error={msg:"missing AND operator for NOT BETWEEN",code:3},"date"===c.fieldObj.shortType?"string"===typeof c.valueObj.value1?c.operator=this.OPERATORS.dateOperatorIsNotBetween:1E3>Math.abs(this.subtractDay(c.valueObj.value2).getTime()-c.valueObj.value1.getTime())?(c.valueObj.value=c.valueObj.value1,delete c.valueObj.value1,delete c.valueObj.value2,c.operator=this.OPERATORS.dateOperatorIsNotOn):c.operator=this.OPERATORS.dateOperatorIsNotBetween:"number"===c.fieldObj.shortType||"oid"===c.fieldObj.shortType?
c.operator=this.OPERATORS.numberOperatorIsNotBetween:c.error={msg:"string field not supported for NOT BETWEEN",code:3}):"is null"===a?(c.valueObj.value=null,c.operator="date"===c.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===c.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===a?(c.valueObj.value=null,c.operator="date"===c.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===c.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:
this.OPERATORS.numberOperatorIsNotBlank):c.error={msg:"unknown operator ("+a+")",code:2};if(d.isDefined(c.valueObj.value)&&"string"===typeof c.valueObj.value&&c.valueObj.value.startsWith("{")&&c.valueObj.value.endsWith("}")||d.isDefined(c.valueObj.value1)&&"string"===typeof c.valueObj.value1&&c.valueObj.value1.startsWith("{")&&c.valueObj.value1.endsWith("}"))c.isInteractive=!0},getFieldItemByName:function(c,d,a){this.fieldsStore.fetch({query:c,onComplete:e.hitch(this,function(c){c&&c.length?d(c[0]):
a()})})},subtractDay:function(c){return new Date(c.getTime()-this.dayInMS)},storeValue:function(c,d){if(c.startsWith("{")&&c.endsWith("}"))d.valueObj.value=c;else if(c.startsWith("'{")&&c.endsWith("}'"))d.valueObj.value=c.substring(1,c.length-1);else if("date"===d.fieldObj.shortType)if(c.startsWith("'")&&c.endsWith("'")){var a=c.substring(1,c.length-1);d.valueObj.value=this.parseDate(a)}else d.valueObj.value=c,d.valueObj.type="field";else"string"===d.fieldObj.shortType?(c.startsWith("#")||c.startsWith("%#"))&&
(c.endsWith("#")||c.endsWith("#%"))?d.valueObj.value=c:c.startsWith("'")&&c.endsWith("'")?d.valueObj.value=c.substring(1,c.length-1).replace(/\'\'/g,"'"):(d.valueObj.value=c,d.valueObj.type="field",this.getFieldItemByName({name:c},function(a){d.valueObj.label=a.label[0]},function(){d.error={msg:"unknown field name ("+c+")",code:1}})):(d.valueObj.value=c,isNaN(c)&&(d.valueObj.type="field",this.getFieldItemByName({name:c},function(a){d.valueObj.label=a.label[0]},function(){d.error={msg:"unknown field name ("+
c+")",code:1}})))},storeValue1:function(c,d){if(c.startsWith("{")&&c.endsWith("}"))d.valueObj.value1=c;else if(c.startsWith("'{")&&c.endsWith("}'"))d.valueObj.value1=c.substring(1,c.length-1);else if("date"===d.fieldObj.shortType)if(c.startsWith("'")&&c.endsWith("'")){var a=c.substring(1,c.length-1);d.valueObj.value1=this.parseDate(a)}else d.valueObj.value1=c,d.valueObj.type="field";else d.valueObj.value1=c,isNaN(c)&&(d.valueObj.type="field")},storeValue2:function(c,d){if(c.startsWith("{")&&c.endsWith("}"))d.valueObj.value2=
c;else if(c.startsWith("'{")&&c.endsWith("}'"))d.valueObj.value2=c.substring(1,c.length-1);else if("date"===d.fieldObj.shortType)if(c.startsWith("'")&&c.endsWith("'")){var a=c.substring(1,c.length-1);d.valueObj.value2=this.parseDate(a)}else d.valueObj.value2=c,d.valueObj.type="field";else d.valueObj.value2=c,isNaN(c)&&(d.valueObj.type="field")},parseDate:function(c){var d=k.parse(c,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});d||(d=k.parse(c.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||
(d=k.parse(c.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return d}})})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(m,e,h,k,d,l,n){return e("dojo.data.ItemFileWriteStore",l,{constructor:function(c){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};
this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(c){return n.toISOString(c,{zulu:!0})});c&&!1===c.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(c){if(!c)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(c,d){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=
typeof c&&"undefined"!=typeof c)throw Error("newItem() was passed something other than an object");var a=null,e=this._getIdentifierAttribute();if(e===Number)a=this._arrayOfAllItems.length;else{a=c[e];if("undefined"===typeof a)throw Error("newItem() was not passed an identity for the new item");if(m.isArray(a))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[a]);this._assert("undefined"===typeof this._pending._newItems[a]);
this._assert("undefined"===typeof this._pending._deletedItems[a]);var h={};h[this._storeRefPropName]=this;h[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[a]=h,h[e]=[a]);this._arrayOfAllItems.push(h);e=null;if(d&&d.parent&&d.attribute){var e={item:d.parent,attribute:d.attribute,oldValue:void 0},q=this.getValues(d.parent,d.attribute);if(q&&0<q.length){var f=q.slice(0,q.length);e.oldValue=1===q.length?q[0]:q.slice(0,q.length);f.push(h);this._setValueOrValues(d.parent,
d.attribute,f,!1);e.newValue=this.getValues(d.parent,d.attribute)}else this._setValueOrValues(d.parent,d.attribute,h,!1),e.newValue=h}else h[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(h);this._pending._newItems[a]=h;for(var p in c){if(p===this._storeRefPropName||p===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");a=c[p];m.isArray(a)||(a=[a]);h[p]=a;if(this.referenceIntegrity)for(q=0;q<a.length;q++)f=a[q],this.isItem(f)&&this._addReferenceToMap(f,
h,p)}this.onNew(h,e);return h},_removeArrayElement:function(c,d){var a=h.indexOf(c,d);return-1!=a?(c.splice(a,1),!0):!1},deleteItem:function(c){this._assert(!this._saveInProgress);this._assertIsItem(c);var d=c[this._itemNumPropName],a=this.getIdentity(c);if(this.referenceIntegrity){var e=this.getAttributes(c);c[this._reverseRefMap]&&(c["backup_"+this._reverseRefMap]=m.clone(c[this._reverseRefMap]));h.forEach(e,function(b){h.forEach(this.getValues(c,b),function(a){this.isItem(a)&&(c["backupRefs_"+
this._reverseRefMap]||(c["backupRefs_"+this._reverseRefMap]=[]),c["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(a),attr:b}),this._removeReferenceFromMap(a,c,b))},this)},this);if(e=c[this._reverseRefMap])for(var r in e){var q=null;if(q=this._itemsByIdentity?this._itemsByIdentity[r]:this._arrayOfAllItems[r])for(var f in e[r]){var p=this.getValues(q,f)||[],l=h.filter(p,function(b){return!(this.isItem(b)&&this.getIdentity(b)==a)},this);this._removeReferenceFromMap(c,q,f);l.length<p.length&&
this._setValueOrValues(q,f,l,!0)}}}this._arrayOfAllItems[d]=null;c[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[a];this._pending._deletedItems[a]=c;c[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,c);this.onDelete(c);return!0},setValue:function(c,d,a){return this._setValueOrValues(c,d,a,!0)},setValues:function(c,d,a){return this._setValueOrValues(c,d,a,!0)},unsetAttribute:function(c,d){return this._setValueOrValues(c,d,[],!0)},_setValueOrValues:function(c,
d,a,e){this._assert(!this._saveInProgress);this._assertIsItem(c);this._assert(m.isString(d));this._assert("undefined"!==typeof a);var r=this._getIdentifierAttribute();if(d==r)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var r=this._getValueOrValues(c,d),q=this.getIdentity(c);if(!this._pending._modifiedItems[q]){var f={},p;for(p in c)f[p]=p===this._storeRefPropName||p===this._itemNumPropName||p===this._rootItemPropName?c[p]:p===this._reverseRefMap?
m.clone(c[p]):c[p].slice(0,c[p].length);this._pending._modifiedItems[q]=f}q=!1;if(m.isArray(a)&&0===a.length){if(q=delete c[d],a=void 0,this.referenceIntegrity&&r){p=r;m.isArray(p)||(p=[p]);for(var l=0;l<p.length;l++)f=p[l],this.isItem(f)&&this._removeReferenceFromMap(f,c,d)}}else{q=m.isArray(a)?a.slice(0,a.length):[a];if(this.referenceIntegrity)if(r){p=r;m.isArray(p)||(p=[p]);var b={};h.forEach(p,function(a){this.isItem(a)&&(a=this.getIdentity(a),b[a.toString()]=!0)},this);h.forEach(q,function(a){if(this.isItem(a)){var f=
this.getIdentity(a);b[f.toString()]?delete b[f.toString()]:this._addReferenceToMap(a,c,d)}},this);for(l in b)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[l]:this._arrayOfAllItems[l],c,d)}else for(l=0;l<q.length;l++)f=q[l],this.isItem(f)&&this._addReferenceToMap(f,c,d);c[d]=q;q=!0}if(e)this.onSet(c,d,r,a);return q},_addReferenceToMap:function(c,d,a){d=this.getIdentity(d);var e=c[this._reverseRefMap];e||(e=c[this._reverseRefMap]={});(c=e[d])||(c=e[d]={});c[a]=!0},_removeReferenceFromMap:function(c,
d,a){d=this.getIdentity(d);var e=c[this._reverseRefMap],h;if(e){for(h in e)h==d&&(delete e[h][a],this._isEmpty(e[h])&&delete e[h]);this._isEmpty(e)&&delete c[this._reverseRefMap]}},_dumpReferenceMap:function(){var c;for(c=0;c<this._arrayOfAllItems.length;c++){var d=this._arrayOfAllItems[c];d&&d[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(d)+"] is referenced by: "+k.toJson(d[this._reverseRefMap]))}},_getValueOrValues:function(c,d){var a=void 0;this.hasAttribute(c,d)&&(a=this.getValues(c,
d),a=1==a.length?a[0]:a);return a},_flatten:function(c){if(this.isItem(c))return{_reference:this.getIdentity(c)};if("object"===typeof c)for(var d in this._datatypeMap){var a=this._datatypeMap[d];if(m.isObject(a)&&!m.isFunction(a)){if(c instanceof a.type){if(!a.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+d+"]");return{_type:d,_value:a.serialize(c)}}}else if(c instanceof a)return{_type:d,_value:c.toString()}}return c},_getNewFileContentString:function(){var c=
{},d=this._getIdentifierAttribute();d!==Number&&(c.identifier=d);this._labelAttr&&(c.label=this._labelAttr);c.items=[];for(d=0;d<this._arrayOfAllItems.length;++d){var a=this._arrayOfAllItems[d];if(null!==a){var e={},h;for(h in a)if(h!==this._storeRefPropName&&h!==this._itemNumPropName&&h!==this._reverseRefMap&&h!==this._rootItemPropName){var q=this.getValues(a,h);if(1==q.length)e[h]=this._flatten(q[0]);else for(var f=[],p=0;p<q.length;++p)f.push(this._flatten(q[p])),e[h]=f}c.items.push(e)}}return k.toJson(c,
!0)},_isEmpty:function(c){var d=!0;if(m.isObject(c))for(var a in c){d=!1;break}else m.isArray(c)&&0<c.length&&(d=!1);return d},save:function(c){this._assert(!this._saveInProgress);this._saveInProgress=!0;var e=this,a=function(){e._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};e._saveInProgress=!1;c&&c.onComplete&&c.onComplete.call(c.scope||d.global)},h=function(a){e._saveInProgress=!1;c&&c.onError&&c.onError.call(c.scope||d.global,a)};if(this._saveEverything){var l=this._getNewFileContentString();
this._saveEverything(a,h,l)}this._saveCustom&&this._saveCustom(a,h);!this._saveEverything&&!this._saveCustom&&a()},revert:function(){this._assert(!this._saveInProgress);for(var c in this._pending._modifiedItems){var d=this._pending._modifiedItems[c],a=null,a=this._itemsByIdentity?this._itemsByIdentity[c]:this._arrayOfAllItems[c];d[this._storeRefPropName]=this;for(var e in a)delete a[e];m.mixin(a,d)}var l;for(c in this._pending._deletedItems)l=this._pending._deletedItems[c],l[this._storeRefPropName]=
this,d=l[this._itemNumPropName],l["backup_"+this._reverseRefMap]&&(l[this._reverseRefMap]=l["backup_"+this._reverseRefMap],delete l["backup_"+this._reverseRefMap]),this._arrayOfAllItems[d]=l,this._itemsByIdentity&&(this._itemsByIdentity[c]=l),l[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(l);for(c in this._pending._deletedItems)l=this._pending._deletedItems[c],l["backupRefs_"+this._reverseRefMap]&&(h.forEach(l["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?
this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],l,a.attr)},this),delete l["backupRefs_"+this._reverseRefMap]);for(c in this._pending._newItems)d=this._pending._newItems[c],d[this._storeRefPropName]=null,this._arrayOfAllItems[d[this._itemNumPropName]]=null,d[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,d),this._itemsByIdentity&&delete this._itemsByIdentity[c];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(c){return c?
(c=this.getIdentity(c),(new Boolean(this._pending._newItems[c]||this._pending._modifiedItems[c]||this._pending._deletedItems[c])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(c,d,a,e){},onNew:function(c,d){},onDelete:function(c){},close:function(c){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(m,e,h,k,d,l,n,c,g){h=h("dojo.data.ItemFileReadStore",[l],{constructor:function(a){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=a.url;this._jsonData=a.data;this.data=null;this._datatypeMap=a.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return g.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==a.urlPreventCache&&(this.urlPreventCache=a.urlPreventCache?!0:!1);void 0!==a.hierarchical&&(this.hierarchical=a.hierarchical?
!0:!1);a.clearOnClose&&(this.clearOnClose=!0);"failOk"in a&&(this.failOk=a.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(a,c,d){a=this.getValues(a,c);return 0<a.length?a[0]:d},getValues:function(a,
c){this._assertIsItem(a);this._assertIsAttribute(c);return(a[c]||[]).slice(0)},getAttributes:function(a){this._assertIsItem(a);var c=[],d;for(d in a)d!==this._storeRefPropName&&(d!==this._itemNumPropName&&d!==this._rootItemPropName&&d!==this._reverseRefMap)&&c.push(d);return c},hasAttribute:function(a,c){this._assertIsItem(a);this._assertIsAttribute(c);return c in a},containsValue:function(a,c,d){var e=void 0;"string"===typeof d&&(e=n.patternToRegExp(d,!1));return this._containsValue(a,c,d,e)},_containsValue:function(a,
c,d,g){return k.some(this.getValues(a,c),function(a){if(null!==a&&!e.isObject(a)&&g){if(a.toString().match(g))return!0}else if(d===a)return!0})},isItem:function(a){return a&&a[this._storeRefPropName]===this&&this._arrayOfAllItems[a[this._itemNumPropName]]===a?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this._assertIsItem(a.item)},getFeatures:function(){return this._features},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},
getLabelAttributes:function(a){return this._labelAttr?[this._labelAttr]:null},filter:function(a,c,d){var e=[],f,g;if(a.query){var h;f=a.queryOptions?a.queryOptions.ignoreCase:!1;var b={};for(g in a.query)h=a.query[g],"string"===typeof h?b[g]=n.patternToRegExp(h,f):h instanceof RegExp&&(b[g]=h);for(f=0;f<c.length;++f){var l=!0,k=c[f];if(null===k)l=!1;else for(g in a.query)h=a.query[g],this._containsValue(k,g,h,b[g])||(l=!1);l&&e.push(k)}}else for(f=0;f<c.length;++f)g=c[f],null!==g&&e.push(g);d(e,a)},
_fetchItems:function(a,c,g){var q=this;if(this._loadFinished)this.filter(a,this._getItemsArray(a.queryOptions),c);else if(this._jsonFileUrl!==this._ccUrl?(m.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:a,
filter:e.hitch(q,"filter"),findCallback:e.hitch(q,c)});else{this._loadInProgress=!0;var f=d.get({url:q._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});f.addCallback(function(b){try{q._getItemsFromLoadedData(b),q._loadFinished=!0,q._loadInProgress=!1,q.filter(a,q._getItemsArray(a.queryOptions),c),q._handleQueuedFetches()}catch(f){q._loadFinished=!0,q._loadInProgress=!1,g(f,a)}});f.addErrback(function(b){q._loadInProgress=!1;g(b,a)});var p=null;a.abort&&
(p=a.abort);a.abort=function(){f&&-1===f.fired&&f.cancel();p&&p.call(a)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,q.filter(a,this._getItemsArray(a.queryOptions),c)}catch(h){g(h,a)}else g(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),a)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var c=this._queuedFetches[a],
d=c.args,e=c.filter,c=c.findCallback;e?e(d,this._getItemsArray(d.queryOptions),c):this.fetchItemByIdentity(d)}this._queuedFetches=[]}},_getItemsArray:function(a){return a&&a.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(a){this.clearOnClose&&(this._loadFinished&&!this._loadInProgress)&&((""==this._jsonFileUrl||null==this._jsonFileUrl)&&(""==this.url||null==this.url)&&null==this.data&&console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(a){function c(b){return null!==b&&"object"===typeof b&&(!e.isArray(b)||g)&&!e.isFunction(b)&&(b.constructor==Object||e.isArray(b))&&"undefined"===typeof b._reference&&"undefined"===typeof b._type&&"undefined"===typeof b._value&&f.hierarchical}function d(b){f._arrayOfAllItems.push(b);for(var a in b){var g=b[a];if(g)if(e.isArray(g))for(var q=
0;q<g.length;++q){var p=g[q];c(p)&&d(p)}else c(g)&&d(g)}}var g=!1,f=this;this._labelAttr=a.label;var p,h;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=a.items;for(p=0;p<this._arrayOfTopLevelItems.length;++p)h=this._arrayOfTopLevelItems[p],e.isArray(h)&&(g=!0),d(h),h[this._rootItemPropName]=!0;var b={},l;for(p=0;p<this._arrayOfAllItems.length;++p)for(l in h=this._arrayOfAllItems[p],h){if(l!==this._rootItemPropName){var k=h[l];null!==k?e.isArray(k)||(h[l]=[k]):h[l]=[null]}b[l]=l}for(;b[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;b[this._itemNumPropName];)this._itemNumPropName+="_";for(;b[this._reverseRefMap];)this._reverseRefMap+="_";if(b=a.identifier){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=b;for(p=0;p<this._arrayOfAllItems.length;++p)if(h=this._arrayOfAllItems[p],a=h[b],a=a[0],Object.hasOwnProperty.call(this._itemsByIdentity,a)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
b+"].  Value collided: ["+a+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+b+"].  Value collided: ["+a+"]");}else this._itemsByIdentity[a]=h}else this._features["dojo.data.api.Identity"]=Number;for(p=0;p<this._arrayOfAllItems.length;++p)h=this._arrayOfAllItems[p],h[this._storeRefPropName]=this,h[this._itemNumPropName]=p;for(p=0;p<this._arrayOfAllItems.length;++p)for(l in h=this._arrayOfAllItems[p],
h){a=h[l];for(b=0;b<a.length;++b)if(k=a[b],null!==k&&"object"==typeof k){if("_type"in k&&"_value"in k){var n=k._type,m=this._datatypeMap[n];if(m)if(e.isFunction(m))a[b]=new m(k._value);else if(e.isFunction(m.deserialize))a[b]=m.deserialize(k._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
n+"'");}if(k._reference){k=k._reference;if(e.isObject(k))for(n=0;n<this._arrayOfAllItems.length;++n){var m=this._arrayOfAllItems[n],A=!0,C;for(C in k)m[C]!=k[C]&&(A=!1);A&&(a[b]=m)}else a[b]=this._getItemByIdentity(k);this.referenceIntegrity&&(k=a[b],this.isItem(k)&&this._addReferenceToMap(k,h,l))}else this.isItem(k)&&this.referenceIntegrity&&this._addReferenceToMap(k,h,l)}}},_addReferenceToMap:function(a,c,d){},getIdentity:function(a){var c=this._features["dojo.data.api.Identity"];return c===Number?
a[this._itemNumPropName]:(a=a[c])?a[0]:null},fetchItemByIdentity:function(a){var c,e;if(this._loadFinished)c=this._getItemByIdentity(a.identity),a.onItem&&(e=a.scope?a.scope:m.global,a.onItem.call(e,c));else{var g=this;this._jsonFileUrl!==this._ccUrl?(m.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:a}):(this._loadInProgress=!0,e=d.get({url:g._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),e.addCallback(function(f){var d=a.scope?a.scope:m.global;try{g._getItemsFromLoadedData(f),g._loadFinished=!0,g._loadInProgress=!1,c=g._getItemByIdentity(a.identity),a.onItem&&a.onItem.call(d,c),g._handleQueuedFetches()}catch(e){g._loadInProgress=
!1,a.onError&&a.onError.call(d,e)}}),e.addErrback(function(c){g._loadInProgress=!1;a.onError&&a.onError.call(a.scope?a.scope:m.global,c)})):this._jsonData&&(g._getItemsFromLoadedData(g._jsonData),g._jsonData=null,g._loadFinished=!0,c=g._getItemByIdentity(a.identity),a.onItem&&(e=a.scope?a.scope:m.global,a.onItem.call(e,c)))}},_getItemByIdentity:function(a){var c=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,a)&&(c=this._itemsByIdentity[a]):Object.hasOwnProperty.call(this._arrayOfAllItems,
a)&&(c=this._arrayOfAllItems[a]);void 0===c&&(c=null);return c},getIdentityAttributes:function(a){a=this._features["dojo.data.api.Identity"];return a===Number?null:[a]},_forceLoad:function(){var a=this;this._jsonFileUrl!==this._ccUrl?(m.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var c=d.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});c.addCallback(function(c){try{if(!0!==a._loadInProgress&&!a._loadFinished)a._getItemsFromLoadedData(c),a._loadFinished=!0;else if(a._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(d){throw console.log(d),d;}});c.addErrback(function(a){throw a;
})}else this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),a._jsonData=null,a._loadFinished=!0)}});e.extend(h,c);return h})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(m){var e={};m.setObject("dojo.data.util.filter",e);e.patternToRegExp=function(e,k){for(var d="^",l=null,n=0;n<e.length;n++)switch(l=e.charAt(n),l){case "\\":d+=l;n++;d+=e.charAt(n);break;case "*":d+=".*";break;case "?":d+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":d+=
"\\";default:d+=l}d+="$";return k?RegExp(d,"mi"):RegExp(d,"m")};return e})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(m,e,h){var k={};m.setObject("dojo.data.util.simpleFetch",k);k.errorHandler=function(d,h){h.onError&&h.onError.call(h.scope||e.global,d,h)};k.fetchHandler=function(d,l){var k=l.abort||null,c=!1,g=l.start?l.start:0,a=l.count&&Infinity!==l.count?g+l.count:d.length;l.abort=function(){c=!0;k&&k.call(l)};var s=l.scope||e.global;
l.store||(l.store=this);l.onBegin&&l.onBegin.call(s,d.length,l);l.sort&&d.sort(h.createSortFunction(l.sort,this));if(l.onItem)for(var r=g;r<d.length&&r<a;++r){var q=d[r];c||l.onItem.call(s,q,l)}l.onComplete&&!c&&(r=null,l.onItem||(r=d.slice(g,a)),l.onComplete.call(s,r,l))};k.fetch=function(d){d=d||{};d.store||(d.store=this);this._fetchItems(d,m.hitch(this,"fetchHandler"),m.hitch(this,"errorHandler"));return d};return k})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array",
"jimu/PanelManager"],function(m,e,h){return m(null,{constructor:function(){this.panelManager=h.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(e){},getConfigById:function(e){for(var d=this.getAllConfigs(),h=0;h<d.length;h++)if(d[h].id===e)return d[h]},getAllConfigs:function(){var h=[],h=h.concat(this.getWidgetConfigs(),this.getGroupConfigs()),h=e.filter(h,
function(d){return d.visible});return h.sort(function(d,e){return d.index-e.index})},getAllConfigsIncludeInvisible:function(){var e=[],e=e.concat(this.getWidgetConfigs(),this.getGroupConfigs());return e.sort(function(d,e){return d.index-e.index})},isControlled:function(h){return e.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===h})},widgetIsControlled:function(h){return e.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===h?!0:e.some(d.widgets,function(d){return d.id===
h})})},getGroupConfigs:function(){var h=[];if(!this.appConfig.widgetPool)return h;this.appConfig.widgetPool.groups&&e.forEach(this.appConfig.widgetPool.groups,function(d){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(d.id)&&h.push(d):"all"===this.controlledGroups&&h.push(d))},this);return h},getWidgetConfigs:function(){var h=[];if(!this.appConfig.widgetPool)return h;this.appConfig.widgetPool.widgets&&e.forEach(this.appConfig.widgetPool.widgets,function(d){this.controlledWidgets&&
(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(d.id)&&h.push(d):"all"===this.controlledWidgets&&h.push(d))},this);return h}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(m,e,h,k,d,l,n,c){var g=null,a=null,s=!1;m=m(null,function(){});var r=require.toUrl("jimu"),q=l(r+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),
f=l(r+"/SpatialReference/transform.json",{handleAs:"json"});m.loadResource=function(){var c=new k;if(g&&a)return c.resolve(),c;d([q,f]).then(function(f){g=f[0];a=f[1];s=!0;c.resolve()},function(a){console.error(a);s=!1;c.reject(a)});return c};m.getAllCSUnits=function(){if(s){var a=[];h.forEach(g.wkids,e.hitch(this,function(c){c=this.getCSUnit(c);-1===h.indexOf(a,c)&&a.push(c)}));return a}};m.convertUnit=function(a,f,b){if(s)return c.convertUnit(a,f,b)};m.getUnitRate=function(a,f){if(s)return c.getUnitRate(a,
f)};m.isProjectUnit=function(a){if(s)return c.isProjectUnit(a)};m.isGeographicUnit=function(a){if(s)return c.isGeographicUnit(a)};m.getGeographicUnits=function(){if(s)return c.getGeographicUnits()};m.getProjectUnits=function(){if(s)return c.getProjectUnits()};m.getCSUnit=function(a){if(s){a=this.getCSStr(a);var c=0,b=0,c=a.lastIndexOf("UNIT"),b=a.indexOf(",",c);return a.slice(c+6,b-1)}};m.isSameSR=function(a,c){if(s){var b=this.indexOfWkid(a),f=this.indexOfWkid(c);return g.labels[b]===g.labels[f]}};
m.isValidWkid=function(a){if(s)return-1<this.indexOfWkid(a)};m.getSRLabel=function(a){if(s&&this.isValidWkid(a))return a=this.indexOfWkid(a),g.labels[a]};m.indexOfWkid=function(a){if(s)return h.indexOf(g.wkids,a)};m.isWebMercator=function(a){return n.prototype._isWebMercator?n.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new n(parseInt(a,10))).isWebMercator()};m.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};m.isValidTfWkid=function(a){if(s)return-1<this.indexOfTfWkid(a)};
m.getTransformationLabel=function(c){if(s)return this.isValidTfWkid(c)?(c=this.indexOfTfWkid(c),a.labels[c]):""};m.indexOfTfWkid=function(c){if(s)return h.indexOf(a.tfWkids,c)};m.isGeographicCS=function(a){if(s)return this.isValidWkid(a)?g.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};m.isProjectedCS=function(a){if(s)return this.isValidWkid(a)?g.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};m.getGeoCSByProj=function(a){if(s&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=h.indexOf(g.details,
a),g.wkids[a]};m.getSpheroidStr=function(a){if(s){if(this.isGeographicCS(a))return g.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=g.details[this.indexOfWkid(a)];var c=a.indexOf("GEOGCS"),b=a.indexOf("PROJECTION")-1;return a.slice(c,b)}return null}};m.getCSStr=function(a){if(s)return g.details[this.indexOfWkid(a)]};m.isSameSpheroid=function(a,c){if(s){var b=this.getSpheroidStr(a),f=this.getSpheroidStr(c);return b&&f&&b===f?!0:!1}};return m})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare",
"dojo/_base/array"],function(m,e){var h="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),k="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),d={INCHES:0.0254,FOOT:0.3048,FOOT_US:0.3048006096012192,YARDS:0.9144,MILES:1609.344,NAUTICAL_MILES:1852,
MILLIMETERS:0.0010,CENTIMETERS:0.01,METER:1,KILOMETERS:1E3,DECIMETERS:0.1,LINK_CLARKE:0.2011661949,FOOT_GOLD_COAST:0.3047997101815088,FOOT_CLARKE:0.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:0.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:0.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:0.3047994715386762,YARD_INDIAN_1937:0.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:0.0174532925199433,DECIMAL_DEGREES:0.0174532925199433,MGRS:0.0174532925199433,
USNG:0.0174532925199433,DEGREE_MINUTE_SECONDS:0.0174532925199433,GRAD:0.01570796326794897},l=m(null,function(){});l.convertUnit=function(e,c,g){return d[e.toUpperCase()]/d[c.toUpperCase()]*g};l.getUnitRate=function(e,c){return d[e.toUpperCase()]/d[c.toUpperCase()]};l.isProjectUnit=function(d){return-1<e.indexOf(h,d.toUpperCase())};l.isGeographicUnit=function(d){return-1<e.indexOf(k,d.toUpperCase())};l.getGeographicUnits=function(){return k};l.getProjectUnits=function(){return h};return l})},"jimu/dijit-all":function(){define([],
1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(m,e,h,k,d,l,n,c){return m(e,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){n.create("div",{"class":"jimu-radio-inner"},this.domNode);this.checked&&l.add(this.domNode,"jimu-radio-checked");this.own(d(this.domNode,"click",h.hitch(this,
function(){this.checked||this.check()})))},check:function(c){void 0===c&&(c=!0);this.checked=!0;l.add(this.domNode,"jimu-radio-checked");c&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(c){void 0===c&&(c=!0);this.checked=!1;l.remove(this.domNode,"jimu-radio-checked");c&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(d){null!==this.group&&k.forEach(c.toArray(),function(a){a.id!==this.id&&(a["class"]===this["class"]&&a.group===this.group)&&(d?a.check(!1):
a.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/Evented".split(" "),function(m,e,h,k,d,l,n){return m([e,n],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,status:!0,label:"",postCreate:function(){this.checkNode=k.create("div",{"class":"checkbox jimu-float-leading"},this.domNode);this.labelNode=k.create("div",{"class":"label jimu-float-leading",
innerHTML:this.label||""},this.domNode);this.checked&&k.addClass(this.checkNode,"checked");this.status||k.addClass(this.domNode,"jimu-state-disabled");this.own(l(this.checkNode,"click",h.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})));this.own(l(this.labelNode,"click",h.hitch(this,function(){this.checked&&this.status?this.uncheck():this.status&&this.check()})));this._udpateLabelClass()},setLabel:function(c){this.label=c;this.labelNode.innerHTML=this.label;this._udpateLabelClass()},
_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?k.removeClass(this.labelNode,"not-visible"):k.addClass(this.labelNode,"not-visible"))},setValue:function(c){this.status&&(!0===c?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(c){c=!!c;var e=this.status!==c;(this.status=c)?d.remove(this.domNode,"jimu-state-disabled"):d.add(this.domNode,"jimu-state-disabled");e&&this.emit("status-change",c)},getStatus:function(){return this.status},check:function(){this.status&&
(this.checked=!0,k.addClass(this.checkNode,"checked"),this.onStateChange())},uncheck:function(c){if(this.status&&(this.checked=!1,k.removeClass(this.checkNode,"checked"),!c))this.onStateChange()},onStateChange:function(){if(this.onChange&&h.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",this.checked)}})})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr jimu/utils jimu/symbolUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font dijit/form/Select dijit/form/NumberSpinner jimu/dijit/ColorPicker jimu/dijit/_Transparency".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z){return m([e,h,k,l],{templateString:d,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,symbol:null,type:null,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser},postCreate:function(){this.inherited(arguments);this.own(a(document.body,"click",n.hitch(this,this._onBodyClicked)));(this._isIE8=
8===s("ie"))&&c.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(b){this.reset();var a=b&&b.declaredClass;a&&("string"===typeof a&&0<=a.indexOf("esri.symbol"))&&(this.symbol=this._cloneSymbol(b),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?
(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(b){this.reset();if("marker"===b||"line"===b||"fill"===b||"text"===b)this.type=b,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){var b=
null;"marker"===this.type?b=this._getPointSymbolBySetting():"line"===this.type?b=this._getLineSymbolBySetting():"fill"===this.type?b=this._getFillSymbolBySetting():"text"===this.type&&(b=this._getTextSymbolBySetting());var a=null;b&&(a=this._cloneSymbol(b));return a},hideColorPicker:function(){for(var b="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),a=0,c=b.length;a<c;a++){var f=b[a];this[f]&&this[f].hideTooltipDialog()}},_onBodyClicked:function(b){b=b.target||
b.srcElement;this._tryHideDropDownOfSelectDijit(b,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(b,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(b,a){var f=a.domNode,d=a.dropDown.domNode,f=b===f||c.isDescendant(b,f),d=b===d||c.isDescendant(b,d);if(!f&&!d)a.dropDown.onCancel()},_onChange:function(b){b=this._cloneSymbol(b);this.emit("change",b)},_hideAllSections:function(){r(".symbol-section",this.domNode).style("display","none")},_showSection:function(b){this._hideAllSections();
r("."+b+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(b,a,c){return f.getAncestorDom(b,a,c)},_getAbsoluteUrl:function(b){return window.location.protocol+"//"+window.location.host+require.toUrl(b)},_cloneSymbol:function(b){if(!b)return null;var a=b;try{var c=b.toJson(),a=t.fromJson(c)}catch(f){console.error(f)}return a},_createSymbolIconTable:function(b,a,f){var d=this.type+"-icon-table";b=c.toDom('\x3ctable class\x3d"'+("icon-table "+d+" "+(d+"-"+b))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');
for(var d=r("tbody",b)[0],e=Math.ceil(a.length/8),q=0;q<e;q++)c.create("tr",{},d);var h=r("tr",b);g.forEach(a,n.hitch(this,function(b,a){var d=n.clone(b),e=t.fromJson(b),g=c.create("td",{},h[Math.floor(a/8)]);c.addClass(g,"symbol-td-item");e=this._createSymbolNode(e);c.addClass(e,"symbol-div-item");var q=e.firstChild;c.addClass(q,"svg-node");if(this._isIE8&&"point"===f)if(window.isRTL){if("Cross"===b.name||"X"===b.name)c.setStyle(q,"right","-20px"),c.setStyle(e,"marginTop","20px")}else("Cross"===
b.name||"X"===b.name)&&c.setStyle(e,"marginTop","20px");e.symbol=d;c.place(e,g)}));return b},_updatePreview:function(b){var a=this._cloneSymbol(this.symbol);c.empty(b);(a=p.createSymbolNode(a))||(a=c.create("div"));c.place(a,b)},_createSymbolNode:function(b){(b=p.createSymbolNode(b,{width:36,height:36}))||(b=c.create("div"));c.setStyle(b,{width:"36px",height:"36px"});return b},_getLineShapeDesc:function(b){var a=null;if(this.isSimpleLineSymbol(b)||this.isCartographicLineSymbol(b))a={defaultShape:{type:"path",
path:"M -90,0 L 90,0 E"},fill:null,stroke:b.getStroke()};return a},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new b({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());
this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(a(this.pointIconTables,".symbol-div-item:click",n.hitch(this,this._onPointSymIconItemClick)));this.own(a(this.pointSymClassSelect,"Change",n.hitch(this,this._onPointSymClassSelectChange)));this.own(a(this.pointSize,"change",n.hitch(this,this._onPointSymbolChange)));this.own(a(this.pointColor,"change",n.hitch(this,this._onPointSymbolChange)));this.own(a(this.pointAlpha,"change",n.hitch(this,this._onPointSymbolChange)));
this.own(a(this.pointOutlineColor,"change",n.hitch(this,this._onPointSymbolChange)));this.own(a(this.pointOutlineWidth,"change",n.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(b){if(b){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(b)){if(this.pointSize.set("value",b.size),this.pointColor.setColor(b.color),this.pointAlpha.setAlpha(parseFloat(b.color.a.toFixed(2))),
b=b.outline)this.pointOutlineColor.setColor(b.color),this.pointOutlineWidth.set("value",parseFloat(b.width.toFixed(0)))}else this.isPictureMarkerSymbol(b)&&this.pointSize.set("value",b.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(b){return b&&"esri.symbol.SimpleMarkerSymbol"===b.declaredClass},isPictureMarkerSymbol:function(b){return b&&"esri.symbol.PictureMarkerSymbol"===b.declaredClass},_onPointSymClassSelectChange:function(){this._showSelectedPointSymIconTable();var b=
this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+b]||this._requestPointSymJson(b);b=this.pointSymClassSelect.getOptions(b);this.pointSymClassSelect.domNode.title=b?b.label:""},_showSelectedPointSymIconTable:function(){var b=this.pointSymClassSelect.get("value");r(".marker-icon-table",this.pointIconTables).style("display","none");b=r(".marker-icon-table-"+b,this.pointIconTables);0<b.length&&b.style("display","table")},_requestPointSymJson:function(b){var a="def"+b,f=this.pointSymClassSelect[a];
f||(f=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json"),f=q(f,{handleAs:"json"}),this.pointSymClassSelect[a]=f,f.then(n.hitch(this,function(a){this.domNode&&(a=this._createSymbolIconTable(b,a,"point"),c.place(a,this.pointIconTables),this._showSelectedPointSymIconTable())}),n.hitch(this,function(b){console.error("get point symbol failed",b)})))},_onPointSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return c.hasClass(b,"symbol-div-item")},5))if(r(".selected-symbol-div-item",
b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),c.addClass(b,"selected-symbol-div-item"),b=b.symbol){this.symbol=t.fromJson(b);b=c.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showPictureMarkerSymSettings();this._onPointSymbolChange();var a=c.getStyle(this.pointColorTr,"display");b!==a&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){c.setStyle(this.pointColorTr,"display","");c.setStyle(this.pointOpacityTr,
"display","");c.setStyle(this.pointOutlineColorTr,"display","");c.setStyle(this.pointOulineWidthTr,"display","")},_showPictureMarkerSymSettings:function(){c.setStyle(this.pointColorTr,"display","none");c.setStyle(this.pointOpacityTr,"display","none");c.setStyle(this.pointOutlineColorTr,"display","none");c.setStyle(this.pointOulineWidthTr,"display","none")},_getPointSymbolBySetting:function(){if(!this.symbol)return null;var b=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){this.symbol.setSize(b);
var b=this.pointColor.getColor(),a=this.pointAlpha.getAlpha();b.a=a;this.symbol.setColor(b);var b=this.pointOutlineColor.getColor(),a=parseFloat(this.pointOutlineWidth.get("value")),c=new v;c.setStyle(v.STYLE_SOLID);c.setColor(b);c.setWidth(a);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(b),this.symbol.setHeight(b));this._updatePreview(this.pointSymPreview);return this.symbol},_initLineSection:function(){this._showSection("line");this._lineEventBinded||
(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(a(this.lineIconTables,".symbol-div-item:click",n.hitch(this,this._onLineSymIconItemClick)));this.own(a(this.lineColor,"change",n.hitch(this,this._onLineSymbolChange)));this.own(a(this.lineStylesSelect,"change",n.hitch(this,this._onLineSymbolChange)));this.own(a(this.lineAlpha,"change",n.hitch(this,this._onLineSymbolChange)));
this.own(a(this.lineWidth,"change",n.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(b){b&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(b.color),this.lineAlpha.setAlpha(parseFloat(b.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(b.width.toFixed(0))),this.lineStylesSelect.set("value",b.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(b){return b&&
"esri.symbol.SimpleLineSymbol"===b.declaredClass},isCartographicLineSymbol:function(b){return b&&"esri.symbol.CartographicLineSymbol"===b.declaredClass},_requestLineSymJson:function(b){var a=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");q(a,{handleAs:"json"}).then(n.hitch(this,function(a){this.domNode&&(a=this._createSymbolIconTable(b,a,"line"),c.place(a,this.lineIconTables))}),n.hitch(this,function(b){console.error("get line symbol failed",b)}))},_onLineSymIconItemClick:function(b){if(b=
this._getAncestor(b.target||b.srcElement,function(b){return c.hasClass(b,"symbol-div-item")},5))if(r(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),c.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=t.fromJson(b),this._initLineSettings(b),this._onLineSymbolChange()},_getLineSymbolBySetting:function(){this.symbol=new v;var b=this.lineColor.getColor(),a=this.lineStylesSelect.get("value");b.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));
this.symbol.setStyle(a);this.symbol.setColor(b);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(a(this.fillIconTables,".symbol-div-item:click",n.hitch(this,this._onFillSymIconItemClick)));this.own(a(this.fillColor,
"change",n.hitch(this,this._onFillSymbolChange)));this.own(a(this.fillAlpha,"change",n.hitch(this,this._onFillSymbolChange)));this.own(a(this.fillOutlineColor,"change",n.hitch(this,this._onFillSymbolChange)));this.own(a(this.fillOutlineWidth,"change",n.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(b){b&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(b.color),
this.fillAlpha.setAlpha(parseFloat(b.color.a.toFixed(2))),b.outline&&(this.fillOutlineColor.setColor(b.outline.color),this.fillOutlineWidth.set("value",parseInt(b.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(b){return b&&"esri.symbol.SimpleFillSymbol"===b.declaredClass},_requestFillSymJson:function(b){var a=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");q(a,{handleAs:"json"}).then(n.hitch(this,function(a){this.domNode&&(a=this._createSymbolIconTable(b,
a,"fill"),c.place(a,this.fillIconTables))}),n.hitch(this,function(b){console.error("get fill symbol failed",b)}))},_onFillSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return c.hasClass(b,"symbol-div-item")},5))if(r(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),c.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=t.fromJson(b),this._initFillSettings(b),this._onFillSymbolChange()},_getFillSymbolBySetting:function(){this.symbol=
new u;var b=this.fillColor.getColor();b.a=this.fillAlpha.getAlpha();var a=this.fillOutlineColor.getColor(),c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(b);this.symbol.setStyle(u.STYLE_SOLID);b=new v;b.setStyle(v.STYLE_SOLID);b.setColor(a);b.setWidth(c);this.symbol.setOutline(b);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();
this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(a(this.inputText,"change",n.hitch(this,this._onTextSymbolChange)));this.own(a(this.textColor,"change",n.hitch(this,this._onTextSymbolChange)));this.own(a(this.textFontSize,"change",n.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(b){b&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=
b.text,this.textColor.setColor(b.color),b=parseInt(b.font.size,10),this.textFontSize.set("value",b),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(b){return b&&"esri.symbol.TextSymbol"===b.declaredClass},_updateTextPreview:function(){var b=this.textColor.getColor().toHex(),a=parseInt(this.textFontSize.get("value"),10)+"px";c.setStyle(this.textPreview,{color:b,fontSize:a});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(){this.symbol=new x;var b=this.inputText.value,
a=this.textColor.getColor(),c=parseInt(this.textFontSize.get("value"),10),f=new z;f.setSize(c);this.symbol.setText(b);this.symbol.setColor(a);this.symbol.setFont(f);this._updateTextPreview();return this.symbol}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(m,e,h,k){return m("dijit.form.NumberSpinner",[h,k.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(d,e){var h=this.constraints,c=isNaN(d),
g=!isNaN(h.max),a=!isNaN(h.min);c&&0!=e&&(d=0<e?a?h.min:g?h.max:0:g?this.constraints.max:a?h.min:0);var k=d+e;if(c||isNaN(k))return d;g&&k>h.max&&(k=h.max);a&&k<h.min&&(k=h.min);return k},_onKeyDown:function(d){if(!this.disabled&&!this.readOnly&&(d.keyCode==e.HOME||d.keyCode==e.END)&&!d.ctrlKey&&(!d.altKey&&!d.metaKey)&&"undefined"!=typeof this.get("value")){var h=this.constraints[d.keyCode==e.HOME?"min":"max"];"number"==typeof h&&this._setValueAttr(h,!1);d.stopPropagation();d.preventDefault()}}})})},
"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(m,e,h,k,d,l,n,c,g,a){return m("dijit.form._Spinner",c,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:0.9,smallDelta:1,largeDelta:10,templateString:g,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},
adjust:function(a){return a},_arrowPressed:function(c,d,e){!this.disabled&&!this.readOnly&&(this._setValueAttr(this.adjust(this.get("value"),d*e),!1),a.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,c,d){var f=this.smallDelta;c==this.textbox&&(c=d.keyCode,f=c==e.PAGE_UP||c==e.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==e.UP_ARROW||c==e.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(c):
this._arrowPressed(c,c==this.upArrowNode?1:-1,f)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var c=a.wheelDelta/120;Math.floor(c)!=c&&(c=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:c;if(0!==a){var d=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(d,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(d)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);
this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,c){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,d.wheel,h.hitch(this,
"_mouseWheeled")),n.addListener(this.upArrowNode,this.textbox,{keyCode:e.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.downArrowNode,this.textbox,{keyCode:e.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.upArrowNode,this.textbox,{keyCode:e.PAGE_UP,ctrlKey:!1,altKey:!1,
shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.downArrowNode,this.textbox,{keyCode:e.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(m,e,h){return m("dijit.form.RangeBoundTextBox",
h,{rangeMessage:"",rangeCheck:function(e,d){return("min"in d?0<=this.compare(e,d.min):!0)&&("max"in d?0>=this.compare(e,d.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var e=this.get("value");if(null==e)return!1;var d=!1;"min"in this.constraints&&(d=this.constraints.min,d=0>this.compare(e,"number"==typeof d&&0<=d&&0!=e?0:d));!d&&"max"in this.constraints&&(d=this.constraints.max,d=0<this.compare(e,"number"!=typeof d||0<
d?d:0));return d},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(e){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(e))},getErrorMessage:function(e){var d=this.get("value");return null!=d&&""!==d&&("number"!=typeof d||!isNaN(d))&&!this.isInRange(e)?this.rangeMessage:this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=
e.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(m,e,h,k){return m("dijit.form.MappedTextBox",k,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(d){return d.toString?d.toString():""},toString:function(){var d=this.filter(this.get("value"));
return null!=d?"string"==typeof d?d:this.serialize(d,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=h.place("\x3cinput type\x3d'hidden'"+(this.name&&!e("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),
function(m,e,h,k,d,l){var n=function(c){c=c||{};var a=h.getLocalization("dojo.cldr","number",h.normalizeLocale(c.locale)),d=c.pattern?c.pattern:a[(c.type||"decimal")+"Format"];c="number"==typeof c.places?c.places:"string"===typeof c.places&&0<c.places.length?c.places.replace(/.*,/,""):-1!=d.indexOf(".")?d.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:a.decimal,places:c}},c=m("dijit.form.NumberTextBoxMixin",null,{pattern:function(c){return"("+(this.focused&&this.editOptions?this._regExpGenerator(e.delegate(c,
this.editOptions))+"|":"")+this._regExpGenerator(c)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:d.format,_regExpGenerator:d.regexp,_decimalInfo:n(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(c){var a="number"==typeof c.places?c.places:0;a&&a++;"number"!=typeof c.max&&(c.max=9*Math.pow(10,15-a));"number"!=typeof c.min&&(c.min=-9*Math.pow(10,15-a));this.inherited(arguments,[c]);this.focusNode&&(this.focusNode.value&&
!isNaN(this.value))&&this.set("value",this.value);this._decimalInfo=n(c)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var c=this.get("value");"number"==typeof c&&!isNaN(c)&&(c=this.format(c,this.constraints),void 0!==c&&(this.textbox.value=c));this.inherited(arguments)}},format:function(c,a){var d=String(c);if("number"!=typeof c)return d;if(isNaN(c))return"";if(!("rangeCheck"in this&&this.rangeCheck(c,a))&&!1!==a.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&this.focused&&
(a=e.mixin({},a,this.editOptions));return this._formatter(c,a)},_parser:d.parse,parse:function(c,a){var d=e.mixin({},a,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=d.places){var h=d.places,h="number"===typeof h?h:Number(h.split(",").pop());d.places="0,"+h}d=this._parser(c,d);this.editOptions&&(this.focused&&isNaN(d))&&(d=this._parser(c,a));return d},_getDisplayedValueAttr:function(){var c=this.inherited(arguments);return isNaN(c)?this.textbox.value:c},filter:function(c){if(null==
c||"string"==typeof c&&""==c)return NaN;"number"==typeof c&&(!isNaN(c)&&0!=c)&&(c=d.round(c,this._decimalInfo.places));return this.inherited(arguments,[c])},serialize:function(c,a){return"number"!=typeof c||isNaN(c)?"":this.inherited(arguments)},_setBlurValue:function(){var c=e.hitch(e.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(c,!0)},_setValueAttr:function(c,a,d){if(void 0!==c&&void 0===d)if(d=String(c),"number"==typeof c)if(isNaN(c))d="";else{if("rangeCheck"in this&&this.rangeCheck(c,
this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=void 0}else c?c=void 0:(d="",c=NaN);this.inherited(arguments,[c,a,d])},_getValueAttr:function(){var c=this.inherited(arguments);if(isNaN(c)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&RegExp("^"+d._realNumberRegexp(e.delegate(this.constraints))+"$").test(this.textbox.value))return c=Number(this.textbox.value),isNaN(c)?void 0:c}else return c},isValid:function(c){if(!this.focused||
this._isEmpty(this.textbox.value))return this.inherited(arguments);var a=this.get("value");return!isNaN(a)&&this.rangeCheck(a,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var c="number"==typeof this.constraints.min,a="number"==typeof this.constraints.max,d=this.get("value");if(isNaN(d)||!c&&!a)return this.inherited(arguments);var e=d|0,q=0>d,f=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
h=(this.maxLength||20)-this.textbox.value.length,l=f?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",e=f?e+"."+l:e+"",h=k.rep("9",h),f=d;q?f=Number(e+h):d=Number(e+h);return!(c&&d<this.constraints.min||a&&f>this.constraints.max)}});m=m("dijit.form.NumberTextBox",[l,c],{baseClass:"dijitTextBox dijitNumberTextBox"});m.Mixin=c;return m})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup dojox/widget/ColorPicker jimu/utils".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s){return m([e,h],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof n||(this.color=new n(this.color)):this.color=new n("#ccc");d.setStyle(this.domNode,"backgroundColor",this.color.toHex());
this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){g.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var c=this.tooltipDialog.domNode;return a===c||d.isDescendant(a,c)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){g.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=
!0},_hideTooltipDialog:function(){g.close(this.tooltipDialog);this._isTooltipDialogOpened=!1},_createTooltipDialog:function(){var e=d.create("div");this.tooltipDialog=new c({content:e});d.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");var g=new a({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:k.hitch(this,function(a){this.ensureMode||(a=new n(a),this.setColor(a))})});g.placeAt(e);g.startup();if(this.ensureMode){var f=d.create("div",
{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},e);this.own(l(f,"click",k.hitch(this,function(){this._hideTooltipDialog()})));f=d.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.ok,innerHTML:this.nls.ok},e);this.own(l(f,"click",k.hitch(this,function(){var a=this.picker.get("value");this.setColor(new n(a));this._hideTooltipDialog()})));e=d.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},
e);this.own(l(e,"click",k.hitch(this,function(){var a=this.picker.get("value");this.setColor(new n(a))})))}this.own(l(this.domNode,"click",k.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(l(document.body,"click",k.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=g},setColor:function(a){if(a instanceof n){var c=this.color,f="";c&&(f=
c.toHex());c=a.toHex();this.color=a;d.setStyle(this.domNode,"backgroundColor",c);f!==c&&(this.picker.set("value",c),this.onChange(new n(c)))}},getColor:function(){return this.color},_changeLabel:function(a){d.empty(this.domNode);d.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:s.invertColor(a.toHex())}},this.domNode)},onChange:function(a){this.showLabel&&this._changeLabel(a)}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z,A,C){m.experimental("dojox.widget.ColorPicker");return e("dojox.widget.ColorPicker",b,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:C,postMixInProperties:function(){s.contains(c.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=p.getUniqueId(this.id);h.mixin(this,x.getLocalization("dojox.widget","ColorPicker"));h.mixin(this,x.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>n("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new f.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new f.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(l.subscribe("/dnd/move/stop",h.hitch(this,"_clearTimer"))),this._subs.push(l.subscribe("/dnd/move/start",
h.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:r.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,h.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:r.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,h.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:r.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,h.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:r.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,h.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:r.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,h.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:r.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,h.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(b,a){this._started&&this.setColor(b,a)},setColor:function(b,a){b=u.fromString(b);this._updatePickerLocations(b);this._updateColorInputs(b);this._updateValue(b,a)},_setTimer:function(b){b.node!=this.cursorNode&&b.node!=this.hueCursorNode||(t.focus(b.node),a.setSelectable(this.domNode,!1),this._timer=setInterval(h.hitch(this,"_updateColor"),45))},_clearTimer:function(b){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),a.setSelectable(this.domNode,!0))},_setHue:function(b){d.style(this.colorUnderlay,"backgroundColor",u.fromHsv(b,100,100).toHex())},_updateHueCursorNode:function(b,a,c){if(-1!==b){b=d.style(this.hueCursorNode,"top");a=this.PICKER_HUE_SELECTOR_H/2;b+=a;var f=!1;c.charOrCode==r.UP_ARROW?0<b&&(b-=1,f=!0):c.charOrCode==r.DOWN_ARROW&&b<this.PICKER_HUE_H&&(b+=1,f=!0);f&&d.style(this.hueCursorNode,"top",b-a+"px")}else this._updateColor(!0)},_updateCursorNode:function(b,
a,c){a=this.PICKER_SAT_SELECTOR_H/2;var f=this.PICKER_SAT_SELECTOR_W/2;if(-1!==b){b=d.style(this.cursorNode,"top");var e=d.style(this.cursorNode,"left");b+=a;var e=e+f,g=!1;c.charOrCode==r.UP_ARROW?0<b&&(b-=1,g=!0):c.charOrCode==r.DOWN_ARROW?b<this.PICKER_SAT_VAL_H&&(b+=1,g=!0):c.charOrCode==r.LEFT_ARROW?0<e&&(e-=1,g=!0):c.charOrCode==r.RIGHT_ARROW&&e<this.PICKER_SAT_VAL_W&&(e+=1,g=!0);g&&(e-=f,d.style(this.cursorNode,"top",b-a+"px"),d.style(this.cursorNode,"left",e+"px"))}else this._updateColor(!0)},
_updateColor:function(b){var a=this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,f=this.PICKER_SAT_SELECTOR_W/2,a=d.style(this.hueCursorNode,"top")+a,c=d.style(this.cursorNode,"top")+c,f=d.style(this.cursorNode,"left")+f,a=Math.round(360-360*(a/this.PICKER_HUE_H)),f=u.fromHsv(a,100*(f/this.PICKER_SAT_VAL_W),100-100*(c/this.PICKER_SAT_VAL_H));this._updateColorInputs(f);this._updateValue(f,b);a!=this._hue&&this._setHue(a)},_colorInputChange:function(b){var a,c=!1;switch(b.target){case this.hexCode:a=
u.fromString(b.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:a=u.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:a=u.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(a),this._updateColorInputs(a),this._updateValue(a,!0))},_updateValue:function(b,a){var c=b.toHex();this.value=this.valueNode.value=c;if(a&&(!this._timer||this.liveUpdate))this.onChange(c)},_updatePickerLocations:function(b){var a=
this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,f=this.PICKER_SAT_SELECTOR_W/2;b=b.toHsv();a=Math.round(this.PICKER_HUE_H-b.h/360*this.PICKER_HUE_H)-a;f=Math.round(b.s/100*this.PICKER_SAT_VAL_W)-f;c=Math.round(this.PICKER_SAT_VAL_H-b.v/100*this.PICKER_SAT_VAL_H)-c;this.animatePoint?(q.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0}).play(),q.slideTo({node:this.cursorNode,duration:this.slideDuration,top:c,left:f}).play()):(d.style(this.hueCursorNode,"top",a+"px"),
d.style(this.cursorNode,{left:f+"px",top:c+"px"}));b.h!=this._hue&&this._setHue(b.h)},_updateColorInputs:function(b){var a=b.toHex();this.showRgb&&(this.Rval.value=b.r,this.Gval.value=b.g,this.Bval.value=b.b);this.showHsv&&(b=b.toHsv(),this.Hval.value=Math.round(b.h),this.Sval.value=Math.round(b.s),this.Vval.value=Math.round(b.v));this.showHex&&(this.hexCode.value=a);this.previewNode.style.backgroundColor=a;this.webSafe&&(this.safePreviewNode.style.backgroundColor=a)},_setHuePoint:function(b){b=b.layerY-
this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?q.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0,onEnd:h.hitch(this,function(){this._updateColor(!1);t.focus(this.hueCursorNode)})}).play():(d.style(this.hueCursorNode,"top",b+"px"),this._updateColor(!1))},_setPoint:function(b){var a=b.layerY-this.PICKER_SAT_SELECTOR_H/2,c=b.layerX-this.PICKER_SAT_SELECTOR_W/2;b&&t.focus(b.target);this.animatePoint?q.slideTo({node:this.cursorNode,duration:this.slideDuration,top:a,left:c,onEnd:h.hitch(this,
function(){this._updateColor(!0);t.focus(this.cursorNode)})}).play():(d.style(this.cursorNode,{left:c+"px",top:a+"px"}),this._updateColor(!1))},_handleKey:function(b){},focus:function(){this.focused||t.focus(this.focusNode)},_stopDrag:function(b){g.stop(b)},destroy:function(){this.inherited(arguments);k.forEach(this._subs,function(b){l.unsubscribe(b)});delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(m){return m})},"dojox/color/_base":function(){define(["../main",
"dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(m,e,h,k){m=e.getObject("color",!0,m);m.Color=h;m.blend=h.blendColors;m.fromRgb=h.fromRgb;m.fromHex=h.fromHex;m.fromArray=h.fromArray;m.fromString=h.fromString;m.greyscale=k.makeGrey;e.mixin(m,{fromCmy:function(d,l,k){e.isArray(d)?(l=d[1],k=d[2],d=d[0]):e.isObject(d)&&(l=d.m,k=d.y,d=d.c);l=1-l/100;k=1-k/100;return new h({r:Math.round(255*(1-d/100)),g:Math.round(255*l),b:Math.round(255*k)})},fromCmyk:function(d,l,k,c){e.isArray(d)?(l=d[1],
k=d[2],c=d[3],d=d[0]):e.isObject(d)&&(l=d.m,k=d.y,c=d.b,d=d.c);l/=100;k/=100;c/=100;d=1-Math.min(1,d/100*(1-c)+c);l=1-Math.min(1,l*(1-c)+c);k=1-Math.min(1,k*(1-c)+c);return new h({r:Math.round(255*d),g:Math.round(255*l),b:Math.round(255*k)})},fromHsl:function(d,l,k){e.isArray(d)?(l=d[1],k=d[2],d=d[0]):e.isObject(d)&&(l=d.s,k=d.l,d=d.h);l/=100;for(k/=100;0>d;)d+=360;for(;360<=d;)d-=360;var c,g;120>d?(c=(120-d)/60,g=d/60,d=0):240>d?(c=0,g=(240-d)/60,d=(d-120)/60):(c=(d-240)/60,g=0,d=(360-d)/60);c=2*
l*Math.min(c,1)+(1-l);g=2*l*Math.min(g,1)+(1-l);d=2*l*Math.min(d,1)+(1-l);0.5>k?(c*=k,g*=k,d*=k):(c=(1-k)*c+2*k-1,g=(1-k)*g+2*k-1,d=(1-k)*d+2*k-1);return new h({r:Math.round(255*c),g:Math.round(255*g),b:Math.round(255*d)})}});m.fromHsv=function(d,l,k){e.isArray(d)?(l=d[1],k=d[2],d=d[0]):e.isObject(d)&&(l=d.s,k=d.v,d=d.h);360==d&&(d=0);l/=100;k/=100;var c,g,a;if(0==l)g=a=c=k;else{var s=d/60;d=Math.floor(s);var r=s-d,s=k*(1-l),q=k*(1-l*r);l=k*(1-l*(1-r));switch(d){case 0:c=k;g=l;a=s;break;case 1:c=
q;g=k;a=s;break;case 2:c=s;g=k;a=l;break;case 3:c=s;g=q;a=k;break;case 4:c=l;g=s;a=k;break;case 5:c=k,g=s,a=q}}return new h({r:Math.round(255*c),g:Math.round(255*g),b:Math.round(255*a)})};e.extend(h,{toCmy:function(){var d=1-this.g/255,e=1-this.b/255;return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*d),y:Math.round(100*e)}},toCmyk:function(){var d,e,h,c=this.r/255;d=this.g/255;e=this.b/255;h=Math.min(1-c,1-d,1-e);d=(1-d-h)/(1-h);e=(1-e-h)/(1-h);return{c:Math.round(100*((1-c-h)/(1-h))),m:Math.round(100*
d),y:Math.round(100*e),b:Math.round(100*h)}},toHsl:function(){var d=this.r/255,e=this.g/255,h=this.b/255,c=Math.min(d,h,e),g=Math.max(d,e,h),a=g-c,k=0,r=0,c=(c+g)/2;0<c&&1>c&&(r=a/(0.5>c?2*c:2-2*c));0<a&&(g==d&&g!=e&&(k+=(e-h)/a),g==e&&g!=h&&(k+=2+(h-d)/a),g==h&&g!=d&&(k+=4+(d-e)/a),k*=60);return{h:k,s:Math.round(100*r),l:Math.round(100*c)}},toHsv:function(){var d=this.r/255,e=this.g/255,h=this.b/255,c=Math.min(d,h,e),g=Math.max(d,e,h),c=g-c,a=null,k=0==g?0:c/g;0==k?a=0:(a=d==g?60*(e-h)/c:e==g?120+
60*(h-d)/c:240+60*(d-e)/c,0>a&&(a+=360));return{h:a,s:Math.round(100*k),v:Math.round(100*g)}}});return m})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(m,e,h,k){var d={};e.setObject("dojo.colors",d);var l=function(c,d,a){0>a&&++a;1<a&&--a;var e=6*a;return 1>e?c+(d-c)*e:1>2*a?d:2>3*a?c+6*(d-c)*(2/3-a):c};m.colorFromRgb=h.fromRgb=function(c,d){var a=c.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(a){var e=a[2].split(/\s*,\s*/),
r=e.length,a=a[1];if("rgb"==a&&3==r||"rgba"==a&&4==r)return a=e[0],"%"==a.charAt(a.length-1)?(a=k.map(e,function(a){return 2.56*parseFloat(a)}),4==r&&(a[3]=e[3]),h.fromArray(a,d)):h.fromArray(e,d);if("hsl"==a&&3==r||"hsla"==a&&4==r){var a=(parseFloat(e[0])%360+360)%360/360,q=parseFloat(e[1])/100,f=parseFloat(e[2])/100,q=0.5>=f?f*(q+1):f+q-f*q,f=2*f-q,a=[256*l(f,q,a+1/3),256*l(f,q,a),256*l(f,q,a-1/3),1];4==r&&(a[3]=e[3]);return h.fromArray(a,d)}}return null};var n=function(c,d,a){c=Number(c);return isNaN(c)?
a:c<d?d:c>a?a:c};h.prototype.sanitize=function(){this.r=Math.round(n(this.r,0,255));this.g=Math.round(n(this.g,0,255));this.b=Math.round(n(this.b,0,255));this.a=n(this.a,0,1);return this};d.makeGrey=h.makeGrey=function(c,d){return h.fromArray([c,c,c,d])};e.mixin(h.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],
cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],
darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,
92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,
153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,
245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,
82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return h})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r){return m([e,h,k,d],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:l,nls:null,alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency},postCreate:function(){this.inherited(arguments);"number"===typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){a=Math.round(100-100*a);this.opacitySlider.set("value",a)},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=
this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z){var A=e("dijit.form._SliderMover",
s,{onMouseMove:function(b){var a=this.widget,f=a._abspos;f||(f=a._abspos=d.position(a.sliderBarContainer,!0),a._setPixelValue_=c.hitch(a,"_setPixelValue"),a._isReversed_=a._isReversed());b=b[a._mousePixelCoord]-f[a._startingPixelCoord];a._setPixelValue_(a._isReversed_?f[a._pixelCount]-b:b,f[a._pixelCount],!1)},destroy:function(b){s.prototype.destroy.apply(this,arguments);var a=this.widget;a._abspos=null;a._setValueAttr(a.value,!0)}});h=e("dijit.form.HorizontalSlider",[u,x],{templateString:z,value:0,
showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:p.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(b){!this.disabled&&(!this.readOnly&&!b.altKey&&
!b.ctrlKey&&!b.metaKey)&&this._setValueAttr(this.value,!0)},_onKeyDown:function(b){if(!this.disabled&&!this.readOnly&&!b.altKey&&!b.ctrlKey&&!b.metaKey){switch(b.keyCode){case n.HOME:this._setValueAttr(this.minimum,!1);break;case n.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?n.RIGHT_ARROW:n.LEFT_ARROW:case !1===this._descending?n.DOWN_ARROW:n.UP_ARROW:case !1===this._descending?n.PAGE_DOWN:n.PAGE_UP:this.increment(b);break;case this._descending||this.isLeftToRight()?
n.LEFT_ARROW:n.RIGHT_ARROW:case !1===this._descending?n.UP_ARROW:n.DOWN_ARROW:case !1===this._descending?n.PAGE_UP:n.PAGE_DOWN:this.decrement(b);break;default:return}b.stopPropagation();b.preventDefault()}},_onHandleClick:function(b){!this.disabled&&!this.readOnly&&(g("ie")||t.focus(this.sliderHandle),b.stopPropagation(),b.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(b){if(!this.disabled&&!this.readOnly&&this.clickSelect){t.focus(this.sliderHandle);b.stopPropagation();
b.preventDefault();var a=d.position(this.sliderBarContainer,!0),c=b[this._mousePixelCoord]-a[this._startingPixelCoord];this._setPixelValue(this._isReversed()?a[this._pixelCount]-c:c,a[this._pixelCount],!0);this._movable.onMouseDown(b)}},_setPixelValue:function(b,a,c){if(!this.disabled&&!this.readOnly){var f=this.discreteValues;if(1>=f||Infinity==f)f=a;f--;b=Math.round(b/(a/f));this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*b/f+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(b,
a){this._set("value",b);this.valueNode.value=b;this.focusNode.setAttribute("aria-valuenow",b);this.inherited(arguments);var c=this.maximum>this.minimum?(b-this.minimum)/(this.maximum-this.minimum):0,f=!1===this._descending?this.remainingBar:this.progressBar,d=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(a&&0<this.slideDuration&&f.style[this._progressPixelSize]){var e=this,g={},h=parseFloat(f.style[this._progressPixelSize]),
q=this.slideDuration*(c-h/100);0!=q&&(0>q&&(q=0-q),g[this._progressPixelSize]={start:h,end:100*c,units:"%"},this._inProgressAnim=k.animateProperty({node:f,duration:q,onAnimate:function(b){d.style[e._progressPixelSize]=100-parseFloat(b[e._progressPixelSize])+"%"},onEnd:function(){delete e._inProgressAnim},properties:g}),this._inProgressAnim.play())}else f.style[this._progressPixelSize]=100*c+"%",d.style[this._progressPixelSize]=100*(1-c)+"%"},_bumpValue:function(b,a){if(!this.disabled&&!(this.readOnly||
this.maximum<=this.minimum)){var c=l.getComputedStyle(this.sliderBarContainer),f=d.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=f[this._pixelCount];c--;f=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+b;0>f&&(f=0);f>c&&(f=c);f=f*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(f,a)}},_onClkBumper:function(b){!this.disabled&&(!this.readOnly&&this.clickSelect)&&this._setValueAttr(b,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===
this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(b){this._bumpValue(b.keyCode==n.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(b){this._bumpValue(b.keyCode==n.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(b){this.focused&&(b.stopPropagation(),b.preventDefault(),this._bumpValue(0>b.wheelDelta?-1:1,!0))},startup:function(){this._started||(m.forEach(this.getChildren(),function(b){this[b.container]!=
this.containerNode&&this[b.container].appendChild(b.domNode)},this),this.inherited(arguments))},_typematicCallback:function(b,a,c){if(-1==b)this._setValueAttr(this.value,!0);else this[a==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var b=r('label[for\x3d"'+this.id+'"]');b.length&&(b[0].id||(b[0].id=this.id+
"_label"),this.focusNode.setAttribute("aria-labelledby",b[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(b.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),b.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(f(this.domNode,q.wheel,c.hitch(this,"_mouseWheeled")));var d=e(A,{widget:this});this._movable=
new a(this.sliderHandle,{mover:d});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});h._Mover=A;return h})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(m,e,h,k,d,l){m=m("dijit.form.HorizontalRuleLabels",l,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',
labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(d){return d},_genHTML:function(d,c){var e=this.labels[c];return this._positionPrefix+this._calcPosition(d)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(e)+this._labelPrefix+
e+this._suffix},_genDirectionHTML:function(d){return""},getLabels:function(){var d=this.labels;!d.length&&this.srcNodeRef&&(d=k("\x3e li",this.srcNodeRef).map(function(a){return String(a.innerHTML)}));if(!d.length&&1<this.count)for(var d=[],c=this.minimum,e=(this.maximum-c)/(this.count-1),a=0;a<this.count;a++)d.push(a<this.numericMargin||a>=this.count-this.numericMargin?"":h.format(c,this.constraints)),c+=e;return d},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();
this.count=this.labels.length}});e("dojo-bidi")&&m.extend({_setTextDirAttr:function(e){this.textDir!=e&&(this._set("textDir",e),k(".dijitRuleLabelContainer",this.domNode).forEach(d.hitch(this,function(c){c.style.direction=this.getTextDir(c.innerText||c.textContent||"")})))},_genDirectionHTML:function(d){return this.textDir?"direction:"+this.getTextDir(d)+";":""}});return m})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(m,e,h){return m("dijit.form.HorizontalRule",
[e,h],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(e){return this._positionPrefix+e+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var e;if(1==this.count)e=this._genHTML(50,0);else{var d,
h=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){e=this._genHTML(0,0);for(d=1;d<this.count-1;d++)e+=this._genHTML(h*d,d);e+=this._genHTML(100,this.count-1)}else{e=this._genHTML(100,0);for(d=1;d<this.count-1;d++)e+=this._genHTML(100-h*d,d);e+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=e}})})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(m,e,h,k,d,l,n,c){return m([c],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=e.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=e.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=e.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);e.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(k(this,"Change",h.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(c,a){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof c&&(this._fetchHandle=l.after(this,"onFetch",c),this.own(this._fetchHandle));"function"===typeof a&&(this._fetchErrHandle=l.after(this,"onFetchError",a),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(c){return c},onFetchError:function(c){},getStatus:function(){return this._status},_onServiceUrlChange:function(c){var a=new d;a.then(h.hitch(this,function(){this._valid()}),h.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();c?n({url:h.trim(c||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(h.hitch(this,function(c){this.onFetch({url:this.getValue(),data:c})?a.resolve("success"):a.reject("error")}),h.hitch(this,function(c){a.reject(c)})):a.reject("error")},_validating:function(){this._status="validating";e.removeClass(this.domNode,"jimu-serviceurl-input-invalid");e.removeClass(this.domNode,"jimu-serviceurl-input-valid");e.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";e.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
e.removeClass(this.domNode,"jimu-serviceurl-input-validating");e.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";e.removeClass(this.domNode,"jimu-serviceurl-input-validating");e.removeClass(this.domNode,"jimu-serviceurl-input-valid");e.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r){return m([e,h,k],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(s.bindClickAndDblclickEvents(this.tableInBodySection,d.hitch(this,function(a){if(a=s.getAncestorDom(a.target||a.srcElement,function(a){return l.hasClass(a,"simple-table-row")&&l.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),d.hitch(this,function(a){if(a=s.getAncestorDom(a.target||a.srcElement,function(a){return l.hasClass(a,"simple-table-row")&&l.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var a=Math.random().toString();this._name="jimu_table_"+a.slice(2,a.length);if(this.fields&&0<this.fields.length){var f=l.create("tr",{},this.thead);n.forEach(this.fields,d.hitch(this,function(a){var e="auto";"actions"===a.type&&(a.name="actions");a.hidden?e=1:void 0!==a.width&&null!==a.width?e=a.width:"actions"===a.type&&!a.name&&(a.width=this._calculateActionsWidth(a)+20,e=a.width);l.create("col",{width:e},this.headColgroup);
l.create("col",{width:e},this.bodyColgroup);e=l.create("th",{innerHTML:a.title,title:a.title},f);if("checkbox"===a.type){e.innerHTML="";var b=new r({label:a.title}),h=g(".checkbox",b.domNode)[0];h&&(h.style.marginTop="10px");this.own(c(b.domNode,"click",d.hitch(this,function(){b.getValue()?this._checkAllTdCheckBoxes(a.name):this._uncheckAllTdCheckBoxes(a.name)})));b.placeAt(e)}l.addClass(e,"simple-table-field");a.hidden&&l.addClass(e,"hidden-column");a["class"]&&l.addClass(e,a["class"]);l.addClass(e,
a.name)}))}else this.fields=null},_getThCheckBox:function(c){var f=null;c=g(".simple-table-field."+c+" .jimu-checkbox",this.thead)[0];return f=a.byNode(c)},_getAllEnabledTdCheckBoxes:function(c){c=g(".simple-table-cell."+c+" .jimu-checkbox",this.tbody);c=n.map(c,function(c){return a.byNode(c)});return c=n.filter(c,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);n.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=
this._getAllEnabledTdCheckBoxes(a);n.forEach(a,function(a){a.getValue()&&a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(d.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var c=this._getAllEnabledTdCheckBoxes(a),c=n.filter(c,d.hitch(this,function(a){return a.getStatus()}));0!==c.length&&(a=this._getThCheckBox(a),n.every(c,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):
a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows(),c=n.map(a,d.hitch(this,function(a){return this.getRowData(a)}));l.empty(this.tbody);n.forEach(a,d.hitch(this,function(a,d){this._onDeleteRow(a,c[d])}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var c=[];this.fields&&(a&&0<a.length)&&n.forEach(a,d.hitch(this,function(a){c.push(this.addRow(a,-1,!0))}));this.updateUI();return c},addRow:function(a,c,e){this._rowIndex++;var g={success:!1,tr:null,
errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return g;var b=n.filter(this.fields,d.hitch(this,function(b){return"text"===b.type&&!0===b.unique})),b=n.filter(b,d.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<b.length)return g.errorCode=this.REPEATING_ERROR,g.errorMessage="repeating data",g.repeatFields=b,g;var h=l.create("tr",{"class":"simple-table-row not-empty"},this.tbody);l.setAttr(h,"rowId","row"+this._rowIndex);
n.forEach(this.fields,d.hitch(this,function(b){var c=a[b.name],f=b.type,d=null;"actions"===f?this._createActionsTd(h,b):("text"===f?d=this._createTextTd(h,b,c):"radio"===f?d=this._createRadioTd(h,b,c):"checkbox"===f?d=this._createCheckboxTd(h,b,c):"empty"===f?d=this._createEmptyTd(h,b):"extension"===f&&(d=this._createExtensionTd(h,b,c)),b.hidden&&l.addClass(d,"hidden-column"))}));e||(this.updateUI(),e=this.getRows(),"number"===typeof c&&(0<=c&&c<e.length)&&l.place(h,e[c],"before"));g.success=!0;g.tr=
h;g.errorMessage=null;this._onAddRow(h);return g},deleteRow:function(a){if(a){var c=this.getRowData(a);l.destroy(a);this.updateUI();this._onDeleteRow(a,c)}},selectRow:function(a){this.selectable&&(g(".simple-table-row",this.tbody).removeClass("jimu-state-active"),l.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();l.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
l.addClass(this.domNode,this._classVerticalScroll)},_updateHeadTableWidth:function(){if(this.domNode){var a=l.getContentBox(this.tableInBodySection).w,c="100%";"number"===typeof a&&0<a&&(c=a+"px");l.setStyle(this.tableInHeadSection,"width",c)}},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();l.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=g("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&
(a=g("."+this._classRowUpDiv,a)[0])&&l.removeClass(a,this._classJimuStateDisabled);if(a=g("."+this._classLastSimpleTableRow,this.tbody)[0])(a=g("."+this._classRowDownDiv,a)[0])&&l.removeClass(a,this._classJimuStateDisabled);a=g("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);n.forEach(a,d.hitch(this,function(a,c){0===c%2?l.addClass(a,"odd"):l.addClass(a,"even")}));if(0<a.length){var c=
a[0];l.addClass(c,this._classFirstSimpleTableRow);(c=g("."+this._classRowUpDiv,c)[0])&&l.addClass(c,this._classJimuStateDisabled);a=a[a.length-1];l.addClass(a,this._classLastSimpleTableRow);(a=g("."+this._classRowDownDiv,a)[0])&&l.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,c,d){var e=null;return e=c.editable?this._createEditableTextTd(a,c,d):this._createNormalTextTd(a,c,d)},_createNormalTextTd:function(a,c,d){var e=l.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');
l.addClass(e,c.name);var b=g("div",e)[0];b.innerHTML=d||"";b.title=d||"";c["class"]&&l.addClass(e,c["class"]);l.place(e,a);return e},_createEditableTextTd:function(a,f,e){var h=l.toDom('\x3ctd class\x3d"editable-text-td '+f.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');l.addClass(h,"simple-table-cell");l.place(h,a);f["class"]&&l.addClass(h,f["class"]);var b=g("div",h)[0],k=g("input",h)[0];b.innerHTML=
e||"";""!==b.innerHTML&&(b.title=b.innerText||b.innerHTML);k.value=b.innerHTML;this.own(c(b,"dblclick",d.hitch(this,function(a){a.stopPropagation();k.value=b.innerText||b.innerHTML;l.setStyle(b,"display","none");l.setStyle(k,"display","inline");k.focus()})));this.own(c(k,"blur",d.hitch(this,function(){k.value=d.trim(k.value);var c=b.innerText||b.innerHTML,e=k.value;""!==e?f.unique?0<this.getRowDataArrayByFieldValue(f.name,e,a).length?k.value=c:b.innerHTML=e:b.innerHTML=e:k.value=c;l.setStyle(k,"display",
"none");l.setStyle(b,"display","block")})));return h},_createRadioTd:function(a,c,d){var e=l.toDom('\x3ctd class\x3d"radio-td '+c.name+'"\x3e\x3cinput type\x3d"radio" /\x3e\x3c/td\x3e');l.addClass(e,"simple-table-cell");l.place(e,a);c["class"]&&l.addClass(e,c["class"]);a=g("input",e)[0];a.name=c.radio&&"row"===c.radio?this._name+this._rowIndex:this._name+c.name;a.checked=!0===d;return e},_createCheckboxTd:function(a,f,e){var g=l.toDom('\x3ctd class\x3d"checkbox-td '+f.name+'"\x3e\x3c/td\x3e');l.addClass(g,
"simple-table-cell");l.place(g,a);f["class"]&&l.addClass(g,f["class"]);var b=new r({onChange:d.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(f.name);"function"===typeof f.onChange&&setTimeout(d.hitch(this,function(){f.onChange(a,b)}),200)})});this.own(c(b,"status-change",d.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(f.name)})));this._setValueForCheckBox(b,e);b.placeAt(g);return g},_createActionsTd:function(a,f){var e=l.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');
l.addClass(e,"simple-table-cell");var h=g(".action-item-parent",e)[0];l.place(e,a);f["class"]&&l.addClass(e,f["class"]);n.forEach(f.actions,d.hitch(this,function(b){"up"===b?(b=l.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},h),b.title=this.nls.moveUp,this.own(c(b,"click",d.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowUp(a)){b=g(".simple-table-row",this.tbody);var c=n.indexOf(b,a);if(0<c&&(b=b[c-1]))l.place(a,b,"before"),this.updateUI(),
this.emit("row-up",a)}})))):"down"===b?(b=l.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},h),b.title=this.nls.moveDown,this.own(c(b,"click",d.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowDown(a)){b=g(".simple-table-row",this.tbody);var c=n.indexOf(b,a);if(c<b.length-1&&(b=b[c+1]))l.place(a,b,"after"),this.updateUI(),this.emit("row-down",a)}})))):"edit"===b?(b=l.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},
h),b.title=this.nls.edit,this.own(c(b,"click",d.hitch(this,function(b){b.stopPropagation();this.onBeforeRowEdit(a)&&this._onActionsEdit(a)})))):"delete"===b&&(b=l.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},h),b.title=this.nls.deleteRow,this.own(c(b,"click",d.hitch(this,function(b){b.stopPropagation();this.onBeforeRowDelete(a)&&this.deleteRow(a)}))))}));var b=this._calculateActionsWidth(f)+"px";l.setStyle(h,"width",b);return e},_calculateActionsWidth:function(a){return 20*
n.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,c){var d=l.create("td",{"class":c.name},a);l.addClass(d,"simple-table-cell");l.addClass(d,"empty-text-td");c["class"]&&l.addClass(d,c["class"]);return d},_createExtensionTd:function(a,c,d){a=l.create("td",{"class":c.name},a);l.addClass(a,"simple-table-cell");l.addClass(a,"extension-td");c["class"]&&l.addClass(a,c["class"]);c.create&&"function"===typeof c.create&&c.create(a);c.setValue&&
"function"===typeof c.setValue&&c.setValue(a,d);return a},editRow:function(a,c){var e={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof c||!l.isDescendant(a,this.tbody))return e;var h=d.mixin([],this.fields),h=n.filter(h,d.hitch(this,function(b){return"text"===b.type&&!0===b.unique})),h=n.filter(h,d.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,c[b.name],a).length}));if(0<h.length)return e.errorCode=this.REPEATING_ERROR,
e.errorMessage="repeating data",e.repeatFields=h,e;var b=g(".simple-table-cell",a);n.forEach(this.fields,d.hitch(this,function(a,d){if(c.hasOwnProperty(a.name)){var e=b[d],g=c[a.name],h=a.type;"text"===h?a.editable?this._editEditableText(e,a,g):this._editNormalText(e,a,g):"radio"===h?this._editRadio(e,a,g):"checkbox"===h?this._editCheckbox(e,a,g):"extension"===h&&this._editExtension(e,a,g)}}));e.success=!0;e.tr=a;e.errorMessage=null;this._onEditRow(a);return e},_editNormalText:function(a,c,d){a=g("div",
a)[0];a.innerHTML=d||"";a.title=a.innerHTML},_editEditableText:function(a,c,d){c=g("div",a)[0];c.innerHTML=d||"";g("input",a)[0].value=c.innerHTML},_editRadio:function(a,c,d){g("input",a)[0].checked=!0===d},_editCheckbox:function(c,f,d){c=g(".jimu-checkbox",c)[0];c=a.byNode(c);this._setValueForCheckBox(c,d)},_setValueForCheckBox:function(a,c){null===c?a.setStatus(!1):(a.setStatus(!0),c!==a.getValue()&&a.setValue(c))},_editExtension:function(a,c,d){c.setValue&&"function"===typeof c.setValue&&c.setValue(a,
d)},_getAllRows:function(){return g(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return n.filter(a,d.hitch(this,function(a){return!l.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return n.filter(a,d.hitch(this,function(a){return l.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,c=g(".simple-table-row",this.tbody),c=n.filter(c,d.hitch(this,function(a){return!l.hasClass(a,
"empty")&&l.hasClass(a,"jimu-state-active")}));0<c.length&&(a=c[0]);return a},getSelectedRowData:function(){var a=null,c=this.getSelectedRow();c&&(a=this._getRowDataByTr(c));return a},getData:function(a){var c=this._getNotEmptyRows();a&&(c=n.filter(c,d.hitch(this,function(c){return c!==a})));return n.map(c,d.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(c){var f=null;if(c)f={};else return null;n.forEach(this.fields,
d.hitch(this,function(d){var e=d.type;if("actions"!==e){var b=d.name;f[b]=null;var h=g(".simple-table-cell."+b,c)[0];h&&("text"===e?(d=g("div",h)[0],f[b]=d.innerText||d.innerHTML):"radio"===e?(d=g("input",h)[0],f[b]=d.checked):"checkbox"===e?(d=g(".jimu-checkbox",h)[0],d=a.byNode(d),d.getStatus()?f[b]=d.getValue():f[b]=null):"extension"===e&&d.getValue&&"function"===typeof d.getValue&&(f[b]=d.getValue(h,d)))}}));return f},getRowDataArrayByFieldValue:function(a,c,e){var g=[];if(!this.fields||!n.some(this.fields,
d.hitch(this,function(b){return b.name===a})))return[];e=this.getData(e);return g=n.filter(e,d.hitch(this,function(b){return b[a]==c}))},moveToTop:function(a){a&&a.parentNode===this.tbody&&l.place(a,this.tbody,"first")},_onClickRow:function(a){this.emit("row-click",a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a,c){this.emit("row-delete",
a,c)},_onEnterRow:function(a){this.emit("row-enter",a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),
function(m,e,h,k,d,l,n,c,g,a){return m([n,c,l],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new g(null,this.containerNode);var a=100*(1/this.tabs.length);this.isNested&&
k.addClass(this.domNode,"nested");h.forEach(this.tabs,function(c){this._createTab(c,a)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);a.setVerticalCenter(this.domNode)},_createTab:function(a,c){var g;g=k.create("div",{innerHTML:a.title,"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":c+"%"},label:a.title},this.controlNode);this.viewStack.viewType=a.content.domNode?"dijit":"dom";a.content.label=a.title;
this.viewStack.addView(a.content);this.own(d(g,"click",e.hitch(this,this.onSelect,a.title)));g.label=a.title;this.controlNodes.push(g)},onSelect:function(a){this.selectTab(a)},selectTab:function(a){this._selectControl(a);this.viewStack.switchView(a);this.emit("tabChanged",a)},_selectControl:function(a){h.forEach(this.controlNodes,function(c){k.removeClass(c,"jimu-state-selected");c.label===a&&k.addClass(c,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/html","dojo/_base/array","dijit/_WidgetBase"],function(m,e,h,k,d){return m(d,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);k.forEach(this.views,e.hitch(this,function(d){1===d.nodeType?(h.place(d,this.domNode),h.addClass(d,"view"),h.setStyle(d,"display","none")):d.domNode&&(h.place(d.domNode,this.domNode),h.addClass(d.domNode,"view"),h.setStyle(d.domNode,"display",
"none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var d="",e=this.getSelectedView();e&&(d=e.label);return d},getViewByLabel:function(d){for(var e=0;e<this.views.length;e++)if(d===this.views[e].label)return this.views[e];return null},addView:function(d){this.views.push(d);1===d.nodeType?(h.place(d,this.domNode),h.addClass(d,"view")):d.domNode&&(h.place(d.domNode,this.domNode),
h.addClass(d.domNode,"view"))},removeView:function(d){var e=this.views.length;this.views=k.filter(this.views,function(c){return d!==c});e!==this.views.length&&(1===d.nodeType?h.destroy(d):d.domNode&&d.destroyRecursive())},switchView:function(d){var k,c;k="number"===typeof d?this.views[d]:"string"===typeof d?this.getViewByLabel(d):d;this.views.forEach(e.hitch(this,function(d){d&&(1===d.nodeType?c=d:d.domNode&&(c=d.domNode),d===k?(h.setStyle(c,"display","block"),d.domNode&&!d._started&&(d.startup(),
d._started=!0)):h.setStyle(c,"display","none"))}));this._currentView=k;this.onViewSwitch(k)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),function(m,e,h,k,d,l,n,c,g,a,s){return m([c,g,l],{templateString:a,selected:"",tabs:null,average:!1,baseClass:"jimu-tab3",
declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var c=n("td",this.tabTr);h.forEach(c,e.hitch(this,function(c,d){k.removeClass(c,"jimu-state-active");c.label===a&&(k.addClass(c,"jimu-state-active"),this._currentIndex=d)}));this.controlNode.removeChild(this.controlTable);k.place(this.controlTable,this.controlNode);
this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var c=n("td:last-child",this.tabTr);0<c.length&&k.destroy(c[0])}0<h.filter(this.tabs,function(c){return c.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(c=k.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),k.place(c,this.tabTr)))},
removeTab:function(a){var c=-1;if(h.some(this.tabs,function(b,f){if(b.title===a)return c=f,!0})){var f=this.tabs.splice(c,1)[0],d=n("td",this.tabTr),e;h.some(d,function(b){if(b.label===a)return e=b,!0})&&k.destroy(e);this.viewStack.removeView(f.content)}},showShelter:function(){k.setStyle(this.shelter,"display","block")},hideShelter:function(){k.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},
_initSelf:function(){this.viewStack=new s(null,this.containerNode);h.forEach(this.tabs,function(a){this._createTab(a)},this);if(this.average)this.controlTable.style.tableLayout="fixed";else{var a=k.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');k.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var c=k.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
c.label=a.title||"";k.place(c,this.tabTr);var f=n(".tab-item-div",c)[0];f.innerHTML=c.label;f.label=c.label;a.content.label=c.label;this.viewStack.addView(a.content);this.own(d(c,"click",e.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(m,e,h,k){return m([k],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",
constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(e.hitch(this,function(d){this._placeItem(d)}));this.resize()},_placeItem:function(d){d.domNode?h.place(d.domNode,this.domNode):h.place(d,this.domNode)},addItem:function(d){this.items.push(d);this._placeItem(d);this.resize()},addItems:function(d){this.items=this.items.concat(d);this.items.forEach(e.hitch(this,function(d){this._placeItem(d)}));this.resize()},removeItem:function(d){var e;
for(e=0;e<this.items.length;e++)if(this.items[e].label===d){this.items[e].domNode?this.items[e].destroy():h.destroy(this.items[e]);this.items.splice(e,1);this.resize();break}},empty:function(){var d;for(d=0;d<this.items.length;d++)this.items[d].domNode?this.items[d].destroy():h.destroy(this.items[d]);this.items=[]},resize:function(){var d,l,k;d=h.getMarginBox(this.domNode);l=this.getItemSize(d);k=Math.floor((d.w+this.hmargin)/(l.width+this.hmargin));this.items.forEach(e.hitch(this,function(c,d){this.setItemPosition(c,
d,l,k)}))},getItemSize:function(d){var e={},h;if("fixWidth"===this.strategy)e.width=this.itemSize.width,e.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(h=0;h<this.itemSize.length;h++){if(d.w<=this.itemSize[h].screenWidth){e.width=this.itemSize[h].width;e.height=this.itemSize[h].height;break}}else"fixCols"===this.strategy&&(e.width=(d.w-this.hmargin*(this.maxCols-1))/this.maxCols,e.height="number"===typeof this.itemSize.height?this.itemSize.height:e.width*parseFloat(this.itemSize.height.substring(0,
this.itemSize.height.length-1))/100);return e},setItemPosition:function(d,e,k,c){e++;var g=e%c;e=Math.ceil(e/c);0===g&&(g=c);c={position:"absolute",top:(this.vmargin+k.height)*(e-1)+"px"};c[window.isRTL?"right":"left"]=(this.hmargin+k.width)*(g-1)+"px";0<=k.width&&(c.width=k.width+"px");0<=k.height&&(c.height=k.height+"px");h.setStyle(d.domNode?d.domNode:d,c)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t){return m([e,h,k,s],{templateString:d,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);
var b={};this.drawLayerId&&(b.id=this.drawLayerId);this.drawLayer=new q(b);this._initDefaultSymbols();this._initTypes();b=a(".draw-item",this.domNode);this.own(b.on("click",l.hitch(this,this._onItemClick)));this.own(g(this.btnClear,"click",l.hitch(this,this._onClickClear)));this.own(g(document.body,"keydown",l.hitch(this,function(b){this._shiftKey=!!b.shiftKey;this._ctrlKey=!!b.ctrlKey;this._metaKey=!!b.metaKey})));this.own(g(document.body,"keyup",l.hitch(this,function(b){this._shiftKey=!!b.shiftKey;
this._ctrlKey=!!b.ctrlKey;this._metaKey=!!b.metaKey})));this.map&&this.setMap(this.map);n.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable()},enable:function(){this._isDisabled=!1;n.addClass(this.domNode,"enabled");n.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;n.addClass(this.domNode,"disabled");n.removeClass(this.domNode,"enabled");this.deactivate()},isEnabled:function(){return!this._isDisabled},isActive:function(){var b=a(".draw-item.jimu-state-active",
this.domNode);return b&&0<b.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;this.inherited(arguments)},setMap:function(b){b&&(this.map=b,this.map.addLayer(this.drawLayer),this.drawToolBar=new f(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),
this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(g(this.drawToolBar,"draw-end",l.hitch(this,this._onDrawEnd))))},setPointSymbol:function(b){this.pointSymbol=b;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(b){this.polylineSymbol=b;this.drawToolBar.setLineSymbol(b)},setPolygonSymbol:function(b){this.polygonSymbol=b;this.drawToolBar.setFillSymbol(b)},setTextSymbol:function(b){this.textSymbol=b},reset:function(){this.deactivate();
this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();a(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),this.emit("draw-deactivate"))},activate:function(b){var c=null,f=a(".draw-item",this.domNode);"TEXT"===b?(b="POINT",c=this.textIcon):(f=f.filter(function(a){return a.getAttribute("data-geotype")===b}),0<f.length&&(c=f[0]));c&&this._activate(c)},onIconSelected:function(b,a,
c){this.emit("icon-selected",b,a,c)},onDrawEnd:function(b,a,c,f,d,e){this.emit("draw-end",b,a,c,f,d,e)},onClear:function(){this.emit("clear")},addGraphic:function(b){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(b)},removeGraphic:function(b){this.drawLayer.remove(b)},getFirstGraphic:function(){var b=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(b=this.drawLayer.graphics[0]);return b},show:function(){n.removeClass(this.domNode,"hidden")},hide:function(){n.addClass(this.domNode,
"hidden")},getDrawItemIcons:function(){return a(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var b={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},a={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},c={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,
93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=p.fromJson(b));this.polylineSymbol||(this.polylineSymbol=p.fromJson(a));this.polygonSymbol||(this.polygonSymbol=p.fromJson(c))},_initTypes:function(){this.geoTypes&&0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&(this.geoTypes=
this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var b=a(".draw-item",this.domNode);b.style("display","none");c.forEach(b,l.hitch(this,function(b){var a=b.getAttribute("data-geotype"),a=0<=c.indexOf(this.geoTypes,a);n.setStyle(b,"display",a?"block":"none")}))},_onItemClick:function(b){this._isDisabled||
(b=b.target||b.srcElement,n.hasClass(b,"draw-item")&&(n.hasClass(b,"jimu-state-active")?this.deactivate():this._activate(b)))},_activate:function(b){a(".draw-item",this.domNode).removeClass("jimu-state-active");n.addClass(b,"jimu-state-active");var c=b.getAttribute("data-geotype"),d=b.getAttribute("data-commontype"),e=f[c];"TEXT"===c&&(e=f.POINT);this.disableWebMapPopup();this.drawToolBar.activate(e);this.emit("draw-activate",e);this.onIconSelected(b,c,d)},_onDrawEnd:function(b){var c=a(".draw-item.jimu-state-active",
this.domNode)[0],f=c.getAttribute("data-geotype"),c=c.getAttribute("data-commontype"),d=null,d="extent"===b.geometry.type?t.fromExtent(b.geometry):b.geometry;d.geoType=f;d.commonType=c;b=d.type;var e=null,e="point"===b||"multipoint"===b?n.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===b||"polyline"===b?this.polylineSymbol:this.polygonSymbol,d=new r(d,e,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(d);this.deactivateAfterDrawing&&this.deactivate();
this.onDrawEnd(d,f,c,this._shiftKey,this._ctrlKey,this._metaKey)}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z,A,C,w,F,D){var B=m(p,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(a,f){this.markerSymbol=new t(t.STYLE_SOLID,10,new b(b.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,0.25]));this.lineSymbol=new b(b.STYLE_SOLID,new d([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new b(b.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,0.25]));this._points=[];this._mouse=!n("esri-touch")&&!n("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=e.mixin(e.mixin({},this._defaultOptions),f||{});if(c("ios")||c("android"))this._options.showTooltips=!1;this._onKeyDownHandler=e.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=e.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=e.hitch(this,this._onMouseUpHandler);this._onClickHandler=e.hitch(this,this._onClickHandler);this._onMouseMoveHandler=e.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=e.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=e.hitch(this,this._onDblClickHandler);this._updateTooltip=e.hitch(this,this._updateTooltip);this._hideTooltip=e.hitch(this,this._hideTooltip);this._redrawGraphic=e.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(b){this.respectDrawingVertexOrder=b},setMarkerSymbol:function(b){this.markerSymbol=b},setLineSymbol:function(b){this.lineSymbol=b},
setFillSymbol:function(b){this.fillSymbol=b},activate:function(b,a){this._geometryType&&this.deactivate();var c=this.map,f=k.connect,d=B;this._options=e.mixin(e.mixin({},this._options),a||{});c.navigationManager.setImmediateClick(!1);switch(b){case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.TRIANGLE:case d.CIRCLE:case d.ELLIPSE:case d.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=f(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=f(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=f(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=f(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=f(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=f(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=f(c,"onMouseDragEnd",this._onMouseUpHandler));n("esri-touch")&&!n("esri-pointer")&&
(this._onMouseDownHandler2_connect=f(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=f(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=f(c,"onSwipeEnd",this._onMouseUpHandler));break;case d.POINT:this._onClickHandler_connect=f(c,"onClick",this._onClickHandler);break;case d.LINE:case d.EXTENT:case d.FREEHAND_POLYLINE:case d.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=f(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=f(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=f(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=f(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=f(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=f(c,"onMouseDragEnd",this._onMouseUpHandler));n("esri-touch")&&!n("esri-pointer")&&(this._onMouseDownHandler2_connect=f(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=f(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=f(c,"onSwipeEnd",this._onMouseUpHandler));break;case d.POLYLINE:case d.POLYGON:case d.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=f(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=f(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
b);return}this._onKeyDown_connect=f(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=f(c,"onExtentChange",this._redrawGraphic);this._geometryType=b;this._toggleTooltip(!0);c.snappingManager&&("freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType)&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var b=this.map;this._clear();var a=k.disconnect;a(this._onMouseMoveHandler_connect);
a(this._onMouseDownHandler_connect);a(this._onMouseDragHandler_connect);a(this._onMouseUpHandler_connect);a(this._onMouseDownHandler2_connect);a(this._onMouseDragHandler2_connect);a(this._onMouseUpHandler2_connect);a(this._onClickHandler_connect);a(this._onDblClickHandler_connect);a(this._onKeyDown_connect);a(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;b.snappingManager&&(b.snappingManager._stopSelectionLayerQuery(),b.snappingManager._killOffSnapping());switch(this._geometryType){case B.CIRCLE:case B.ELLIPSE:case B.TRIANGLE:case B.ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.UP_ARROW:case B.DOWN_ARROW:case B.RECTANGLE:case B.LINE:case B.EXTENT:case B.FREEHAND_POLYLINE:case B.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case B.POLYLINE:case B.POLYGON:case B.MULTI_POINT:this._dblClickZoom&&b.enableDoubleClickZoom()}a=this._geometryType;this._geometryType=null;b.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(a)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var b,a=this._points,c=this.map.spatialReference,f=B,a=a.slice(0,a.length);switch(this._geometryType){case f.POLYLINE:if(!this._graphic||2>a.length)return;b=new A(c);b.addPath([].concat(a));break;case f.POLYGON:if(!this._graphic||3>a.length)return;b=new C(c);a=[].concat(a,[a[0].offset(0,0)]);!C.prototype.isClockwise(a)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());
b.addRing(a);break;case f.MULTI_POINT:b=new w(c),h.forEach(a,function(a){b.addPoint(a)})}k.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_drawEnd:function(b){if(b){var a=this.map.spatialReference,c;this.onDrawEnd(b);a&&(a.isWebMercator()?c=z.webMercatorToGeographic(b,!0):4326===a.wkid&&(c=x.fromJson(b.toJson())));this.onDrawComplete({geometry:b,geographicGeometry:c})}},_normalizeRect:function(b,a,c){var f=b.x;b=b.y;var d=a.x;a=a.y;var e=Math.abs(f-
d),g=Math.abs(b-a);return{x:Math.min(f,d),y:Math.max(b,a),width:e,height:g,spatialReference:c}},_onMouseDownHandler:function(b){this._dragged=!1;var a;this.map.snappingManager&&(a=this.map.snappingManager._snappingPoint);var c=a||b.mapPoint,f=B;a=this.map;var d=a.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case f.LINE:this._graphic=a.graphics.add(new u(new A({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:d}),this.lineSymbol),!0);a.snappingManager&&a.snappingManager._setGraphic(this._graphic);
break;case f.FREEHAND_POLYLINE:this._oldPoint=b.screenPoint;c=new A(d);c.addPath(this._points);this._graphic=a.graphics.add(new u(c,this.lineSymbol),!0);a.snappingManager&&a.snappingManager._setGraphic(this._graphic);break;case f.CIRCLE:case f.ELLIPSE:case f.TRIANGLE:case f.ARROW:case f.LEFT_ARROW:case f.RIGHT_ARROW:case f.UP_ARROW:case f.DOWN_ARROW:case f.RECTANGLE:case f.FREEHAND_POLYGON:this._oldPoint=b.screenPoint,c=new C(d),c.addRing(this._points),this._graphic=a.graphics.add(new u(c,this.fillSymbol),
!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic)}n("esri-touch")&&b.preventDefault()},_onMouseMoveHandler:function(b){var a;this.map.snappingManager&&(a=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];b=a||b.mapPoint;a=this._tGraphic;var f=a.geometry;switch(this._geometryType){case B.POLYLINE:case B.POLYGON:f.setPoint(0,0,{x:c.x,y:c.y}),f.setPoint(0,1,{x:b.x,y:b.y}),a.setGeometry(f)}},_onMouseDragHandler:function(b){if(this._graphic||this._points.length)if(n("esri-touch")&&
!this._points.length)b.preventDefault();else{this._dragged=!0;var a;this.map.snappingManager&&(a=this.map.snappingManager._snappingPoint);var c=this._points[0],f=a||b.mapPoint,d=this.map,g=d.spatialReference;a=this._graphic;var h=B,k=d.toScreen(c),l=d.toScreen(f),p=[],p=l.x-k.x,l=l.y-k.y,q=Math.sqrt(p*p+l*l);switch(this._geometryType){case h.CIRCLE:this._hideTooltip();a.geometry=C.createCircle({center:k,r:q,numberOfPoints:60,map:d});a.setGeometry(a.geometry);break;case h.ELLIPSE:this._hideTooltip();
a.geometry=C.createEllipse({center:k,longAxis:p,shortAxis:l,numberOfPoints:60,map:d});a.setGeometry(a.geometry);break;case h.TRIANGLE:this._hideTooltip();p=[[0,-q],[0.8660254037844386*q,0.5*q],[-0.8660254037844386*q,0.5*q],[0,-q]];a.geometry=this._toPolygon(p,k.x,k.y);a.setGeometry(a.geometry);break;case h.ARROW:this._hideTooltip();c=l/q;d=p/q;f=0.25*d*q;g=0.25*q/(l/p);q*=0.25*c;p=[[p,l],[p-f*(1+24/g),l+24*d-q],[p-f*(1+12/g),l+12*d-q],[-12*c,12*d],[12*c,-12*d],[p-f*(1-12/g),l-12*d-q],[p-f*(1-24/g),
l-24*d-q],[p,l]];a.geometry=this._toPolygon(p,k.x,k.y);a.setGeometry(a.geometry);break;case h.LEFT_ARROW:this._hideTooltip();p=0>=p?[[p,0],[0.75*p,l],[0.75*p,0.5*l],[0,0.5*l],[0,-0.5*l],[0.75*p,-0.5*l],[0.75*p,-l],[p,0]]:[[0,0],[0.25*p,l],[0.25*p,0.5*l],[p,0.5*l],[p,-0.5*l],[0.25*p,-0.5*l],[0.25*p,-l],[0,0]];a.geometry=this._toPolygon(p,k.x,k.y);a.setGeometry(a.geometry);break;case h.RIGHT_ARROW:this._hideTooltip();p=0<=p?[[p,0],[0.75*p,l],[0.75*p,0.5*l],[0,0.5*l],[0,-0.5*l],[0.75*p,-0.5*l],[0.75*
p,-l],[p,0]]:[[0,0],[0.25*p,l],[0.25*p,0.5*l],[p,0.5*l],[p,-0.5*l],[0.25*p,-0.5*l],[0.25*p,-l],[0,0]];a.geometry=this._toPolygon(p,k.x,k.y);a.setGeometry(a.geometry);break;case h.UP_ARROW:this._hideTooltip();p=0>=l?[[0,l],[-p,0.75*l],[-0.5*p,0.75*l],[-0.5*p,0],[0.5*p,0],[0.5*p,0.75*l],[p,0.75*l],[0,l]]:[[0,0],[-p,0.25*l],[-0.5*p,0.25*l],[-0.5*p,l],[0.5*p,l],[0.5*p,0.25*l],[p,0.25*l],[0,0]];a.geometry=this._toPolygon(p,k.x,k.y);a.setGeometry(a.geometry);break;case h.DOWN_ARROW:this._hideTooltip();
p=0<=l?[[0,l],[-p,0.75*l],[-0.5*p,0.75*l],[-0.5*p,0],[0.5*p,0],[0.5*p,0.75*l],[p,0.75*l],[0,l]]:[[0,0],[-p,0.25*l],[-0.5*p,0.25*l],[-0.5*p,l],[0.5*p,l],[0.5*p,0.25*l],[p,0.25*l],[0,0]];a.geometry=this._toPolygon(p,k.x,k.y);a.setGeometry(a.geometry);break;case h.RECTANGLE:this._hideTooltip();p=[[0,0],[p,0],[p,l],[0,l],[0,0]];a.geometry=this._toPolygon(p,k.x,k.y);a.setGeometry(a.geometry);break;case h.LINE:a.setGeometry(e.mixin(a.geometry,{paths:[[[c.x,c.y],[f.x,f.y]]]}));break;case h.EXTENT:a&&d.graphics.remove(a,
!0);a=new F(this._normalizeRect(c,f,g));a._originOnly=!0;this._graphic=d.graphics.add(new u(a,this.fillSymbol),!0);d.snappingManager&&d.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(b)){n("esri-touch")&&b.preventDefault();return}this._points.push(b.mapPoint.offset(0,0));a.geometry._insertPoints([f.offset(0,0)],0);a.setGeometry(a.geometry);break;case h.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(b)){n("esri-touch")&&
b.preventDefault();return}this._points.push(b.mapPoint.offset(0,0));a.geometry._insertPoints([f.offset(0,0)],0);a.setGeometry(a.geometry)}n("esri-touch")&&b.preventDefault()}},_canDrawFreehandPoint:function(b){if(!this._oldPoint)return!1;var a=this._oldPoint.x-b.screenPoint.x,c=this._oldPoint.y-b.screenPoint.y,f=this._options.tolerance;if((0>a?-1*a:a)<f&&(0>c?-1*c:c)<f)return!1;a=new Date;if(a-this._startTime<this._options.drawTime)return!1;this._startTime=a;this._oldPoint=b.screenPoint;return!0},
_onMouseUpHandler:function(b){if(!this._dragged||!this._graphic)this._clear();else{0===this._points.length&&this._points.push(b.mapPoint.offset(0,0));var a;this.map.snappingManager&&(a=this.map.snappingManager._snappingPoint);var c=this._points[0];a=a||b.mapPoint;var f=this.map.spatialReference,d=B,e;switch(this._geometryType){case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:e=this._graphic.geometry;break;
case d.LINE:e=new A({paths:[[[c.x,c.y],[a.x,a.y]]],spatialReference:f});break;case d.EXTENT:e=(new F(this._normalizeRect(c,a,f))).getExtent();break;case d.FREEHAND_POLYLINE:e=new A(f);e.addPath([].concat(this._points,[a.offset(0,0)]));break;case d.FREEHAND_POLYGON:e=new C(f),c=[].concat(this._points,[a.offset(0,0),this._points[0].offset(0,0)]),!C.prototype.isClockwise(c)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),
c.reverse()),e.addRing(c)}n("esri-touch")&&b.preventDefault();this._clear();this._drawEnd(e)}},_onClickHandler:function(b){var a;this.map.snappingManager&&(a=this.map.snappingManager._snappingPoint);b=a||b.mapPoint;a=this.map;var c=a.toScreen(b),f=B;this._points.push(b.offset(0,0));switch(this._geometryType){case f.POINT:this._drawEnd(b.offset(0,0));this._setTooltipMessage(0);break;case f.POLYLINE:1===this._points.length?(c=new A(a.spatialReference),c.addPath(this._points),this._graphic=a.graphics.add(new u(c,
this.lineSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=k.connect(a,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=a.graphics.add(new u(new A({paths:[[[b.x,b.y],[b.x,b.y]]],spatialReference:a.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([b.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),a=this._tGraphic,c=a.geometry,c.setPoint(0,0,b.offset(0,0)),c.setPoint(0,
1,b.offset(0,0)),a.setGeometry(c));break;case f.POLYGON:1===this._points.length?(c=new C(a.spatialReference),c.addRing(this._points),this._graphic=a.graphics.add(new u(c,this.fillSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=k.connect(a,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=a.graphics.add(new u(new A({paths:[[[b.x,b.y],[b.x,b.y]]],spatialReference:a.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([b.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),a=this._tGraphic,c=a.geometry,c.setPoint(0,0,b.offset(0,0)),c.setPoint(0,1,b.offset(0,0)),a.setGeometry(c));break;case f.MULTI_POINT:b=this._points;1===b.length?(c=new w(a.spatialReference),c.addPoint(b[b.length-1]),this._graphic=a.graphics.add(new u(c,this.markerSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(b[b.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));
break;case f.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case f.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case f.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case f.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case f.DOWN_ARROW:this._addShape([[0,
0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],c.x,c.y);break;case f.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case f.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case f.CIRCLE:this._clear();this._drawEnd(C.createCircle({center:c,r:48,numberOfPoints:60,map:a}));break;case f.ELLIPSE:this._clear(),this._drawEnd(C.createEllipse({center:c,longAxis:48,shortAxis:24,numberOfPoints:60,
map:a}))}this._setTooltipMessage(this._points.length)},_addShape:function(b,a,c){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(b,a,c))},_toPolygon:function(b,a,c){var f=this.map,d=new C(f.spatialReference);d.addRing(h.map(b,function(b){return f.toMap({x:b[0]+a,y:b[1]+c})}));return d},_onDblClickHandler:function(b){var a,c=this._points,f=this.map.spatialReference,d=B;n("esri-touch")&&c.push(b.mapPoint);var e=c[c.length-1],g=c[c.length-2],c=e&&g&&e.x===g.x&&e.y===g.y?c.slice(0,
c.length-1):c.slice(0,c.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>c.length){k.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(b);return}a=new A(f);a.addPath([].concat(c));break;case d.POLYGON:if(!this._graphic||2>c.length){k.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(b);return}a=new C(f);b=[].concat(c,[c[0].offset(0,0)]);!C.prototype.isClockwise(b)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+
" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());a.addRing(b);break;case d.MULTI_POINT:a=new w(f),h.forEach(c,function(b){a.addPoint(b)})}k.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_onKeyDownHandler:function(b){b.keyCode===g.ESCAPE&&(k.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(b){this._options.showTooltips&&(b?this._tooltip||
(this._tooltip=a.create("div",{"class":"tooltip"},this.map.container),r.isBodyLtr()||s.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=k.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=k.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=k.connect(this.map,"onMouseMove",this._updateTooltip)):
this._tooltip&&(k.disconnect(this._onTooltipMouseEnterHandler_connect),k.disconnect(this._onTooltipMouseLeaveHandler_connect),k.disconnect(this._onTooltipMouseMoveHandler_connect),a.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var b=this._tooltip;b&&(b.style.display="none")},_setTooltipMessage:function(b){var a=this._tooltip;if(a){var c="";switch(this._geometryType){case B.POINT:c=D.toolbars.draw.addPoint;break;case B.ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.UP_ARROW:case B.DOWN_ARROW:case B.TRIANGLE:case B.RECTANGLE:case B.CIRCLE:case B.ELLIPSE:c=
D.toolbars.draw.addShape;break;case B.LINE:case B.EXTENT:case B.FREEHAND_POLYLINE:case B.FREEHAND_POLYGON:c=D.toolbars.draw.freehand;break;case B.POLYLINE:case B.POLYGON:c=D.toolbars.draw.start;1===b?c=D.toolbars.draw.resume:2<=b&&(c=D.toolbars.draw.complete);break;case B.MULTI_POINT:c=D.toolbars.draw.addMultipoint,1<=b&&(c=D.toolbars.draw.finish)}a.innerHTML=c}},_updateTooltip:function(b){var a=this._tooltip;if(a){var c;b.clientX||b.pageY?(c=b.clientX,b=b.clientY):(c=b.clientX+l.body().scrollLeft-
l.body().clientLeft,b=b.clientY+l.body().scrollTop-l.body().clientTop);a.style.display="none";s.set(a,{left:c+this._options.tooltipOffset+"px",top:b+"px"});a.style.display=""}},_redrawGraphic:function(b,a,c,f){if(c||this.map.wrapAround180)(b=this._graphic)&&b.setGeometry(b.geometry),(b=this._tGraphic)&&b.setGeometry(b.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});e.mixin(B,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",
POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});return B})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(m,e,h,k,d){return m([d],{declaredClass:"esri.toolbars._Toolbar",constructor:function(d){this.map=
d},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(d,e,c,g){var a=this.map;d&&(this._mapNavState={isDoubleClickZoom:a.isDoubleClickZoom,isClickRecenter:a.isClickRecenter,isPan:a.isPan,isRubberBandZoom:a.isRubberBandZoom,isKeyboardNavigation:a.isKeyboardNavigation,isScrollWheelZoom:a.isScrollWheelZoom},a.disableDoubleClickZoom(),
a.disableClickRecenter(),a.disablePan(),a.disableRubberBandZoom(),a.disableKeyboardNavigation());e&&a.hideZoomSlider();c&&a.hidePanArrows();g&&a.graphics.disableMouseEvents()},_activateMapTools:function(d,e,c,g){var a=this.map,h=this._mapNavState;d&&h&&(h.isDoubleClickZoom&&a.enableDoubleClickZoom(),h.isClickRecenter&&a.enableClickRecenter(),h.isPan&&a.enablePan(),h.isRubberBandZoom&&a.enableRubberBandZoom(),h.isKeyboardNavigation&&a.enableKeyboardNavigation(),h.isScrollWheelZoom&&a.enableScrollWheelZoom());
e&&a.showZoomSlider();c&&a.showPanArrows();g&&a.graphics.enableMouseEvents()}})})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(m,e,h,k){return m([h],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,declaredClass:"jimu.dijit.URLInput",postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:
"Invalid Url"},postCreate:function(){this.inherited(arguments);e.addClass(this.domNode,"jimu-url-input")},validator:function(d){if(isFinite(d))return!1;var e="^"+k.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),e=RegExp(e,"g").test(d);return this.rest?(d=/\/rest\/services/gi.test(d),e&&d):e}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(m,e,h){var k=m.getObject("validate.regexp",!0,h);return k=h.validate.regexp={ipAddress:function(d){d=
"object"==typeof d?d:{};"boolean"!=typeof d.allowDottedDecimal&&(d.allowDottedDecimal=!0);"boolean"!=typeof d.allowDottedHex&&(d.allowDottedHex=!0);"boolean"!=typeof d.allowDottedOctal&&(d.allowDottedOctal=!0);"boolean"!=typeof d.allowDecimal&&(d.allowDecimal=!0);"boolean"!=typeof d.allowHex&&(d.allowHex=!0);"boolean"!=typeof d.allowIPv6&&(d.allowIPv6=!0);"boolean"!=typeof d.allowHybrid&&(d.allowHybrid=!0);var e=[];d.allowDottedDecimal&&e.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
d.allowDottedHex&&e.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");d.allowDottedOctal&&e.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");d.allowDecimal&&e.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");d.allowHex&&e.push("0[xX]0*[\\da-fA-F]{1,8}");d.allowIPv6&&e.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");d.allowHybrid&&e.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
d="";0<e.length&&(d="("+e.join("|")+")");return d},host:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowIP&&(d.allowIP=!0);"boolean"!=typeof d.allowLocal&&(d.allowLocal=!1);"boolean"!=typeof d.allowPort&&(d.allowPort=!0);"boolean"!=typeof d.allowNamed&&(d.allowNamed=!1);var e=d.allowPort?"(\\:\\d+)?":"",h="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";d.allowIP&&(h+="|"+k.ipAddress(d));d.allowLocal&&(h+="|localhost");
d.allowNamed&&(h+="|^[^-][a-zA-Z0-9_-]*");return"("+h+")"+e},url:function(d){d="object"==typeof d?d:{};"scheme"in d||(d.scheme=[!0,!1]);return e.buildGroupRE(d.scheme,function(d){return d?"(https?|ftps?)\\://":""})+k.host(d)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowCruft&&(d.allowCruft=!1);d.allowPort=!1;var e="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+k.host(d);
d.allowCruft&&(e="\x3c?(mailto\\:)?"+e+"\x3e?");return e},emailAddressList:function(d){d="object"==typeof d?d:{};"string"!=typeof d.listSeparator&&(d.listSeparator="\\s;,");var e=k.emailAddress(d);return"("+e+"\\s*["+d.listSeparator+"]\\s*)*"+e+"\\s*["+d.listSeparator+"]?\\s*"},numberFormat:function(d){d="object"==typeof d?d:{};"undefined"==typeof d.format&&(d.format="###-###-####");return e.buildGroupRE(d.format,function(d){return e.escapeString(d,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},
ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowTerritories&&(d.allowTerritories=!0);"boolean"!=typeof d.allowMilitary&&(d.allowMilitary=!0);var e="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";d.allowTerritories&&(e+="|AS|FM|GU|MH|MP|PW|PR|VI");
d.allowMilitary&&(e+="|AA|AE|AP");return"("+e+")"}}}})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(m,e,h,k,d,l,n,c,g){return m([n,l],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(h.removeClass(this.foldableNode,"fold-up"),h.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(h.removeClass(this.foldableNode,"fold-down"),h.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation();"touchstart"===a.type&&a.preventDefault()},_normalizePositionObj:function(a){var c=
this._getLayoutBox();a.left=isFinite(a.left)?a.left:c.w-a.right;a.top=isFinite(a.top)?a.top:c.h-a.bottom;delete a.right;delete a.bottom;this.position=e.mixin(e.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new g({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(a,c){this.disableMoveable();var g=h.getMarginBox(jimuConfig.layoutId);g.l=g.l-a+c;g.w+=2*(a-c);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:g,handle:this.titleNode,within:!0});this.own(k(this.moveable,
"Moving",e.hitch(this,this.onMoving)));this.own(k(this.moveable,"MoveStop",e.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){h.removeClass(this.titleNode,"title-normal");h.addClass(this.titleNode,"title-full");h.setStyle(this.foldableNode,"display",
"block");h.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(h.removeClass(this.foldableNode,"fold-up"),h.addClass(this.foldableNode,"fold-down")):(h.removeClass(this.foldableNode,"fold-down"),h.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){h.removeClass(this.titleNode,"title-full");h.addClass(this.titleNode,"title-normal");h.setStyle(this.foldableNode,"display","none");h.setStyle(this.maxNode,"display","none")},resize:function(a){var c=this._getPositionInfo(),
d={left:c.position.left,top:c.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,d.left=isFinite(a.l)?a.l:d.left,d.top=isFinite(a.t)?a.t:d.top,d.width=isFinite(a.w)?a.w:d.width,d.height=isFinite(a.h)?a.h:d.height,this._normalizePositionObj(e.clone(d)),this.makePositionInfoBox(),d.width=this._positionInfoBox.w,d.height=this._positionInfoBox.h);c.position=d;this._onResponsible(c);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return h.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},c=this._getLayoutBox(),d=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;a.position.left=window.isRTL?c.w-d:d;var d=this._positionInfoBox.t,e=c.h-d;d>=e?d>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):e>=this._positionInfoBox.h&&(a.position.top=
this._positionInfoBox.t+40+3);!a.isRunInMobile&&a.position.left+this._positionInfoBox.w>c.w&&(a.position.left-=this._positionInfoBox.w);return a},_setMobilePosition:function(){window.appInfo.isRunInMobile&&(this.domNode&&this.domNode.parentNode!==h.byId(jimuConfig.layoutId))&&h.place(this.domNode,jimuConfig.layoutId);var a=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(a.zIndex=this.position.zIndex);var d=c.getPositionStyle(a);e.mixin(d,a.borderRadiusStyle);h.setStyle(this.domNode,
d)},_setDesktopPosition:function(a){!window.appInfo.isRunInMobile&&(this.domNode&&this.domNode.parentNode!==h.byId(jimuConfig.mapId))&&h.place(this.domNode,jimuConfig.mapId);h.setStyle(this.domNode,{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){h.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){h.setStyle(a.node,"opacity",1);a=h.getMarginBox(a.node);
this._normalizePositionObj(e.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b){m.experimental("dojox.layout.ResizeHandle");
var v=q("dojox.layout._ResizeHelper",t,{show:function(){r.set(this.domNode,"display","")},hide:function(){r.set(this.domNode,"display","none")},resize:function(b){s.setMarginBox(this.domNode,b)}});return q("dojox.layout.ResizeHandle",[t,b],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,
startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,f.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=p.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(n.body()),a.add(this._resizeHelper.domNode,this.activeResizeClass)));
this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var b=e.partial(a.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;b("dojoxResizeNW");break;case "x":this._resizeX=!0;b("dojoxResizeW");break;case "y":this._resizeY=!0,b("dojoxResizeN")}},_beginSizing:function(b){if(!this._isSizing&&(h.publish(this.startTopic,[this]),this.targetDomNode=
(this.targetWidget=p.byId(this.targetId))?this.targetWidget.domNode:g.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var a=s.position(this.targetDomNode,!0);this._resizeHelper.resize({l:a.x,t:a.y,w:a.w,h:a.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:a.x,t:a.y})}this._isSizing=!0;this.startPoint={x:b.clientX,y:b.clientY};var a=r.getComputedStyle(this.targetDomNode),c="border-model"===
s.boxModel?{w:0,h:0}:s.getPadBorderExtents(this.targetDomNode,a),e=s.getMarginExtents(this.targetDomNode,a);this.startSize={w:r.get(this.targetDomNode,"width",a),h:r.get(this.targetDomNode,"height",a),pbw:c.w,pbh:c.h,mw:e.w,mh:e.h};!this.isLeftToRight()&&"absolute"==r.get(this.targetDomNode,"position")&&(a=s.position(this.targetDomNode,!0),this.startPosition={l:a.x,t:a.y});this._pconnects=[h.connect(n.doc,f.move,this,"_updateSizing"),h.connect(n.doc,f.release,this,"_endSizing")];d.stop(b)}},_updateSizing:function(b){if(this.activeResize)this._changeSizing(b);
else{var a=this._getNewCoords(b,"border",this._resizeHelper.startPosition);if(!1===a)return;this._resizeHelper.resize(a)}b.preventDefault()},_getNewCoords:function(b,a,c){try{if(!b.clientX||!b.clientY)return!1}catch(f){return!1}this._activeResizeLastEvent=b;var d=(this.isLeftToRight()?1:-1)*(this.startPoint.x-b.clientX),e=this.startPoint.y-b.clientY;b=this.startSize.w-(this._resizeX?d:0);e=this._checkConstraints(b,this.startSize.h-(this._resizeY?e:0));if((c=c||this.startPosition)&&this._resizeX)e.l=
c.l+d,e.w!=b&&(e.l+=b-e.w),e.t=c.t;switch(a){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(b,a){if(this.minSize){var c=this.minSize;b<c.w&&(b=c.w);a<c.h&&(a=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,b>c.w&&(b=c.w),a>c.h&&(a=c.h));if(this.fixedAspect){var c=this.startSize.w,f=this.startSize.h,d=c*a-f*b;0>d?b=a*c/f:0<d&&(a=b*f/c)}return{w:b,h:a}},_changeSizing:function(b){var a=
this.targetWidget&&e.isFunction(this.targetWidget.resize),f=this._getNewCoords(b,a&&"margin");if(!1!==f&&(a?this.targetWidget.resize(f):this.animateSizing?c[this.animateMethod]([l.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:f.w}},duration:this.animateDuration}),l.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:f.h}},duration:this.animateDuration})]).play():r.set(this.targetDomNode,{width:f.w+"px",height:f.h+"px"}),
this.intermediateChanges))this.onResize(b)},_endSizing:function(b){k.forEach(this._pconnects,h.disconnect);var a=e.partial(h.publish,this.endTopic,[this]);this.activeResize?a():(this._resizeHelper.hide(),this._changeSizing(b),setTimeout(a,this.animateDuration+15));this._isSizing=!1;this.onResize(b)},onResize:function(b){}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define(["dojo/_base/declare","dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(m,e,h,
k,d){return m(k,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},getExtent:function(){var d=[],k;e.forEach(this.originOperLayer.featureCollection.layers,function(c){d=d.concat(c.layerObject.graphics)});0===d.length?k=null:(k=1===d.length?d[0].getLayer().fullExtent:h.graphicsExtent(d),k=this._convertGeometryToMapSpatialRef(k));return k},_resetLayerObjectVisiblity:function(d){var h=d?d[this.id]:null;h&&(e.forEach(this.newSubLayers,
function(c){var e=d?d[c.id]:null;e&&c.layerObject.setVisibility(e.visible)},this),this._setTopLayerVisible(h.visible))},initVisible:function(){var d=!1,e;for(e=0;e<this.newSubLayers.length;e++)d=d||this.newSubLayers[e].layerObject.visible;d&&(this._visible=!0)},_setTopLayerVisible:function(d){this._visible=d?!0:!1;e.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var h=[];e.forEach(this.originOperLayer.featureCollection.layers,
function(e){this._getLayerIndexesInMapByLayerId(e.layerObject.id)&&(e=d.getInstance().create({layerObject:e.layerObject,title:e.layerObject.label||e.layerObject.title||e.layerObject.name||e.layerObject.id||" ",id:e.id||" ",collection:{layerInfo:this},selfType:"collection",showLegend:e.showLegend,parentLayerInfo:this}),h.push(e),e.init())},this);h.reverse();return h},_obtainLayerIndexesInMap:function(){var d=[],e,c;for(c=0;c<this.newSubLayers.length;c++)(e=this._getLayerIndexesInMapByLayerId(this.newSubLayers[c].layerObject.id))&&
d.push(e);return d},moveLeftOfIndex:function(d){var e;for(e=this.newSubLayers.length-1;0<=e;e--)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)},moveRightOfIndex:function(d){var e;for(e=0;e<this.newSubLayers.length;e++)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getScaleRange:function(){var d=this.getSubLayers();return d[0]?
d[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect esri/config esri/tasks/ProjectParameters esri/SpatialReference esri/geometry/webMercatorUtils".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r){return m(null,{originOperLayer:null,layerObject:null,map:null,title:null,id:null,newSubLayers:null,parentLayerInfo:null,_oldIsShowInMap:null,
_oldFilter:null,_eventHandles:null,constructor:function(a,c){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=c;this.title=this.originOperLayer.title;this.id=this.originOperLayer.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.nls=window.jimuNls.layerInfosMenu;this._eventHandles=[]},init:function(){this.newSubLayers=this.obtainNewSubLayers();this.initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();
this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getExtent:function(){},getOpacity:function(){var a,c=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)c=this.newSubLayers[a].layerObject.opacity>c?this.newSubLayers[a].layerObject.opacity:c;else return 1;return c},setOpacity:function(a){e.forEach(this.newSubLayers,
function(c){c.layerObject.setOpacity&&c.layerObject.setOpacity(a)})},moveLayerByIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var c=this.getSubLayers(),d=0;d<c.length;d++)if(c[d].traversal(a))return!0},findLayerInfoById:function(a){var c=null,d=0;if(this.id&&this.id===a)return this;for(d=0;d<this.newSubLayers.length&&!(c=this.newSubLayers[d].findLayerInfoById(a));d++);return c},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},
_setTopLayerVisible:function(a){},setSubLayerVisible:function(a,c){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var c=a?a[this.id]:null;this.isRootLayer&&c&&this._resetLayerObjectVisiblity(a)},initVisible:function(){},isVisible:function(){return this._visible?!0:!1},_obtainLayerIndexesInMap:function(){var a=[],c;(c=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(c);return a},_getLayerIndexesInMapByLayerId:function(a){var c;
for(c=0;c<this.map.graphicsLayerIds.length;c++)if(this.map.graphicsLayerIds[c]===a)return{isGraphicLayer:!0,index:c};for(c=0;c<this.map.layerIds.length;c++)if(this.map.layerIds[c]===a)return{isGraphicLayer:!1,index:c};return null},_convertGeometryToMapSpatialRef:function(c){var f=new k;if(this.map.spatialReference.equals(c.spatialReference))return f.resolve([c]),f;if(this.map.spatialReference.isWebMercator()&&c.spatialReference.equals(new s(4326)))return f.resolve([r.geographicToWebMercator(c)]),
f;if(this.map.spatialReference.equals(new s(4326))&&c.spatialReference.isWebMercator())return f.resolve([r.webMercatorToGeographic(c)]),f;f=new a;f.geometries=[c];f.outSR=this.map.spatialReference;return g.defaults.geometryService.project(f)},_isShowInMapChanged:function(){var a=!1,c=this.isShowInMap();!1===c&&this.map.infoWindow.hide();this._oldIsShowInMap!==c&&(this._oldIsShowInMap=c,a=!0);return a},_isShowInMapChanged2:function(){var a=[];this.traversal(function(c){c._isShowInMapChanged()&&a.push(c)});
n.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){n.publish("layerInfos/layerInfo/visibleChanged",[this])},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return l.create("div",{"class":"legends-div"})},drawLegends:function(a,c){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_isItemLayer:function(){return this.originOperLayer.itemId||this.layerObject._itemId},
_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},getLayerObject:function(){var a=new k;this.layerObject?a.resolve(this.layerObject):a.reject("layerObject is null");return a},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},
isShowInMap:function(){for(var a=!0,c=this;c;)a=a&&c.isVisible(),c=c.parentLayerInfo;return a},getLayerType:function(){var a=[null],c=new k;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));c.resolve(a[a.length-1]);return c},getPopupInfo:function(){return this.originOperLayer.popupInfo},loadInfoTemplate:function(){var a=new k;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:
null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=this,c=!0;a;)c=c&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return c},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new k,c={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},e=this.getLayerType(),g=this.getLayerObject();d({type:e,layerObject:g}).then(h.hitch(this,function(b){var d=b.type;b=b.layerObject;
c.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(c.isSupportedLayer=!0);if(b)if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())c.isSupportQuery=!1;else{if(!b.url||b.capabilities&&0<=b.capabilities.indexOf("Query"))c.isSupportQuery=!0}else c.isSupportQuery=!1;a.resolve(c)}),function(){a.resolve(c)});return a},getRelatedTableInfoArray:function(){var a=new k;a.resolve([]);return a},removeSubLayerById:function(a){var c=[];e.forEach(this.newSubLayers,function(d){d.id!==
a&&c.push(d)});this.newSubLayers=c},destroy:function(){e.forEach(this._eventHandles,function(a){a.remove()});this.inherited(arguments)},destroyLayerInfo:function(){e.forEach(this.newSubLayers,function(a){a.destroyLayerInfo()});this.destroy()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&
0<=this.layerObject.maxScale?{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},isCurrentScaleInTheScaleRange:function(){var a=this.getScaleRange(),c=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>c)&&(0===a.maxScale||c>a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,c=this;c&&!(a=c.isCurrentScaleInTheScaleRange(),c=c.parentLayerInfo,!a););return a},enablePopup:function(){},disablePopup:function(){},_bindEvent:function(){var a;
this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visibility-change",h.hitch(this,this._onVisibilityChanged)),this._eventHandles.push(a),a=c.after(this.layerObject,"setDefinitionExpression",h.hitch(this,this._onFilterChanged)),this._eventHandles.push(a),a=c.after(this.layerObject,"setRenderer",h.hitch(this,this._onRendererChanged)),this._eventHandles.push(a))},_onVisibilityChanged:function(){this.initVisible();this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=
this._oldFilter?this._oldFilter:null,c=this.layerObject.getDefinitionExpression(),c=c?c:null;a!==c&&(n.publish("layerInfos/layerInfo/filterChanged",[this]),this._oldFilter=c)},_onRendererChanged:function(){n.publish("layerInfos/layerInfo/rendererChanged",[this])}})})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang ./LayerInfoFactory".split(" "),function(m,
e,h,k,d,l,n,c,g,a,s){return m(c,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,constructor:function(a,c){this._initJsapiLayerInfos();this.initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup()},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},_initJsapiLayerInfos:function(){var c=e.filter(this.originOperLayer.layers,function(c){return a.isDefined(c.id)&&
a.isDefined(c.name)&&a.isDefined(c.minScale)&&a.isDefined(c.maxScale)&&a.isDefined(c.parentLayerId)&&a.isDefined(c.defaultVisibility)});this._jsapiLayerInfos=0<c.length?c:this.layerObject.layerInfos},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:h.clone(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=h.clone(this.layerObject.infoTemplates);l.after(this.layerObject,"setInfoTemplates",h.hitch(this,function(){this.layerObject._infoTemplates=h.clone(this.layerObject.infoTemplates);
this.controlPopupInfo.infoTemplates=h.clone(this.layerObject.infoTemplates);this.traversal(function(a){a._afterSetInfoTemplates&&a._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new k}},initSubLayerVisible:function(a){this.subLayerVisible={};for(var c=0;c<this._jsapiLayerInfos.length;c++)this.subLayerVisible[this._jsapiLayerInfos[c].id]=0;a?e.forEach(a,function(a){this.subLayerVisible[a]++},this):this.originOperLayer.visibleLayers?
e.forEach(this.originOperLayer.visibleLayers,function(a){this.subLayerVisible[a]++},this):e.forEach(this._jsapiLayerInfos,function(a){a.defaultVisibility&&this.subLayerVisible[a.id]++},this)},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent)},_resetLayerObjectVisiblity:function(c){var d=c?c[this.id]:null;if(c&&(d&&this.layerObject.setVisibility(d.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===
this.layerObject.declaredClass)){var f=!1,g=[];e.forEach(this._jsapiLayerInfos,function(b){var d=this.id+"_"+b.id;a.isDefined(c[d])&&(f=!0,c[d].visible&&g.push(b.id))},this);if(f){this.initSubLayerVisible(g);this.traversal(function(a){a.initVisible()});var h={};this.traversal(function(a){0===a.getSubLayers().length&&(h[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});this.setSubLayerVisible(h)}}},initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){this.originOperLayer.layerObject.setVisibility(a);
this._visible=a},setSubLayerVisible:function(a){var c=[-1,-1,-1],f,d=[],g=e.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});e.forEach(g,function(a){this._isGroupLayerBySubId(a)||d.push(a)},this);var g=d,b;for(b in a)if(a.hasOwnProperty(b)&&"function"!==typeof a[b]){var h=Number(b);a[b]?(f=e.indexOf(g,h),0>f&&g.push(h)):(f=e.indexOf(g,h),0<=f&&g.splice(f,1))}c=c.concat(g);this.originOperLayer.layerObject.setVisibleLayers(c)},obtainNewSubLayers:function(){var a=[],c=
this.originOperLayer.layerObject,f=null,f="esri.layers.ArcGISDynamicMapServiceLayer"===c.declaredClass?"dynamic":"tiled";e.forEach(this._jsapiLayerInfos,function(d){var b=null,b=c.url+"/"+d.id,e=c.id+"_"+d.id;d.subLayerIds&&0<d.subLayerIds.length?(b={url:b,empty:!0},this._addNewSubLayer(a,b,e,d,f+"_group")):(b={url:b,empty:!0},this._addNewSubLayer(a,b,e,d,f))},this);var d=[];e.forEach(this._jsapiLayerInfos,function(c,b){var f=c.parentLayerId;if(-1!==f){for(var d=null,e=0;e<a.length;e++)if(a[e].mapService.subId===
f){d=a[e];break}(f=d)&&f.subLayers.push(a[b])}},this);e.forEach(this._jsapiLayerInfos,function(c,b){var f;-1===c.parentLayerId&&(f=s.getInstance().create(a[b]),d.push(f),f.init())},this);return d},_addNewSubLayer:function(a,c,f,d,e){a.push({layerObject:c,title:d.name||d.id||" ",id:f||" ",subLayers:[],mapService:{layerInfo:this,subId:d.id},selfType:"mapservice_"+e,parentLayerInfo:this})},_handleErrorSubLayer:function(a,c,f,d,e,b){a[c]={layerObject:null,title:b.name||b.id||" ",id:f||" ",subLayers:[],
mapService:{layerInfo:this,subId:d}}},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},getLegendInfo:function(a){var c=new k;this._legendInfo?c.resolve(this._legendInfo):this._legendRequest(a).then(h.hitch(this,function(a){this._legendInfo=a.layers;c.resolve(this._legendInfo)}),function(){c.reject()});return c},_legendRequest:function(a){return 10.01<=this.layerObject.version?this._legendRequestServer():
this._legendRequestTools(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",c={f:"json"};this.layerObject._params.dynamicLayers&&(c.dynamicLayers=d.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));return g({url:a,content:c,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(a){return g({url:a+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},
_createDynamicLayers:function(a){var c=[],f;e.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){f={id:d.id};f.source=d.source&&d.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(f.definitionExpression=e);var b;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(b=a.layerDrawingOptions[d.id]);b&&(f.drawingInfo=b.toJson());f.minScale=d.minScale||0;f.maxScale=d.maxScale||0;c.push(f)});return c},_getLayerDefinition:function(){var a=new k;this._request(this.layerObject.url).then(h.hitch(this,
function(c){a.resolve(c)}),function(c){console.error(c.message||c);a.resolve(null)});return a},_getSublayerDefinition:function(a){var c;this._sublayerIdent.definitions[a]?(c=new k,c.resolve(this._sublayerIdent.definitions[a])):c=this._layerAndTableRequest(a);return c},_layerAndTableRequest:function(a){return 10.11<=this.layerObject.version?this._allLayerAndTableServer(a):this._allLayerAndTable(a)},_allLayerAndTableServer:function(a){var c=new k,f=this.layerObject.url+"/layers";this._sublayerIdent.empty?
(this._sublayerIdent.empty=!1,this._request(f).then(h.hitch(this,function(f){e.forEach(f.layers,function(a){this._sublayerIdent.definitions[a.id]=a},this);this._sublayerIdent.defLoad.resolve();c.resolve(this._sublayerIdent.definitions[a])}),h.hitch(this,function(a){console.error(a.message||a);this._sublayerIdent.defLoad.reject();this._sublayerIdent.defLoad=new k;this._sublayerIdent.empty=!0;c.resolve(null)}))):this._sublayerIdent.defLoad.then(h.hitch(this,function(){c.resolve(this._sublayerIdent.definitions[a])}),
function(a){console.error(a.message||a);c.resolve(null)});return c},_allLayerAndTable:function(a){var c=new k;this._request(this.layerObject.url+"/"+a).then(h.hitch(this,function(f){this._sublayerIdent.definitions[a]=f;c.resolve(f)}),function(a){console.error(a.message||a);c.resolve(null)});return c},_request:function(a){return g({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_getSublayerSettingOfWebmap:function(a){var c=e.filter(this.originOperLayer.layers,function(c){return c.id===
a});return 1===c.length?c[0]:null},_getSublayerShowLegendOfWebmap:function(a){return(a=this._getSublayerSettingOfWebmap(a))?void 0!==a.showLegend?a.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(a){return null===this._getJsapiLayerInfoById(a)?!1:!0},_getJsapiLayerInfoById:function(a){for(var c=null,f=0;f<this._jsapiLayerInfos.length;f++)this._jsapiLayerInfos[f].id===a&&(c=this._jsapiLayerInfos[f]);return c},_isGroupLayerBySubId:function(a){return(a=this._getJsapiLayerInfoById(a))&&a.subLayerIds&&
0<a.subLayerIds.length?!0:!1},_subLayerVisibleChanged:function(){var a=[];this.traversal(function(c){a.push(c)});n.publish("layerInfos/layerInfo/visibleChanged",a)},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visible-layers-change",h.hitch(this,this._onVisibleLayersChanged)),this._eventHandles.push(a),a=l.after(this.layerObject,"setLayerDefinitions",h.hitch(this,this._onFilterChanged)),this._eventHandles.push(a))},_onVisibleLayersChanged:function(a){var c=
a.visibleLayers;if(-1===c[0]&&-1===c[1]&&-1===c[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{a=[];var f=[-1,-1,-1],c=this._converVisibleLayers(c);a=c.visibleLayersForUpdateSubLayerVisible;f=f.concat(c.visibleLayersForSetVisibleLayers);this.initSubLayerVisible(a);this.traversal(function(a){a.initVisible()});this.layerObject.setVisibleLayers(f)}},_converVisibleLayers:function(a){var c={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};e.forEach(a,function(c){var d=
this.findLayerInfoById(this.id+"_"+c);if(this._isGroupLayerBySubId(c))d.traversal(function(c){a.push(c.originOperLayer.mapService.subId)});else for(;d&&d.originOperLayer.mapService;)a.push(d.originOperLayer.mapService.subId),d=d.parentLayerInfo},this);e.forEach(a,function(a){0>c.visibleLayersForUpdateSubLayerVisible.indexOf(a)&&c.visibleLayersForUpdateSubLayerVisible.push(a)},this);e.forEach(c.visibleLayersForUpdateSubLayerVisible,function(a){this._isGroupLayerBySubId(a)||c.visibleLayersForSetVisibleLayers.push(a)},
this);return c},_onFilterChanged:function(){for(var a,c=[],d=this.layerObject.layerDefinitions,e=d.length>this._oldFilter.length?d.length:this._oldFilter.length,g=0;g<e;g++)if((d[g]?d[g]:null)!==(this._oldFilter[g]?this._oldFilter[g]:null))(a=this.findLayerInfoById(this.id+"_"+g))&&a.isLeaf()&&c.push(a);0<c.length&&(n.publish("layerInfos/layerInfo/filterChanged",c),this._oldFilter=d)}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefault ./LayerInfoFactory dojo/Deferred".split(" "),
function(m,e,h,k,d,l,n,c,g){return m(l,{constructor:function(){},getExtent:function(){var a=this.originOperLayer.layerObject.getLayers(),c=null,d;e.forEach(a,function(a){d=this._convertGeometryToMapSpatialRef(a.initialExtent);c=c?c.union(d):d},this);return c},_resetLayerObjectVisiblity:function(a){var c=a?a[this.id]:null;c&&(e.forEach(this.newSubLayers,function(c){var d=a?a[c.id]:null;d&&c.layerObject.setVisibility(d.visible)},this),this._setTopLayerVisible(c.visible))},initVisible:function(){var a=
!1,c;for(c=0;c<this.newSubLayers.length;c++)a=a||this.newSubLayers[c].layerObject.visible;a&&(this._visible=!0)},_setTopLayerVisible:function(a){this._visible=a?!0:!1;e.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var a=[],d=this.originOperLayer.layerObject.getLayers();e.forEach(d,function(d){this._getLayerIndexesInMapByLayerId(d.id)&&(d=c.getInstance().create({layerObject:d,title:d.label||d.title||d.name||
d.id||" ",id:d.id||" ",collection:{layerInfo:this},selfType:"kml",parentLayerInfo:this}),a.push(d),d.init())},this);return a}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo ./LayerInfos dojox/gfx dojo/dom-construct dojo/dom-attr dojo/aspect jimu/portalUrlUtils jimu/utils esri/symbols/jsonUtils esri/dijit/PopupTemplate esri/dijit/Legend".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p){var t=m(d,{_legendsNode:null,
controlPopupInfo:null,constructor:function(){this._initControlPopup()},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},_getLayerOptionsForCreateLayerObject:function(){var a={},c=[],d=this.getInfoTemplate();d&&d.info&&d.info.fieldInfos?e.forEach(d.info.fieldInfos,function(a){a.visible&&c.push(a.fieldName)},this):c=["*"];a.outFields=c;return a},getExtent:function(){var a=this.originOperLayer.layerObject.fullExtent||
this.originOperLayer.layerObject.initialExtent;if(a)return this._convertGeometryToMapSpatialRef(a);a=new k;a.resolve(null);return a},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=this.layerObject.visible)},initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,c=this.layerObject.visible;if(a._oldIsShowInMap!==
a.isShowInMap())return;this._visible=c?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;a.after(this.layerObject,"setInfoTemplate",h.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=
this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}))},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?
this._visible&&this.layerObject.show():this.layerObject.hide()},createLegendsNode:function(){var a=c.create("div",{"class":"legends-div jimu-leading-margin1",legendsDivId:this.id},document.body);c.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},a);return a},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(a){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&
this.layerObject.loaded){c.empty(a);var d=new p({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:p.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},c.create("div",{},a));d.startup();a._legendDijit=d}},_initLegendsNode:function(a){var d=[],f=this.layerObject;if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length))c.empty(a),f.renderer&&(f.renderer.infos?d=h.clone(f.renderer.infos):d.push({label:f.renderer.label,
symbol:f.renderer.symbol}),f.renderer&&(f.renderer.defaultSymbol&&0<d.length)&&d.push({label:f.renderer.defaultLabel||"others",symbol:f.renderer.defaultSymbol}),e.forEach(d,function(d){d.legendDiv=c.create("div",{"class":"legend-div"},a);d.symbolDiv=c.create("div",{"class":"legend-symbol jimu-float-leading"},d.legendDiv);d.labelDiv=c.create("div",{"class":"legend-label jimu-float-leading",innerHTML:d.label||" "},d.legendDiv);if("textsymbol"===d.symbol.type)g.set(d.symbolDiv,"innerHTML",d.symbol.text);
else{var f=n.createSurface(d.symbolDiv,50,50);d=q.getShapeDescriptors(d.symbol);f.createShape(d.defaultShape).setFill(d.fill).setStroke(d.stroke).setTransform(n.matrix.translate(25,25))}},this))},obtainNewSubLayers:function(){var a=[];this.originOperLayer.subLayers&&0!==this.originOperLayer.subLayers.length&&e.forEach(this.originOperLayer.subLayers,function(c){c=new t(c,this.map);a.push(c);c.init()},this);return a},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},
setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},_getDefaultPopupTemplate:function(a){var c=null;if(a&&a.fields){var d={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]};e.forEach(a.fields,function(c){if(c.name!==a.objectIdField&&"globalid"!==c.name.toLowerCase()&&"shape"!==c.name.toLowerCase()){var f=r.getDefaultPortalFieldInfo(c);f.visible=!0;f.isEditable=c.editable;d.fieldInfos.push(f)}});c=new f(d)}return c},enablePopup:function(){this.controlPopupInfo.enablePopup=
!0;this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},loadInfoTemplate:function(){var a=new k;this.controlPopupInfo.infoTemplate||(this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject));a.resolve(this.controlPopupInfo.infoTemplate);return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedUrls:function(a){var c=[];if(!a||!a.url||
!a.relationships)return c;var d=a.url.lastIndexOf("/"),f=a.url.slice(0,d);e.forEach(a.relationships,function(a){c.push(f+"/"+a.relatedTableId.toString())},this);return c},getRelatedTableInfoArray:function(){var a=[],c=new k;this.getLayerObject().then(h.hitch(this,function(d){var f=this._getRelatedUrls(d);0!==f.length&&l.getInstanceSync().traversalAll(h.hitch(this,function(c){var d=-1;if(0===f.length)return!0;e.forEach(f,function(f,e){h.getObject("layerObject.url",!1,c)&&s.removeProtocol(f.toString().toLowerCase())===
s.removeProtocol(c.layerObject.url.toString().toLowerCase())&&(a.push(c),d=e)},this);0<=d&&f.splice(d,1);return!1}));c.resolve(a)}),h.hitch(this,function(){c.resolve(a)}));return c},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(a){this.layerObject&&(!this.layerObject.empty&&this.layerObject.setDefinitionExpression)&&this.layerObject.setDefinitionExpression(a)}});return t})},
"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z,A,C,w,F,D,B,G,I,K,Q,N,O,J,H,P,L,M,E){var y=e([M,b],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new n([64,64,64]),defaultText:"Aa",sizeRampLightColor:new n([255,255,255]),sizeRampDarkColor:new n([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,
_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){h.mixin(this,E.widgets.legend);this._i18n=E.widgets.legend;a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?!1:!0,this.arrangement=a.arrangement===y.ALIGN_RIGHT?y.ALIGN_RIGHT:y.ALIGN_LEFT,this.arrangement===y.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=
[],this.hideLayersInLegend={},this.refresh=c(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],m.locale&&-1!==m.locale.indexOf(c)&&(-1!==m.locale.indexOf("-")?-1!==m.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=
this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>g("ie")&&(this._repaintItems=h.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?
(this.layerInfos=a,this.layers=[],k.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=
this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)f.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],k.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,
this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];k.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==
c.declaredClass&&(d=c.getLayers(),k.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(d=c.getFeatureLayers(),k.forEach(d,function(a){b.push(a.id)},this))},this);k.forEach(this.map.graphicsLayerIds,function(c){var d=this.map.getLayer(c);-1==k.indexOf(a,c)&&-1==k.indexOf(b,c)&&(this._isSupportedLayerType(d)&&d._params&&d._params.drawMode)&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},
_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=d.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=d.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=d.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=d.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),k.forEach(this.layers,function(a){var b={};b.ovcConnect=d.connect(a,"onVisibilityChange",
this,"_refreshLayers");b.oocConnect=d.connect(a,"onOpacityChange",this,"_refreshLayers");b.oscConnect=d.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(b.odcConnect=d.connect(a,"_onDynamicLayersChange",h.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(b.oirConnect=d.connect(a,"onRenderingChange",h.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass&&(b.oivrConnect=d.connect(a,"onRendererChange",h.hitch(this,"_refreshLayers")));this.layerConnects[a.id]=b},this))},_deactivate:function(){this._ozeConnect&&d.disconnect(this._ozeConnect);this._olaConnect&&d.disconnect(this._olaConnect);this._olroConnect&&d.disconnect(this._olroConnect);this._olrConnect&&d.disconnect(this._olrConnect);k.forEach(this.layers,function(a){a=this.layerConnects[a.id]||{};a.ovcConnect&&d.disconnect(a.ovcConnect);a.oocConnect&&d.disconnect(a.oocConnect);a.oscConnect&&
d.disconnect(a.oscConnect);a.odcConnect&&d.disconnect(a.odcConnect);a.oirConnect&&d.disconnect(a.oirConnect);a.oivrConnect&&d.disconnect(a.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];k.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&
this.layers.push(a)},this);k.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1,b=!1;p.set(this.domNode,"position","relative");f.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var c=[];k.forEach(this.layers,function(e){if("esri.layers.KMLLayer"==e.declaredClass||"esri.layers.GeoRSSLayer"==
e.declaredClass){var g;e.loaded?("esri.layers.KMLLayer"==e.declaredClass?g=e.getLayers():"esri.layers.GeoRSSLayer"==e.declaredClass&&(g=e.getFeatureLayers(),this.hideLayersInLegend[e.id]&&(g=k.filter(g,function(a){return-1==k.indexOf(this.hideLayersInLegend[e.id],a.id)},this))),k.forEach(g,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&e._titleForLegend&&(a._titleForLegend=e._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==
a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),c.push(a))},this)):d.connect(e,"onLoad",h.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===e.declaredClass)if(e.loaded){if((!this._respectVisibility||this._respectVisibility&&e.visible)&&0<e.layerInfos.length&&k.some(e.layerInfos,function(a){return a.legendURL})){var p=!1;k.forEach(e.layerInfos,function(b){b.legendURL&&-1<k.indexOf(e.visibleLayers,
b.name)&&(p||(f.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(e._titleForLegend||e.name||e.id)+"\x3c/span\x3e"},this.domNode),p=!0),f.create("div",{innerHTML:"\x3cimg src\x3d'"+b.legendURL+"'/\x3e"},this.domNode),a=!0)},this)}}else d.connect(e,"onLoad",h.hitch(this,function(){this.refresh(this.layerInfos)}));else"esri.layers.WFSLayer"===e.declaredClass&&!e.renderer?(g=f.create("div",{id:this.id+"_"+e.id,"class":"esriLegendService"}),f.create("span",{innerHTML:this._getServiceTitle(e),
"class":"esriLegendServiceLabel"},f.create("td",{align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},g))))),f.place(g,this.id,"first"),tableNode=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),tableBody=f.create("tbody",{},tableNode),"esriGeometryComplex"===e.geometryType?(this._buildRow_Renderer(e,e._pointSymbol,null,this.NLS_points,null,tableBody),this._buildRow_Renderer(e,e._lineSymbol,null,this.NLS_lines,null,tableBody),
this._buildRow_Renderer(e,e._polygonSymbol,null,this.NLS_areas,null,tableBody)):"esriGeometryPoint"===e.geometryType?this._buildRow_Renderer(e,e._pointSymbol,null,"",null,tableBody):"esriGeometryPolyline"===e.geometryType?this._buildRow_Renderer(e,e._lineSymbol,null,"",null,tableBody):"esriGeometryPolygon"===e.geometryType&&this._buildRow_Renderer(e,e._polygonSymbol,null,"",null,tableBody),b=!0):c.push(e)},this);var e=[];k.forEach(c,function(a){if(a.loaded){if((!this._respectVisibility||this._respectVisibility&&
a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=f.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});f.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},f.create("td",{align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},b)))));f.place(b,this.id,"first");a.legendResponse||a.renderer?this._createLegendForLayer(a):e.push(this._legendRequest(a))}}else var c=
d.connect(a,"onLoad",this,function(a){d.disconnect(c);c=null;this.refresh()})},this);0===e.length&&!a&&!b?(q.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new s(e)).addCallback(h.hitch(this,function(c){!a&&!b?q.byId(this.id+"_msg").innerHTML=this.NLS_noLegend:q.byId(this.id+"_msg").innerHTML="";this._activate()}))},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var b=!1;if(a.legendResponse){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?k.forEach(c,function(c,
d){if(!this.hideLayersInLegend[a.id]||-1==k.indexOf(this.hideLayersInLegend[a.id],c.id)){var f=this._buildLegendItems(a,c,d);b=b||f}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(p.set(q.byId(this.id+"_"+a.id),
"display","block"),p.set(q.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);d.connect(a,"onLoad",h.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a._getToken())&&(b+="?token\x3d"+c);var d=h.hitch(this,"_processLegendResponse"),f={f:"json"};a._params.dynamicLayers&&(f.dynamicLayers=
r.stringify(this._createDynamicLayers(a)),"[{}]"===f.dynamicLayers&&(f.dynamicLayers="[]"));a._params.bandIds&&(f.bandIds=a._params.bandIds);a._params.renderingRule?f.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&k.forEach(a.rasterFunctionInfos,function(a){a&&(a.name&&"none"===a.name.toLowerCase())&&(f.renderingRule=r.stringify({rasterFunction:a.name}))});return C({url:b,content:f,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:A.defaults.io.errorHandler})},
_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!g("ie")||8<g("ie"))b+="\x26returnbytes\x3dtrue";var c=h.hitch(this,"_processLegendResponse");return C({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,d){c(a,b,d)},error:A.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,q.byId(this.id+"_"+a.id)&&
f.empty(q.byId(this.id+"_"+a.id)),f.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},f.create("td",{align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},q.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+l.toJson(b))},_buildLegendItems:function(a,b,c){var d=!1,e=q.byId(this.id+"_"+a.id),g=b.parentLayerId;if(b.subLayerIds)a=f.create("div",{id:this.id+"_"+a.id+
"_"+b.id+"_group",style:{display:"none"},"class":-1==g?0<c?"esriLegendGroupLayer":"":this._legendAlign},-1==g?e:q.byId(this.id+"_"+a.id+"_"+g+"_group")),f.create("td",{innerHTML:x.encode(b.name),align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+b.id+","))return d;c=f.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<
g?this._legendAlign:""},-1==g?e:q.byId(this.id+"_"+a.id+"_"+g+"_group"));f.create("td",{innerHTML:x.encode(b.name)||"",align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%","class":"esriLegendLayerLabel"},c))));a.legendResponse?d=d||this._buildLegendItems_Tools(a,b,c):a.renderer&&(d=d||this._buildLegendItems_Renderer(a,b,c))}return d},_buildLegendItems_Tools:function(a,b,c){var d=b.parentLayerId,e=this.map.getScale(),g=!1,h=function(a,b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=
0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,b,e)){var l=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var n=this._getEffectiveScale(a,b);if(n.minScale&&n.minScale<e||n.maxScale&&n.maxScale>e)l=!1}if(l){var e=
h(a.legendResponse.layers,b),r=e.legendType,m=e.layerType,s=e.legend;if(s){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,e,b);c=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);var v=f.create("tbody",{},c);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(c,a,b);k.forEach(s,function(c){if(!(10.1<=a.version&&!c.values&&1<s.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===c.label||!c.label&&!("esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.3<=a.version||"Raster Layer"===m))))if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)g=!0,this._buildRow_Tools(c,v,a,b.id,r)},this)}}}g&&(p.set(q.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(p.set(q.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,a,d)));return g},_sanitizeLegendResponse:function(a,b,c){var d=b.legend;if(10.1<=a.version&&1<d.length&&!b._sanitized){a=h.getObject("layerDefinition.drawingInfo.renderer",
!1,c);var f,e;a||(a=h.getObject("drawingInfo.renderer",!1,c));k.some(d,function(a){if(a.values)return!0})&&k.some(d,function(a,b){a.values||(e=b,f=a);return!!f});a?"uniqueValue"===a.type?f&&(d.splice(e,1),d.push(f)):"classBreaks"===a.type&&(f&&d.splice(e,1),d.reverse(),f&&d.push(f)):f&&(d.splice(e,1),d.push(f));b._sanitized=!0}},_buildRow_Tools:function(a,b,c,d,e){var h=f.create("tr",{},b),k;this.alignRight?(b=f.create("td",{align:this._isRightToLeft?"left":"right"},h),k=f.create("td",{align:this._isRightToLeft?
"left":"right",width:35},h)):(k=f.create("td",{width:35,align:"center"},h),b=f.create("td",{},h));h=a.url;(!g("ie")||9<=g("ie")||9>g("ie")&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&a.imageData&&0<a.imageData.length?h="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(h=c.url+"/"+d+"/images/"+a.url,(d=c._getToken())&&(h+="?token\x3d"+d));d=f.create("img",{src:h,border:0,style:"opacity:"+c.opacity},k);a=f.create("td",{innerHTML:x.encode(a.label),align:this._align},f.create("tr",
{},f.create("tbody",{},f.create("table",{width:"95%",dir:"ltr"},b))));e&&("Stretched"===e&&10.3<=c.version&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&(a.style.verticalAlign="top",a.style.lineHeight="1",d.style.marginBottom="-1px",d.style.display="block",b.style.verticalAlign="top");9>g("ie")&&(d.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getVariables:function(a,b,c){a=[this._getVariable(a,
"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?k.filter(a,function(a){return!(!a||!(a.field===b&&a.normalizationField==c))}):a},_getFieldAlias:function(a,b){var c=b.infoTemplate,c=c&&c.getFieldInfo&&c.getFieldInfo(a),d=h.isFunction(a)?null:b.getField(a),f=c||d,e="";f&&(e=c&&c.label||d&&d.alias||f.name||f.fieldName);return e},_getRampTitle:function(a,b){var c,d=a.field,f=a.normalizationField,e=!1,g=!1,k=!1,p,d=h.isFunction(d)?null:d,f=h.isFunction(f)?
null:f;if(a.legendOptions&&a.legendOptions.title)c=a.legendOptions.title;else{if(b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var l=b.renderer.authoringInfo.visualVariables;for(p=0;p<l.length;p++){var q=l[p];if("colorInfo"===q.type&&"ratio"===q.style){e=!0;break}else if("colorInfo"===q.type&&"percent"===q.style){g=!0;break}else if("colorInfo"===q.type&&"percentTotal"===q.style){k=!0;break}}}(e=k&&"showRatioPercentTotal"||g&&"showRatioPercent"||e&&"showRatio"||f&&"showNormField"||
d&&"showField"||null)&&(c=w.substitute({field:d&&this._getFieldAlias(d,b),normField:f&&this._getFieldAlias(f,b)},this._i18n[e]))}return c},_getRendererTitle:function(a,b){var c;if(a){var d,f,e;a instanceof I&&(d=a.attributeField,f=a.normalizationField,e="percent-of-total"===a.normalizationType);d=h.isFunction(d)?null:d;(e=(f=h.isFunction(f)?null:f)&&"showNormField"||(e?"showNormPct":null)||d&&"showField"||null)&&(c=w.substitute({field:d&&this._getFieldAlias(d,b),normField:f&&this._getFieldAlias(f,
b)},this._i18n[e]))}return c},_buildLegendItems_Renderer:function(a,b,c){var d=b.parentLayerId,e=this.map,g=e.getScale(),l,n=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,g)){var r,m,s="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:a.renderer,v,t,u,z,C;if(s instanceof K&&(s=(s="zoom"===s.rangeType?s.getRendererInfoByZoom(e.getZoom()):s.getRendererInfoByScale(g))&&s.renderer,!s))return!1;var w=this._getVariables(s),A=k.filter(w,function(a){return!!a}).length,
g=w[0],e=w[1],w=w[2],F,D;g&&(v=this._getMedianColor(s,g),g.field&&(u=h.isFunction(g.field)?null:a.getField(g.field)));e&&e.field&&(C=h.isFunction(e.field)?null:a.getField(e.field));w&&w.field&&(z=h.isFunction(w.field)?null:a.getField(w.field));if(s instanceof J)l=n=!0,this._showHeatRamp(a,b,s,c);else if(s instanceof Q)l=n=!0,this._showDotDensityLegend(a,b,s,c);else if(s instanceof N)l=n=!0,m=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),r=f.create("tbody",
{},m),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(m,a,b),s.latestObservationRenderer&&s.latestObservationRenderer instanceof B&&this._buildRow_Renderer(a,s.latestObservationRenderer.symbol,v,x.encode(s.latestObservationRenderer.label)||this.NLS_currentObservations,null,r),s.observationRenderer&&s.observationRenderer instanceof B&&this._buildRow_Renderer(a,s.observationRenderer.symbol,v,x.encode(s.observationRenderer.label)||this.NLS_previousObservations,null,r);else if(s instanceof G){if(s.infos&&
0<s.infos.length){l=n=!0;m=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);r=f.create("tbody",{},m);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(m,a,b);s.attributeField&&w&&this._addSubHeader(r,this._getFieldAlias(s.attributeField,a));var y=[];k.forEach(s.infos,function(b){var c=null;a._editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var d=b.label;null==d&&(d=b.value);-1===k.indexOf(y,d)&&(y.push(d),this._buildRow_Renderer(a,b.symbol,
v,x.encode(d),c,r))},this)}D=this._displayDefaultSymbol(a,s,c)}else if(s instanceof I){if(s.infos&&0<s.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){l=n=!0;F=this._isUnclassedRenderer(s);!g&&1===s.infos.length&&(t=(t=s.infos[0])&&t.symbol);F||(m=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),r=f.create("tbody",{},m),A=this._getRendererTitle(s,a),this._buildRow_Renderer(a,null,v,x.encode(A),null,r));m=f.create("table",{cellpadding:0,
cellspacing:0,width:"95%","class":"esriLegendLayer"},c);r=f.create("tbody",{},m);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(m,a,b);if(!F||!w)A=s.infos.slice(0).reverse(),k.forEach(A,function(b){var c=b.label;null==c&&!F&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,v,x.encode(c),null,r)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===O.STYLE_SCALAR||a.renderer.style===O.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,s.defaultSymbol,
null,"",null,r),a._hideDefaultSymbol=!0}F||(D=this._displayDefaultSymbol(a,s,c))}else s instanceof B&&(l=n=!0,m=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),r=f.create("tbody",{},m),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(m,a,b),t=null,a._editable&&(a.templates&&0<a.templates.length)&&(t=a.templates[0]),m=1<A?null:u||C||z,this._buildRow_Renderer(a,s.symbol,v,x.encode(m?this._getRampTitle(1<A?null:g||e||w,a):s.label),t,r),t=g?null:s.symbol,
m&&(u=C=z=null));if(l){if(g&&(g.field||g.valueExpression))this._showGradientRamp(a,b,s,null,c,g,u,null,w?!0:!1);if(w&&(w.field||w.valueExpression))l=g||s instanceof G?!1:!0,this._showSizeLegend(a,b,s,w,v,c,z,null,l);if(e&&(e.field||e.valueExpression))z=t&&!t.url&&t.color?t.color:this.transparencyRampColor,this._showGradientRamp(a,b,s,z,c,e,C,null,!1)}D||(D=this._displayDefaultSymbol(a,s,c));n=n||D}n&&(p.set(q.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(p.set(q.byId(this.id+"_"+a.id+
"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,d)));return n},_isUnclassedRenderer:function(a,b){var c;if(a instanceof I&&a.infos&&1===a.infos.length){c=a.attributeField;var d=a.normalizationField;c=b?c===b:!!this._getVariables(a,c,d).length}return c},_displayDefaultSymbol:function(a,b,c){var d;!a._hideDefaultSymbol&&b.defaultSymbol&&(d=!0,c=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),c=f.create("tbody",{},c),this._buildRow_Renderer(a,b.defaultSymbol,
null,x.encode(b.defaultLabel)||"others",null,c));return d},_showGradientRamp:function(a,b,c,d,e,g,k,p,l){l=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(!l?" esriLegendSubFragment":"")},e);e=f.create("tbody",{},l);(a._hoverLabel||a._hoverLabels||p)&&this._createHoverAction(l,a,b,p);(k||g.valueExpression)&&this._addSubHeader(e,this._getRampTitle(g,a));b=g.field;var n;b&&(n=h.isFunction(b)?null:a.getField(b));(g=this._getRampStops(c,g,d,n&&"esriFieldTypeDate"===
n.type))&&g.length&&this._drawGradientRamp(e,g,!0,a,this._getRampBorderColor(c),!!d)},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c,d){var f,e,g,h,p=!1;b.colors||b.opacityValues?(e=b.maxDataValue-b.minDataValue,f=k.map([0,0.25,0.5,0.75,1],function(a){g=b.minDataValue+a*e;return Number(g.toFixed(6))}),this._checkPrecision(0,4,
f)):b.stops&&(f=k.map(b.stops,function(a){return a.value}),(p=k.some(b.stops,function(a){return!!a.label}))&&(h=k.map(b.stops,function(a){return a.label})));var l=f[0],q,r;e=f[f.length-1]-l;return k.map(f,function(g,k){c?(q=new n(c.toRgba()),r=a.getOpacity(g,{opacityInfo:b}),null!=r&&(q.a=r)):q=a.getColor(g,{colorInfo:b});var s="";if(p)s=h[k];else{var s=d?D.formatDate(g,D.timelineDateFormatOptions):F.format(g),m="";0===k?m=this._specialChars.lt+" ":k===f.length-1&&(m=this._specialChars.gt+" ");s=
m+s}return{value:g,color:q,offset:1-(g-l)/e,label:s}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,f=c[a],e=c[d],g=c[b],h=Math.floor(f),k=Math.floor(e),p=Math.floor(g);h===f&&(p===g&&k!==e&&h!==k&&p!==k)&&(c[d]=k);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof B)b=a.symbol;else if(a instanceof G||a instanceof I)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&
a.color},_drawGradientRamp:function(a,b,c,d,e,h){var l=f.create("tr",{},a),q,r,s,m,t,u=b.length-1,z;m=0;this.alignRight?(a=f.create("td",{align:this._isRightToLeft?"left":"right"},l),q=f.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},l)):(q=f.create("td",{width:this.gradientWidth,align:"center"},l),a=f.create("td",{},l));l=e&&0<e.a&&!(240<=e.r&&240<=e.g&&240<=e.b);r=f.create("div",{"class":l?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+
"px;"},q);q=f.create("div",{"class":"esriLegendColorRamp"+(h?" esriLegendTransparencyRamp":"")},r);h=p.get(q,"width");l&&(e=9>g("ie")?e.toHex():"rgba("+e.toRgba().join(",")+")",p.set(q,"border",this.colorRampBorder+" "+e));c?(e=this.gradientHeight*u,p.set(q,"height",e+"px")):e=p.get(q,"height");p.set(r,"height",e+"px");l=v.createSurface(q,h,e);9>g("ie")&&(m=l.getEventSource(),p.set(m,"position","relative"),p.set(m.parentNode,"position","relative"),m=1);try{c&&k.forEach(b,function(a,b){a.offset=b/
u}),t=l.createRect({x:-m,y:-m,width:h+m,height:e+m}),t.setFill({type:"linear",x1:0,y1:0,x2:0,y2:e,colors:b}).setStroke(null),l.createRect({width:h,height:e}).setFill(new n([255,255,255,1-d.opacity])).setStroke(null),this._surfaceItems.push(l)}catch(w){l.clear(),l.destroy()}k.forEach(b,function(a,c){if(a.label){z="top:"+100*a.offset+"%;";var d="";0===c&&(d+=" esriLegendColorRampTickFirst");c===b.length-1&&(d+=" esriLegendColorRampTickLast");f.create("div",{"class":"esriLegendColorRampTick"+d,innerHTML:"\x26nbsp;",
style:z},r)}});s=f.create("div",{"class":"esriLegendColorRampLabels",style:{height:e+this.gradientHeight+"px"}},a);c?k.forEach(b,function(a){f.create("div",{"class":"esriLegendColorRampLabel",innerHTML:x.encode(a.label)||"\x26nbsp;"},s)}):(f.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},s),f.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(e+this.gradientHeight-2*this.gradientHeight)+"px;"},s))},_showHeatRamp:function(a,b,c,d,e){var g,
h=c.field;g=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=f.create("tbody",{},g);(a._hoverLabel||a._hoverLabels||e)&&this._createHoverAction(g,a,b,e);(h=h&&a.getField(h))&&this._addSubHeader(d,this._getFieldAlias(h.name,a));b=this._getHeatmapStops(c);b.length&&this._drawGradientRamp(d,b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,d,f,e;if(b&&b[0])if(c=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[c])&&1!==a.ratio)b=b.slice(0),
b.push({ratio:1,color:a.color}),c++}else d=b[0].value,f=b[c].value-d,b=k.map(b,function(a){return{color:a.color,ratio:(a.value-d)/f}});else a&&a[0]&&(c=a.length-1,e=1/(a.length-1),b=k.map(a,function(a,b){return{color:a,ratio:b*e}}));b=k.map(b,function(a,b){var d="";0===b?d="Low":b===c&&(d="High");return{color:a.color,label:d,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,b,c,d){var e=c.legendOptions,g,p,l,q,n,r,s,m=this.dotDensitySwatchSize,v=Math.round(m/2);e&&(p=e.backgroundColor,
l=e.outline,q=e.valueUnit,n=e.dotCoverage);n=(n||this.dotCoverage)/100;s=Math.round(m*m/Math.pow(c.dotSize,2)*n);d=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);r=f.create("tbody",{},d);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(d,a,b);this._addSubHeader(r,w.substitute({value:c.dotValue,unit:q||""},this.NLS_dotValue));k.forEach(c.fields,function(b){b=h.mixin({},b);b.numPoints=s;g=new H(c._generateImageSrc(m,m,[b],{x:0,y:0},{x:m,y:m},p),l||c.outline,
m,m);b=a.getField(b.name)||b;this._buildRow_Renderer(a,g,null,x.encode(this._getFieldAlias(b.name,a)),null,r,{type:"path",path:"M "+-v+","+-v+" L "+v+","+-v+" L "+v+","+v+" L "+-v+","+v+" L "+-v+","+-v+" E"})},this)},_showSizeLegend:function(a,b,c,d,e,g,k,p,l){var q=d.legendOptions,q=q&&q.customValues;e=this._getSizeSymbol(c,e);if(!(d.valueUnit&&"unknown"!==d.valueUnit||!e||!q&&(null==d.minSize||null==d.maxSize))){l=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+
(!l?" esriLegendSubFragment":"")},g);g=f.create("tbody",{},l);(a._hoverLabel||a._hoverLabels||p)&&this._createHoverAction(l,a,b,p);(k||d.valueExpression)&&this._addSubHeader(g,this._getRampTitle(d,a));b=d.field;var n;b&&(n=h.isFunction(b)?null:a.getField(b));n=n&&"esriFieldTypeDate"===n.type;q=q||this._getDataValues(c,e,d,n);for(b=l=q.length-1;0<=b;b--)k=q[b],e=L.fromJson(e.toJson()),this._applySize(e,c,d,k),k=n?D.formatDate(k,D.timelineDateFormatOptions):F.format(k),p="",b===l?p=this._specialChars.gt+
" ":0===b&&(p=this._specialChars.lt+" "),p="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+x.encode(p+k)+"\x3c/span\x3e",this._buildRow_Renderer(a,e,null,p,null,g)}},_getSizeSymbol:function(a,b){var c,d;if(a instanceof B)c=a.symbol;else if(a instanceof O)c=a.defaultSymbol;else if(a instanceof G||a instanceof I)c=a.infos[0].symbol,d=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=L.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?c.setColor(new n(this.sizeRampDarkColor)):
(c.setColor(new n(this.sizeRampLightColor)),c.setOutline&&(d=new P,d.setColor(new n(this.sizeRampDarkColor)),d.setWidth(1.5),c.setOutline(d)));return c},_getDataValues:function(a,b,c,d,f,e){f=null==f?5:f;e=null==e?20:e;var g=a.getSizeRangeAtScale(c,this.map.getScale());f=this._interpolateSizeRange(g,f);var h=k.map(f,function(a){return this._getDataValueFromSize(a,c,g)},this);if(!d){var p,h=F.round(h);for(d=1;d<h.length-1;d++)if(p=this._roundDataValue(a,b,c,h[d],h[d-1],e))h[d]=p[0],f[d]=p[1]}return h},
_interpolateSizeRange:function(a,b){var c=a.minSize,d=(a.maxSize-c)/(b-1),f,e=[];for(f=0;f<b;f++)e.push(c+d*f);return e},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var f=b.minDataValue;b=b.maxDataValue;return a=a<=d?f:a>=c?b:(a-d)/(c-d)*(b-f)+f},_roundDataValue:function(a,b,c,d,f,e){var g=this._getSize(b,a,c,d);f=this._getSize(b,a,c,f);var h,k=F.getDigits(d),p=k.integer,k=k.fractional,l,q,n,r,m,s,v,t,x,u,z;0<d&&1>d&&(h=Math.pow(10,k),d*=h,p=F.getDigits(d).integer);for(p-=1;0<=
p&&!(l=Math.pow(10,p),k=Math.floor(d/l)*l,l*=Math.ceil(d/l),null!=h&&(k/=h,l/=h),q=(k+l)/2,q=F.round([k,q,l],{indexes:[1]})[1],n=this._getSize(b,a,c,k),r=this._getSize(b,a,c,l),m=this._getSize(b,a,c,q),s=F.getPctChange(g,n,f,null),v=F.getPctChange(g,r,f,null),t=F.getPctChange(g,m,f,null),x=s.prev<=e,u=v.prev<=e,x&&u&&(s.prev<=v.prev?(x=!0,u=!1):(u=!0,x=!1)),x?z=[k,n]:u?z=[l,r]:t.prev<=e&&(z=[q,m]),z);p--);return z},_applySize:function(a,b,c,d){var f=a.type;b=this._getSize(a,b,c,d);switch(f){case "simplemarkersymbol":a.setSize(b);
break;case "picturemarkersymbol":f=a.width;c=a.height;a.setHeight(b);a.setWidth(b*(f/c));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,d,e,g,h){var k=f.create("tr",{},g),p;this.alignRight?(g=f.create("td",{align:this._isRightToLeft?"left":"right"},
k),b&&(p=f.create("td",{align:this._isRightToLeft?"left":"right",width:35},k))):(b&&(p=f.create("td",{width:35,align:"center"},k)),g=f.create("td",{},k));var l=k=30,q;if(b){if("simplemarkersymbol"==b.type)k=Math.min(Math.max(k,b.size+12),125),l=Math.min(Math.max(l,b.size+12),125);else if("picturemarkersymbol"==b.type)k=Math.min(Math.max(k,b.width),125),l=Math.min(b.height||l,125);else if("textsymbol"==b.type){var n,r;b.text||(n=b.text,r=!0,b.setText(this.defaultText));k=Math.min(Math.max(k,b.getWidth()+
12),125);l=Math.min(Math.max(l,b.getHeight()+12),125);r&&b.setText(n)}q=f.create("div",{style:"width:"+k+"px;height:"+l+"px;"},p)}w.isDefined(d)&&"number"===typeof d&&(d=""+d);f.create("td",{innerHTML:d||"",align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},g))));b&&(a=this._drawSymbol(q,b,c,k,l,e,a,h),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var c=f.create("tr",{},a),c=f.create("td",{align:this._align,colspan:2},c);f.create("td",{innerHTML:x.encode(b)||
"",align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},c))))},_drawSymbol:function(a,b,c,d,f,e,k,l){b=L.fromJson(b.toJson());var q=k.opacity;c&&b.setColor(new n(c.toRgba()));if("simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type){if(!b.color)return;c=b.color.toRgba();c[3]*=q;b.color.setColor(c)}else"simplemarkersymbol"===b.type||"simplefillsymbol"===b.type?(b.color&&(c=b.color.toRgba(),c[3]*=q,b.color.setColor(c)),b.outline&&b.outline.color&&
(c=b.outline.color.toRgba(),c[3]*=q,b.outline.color.setColor(c))):"picturemarkersymbol"===b.type&&(a.style.opacity=q,a.style.filter="alpha(opacity\x3d("+100*q+"))");a=v.createSurface(a,d,f);9>g("ie")&&(c=a.getEventSource(),p.set(c,"position","relative"),p.set(c.parentNode,"position","relative"));e=this._getDrawingToolShape(b,e)||L.getShapeDescriptors(b);var r,q=(c=e.defaultShape)&&"text"===c.type;try{q&&!c.text&&(c.text=this.defaultText),r=a.createShape(l||c).setFill(e.fill).setStroke(e.stroke),q&&
r.setFont(e.font)}catch(m){a.clear();a.destroy();return}var s=r.getBoundingBox();l=s.width;e=s.height;var q=-(s.x+l/2),t=-(s.y+e/2);c=a.getDimensions();q={dx:q+c.width/2,dy:t+c.height/2};if("simplemarkersymbol"===b.type&&"path"===b.style)d=k._getScaleMatrix(s,b.size),r.applyTransform(u.scaleAt(d.xx,d.yy,{x:c.width/2,y:c.height/2}));else if(l>d||e>f)k=l/d>e/f,d=((k?d:f)-5)/(k?l:e),h.mixin(q,{xx:d,yy:d});r.applyTransform(q);return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||
null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,
fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){k.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&h.isArray(a.children)&&k.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c,e){if(e=b._hoverLabel||b._hoverLabels&&b._hoverLabels[c.id]||e)e=x.encode(e),b.mouseMoveHandler=b.mouseMoveHandler||{},
b.mouseMoveHandler[c.id]=d.connect(a,"onmousemove",h.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(q.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(h.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,q.byId(this.id+"_hoverLabel")){var d=q.byId(this.id+"_hoverLabel");d.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";p.set(d,"top",b+"px");p.set(d,"left",
a+15+"px");p.set(d,"display","")}else f.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},e)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=d.connect(a,"onmouseout",h.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(q.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;
k.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)d.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)d.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;k.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var f;a.layerDefinitions&&a.layerDefinitions[d.id]&&(f=a.layerDefinitions[d.id]);f&&(c.definitionExpression=f);var e;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&
(e=a.layerDrawingOptions[d.id]);e&&(c.drawingInfo=e.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,f=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<f.length;d++)if(c==f[d].id){-1<f[d].parentLayerId&&(p.set(q.byId(this.id+"_"+a+"_"+f[d].parentLayerId+"_group"),"display","block"),
this._findParentGroup(a,b,f[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,d){var f=a.layer.dynamicLayerInfos||a.layer.layerInfos,e,g;for(e=0;e<f.length;e++)if(f[e].id===c&&f[e].subLayerIds)for(g=0;g<f[e].subLayerIds.length;g++){var h=f[e].subLayerIds[g];-1===k.indexOf(d,h)&&(d.push(h),b(h,d))}}a.layer.layerInfos&&k.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,f=!0;if(a.legendResponse&&
a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var e=a.legendResponse.layers[d];if(b.id==e.layerId){var g,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==e.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0==e.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,e.minScale)||a.minScale||e.minScale,h=Math.max(a.maxScale,e.maxScale));if(0<g&&g<c||h>c)f=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<
c||a.maxScale&&a.maxScale>c)f=!1;return f},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):
b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],w.isDefined(a)&&(b+=" ("+a+")"));return x.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(w.isDefined(b.parentLayerId)){var f=a.layerInfos,e=b.parentLayerId,g;for(g=f.length-1;0<=g;g--)if(f[g].id==
e)if(0==c&&0<f[g].minScale?c=f[g].minScale:0<c&&0==f[g].minScale||0<c&&0<f[g].minScale&&(c=Math.min(c,f[g].minScale)),d=Math.max(d||0,f[g].maxScale||0),-1<f[g].parentLayerId)e=f[g].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===
a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});h.mixin(y,{ALIGN_LEFT:0,ALIGN_RIGHT:1});return y})},"dojo/debounce":function(){define([],function(){return function(m,e){var h;return function(){h&&clearTimeout(h);var k=this,
d=arguments;h=setTimeout(function(){m.apply(k,d)},e)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(m,e,h,k){var d=function(d,c){return d-c},l={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(d){var c=String(d),e=c.match(l._reNumber);d={integer:0,fractional:0};e&&e[1]?(d.integer=e[1].split("").length,d.fractional=e[3]?e[3].split("").length:0):-1<c.toLowerCase().indexOf("e")&&(e=c.split("e"),c=e[0],e=e[1],c&&e&&(c=Number(c),
e=Number(e),(d=0<e)||(e=Math.abs(e)),c=l.getDigits(c),d?(c.integer+=e,c.fractional=e>c.fractional?0:c.fractional-e):(c.fractional+=e,c.integer=e>c.integer?1:c.integer-e),d=c));return d},getFixedNumbers:function(d,c){var e,a;e=Number(d.toFixed(c));e<d?a=e+1/Math.pow(10,c):(a=e,e-=1/Math.pow(10,c));e=Number(e.toFixed(c));a=Number(a.toFixed(c));return[e,a]},getPctChange:function(d,c,e,a){var h={prev:null,next:null},k;null!=e&&(k=d-e,e=c-e-k,h.prev=Math.floor(Math.abs(100*e/k)));null!=a&&(k=a-d,e=a-c-
k,h.next=Math.floor(Math.abs(100*e/k)));return h},round:function(e,c){var g=e.slice(0),a,h,k,q,f,p,m,b,v,u=!c||null==c.tolerance?2:c.tolerance,x=c&&c.indexes,z=!c||null==c.strictBounds?!1:c.strictBounds;if(x)x.sort(d);else{x=[];for(p=0;p<g.length;p++)x.push(p)}for(p=0;p<x.length;p++)if(v=x[p],a=g[v],h=0===v?null:g[v-1],k=v===g.length-1?null:g[v+1],q=l.getDigits(a),q=q.fractional){m=0;for(b=!1;m<=q&&!b;)f=l.getFixedNumbers(a,m),f=z&&0===p?f[1]:f[0],b=l.hasMinimalChange(a,f,h,k,u),m++;b&&(g[v]=f)}return g},
hasMinimalChange:function(d,c,e,a,h){d=l.getPctChange(d,c,e,a);c=null==d.prev||d.prev<=h;e=null==d.next||d.next<=h;return c&&e||d.prev+d.next<=2*h},_reAllZeros:RegExp("\\"+h.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(d,c){c=c||{places:20,round:-1};var g=e.format(d,c);g&&(g=g.replace(l._reSomeZeros,"$1").replace(l._reAllZeros,""));return g}};return l})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/gregorian".split(" "),
function(m,e,h,k,d,l,n,c,g){function a(a){return a&&e.map(a,function(a){return new n(a)})}function s(a,b,c){var d="";0===b?d=q.lt+" ":b===c&&(d=q.gt+" ");return d+a}var r={},q={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},f={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},p={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},t={formatLength:"short",fullYear:!0},b={formatLength:"short"};m.mixin(r,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,c){var d,f=[];null!=a&&!(a instanceof
Date)&&(a=new Date(a));c=c||{};c=m.mixin({},c);var h=c.selector?c.selector.toLowerCase():null;d=!h||-1<h.indexOf("time");h=!h||-1<h.indexOf("date");d&&(c.timeOptions=c.timeOptions||b,c.timeOptions&&(c.timeOptions=m.mixin({},c.timeOptions),c.timeOptions.selector=c.timeOptions.selector||"time",f.push(c.timeOptions)));h&&(c.dateOptions=c.dateOptions||t,c.dateOptions&&(c.dateOptions=m.mixin({},c.dateOptions),c.dateOptions.selector=c.dateOptions.selector||"date",f.push(c.dateOptions)));f&&f.length?(f=
e.map(f,function(b){return k.format(a,b)}),d=1==f.length?f[0]:g["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return f[b]})):d=k.format(a);return d},createColorStops:function(a){var b=a.values,c=a.colors,d=a.labelIndexes,f=a.isDate,g=a.dateFormatOptions;a=[];return a=e.map(b,function(a,h){var k=null;if(!d||-1<e.indexOf(d,h)){var p;(p=f?r.formatDate(a,g):l.format(a))&&(k=s(p,h,b.length-1))}return{value:a,color:c[h],label:k}})},updateColorStops:function(a){var b=a.stops,
c=a.changes,d=a.isDate,f=a.dateFormatOptions,g=[],h,k=e.map(b,function(a){return a.value});e.forEach(c,function(a){g.push(a.index);k[a.index]=a.value});h=l.round(k,{indexes:g});e.forEach(b,function(a,c){a.value=k[c];if(null!=a.label){var e,g=null;(e=d?r.formatDate(h[c],f):l.format(h[c]))&&(g=s(e,c,b.length-1));a.label=g}})},createClassBreakLabel:function(a){var b=a.minValue,d=a.maxValue,f=a.isFirstBreak?"":q.gt+" ";a="percent-of-total"===a.normalizationType?q.pct:"";b=null==b?"":l.format(b);d=null==
d?"":l.format(d);return f+b+a+" "+c.smartMapping.minToMax+" "+d+a},setLabelsForClassBreaks:function(a){var b=a.classBreaks,c=a.classificationMethod,d=a.normalizationType,f=[];b&&b.length&&("standard-deviation"===c?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):a.round?(f.push(b[0].minValue),e.forEach(b,function(a){f.push(a.maxValue)}),f=l.round(f),e.forEach(b,function(a,b){a.label=r.createClassBreakLabel({minValue:0===b?f[0]:
f[b],maxValue:f[b+1],isFirstBreak:0===b,normalizationType:d})})):e.forEach(b,function(a,b){a.label=r.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===b,normalizationType:d})}))},updateClassBreak:function(a){var b=a.classBreaks,c=a.normalizationType,d=a.change,f=d.index,d=d.value,e=-1,g=-1,h=b.length;"standard-deviation"===a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===f?
e=f:f===h?g=f-1:(g=f-1,e=f),-1<e&&e<h&&(a=b[e],a.minValue=d,a.label=r.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===e,normalizationType:c})),-1<g&&g<h&&(a=b[g],a.maxValue=d,a.label=r.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===g,normalizationType:c})))},calculateDateFormatInterval:function(a){var b,c,d=a.length,g,h,k,l,p,q,r=Infinity,n;a=e.map(a,function(a){return new Date(a)});for(b=0;b<d-1;b++){g=a[b];k=[];p=Infinity;q="";for(c=
b+1;c<d;c++)h=a[c],h=g.getFullYear()!==h.getFullYear()&&"year"||g.getMonth()!==h.getMonth()&&"month"||g.getDate()!==h.getDate()&&"day"||g.getHours()!==h.getHours()&&"hour"||g.getMinutes()!==h.getMinutes()&&"minute"||g.getSeconds()!==h.getSeconds()&&"second"||"millisecond",l=f[h],l<p&&(p=l,q=h),k.push(h);p<r&&(r=p,n=q)}return n},createUniqueValueLabel:function(a){var b=a.value,c=a.fieldInfo,d=a.domain;a=a.dateFormatInterval;var f=String(b);(d=d&&d.codedValues?d.getName(b):null)?f=d:"number"===typeof b&&
(f=c&&"esriFieldTypeDate"===c.type?r.formatDate(b,a&&p[a]):l.format(b));return f},cloneColorInfo:function(b){var c;b&&(c=m.mixin({},b),c.colors=a(c.colors),c.stops=c.stops&&e.map(c.stops,function(a){a=m.mixin({},a);a.color&&(a.color=new n(a.color));return a}),c.legendOptions&&(c.legendOptions=m.mixin({},c.legendOptions)));return c},cloneOpacityInfo:function(a){var b;if(a){b=m.mixin({},a);if(a=b.opacityValues)b.opacityValues=a.slice(0);if(a=b.stops)b.stops=e.map(a,function(a){return m.mixin({},a)});
if(a=b.legendOptions)b.legendOptions=m.mixin({},a)}return b},cloneSizeInfo:function(a){var b;if(a){b=m.mixin({},a);b.stops&&(b.stops=e.map(b.stops,function(a){return m.mixin({},a)}));if((a=b.minSize)&&"object"===typeof a)b.minSize=r.cloneSizeInfo(a);if((a=b.maxSize)&&"object"===typeof a)b.maxSize=r.cloneSizeInfo(a);if(a=b.legendOptions)if(b.legendOptions=m.mixin({},a),a=a.customValues)b.legendOptions.customValues=a.slice(0)}return b}});return r})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define(["dojo/_base/declare",
"dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(m,e,h,k,d){return m(k,{constructor:function(){},getExtent:function(){var d=this.layerObject.items;if(0===d.length)return null;d=h.graphicsExtent(d);return this._convertGeometryToMapSpatialRef(d)},_resetLayerObjectVisiblity:function(d){var h=d?d[this.id]:null;h&&(e.forEach(this.newSubLayers,function(c){var e=d?d[c.id]:null;e&&c.layerObject.setVisibility(e.visible)},this),this._setTopLayerVisible(h.visible))},initVisible:function(){var d=
!1,e;for(e=0;e<this.newSubLayers.length;e++)d=d||this.newSubLayers[e].layerObject.visible;d&&(this._visible=!0)},_setTopLayerVisible:function(d){this._visible=d?!0:!1;e.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var h=[],k=this.layerObject.getFeatureLayers();e.forEach(k,function(c){c=d.getInstance().create({layerObject:c,title:c.label||c.title||c.name||c.id||" ",id:c.id||" ",collection:{layerInfo:this},selfType:"geo_rss",
parentLayerInfo:this});h.push(c);c.init()},this);return h},_obtainLayerIndexesInMap:function(){var d=[],e,c;for(c=0;c<this.newSubLayers.length;c++)(e=this._getLayerIndexesInMapByLayerId(this.newSubLayers[c].layerObject.id))&&d.push(e);return d},moveLeftOfIndex:function(d){var e;for(e=this.newSubLayers.length-1;0<=e;e--)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)},moveRightOfIndex:function(d){var e;for(e=0;e<this.newSubLayers.length;e++)this.map.reorderLayer(this.newSubLayers[e].layerObject,
d)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS ./LayerInfoFactory esri/layers/FeatureLayer esri/lang".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r){return m(c,{constructor:function(a,c){},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.extent)},_resetLayerObjectVisiblity:function(a){var c=a?
a[this.id]:null;if(a){c&&this.layerObject.setVisibility(c.visible);var d=[],g=!1;e.forEach(this.layerObject.layerInfos,function(b){var c=this.id+"_"+b.name;r.isDefined(a[c])&&(g=!0,a[c].visible&&d.push(b.name))},this);if(0<d.length||g)this.layerObject.setVisibleLayers(d),this.traversal(function(a){a.initVisible()})}},initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){this.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a){var c=
[],d,c=h.clone(this.originOperLayer.layerObject.visibleLayers),g;for(g in a)if(a.hasOwnProperty(g)&&"function"!==typeof a[g]){var b=a[g],k=g.toString();d=e.indexOf(c,k);b?0>d&&c.push(k):0<=d&&c.splice(d,1)}this.originOperLayer.layerObject.setVisibleLayers(c)},obtainNewSubLayers:function(){var c=[];e.forEach(this.layerObject.layerInfos,function(d,e){var g;g=a.getInstance().create({layerObject:this.layerObject,title:d.label||d.title||d.name||" ",id:this.id+"_"+(d.name||" "),wms:{layerInfo:this,subId:d.name,
wmsLayerInfo:d},selfType:"wms",parentLayerInfo:this});c.push(g);g.init()},this);return c},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&n.after(this.layerObject,"setVisibleLayers",h.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var a=[];this.traversal(function(c){c.initVisible();a.push(c)});k.publish("layerInfos/layerInfo/visibleChanged",a);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(m,e,h,k,d,l,n){return m(n,{constructor:function(c,d){this.layerObject=c.layerObject},getExtent:function(){},_resetLayerObjectVisiblity:function(){},initVisible:function(){var c=[],c=!1,c=h.clone(this.originOperLayer.layerObject.visibleLayers);this._visible=c=0<=e.indexOf(c,this.originOperLayer.wms.subId)?!0:!1},_setTopLayerVisible:function(c){var d=this.originOperLayer.wms;this._visible=c?!0:!1;var a={};a[d.subId]=c;d.layerInfo.setSubLayerVisible(a)},drawLegends:function(c){this._initLegendsNode(c)},
_initLegendsNode:function(c){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var e=d.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});l(e,"load",function(){d.empty(c);var a=d.create("div",{"class":"legend-div"},c);k.place(e,a)})}else d.empty(c)},obtainNewSubLayers:function(){return[]},getOpacity:function(){},setOpacity:function(c){},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},
"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo ./LayerInfoFactory".split(" "),function(m,e,h,k,d,l,n){return m(l,{constructor:function(c,d,a){this.noLegend=a},getExtent:function(){},initVisible:function(){var c=!1,d=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<d.layerInfo.subLayerVisible[d.subId]&&(c=!0);this._visible=c},_setTopLayerVisible:function(c){var d;if(this.originOperLayer.mapService&&
(d=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){c?d.layerInfo.subLayerVisible[d.subId]++:d.layerInfo.subLayerVisible[d.subId]--;this._visible=c;var a={};this.traversal(function(c){0===c.getSubLayers().length&&(a[c.originOperLayer.mapService.subId]=c.isVisbleOrInvisilbe())});d.layerInfo.setSubLayerVisible(a)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(c){},_sevVisible:function(c){this.visible=c},obtainNewSubLayers:function(){var c=[];e.forEach(this.originOperLayer.subLayers,
function(d){d.parentLayerInfo=this;d=n.getInstance().create(d);c.push(d);d.init()},this);return c},getOpacity:function(){},setOpacity:function(c){},getLayerObject:function(){var c=new k;this.layerObject.empty?d({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(h.hitch(this,function(d){var a=this.layerObject.url;this.layerObject=d;this.layerObject.url=a;this.layerObject.id=this.id;c.resolve(this.layerObject)}),function(d){c.reject(d)}):c.resolve(this.layerObject);
return c},getLayerType:function(){var c=new k;c.resolve("GroupLayer");return c},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getScaleRange:function(){var c=this.originOperLayer.mapService;return(c=c.layerInfo._getJsapiLayerInfoById(c.subId))&&0<=c.minScale&&0<=c.maxScale?{minScale:c.minScale,maxScale:c.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare",
"./LayerInfoForDefaultService"],function(m,e){return m(e,{constructor:function(e,k){},initVisible:function(){var e=!1,k=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<k.layerInfo.subLayerVisible[k.subId]&&(e=!0);this._visible=e},_setTopLayerVisible:function(e){var k;this.originOperLayer.mapService&&(k=this.originOperLayer.mapService,e?k.layerInfo.subLayerVisible[k.subId]++:k.layerInfo.subLayerVisible[k.subId]--,this._visible=e,this.visbleOrInvisilbe())},visbleOrInvisilbe:function(){var e=
this.originOperLayer.mapService,k={};k[e.subId]=this.isVisbleOrInvisilbe();e.layerInfo.setSubLayerVisible(k)},isVisbleOrInvisilbe:function(){for(var e=this.originOperLayer.mapService,k=-1,d=e.subId,l=0;;){k++;l+=e.layerInfo.subLayerVisible[d];d=e.layerInfo._getJsapiLayerInfoById(d);if(-1===d.parentLayerId)return l>k?!0:!1;d=d.parentLayerId}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault esri/layers/FeatureLayer esri/layers/RasterLayer".split(" "),
function(m,e,h,k,d,l,n,c){return m(l,{_legendsNode:null,_resetLayerObjectVisiblity:function(){},_loadLegends:function(c){var a=new k;this.originOperLayer.mapService.layerInfo.getLegendInfo(c).then(h.hitch(this,function(c){a.resolve(c)}));return a},drawLegends:function(c,a){this._loadLegends(a).then(h.hitch(this,function(a){this._initLegendsNode(a,c)}))},_initLegendsNode:function(c,a){var h=this.originOperLayer.mapService;if(c){d.empty(a);for(var k=null,l=0;l<c.length;l++)if(c[l].layerId===h.subId){k=
c[l];break}if(k){var f=d.create("table",{"class":"legend-table",style:"font-size: 12px"},a);e.forEach(k.legend,function(a){if("\x3call other values\x3e"!==a.label){var c=d.create("tr",{"class":"legend-tr",style:"border: 1px solid"},f),b=d.create("td",{"class":"legend-symbol-td",style:""},c),e=null,e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;d.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",src:e},b);d.create("td",{"class":"legend-label-td",
innerHTML:a.label||" ",style:"padding-left: 5px"},c)}},this)}}},_initControlPopup:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,a=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:c.infoTemplates&&c.infoTemplates[a]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,a=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&c.infoTemplates&&delete c.infoTemplates[a]},
_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getLayerObject:function(){var d=new k;this.getLayerType().then(h.hitch(this,function(a){this.layerObject.empty?(this.layerObject="RasterLayer"===a?new c(this.layerObject.url):new n(this.layerObject.url,this._getLayerOptionsForCreateLayerObject()),this.layerObject.on("load",h.hitch(this,function(){this.layerObject.id=this.id;d.resolve(this.layerObject)})),
this.layerObject.on("error",h.hitch(this,function(){d.resolve(null)}))):this.layerObject.loaded?d.resolve(this.layerObject):(this.layerObject.on("load",h.hitch(this,function(){d.resolve(this.layerObject)})),this.layerObject.on("error",h.hitch(this,function(){d.resolve(null)})))}),h.hitch(this,function(){d.resolve(null)}));return d},getPopupInfo:function(){var c=null,a=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(a)for(var d=0;d<a.length;d++)if(a[d].id===this.originOperLayer.mapService.subId){c=
a[d].popupInfo;break}return c},getFilterOfWebmap:function(){var c=null,a=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(a)for(var d=0;d<a.length;d++)if(a[d].id===this.originOperLayer.mapService.subId){c=a[d].layerDefinition?a[d].layerDefinition.definitionExpression:null;break}return c},getFilter:function(){var c=this.originOperLayer.mapService;return c.layerInfo.layerObject&&c.layerInfo.layerObject.layerDefinitions?c.layerInfo.layerObject.layerDefinitions[c.subId]:null},setFilter:function(c){var a,
d=this.originOperLayer.mapService;d.layerInfo.layerObject&&d.layerInfo.layerObject.setLayerDefinitions&&(a=d.layerInfo.layerObject.layerDefinitions?e.map(d.layerInfo.layerObject.layerDefinitions,function(a){return a}):[],a[d.subId]=c,d.layerInfo.layerObject.setLayerDefinitions(a))},getLayerType:function(){var c=new k,a=this.originOperLayer.mapService;a.layerInfo._getSublayerDefinition(a.subId).then(h.hitch(this,function(a){a?c.resolve(a.type.replace(/\ /g,"")):c.resolve(null)}),function(){c.resolve(null)});
return c},getSupportTableInfo:function(){var c=new k,a={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(h.hitch(this,function(d){a.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(a.isSupportedLayer=!0);d=this.originOperLayer.mapService;d.layerInfo._getSublayerDefinition(d.subId).then(h.hitch(this,function(d){d&&0<=d.capabilities.indexOf("Data")&&(a.isSupportQuery=!0);c.resolve(a)}),function(){c.resolve(a)})}),function(){c.resolve(a)});return c},enablePopup:function(){var c=
this.originOperLayer.mapService.layerInfo,a=c.layerObject,d=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!0;c.controlPopupInfo.infoTemplates&&(a.infoTemplates||(a.infoTemplates={}),a.infoTemplates[d]=c.controlPopupInfo.infoTemplates[d])},disablePopup:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,a=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;c.infoTemplates&&delete c.infoTemplates[a]},loadInfoTemplate:function(){var c=
new k,a=this.originOperLayer.mapService.layerInfo,d=this.originOperLayer.mapService.subId;a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[d]&&a.controlPopupInfo.infoTemplates[d].infoTemplate?c.resolve(a.controlPopupInfo.infoTemplates[d].infoTemplate):(a.controlPopupInfo.infoTemplates||(a.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(h.hitch(this,function(e){e=this._getDefaultPopupTemplate(e);a.controlPopupInfo.infoTemplates[d]={infoTemplate:e,layerUrl:null};c.resolve(e)}),
h.hitch(this,function(){c.resolve(null)})));return c},getInfoTemplate:function(){var c=this.originOperLayer.mapService.layerInfo,a=this.originOperLayer.mapService.subId;return c.controlPopupInfo.infoTemplates&&c.controlPopupInfo.infoTemplates[a]&&c.controlPopupInfo.infoTemplates[a].infoTemplate?c.controlPopupInfo.infoTemplates[a].infoTemplate:null},getScaleRange:function(){var c=this.originOperLayer.mapService;return(c=c.layerInfo._getJsapiLayerInfoById(c.subId))&&0<=c.minScale&&0<=c.maxScale?{minScale:c.minScale,
maxScale:c.maxScale}:{minScale:0,maxScale:0}},_onVisibilityChanged:function(){}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./layer ./ImageServiceLayerMixin ../SpatialReference ../geometry/Point".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f){return m([s,r],{declaredClass:"esri.layers.RasterLayer",managedSuspension:!0,constructor:function(a,c){this.drawMode=
c&&void 0!==c.drawMode?c.drawMode:!0;this.drawType=c&&c.drawType?c.drawType:"2d";this._initialize(a,c);(null===this.format||void 0===this.format)&&this.setImageFormat("LERC",!0)},opacity:1,setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){if(this.opacity!=a)this.onOpacityChange(this.opacity=a)},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>d("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},
clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();this._displayTimer=this._displayTimer||setTimeout(e.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},_setMap:function(a,
c){this.inherited(arguments);var b=this._canvas=l.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute; left: 0px; top: 0px;"},c);g.isDefined(this.opacity)&&n.set(b,"opacity",this.opacity);(this._context=b.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(h.connect(a,"onPan",this,this._panHandler));
this._connects.push(h.connect(a,"onPanEnd",this,this._panEndHandler));this._connects.push(h.connect(a,"onZoom",this,this._onZoomHandler));this._connects.push(h.connect(a,"onZoomEnd",this,this._onZoomEndHandler));this._connects.push(h.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(h.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(h.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(h.connect(this,"onOpacityChange",
this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};this.evaluateSuspension();if(this.suspended&&!a.loaded)var d=h.connect(a,"onLoad",this,function(){h.disconnect(d);d=null;this.evaluateSuspension()});return b},_unsetMap:function(a,c){k.forEach(this._connects,h.disconnect,this);this._canvas&&c.removeChild(this._canvas);this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},
_canDraw:function(){return this._map&&this._canvas&&this._context?!0:!1},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){n.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};if(this._canDraw&&this.drawMode)if(this._useBrowserDecoding())this._fireUpdateEnd();else if(this.drawMode)if(!this.pixelData||!this.pixelData.pixelBlock)this.clear();
else{var a=this.pixelData.pixelBlock,c=this._context,b=c.createImageData(a.width,a.height);b.data.set(a.getAsRGBA());c.putImageData(b,0,0);this._fireUpdateEnd()}},_panHandler:function(a,c){n.set(this._canvas,{left:this._startRect.left+c.x+"px",top:this._startRect.top+c.y+"px"})},_panEndHandler:function(a,c){c&&(this._startRect.left+=c.x,this._startRect.top+=c.y)},_onZoomHandler:function(a,c,b){var d=this._startRect;a=d.width*c;c*=d.height;var f=d.left-(a-d.width)*(b.x-d.left)/d.width;b=d.top-(c-d.height)*
(b.y-d.top)/d.height;n.set(this._canvas,{left:f+"px",top:b+"px",width:a+"px",height:c+"px"});this._endRect={left:f,top:b,width:a,height:c}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,c,b){n.set(this._canvas,{width:c+"px",height:b+"px"});this._startRect.width=this._canvas.width=c;this._startRect.height=this._canvas.height=b},_extentChangeHandler:function(a,c,b,d){this.suspended||(this._fireUpdateStart(),a=this._map,this._requestData(a.extent,
a.width,a.height))},_visibilityChangeHandler:function(c){c?a.show(this._canvas):a.hide(this._canvas)},_opacityChangeHandler:function(a){n.set(this._canvas,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z,A,C,w,F,D,B,G,I,K){return m(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,b){this._url=p.urlToObject(a);this.raster=new A(a);this.infoTemplate=b&&b.infoTemplate;var c=b&&b.imageServiceParameters;
this.format=c&&c.format;this.compressionTolerance=c&&c.compressionTolerance?c.compressionTolerance:0.01;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this.useMapDimensionValue=b&&b.hasOwnProperty("useMapDimensionValue")?!!b.useMapDimensionValue:!0;this.activeMapDimensions=b&&b.activeMapDimensions;this._params=e.mixin({},this._url.query,{f:"image",
interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this.pixelFilter=b&&b.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=e.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=e.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=e.hitch(this,this._initLayer);this._queryVisibleRastersHandler=
e.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):q({url:this._url.path,content:e.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,
b){if(!(null===a||void 0===a)){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,d=this.maxScale;e.mixin(this,a);this.minScale=c;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=new t(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var f=this.minValues,g=this.maxValues,h=this.meanValues,k=this.stdvValues,l=this.bands=
[],c=0,d=this.bandCount;c<d;c++)l[c]={min:f[c],max:g[c],mean:h[c],stddev:k[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new D(c):null;d=this.fields=[];if(f=a.fields)for(c=0;c<f.length;c++)d.push(new B(f[c]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);r.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);r.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};a.defaultMosaicMethod?(c.method=
a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=u.METHOD_NONE;this.defaultMosaicRule=new u(c);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType&&!this.hasRasterAttributeTable;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);
10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=e.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=e.clone(a.fields))}));this._isVectorData()&&!r.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new w,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(e.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)}},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new h(f._dfdCanceller);10<this.version?(b._pendingDfd=q({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=l.isDebug,b.errback(a));
return b},getRasterAttributeTable:function(a){var b=this._url.path+"/rasterAttributeTable",c=new h(f._dfdCanceller),e={f:"json"},g=this.hasRasterAttributeTable;a&&a.renderingRule&&(e.renderingRule=d.toJson(a.renderingRule.toJson()),g=!0);10<this.version&&g?(c._pendingDfd=q({url:b,content:e,handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(function(a){c.callback(a)},function(a){c.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=l.isDebug,c.errback(a));return c},
_getRenderingRuleAttributeTable:function(a){var b=new h(f._dfdCanceller);if(!a||!a.renderingRule)return b.errback(Error("Rendering rule is not specified")),b;a=a.renderingRule;var c=a.functionName;this._renderingRuleAttributeTable&&c&&this._renderingRuleAttributeTable.hasOwnProperty(c)?b.resolve(this._renderingRuleAttributeTable[c]):b=this.getRasterAttributeTable({renderingRule:a}).then(e.hitch(this,function(a){var b;a&&(a.features&&a.features.length&&a.fields&&a.fields.length)&&(b={features:e.clone(a.features),
fields:e.clone(a.fields)},c&&(this._renderingRuleAttributeTable[c]=b));return b}));return b},_getRasterAttributeTableFeatures:function(){var a=new h;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=e.clone(a.features))})),
a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return!a?(a=new h,a.errback(Error("Rendering rule is not specified")),a):this._getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features})},getCustomRasterFields:function(a){var b=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var c={name:this._rasterFieldPrefix+
"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},d={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},f={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},g=this.fields?e.clone(this.fields):[];a=g.length;g[a]=d;if(10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||
!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none")))a++,g[a]=f;if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,g[a]=c;if(r.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType))c={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},d={name:this._rasterFieldPrefix+
"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,g[a]=c,a++,g[a]=d;a=this._rasterAttributeTableFields;if((c=this.renderingRule&&this.renderingRule.functionName)&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(c))a=this._renderingRuleAttributeTable[c].fields;a&&0<a.length&&(a=k.filter(a,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),a=k.map(a,function(a){var c=e.clone(a);c.name=b+a.name;return c}),
g=g.concat(a));var h=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&k.forEach(this.rasterFunctionInfos,function(a){a&&(a.name&&"none"!==a.name.toLowerCase())&&(a={name:h+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},g.push(a))});return g},_prepareGetImageParameters:function(a,b,c,f){f=r.isDefined(f)?f:this._params;var g=a.spatialReference.wkid||d.toJson(a.spatialReference.toJson(!1));delete f._ts;
e.mixin(f,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:g,bboxSR:g,size:b+","+c},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete f.compressionTolerance;f.format&&"LERC"===f.format.toUpperCase()&&(f.compressionTolerance=this.compressionTolerance);f.token=this._getToken()},getImageUrl:function(a,b,c,d,f){f=r.isDefined(f)?f:this._params;this._prepareGetImageParameters(a,b,c,f);a=e.clone(f);this._cleanupRequestParams(a);b=this._url.path+"/exportImage?";c=p.addProxy(b+g.objectToQuery(e.mixin(a,
{f:"image"})));var h=a.token;c.length>s.defaults.io.postLength||this.useMapImage?this._jsonRequest=q({url:b,content:e.mixin(a,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;h&&(c+=-1===c.indexOf("?")?"?token\x3d"+h:"\x26token\x3d"+h);d(p.addProxy(c))},error:this._errorHandler}):d(c)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,
b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,
b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=d.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?d.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&this._getRenderingRuleAttributeTable({renderingRule:a});if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=
a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=u.METHOD_NONE);c.where=a;c=new u(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a},getPixelData:function(a){return a?(this._useBrowserDecoding()&&
(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},queryVisibleRasters:function(a,c,d,g){var l=this._map,p=f._fixDfd(new h(f._dfdCanceller));this._visibleRasters=[];var q,r,n=!0,m=this.infoTemplate?this.infoTemplate.info:null,s=m?e.clone(this.infoTemplate.info.fieldInfos):null;c=c||{};if(m&&
this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var t=[];k.forEach(this.infoTemplate.info.mediaInfos,function(a){t=t.concat(a&&a.value&&a.value.fields||[])});t.length&&k.forEach(s,function(a){a&&-1<t.indexOf(a.fieldName)&&(a.visible=!0)})}if(s&&0<s.length){n=!1;for(q=0;q<s.length;q++)if((r=s[q])&&r.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(r.visible||m.title&&-1<m.title.toLowerCase().indexOf(r.fieldName.toLowerCase()))){n=!0;
break}}var v=(r=this._removeVisualizationStretchFunction(this.renderingRule))&&r.functionName,z=[];if(10.4<=this.version){var u=!1;if(this.rasterFunctionInfos&&s){var w=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;k.forEach(this.rasterFunctionInfos,function(a){var b=w+a.name.replace(/ /gi,"_");k.some(s,function(a){return a.visible&&a.fieldName===b})&&(u=u||v&&v===a.name,z.push(new x({rasterFunction:a.name})))})}r&&!u&&z.push(r)}q=new K;q.geometry=a.geometry;q.returnGeometry=this._map.spatialReference.equals(this.spatialReference);
q.returnCatalogItems=n;q.timeExtent=a.timeExtent;q.mosaicRule=this.mosaicRule||null;q.renderingRule=10.4>this.version&&r||null;q.renderingRules=z||null;l&&(a=new b((l.extent.xmax-l.extent.xmin)/(2*l.width),(l.extent.ymax-l.extent.ymin)/(2*l.height),l.extent.spatialReference),q.pixelSize=a);c.requestParams=q;var C=this;a=new I(this.url);(p._pendingDfd=a.execute(q)).addCallbacks(function(a){C._queryVisibleRastersHandler(a,c,d,g,p)},function(a){C._resolve([a],null,g,p,!0)});return p},_queryVisibleRastersHandler:function(a,
b,c,f,g){function h(){var a=this.getCustomRasterFields(b),d=this._getDomainFields(a),f=b?b.returnDomainValues:!1,q=b&&b.rasterAttributeTableFieldPrefix,s,x,v,z,u,w,A,B,D,Q;this._useRenderingRuleAttributeTable&&this.renderingRule?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),Q=l):a=this._getRasterAttributeTableFeatures();a.then(e.hitch(this,function(a){for(s=0;s<m.length;s++){R=m[s];R.setInfoTemplate(this.infoTemplate);R._layer=this;if(l){D=l.replace(/ /gi,"").split(",");
x=l;v=D;n&&n.length>=s&&(x=n[s].replace(/ /gi,", "),v=n[s].split(" "));R.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=v;R.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=D;p&&(R.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=p.replace(/ /gi,"").split(","));if(this.pixelFilter){var b=new C({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});k.forEach(v,function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,
extent:new t(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)R.attributes[this._rasterFieldPrefix+"Magnitude"]=b.pixels[0][0],R.attributes[this._rasterFieldPrefix+"Direction"]=b.pixels[1][0]}k.forEach(F,function(a){R.attributes[a.name]=a.value});var h=Q||x;if(a&&0<a.length&&(z=k.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==h:
a.attributes.VALUE==h}),0<z.length&&(u=e.clone(z[0]),q&&u))){B={};for(w in u.attributes)u.attributes.hasOwnProperty(w)&&(A=q+w,B[A]=u.attributes[w]);u.attributes=B;R.attributes=e.mixin(R.attributes,u.attributes)}}f&&(d&&0<d.length)&&k.forEach(d,function(a){if(a){var b=R.attributes[a.name];r.isDefined(b)&&(b=this._getDomainValue(a.domain,b),r.isDefined(b)&&(R.attributes[a.name]=b))}},this);Y.push(R);this._visibleRasters.push(R)}this._resolve([Y,null,!0],null,c,g)}))}var l=a.value,p=a.value,n,m,s=0,
x=0,z=this,u=this.objectIdField,w,A,F=[];f=b.requestParams.renderingRules;var B=a.processedValues,D=this.renderingRule&&dojo.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(f&&B&&f.length===B.length){var K=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;k.forEach(f,function(a,b){if(a.functionName){var c={name:K+a.functionName.replace(/ /gi,"_"),value:B[b].replace(/ /gi,"").split(",")};F.push(c);D&&D===dojo.toJson(a.toJson())&&(l=B[b])}})}f=this.infoTemplate&&
this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var I=0,Z,V,X=a.catalogItems.features.length;A=0;m=Array(X);n=Array(X);w=Array(X);for(s=0;s<X;s++)-1<a.properties.Values[s].toLowerCase().indexOf("nodata")&&A++;Z=X-A;for(s=0;s<X;s++)A=!0,-1<a.properties.Values[s].toLowerCase().indexOf("nodata")?(V=Z++,f||(A=!1,m.length--,n.length--,w.length--)):
V=I++,A&&(m[V]=a.catalogItems.features[s],n[V]=a.properties.Values[s],w[V]=m[V].attributes[u])}this._visibleRasters=[];var R;if((a=-1<l.toLowerCase().indexOf("nodata"))&&!f)m=[],n=[],w=[];l&&(!m&&!a)&&(u="ObjectId",m=[],R=new G(new t(this.fullExtent),null,{ObjectId:0}),m.push(R));var Y=[];m?!this._map.spatialReference.equals(this.spatialReference)&&w&&0<w.length?q({url:this._url.path+"/query",content:{f:"json",objectIds:w.join(","),returnGeometry:!0,outSR:d.toJson(z._map.spatialReference.toJson()),
outFields:u},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)z._resolve([Y,null,null],null,c,g);else{for(s=0;s<a.features.length;s++)for(x=0;x<m.length;x++)m[x].attributes[u]==a.features[s].attributes[u]&&(m[x].geometry=new v(a.features[s].geometry),m[x].geometry.setSpatialReference(z._map.spatialReference));h.call(z)}},error:function(a){z._resolve([Y,null,null],null,c,g)}}):h.call(this):this._resolve([Y,null,null],null,c,g)},getVisibleRasters:function(){var a=
this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];k.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;k.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=e.clone(a);var d=a._normalize(!0);this._prepareGetImageParameters(d,
b,c);b=e.clone(this._params);this._cleanupRequestParams(b);b.extent=a;c=null;this._useBrowserDecoding()&&(c=new F({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?e.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this.originalPixelData=a,this.hasDataChanged=
!0,this._setPixelData(a)},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this._drawPixelData(),this._rasterReadPromise=null},_drawPixelData:function(){},_requestDataErrorHandler:function(a){},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=e.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},
_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;for(var d=b*c,f=0,e=0,g=new Uint8Array(d),h=new Uint8Array(d),k=new Uint8Array(d),l=new Uint8Array(d),p=Infinity,q=Infinity,r=Infinity,n=-Infinity,m=-Infinity,s=-Infinity,t,x,v,f=0;f<d;f++)t=a[e++],x=a[e++],v=a[e++],p=p<t?p:t,n=n>t?n:t,q=q<x?q:x,m=m>x?m:x,r=r<v?r:v,s=s>v?s:v,g[f]=t,h[f]=x,k[f]=v,l[f]=a[e++]&1;return new C({width:b,height:c,pixels:[g,h,k],pixelType:"U8",mask:l,statistics:[{minValue:p,maxValue:n},{minValue:q,maxValue:m},
{minValue:r,maxValue:s}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"==this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=this._url.path+"/multiDimensionalInfo",b=new h(f._dfdCanceller);if(this._multidimensionalInfo)return b.resolve(this._multidimensionalInfo),b;10.3<=this.version&&this.hasMultidimensions?(b._pendingDfd=q({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),
b._pendingDfd.then(e.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;b.callback(a.multidimensionalInfo)}),function(a){b.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=l.isDebug,b.errback(a));return b},getDefaultMultidimensionalDefinition:function(){var a,b,c,d=[],g=new h(f._dfdCanceller);if(this._defaultMultidimensionalDefinition)return g.resolve(this._defaultMultidimensionalDefinition),g;g._pendingDfd=this.getMultidimensionalInfo();g._pendingDfd.then(e.hitch(this,
function(f){a=f;b=a.variables[0].dimensions;for(c in b)b.hasOwnProperty(c)&&(b[c].hasRanges&&!0==b[c].hasRanges?d.push(new z({variableName:"",dimensionName:b[c].name,isSlice:!1,values:[b[c].values[0]]})):d.push(new z({variableName:"",dimensionName:b[c].name,isSlice:!0,values:[b[c].extent[0]]})));this._defaultMultidimensionalDefinition=d;g.callback(d)}),function(a){g.errback(a)});return g},_setDefaultMultidimensionalDefinition:function(a){var b,c={};this.getDefaultMultidimensionalDefinition().then(e.hitch(this,
function(d){b=d;0<b.length&&(this.mosaicRule?(c=e.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=e.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new u({multidimensionalDefinition:b}),this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=
this.rasterFunctionInfos[0].name;else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"==this.declaredClass&&10.3<this.version){var c="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:c,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new x(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;
if(a.time&&a.mosaicRule){var b=new u(d.fromJson(a.mosaicRule));if(b&&b.multidimensionalDefinition&&0<b.multidimensionalDefinition.length){var c=k.filter(b.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});b.multidimensionalDefinition=c;a.mosaicRule=d.toJson(b.toJson())}}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),f;for(f in b)a.hasOwnProperty(b[f])&&delete a[b[f]];return a},_removeVisualizationStretchFunction:function(a){var b=
a&&a.functionName;if(!b||"stretch"!==b.toLowerCase())return a;var c=a.functionArguments.Raster;return c&&c.functionName&&k.some(this.rasterFunctionInfos,function(a){return c.functionName===a.name})?c:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||
"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_isRasterFunctionInfoAvailable:function(a){return k.some(a&&(this.rasterFunctionInfos||[]),function(b){return b&&b.name&&b.name.toLowerCase()===a.toLowerCase()})},_createPixelData:function(a){a=new C({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new t(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:b}},_resolve:function(a,b,c,d,
e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&f._resDfd(d,a,e)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=n.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(n.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&
(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))}})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(m,e,h,k,d,l){var n=m(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],
constructor:function(c){e.isObject(c)&&(e.mixin(this,c),c.mosaicMethod&&(this.method=c.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),c.mosaicOperation&&(this.operation=c.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),c.fids&&(this.objectIds=c.fids),c.viewpoint&&(this.viewpoint=new l(c.viewpoint)),this.multidimensionalDefinition=
c.multidimensionalDefinition||[])},toJson:function(){var c=null,e=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(e)for(var c=[],a=0;a<e;a++)c.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[a].declaredClass?this.multidimensionalDefinition[a].toJson():this.multidimensionalDefinition[a]);c={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?
this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:c};return d.filter(c,function(a){if(null!==a)return!0})},_getMethodEnum:function(c){if(c){var d=n.METHOD_NONE;switch(c.toLowerCase()){case "byattribute":d=n.METHOD_ATTRIBUTE;break;case "center":d=n.METHOD_CENTER;break;case "lockraster":d=n.METHOD_LOCKRASTER;break;case "nadir":d=n.METHOD_NADIR;break;case "northwest":d=n.METHOD_NORTHWEST;break;case "seamline":d=n.METHOD_SEAMLINE;break;case "viewpoint":d=
n.METHOD_VIEWPOINT}return d}},_getOperatorEnum:function(c){if(c)switch(c.toLowerCase()){case "first":return n.OPERATION_FIRST;case "last":return n.OPERATION_LAST;case "max":return n.OPERATION_MAX;case "min":return n.OPERATION_MIN;case "blend":return n.OPERATION_BLEND;case "mean":return n.OPERATION_MEAN;case "sum":return n.OPERATION_SUM}}});e.mixin(n,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",
METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});return n})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(m,e,h,k,d){var l=m(null,{declaredClass:"esri.layers.RasterFunction",
functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(d){if(e.isObject(d)){var c=0;this.functionName=d.rasterFunction;this.functionArguments=e.clone(d.rasterFunctionArguments||d.arguments);e.mixin(this,d);if(d=this.functionArguments)if(d.Raster=this._toRasterFunction(d.Raster),d.Raster2=this._toRasterFunction(d.Raster2),d.DEM=this._toRasterFunction(d.DEM),d.FillRaster=this._toRasterFunction(d.FillRaster),d.Rasters&&d.Rasters.length)for(c=
0;c<d.Rasters.length;c++)d.Rasters[c]=this._toRasterFunction(d.Rasters[c])}},_toRasterFunction:function(d){return d&&(d.rasterFunction||d.functionName)?new l(d):d},_rfToJson:function(d){d&&"esri.layers.RasterFunction"===d.declaredClass&&(d=d.toJson());return d},toJson:function(){var h=e.clone(this.functionArguments||this.arguments);if(h&&(h.Raster=this._rfToJson(h.Raster),h.Raster2=this._rfToJson(h.Raster2),h.DEM=this._rfToJson(h.DEM),h.FillRaster=this._rfToJson(h.FillRaster),h.Rasters&&h.Rasters.length)){var c,
g=[];for(c=0;c<h.Rasters.length;c++)g.push(this._rfToJson(h.Rasters[c]));h.Rasters=g}return d.filter({rasterFunction:this.functionName,rasterFunctionArguments:h,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});return l})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(m,e,h,k,d){return m(null,{declaredClass:"esri.layers.DimensionalDefinition",
variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(d){e.isObject(d)&&e.mixin(this,d)},toJson:function(){return d.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(d){return null!==d})}})})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t){var b,v,u,x=null,z=null,A=function(a){"U1"===a||"U2"===a||"U4"===a||"U8"===a?(a="U8",z=Math.pow(2,8)-1,x=Uint8Array):"U16"===a?(z=z||Math.pow(2,16)-1,x=Uint16Array):"U32"===a?(z=z||Math.pow(2,32)-1,x=Uint32Array):"S8"===a?(z=z||0-Math.pow(2,7),x=Int8Array):"S16"===a?(z=z||0-Math.pow(2,15),x=Int16Array):"S32"===a?(z=z||0-Math.pow(2,31),x=Int32Array):x=Float32Array;return a};return e(a,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),
validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){if(!a)throw"Image Service URL is not defined";this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(a,b,e){var g=this,p=new k(f._dfdCanceller);if(10>c("ie"))throw"This browser is not supported.";if(!a.imageServiceParameters)throw"Insufficient parameters to read data";var q=h.clone(a.imageServiceParameters),
r=a.pixelType;d.some(this.validPixelTypes,function(a){return a===r})||(q.pixelType="F32");d.some(this.validFormats,function(a){return a.toLowerCase()===q.format.toLowerCase()})||(q.format="lerc");var n=a.decodeFunc,m;this._prepareGetImageParameters(q);p._pendingDfd=s({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:h.mixin(q,{f:"image"}),load:function(a){var c=q.format.toUpperCase();"BSQ"!==c&&"BIP"!==c&&(c=g._getFormat(a));if("ERROR"===c)a=Error(String.fromCharCode.apply(null,
new Uint8Array(a))),a.log=l.isDebug,g._resolve([a],null,e,p,!0);else{if(void 0===n||null===n)n=g._getFormatDecoderDfd(c);n?n(a,{width:q.width,height:q.height,planes:null,pixelType:r,noDataValue:q.noData}).then(function(a){m={pixelBlock:a,extent:q.extent};g._resolve([m,q],"onRasterReadComplete",b,p)},function(a){g._resolve([a],null,e,p,!0)}):(a=Error("Format '"+q.format+"' is not supported."),a.log=l.isDebug,g._resolve([a],null,e,p,!0))}},error:function(a){g._resolve([a],null,e,p,!0)}});return p.promise},
onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new r(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new q(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";
var b=a.extent,c=b.spatialReference.wkid||n.toJson(b.spatialReference.toJson());delete a._ts;h.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,f=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+f*b/c:(f=d*c/b,a.xmax=a.xmin+f);return a},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&f._resDfd(d,a,e)},_getFormatDecoderDfd:function(a){var b=
null;switch(a){case "LERC":b=this._decodeLerc;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip}b=h.hitch(this,b);return function(a,c){var d=new k;try{var f=b(a,c);d.resolve(f)}catch(e){d.reject(e)}return d}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="JPEG":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="PNG":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===
a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="LERC":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="ERROR");return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,c){if(!b)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(c);var d=(new b).decode(a);if(d.height!==c.height||d.width!==c.width)throw"The decoded image dimensions are incorrect.";
var f=[],e,g;for(e=0;e<d.pixels.length;e++)g=d.pixels[e],f.push(this._calculateBandStatistics(g));return new p({width:d.width,height:d.height,pixels:d.pixels,pixelType:"U8",mask:d.mask,statistics:f})},_decodePng:function(a,b){if(!v)throw"The png decoder module is not loaded.";this._validateDecodeParams(b);var c=new Uint8Array(a),d=new v(c),c=new Uint8Array(4*b.width*b.height);d.copyToImageData(c,d.decodePixels());for(var f=d=0,e,f=new Uint8Array(b.width*b.height),d=0;d<b.width*b.height;d++)f[d]=c[4*
d+3];for(var g=new p({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:f,statistics:[]}),d=0;3>d;d++){e=new Uint8Array(b.width*b.height);for(f=0;f<b.width*b.height;f++)e[f]=c[4*f+d];g.addData({pixels:e,statistics:this._calculateBandStatistics(e)})}return g},_decodeBsq:function(a,b){if(!u)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=A(b.pixelType);var c=u.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:x,noDataValue:z}),
d=[],f,e=null;for(f=0;f<c.pixels.length;f++)e=c.pixels[f],d.push(this._calculateBandStatistics(e));return new p({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeBip:function(a,b){this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=A(b.pixelType);var c=u.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:x,noDataValue:z}),d=[],f,e=null;for(f=0;f<c.pixels.length;f++)e=c.pixels[f],d.push(this._calculateBandStatistics(e));
return new p({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeLerc:function(a,b){this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=A(b.pixelType);for(var c=0,d,f=0,e,g=a.byteLength-10;f<g;){var h=t.decode(a,{inputOffset:f,encodedMaskData:d,returnMask:0===c?!0:!1,returnEncodedMask:0===c?!0:!1,returnFileInfo:!0,pixelType:x,noDataValue:z}),f=h.fileInfo.eofOffset;0===c&&(d=h.encodedMaskData,e=new p({width:b.width,height:b.height,pixels:[],
pixelType:b.pixelType,mask:h.maskData,statistics:[]}));c++;if(h.height!==b.height||h.width!==b.width)throw"The decoded image dimensions are incorrect";e.addData({pixels:h.pixelData,statistics:{minValue:h.minValue,maxValue:h.maxValue,noDataValue:h.noDataValue}})}return e},_calculateBandStatistics:function(a){var b=Infinity,c=-Infinity,d=a.length,f,e=0;for(f=0;f<d;f++)e=a[f],b=e<b?e:b,c=e>c?e:c;return{minValue:b,maxValue:c}},_loadRasterFormatModules:function(){10>c("ie")||m(["./rasterFormats/JpgPlus",
"./rasterFormats/Png","./rasterFormats/Raw"],function(a,c,d){b=a;v=c;u=d})}})})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,e,h,k){return m([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(d){if(d){if(!d.width||Math.floor(d.width)!==d.width)throw"PixelBlock: incorrect width";if(!d.height||Math.floor(d.height)!==d.height)throw"PixelBlock: incorrect height";
if(!d.pixels||!d.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=d.width;this.height=d.height;this.pixels=d.pixels;this.pixelType=d.pixelType||null;this.statistics=d.statistics;this.mask=d.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(d){if(!d.pixels||!d.statistics)throw"Pixel data or statistics are not present";if(d.pixels.length!==
this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(d.statistics);this.pixels.push(d.pixels)},getAsRGBA:function(){var d=new ArrayBuffer(4*this.width*this.height);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(d);break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)},getAsRGBAFloat:function(){var d=new Float32Array(4*this.width*this.height);this._fillFrom32Bit(d);return d},clone:function(){var d=
new this.constructor;d.width=this.width;d.height=this.height;d.pixelType=this.pixelType;this.mask&&(d.mask=new Uint8Array(this.mask));var h,k;if(this.pixels){d.pixels=[];k=this.pixels.length;for(h=0;h<k;h++)d.pixels[h]=new Float32Array(this.pixels[h])}if(this.statistics){d.statistics=[];k=this.statistics.length;for(h=0;h<k;h++)d.statistics[h]=e.clone(this.statistics[h])}return d},_fillFrom8Bit:function(d){var e=this.pixels,h=this.mask;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var c,g,a;c=g=a=e[0];3<=e.length&&(g=e[1],a=e[2]);var e=new Uint32Array(d),k=this.width*this.height;if(c.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(h&&h.length===k)for(d=0;d<k;d++)h[d]&&(e[d]=-16777216|a[d]<<16|g[d]<<8|c[d]);else for(d=0;d<k;d++)e[d]=-16777216|a[d]<<16|g[d]<<8|c[d]},_fillFromNon8Bit:function(d){var e=this.pixels,h=this.mask,c=this.statistics;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var g=1,a=0;c&&0<c.length?(a=c[0].minValue,g=255/(c[0].maxValue-c[0].minValue)):(g=255,"S8"===this.pixelType?(a=-128,g=127):"U16"===this.pixelType?g=65535:"S16"===this.pixelType?(a=-32768,g=32767):"U32"===this.pixelType?g=4294967295:"S32"===this.pixelType?(a=-2147483648,g=2147483647):"F32"===this.pixelType?(a=-3.4*1E39,g=3.4*1E39):"F64"===this.pixelType&&(a=-Number.MAX_VALUE,g=Number.MAX_VALUE),g=255/(g-a));d=new Uint32Array(d);var c=this.width*this.height,k,r,q;k=e[0];if(k.length!==c)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(3<=e.length)if(r=e[1],q=e[2],h&&h.length===c)for(e=0;e<c;e++)h[e]&&(d[e]=-16777216|(q[e]-a)*g<<16|(r[e]-a)*g<<8|(k[e]-a)*g);else for(e=0;e<c;e++)d[e]=-16777216|(q[e]-a)*g<<16|(r[e]-a)*g<<8|(k[e]-a)*g;else if(h&&h.length===c)for(e=0;e<c;e++)r=(k[e]-a)*g,h[e]&&(d[e]=-16777216|r<<16|r<<8|r);else for(e=0;e<c;e++)r=(k[e]-a)*g,d[e]=-16777216|r<<16|r<<8|r},_fillFrom32Bit:function(d){var e=this.pixels,h=this.mask;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var c,g,a;c=g=a=e[0];3<=e.length&&(g=e[1],a=e[2]);var k=this.width*this.height;if(c.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var r=0;if(h&&h.length===k)for(e=0;e<k;e++)d[r++]=c[e],d[r++]=g[e],d[r++]=a[e],d[r++]=h[e];else for(e=0;e<k;e++)d[r++]=c[e],d[r++]=g[e],d[r++]=a[e],d[r++]=255}})})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var m={defaultNoDataValue:-3.4027999387901484E38,decode:function(h,k){var d;k=k||{};var l=k.inputOffset||
0,n=k.encodedMaskData||null===k.encodedMaskData,c={},g=new Uint8Array(h,l,10);c.fileIdentifierString=String.fromCharCode.apply(null,g);if("CntZImage"!=c.fileIdentifierString.trim())throw"Unexpected file identifier string: "+c.fileIdentifierString;var l=l+10,a=new DataView(h,l,24);c.fileVersion=a.getInt32(0,!0);c.imageType=a.getInt32(4,!0);c.height=a.getUint32(8,!0);c.width=a.getUint32(12,!0);c.maxZError=a.getFloat64(16,!0);l+=24;if(!n)if(a=new DataView(h,l,16),c.mask={},c.mask.numBlocksY=a.getUint32(0,
!0),c.mask.numBlocksX=a.getUint32(4,!0),c.mask.numBytes=a.getUint32(8,!0),c.mask.maxValue=a.getFloat32(12,!0),l+=16,0<c.mask.numBytes){var n=new Uint8Array(Math.ceil(c.width*c.height/8)),a=new DataView(h,l,c.mask.numBytes),g=a.getInt16(0,!0),s=2,r=0;do{if(0<g)for(;g--;)n[r++]=a.getUint8(s++);else for(var q=a.getUint8(s++),g=-g;g--;)n[r++]=q;g=a.getInt16(s,!0);s+=2}while(s<c.mask.numBytes);if(-32768!==g||r<n.length)throw"Unexpected end of mask RLE encoding";c.mask.bitset=n;l+=c.mask.numBytes}else 0==
(c.mask.numBytes|c.mask.numBlocksY|c.mask.maxValue)&&(n=new Uint8Array(Math.ceil(c.width*c.height/8)),c.mask.bitset=n);a=new DataView(h,l,16);c.pixels={};c.pixels.numBlocksY=a.getUint32(0,!0);c.pixels.numBlocksX=a.getUint32(4,!0);c.pixels.numBytes=a.getUint32(8,!0);c.pixels.maxValue=a.getFloat32(12,!0);l+=16;n=c.pixels.numBlocksX;g=c.pixels.numBlocksY;n+=0<c.width%n?1:0;g+=0<c.height%g?1:0;c.pixels.blocks=Array(n*g);s=1E9;for(q=r=0;q<g;q++)for(var f=0;f<n;f++){var p=0,a=new DataView(h,l,Math.min(10,
h.byteLength-l)),t={};c.pixels.blocks[r++]=t;var b=a.getUint8(0);p++;t.encoding=b&63;if(3<t.encoding)throw"Invalid block encoding ("+t.encoding+")";if(2===t.encoding)l++,s=Math.min(s,0);else{if(0!==b&&2!==b){b>>=6;t.offsetType=b;if(2===b)t.offset=a.getInt8(1),p++;else if(1===b)t.offset=a.getInt16(1,!0),p+=2;else if(0===b)t.offset=a.getFloat32(1,!0),p+=4;else throw"Invalid block offset type";s=Math.min(t.offset,s);if(1===t.encoding)if(b=a.getUint8(p),p++,t.bitsPerPixel=b&63,b>>=6,t.numValidPixelsType=
b,2===b)t.numValidPixels=a.getUint8(p),p++;else if(1===b)t.numValidPixels=a.getUint16(p,!0),p+=2;else if(0===b)t.numValidPixels=a.getUint32(p,!0),p+=4;else throw"Invalid valid pixel count type";}l+=p;if(3!=t.encoding)if(0===t.encoding){a=(c.pixels.numBytes-1)/4;if(a!==Math.floor(a))throw"uncompressed block has invalid length";p=new ArrayBuffer(4*a);b=new Uint8Array(p);b.set(new Uint8Array(h,l,4*a));p=new Float32Array(p);for(b=0;b<p.length;b++)s=Math.min(s,p[b]);t.rawData=p;l+=4*a}else 1===t.encoding&&
(a=Math.ceil(t.numValidPixels*t.bitsPerPixel/8),p=Math.ceil(a/4),p=new ArrayBuffer(4*p),b=new Uint8Array(p),b.set(new Uint8Array(h,l,a)),t.stuffedData=new Uint32Array(p),l+=a)}}c.pixels.minValue=s;c.eofOffset=l;var l=null!=k.noDataValue?k.noDataValue:m.defaultNoDataValue,g=k.encodedMaskData,p=k.returnMask,s=0,r=c.pixels.numBlocksX,q=c.pixels.numBlocksY,f=Math.floor(c.width/r),t=Math.floor(c.height/q),a=2*c.maxZError,g=g||(c.mask?c.mask.bitset:null),v,n=new (k.pixelType||Float32Array)(c.width*c.height);
p&&g&&(v=new Uint8Array(c.width*c.height));for(var p=new Float32Array(f*t),u,x,b=0;b<=q;b++){var z=b!==q?t:c.height%q;if(0!==z)for(var A=0;A<=r;A++){var C=A!==r?f:c.width%r;if(0!==C){var w=b*c.width*t+A*f,F=c.width-C,D=c.pixels.blocks[s],B,G;if(2>D.encoding){if(0===D.encoding)B=D.rawData;else{B=D.stuffedData;G=D.bitsPerPixel;u=D.numValidPixels;x=D.offset;var I=a,K=p,Q=c.pixels.maxValue,N=(1<<G)-1,O=0,J=void 0,H=0,P=void 0,L=void 0,M=Math.ceil((Q-x)/I),J=4*B.length-Math.ceil(G*u/8);B[B.length-1]<<=
8*J;for(J=0;J<u;J++)0===H&&(L=B[O++],H=32),H>=G?(P=L>>>H-G&N,H-=G):(H=G-H,P=(L&N)<<H&N,L=B[O++],H=32-H,P+=L>>>H),K[J]=P<M?x+P*I:Q;B=p}G=0}else d=2===D.encoding?0:D.offset;var E;if(g)for(x=0;x<z;x++){w&7&&(E=g[w>>3],E<<=w&7);for(u=0;u<C;u++)w&7||(E=g[w>>3]),E&128?(v&&(v[w]=1),n[w++]=2>D.encoding?B[G++]:d):(v&&(v[w]=0),n[w++]=l),E<<=1;w+=F}else if(2>D.encoding)for(x=0;x<z;x++){for(u=0;u<C;u++)n[w++]=B[G++];w+=F}else for(x=0;x<z;x++){for(u=0;u<C;u++)n[w++]=d;w+=F}if(1===D.encoding&&G!==D.numValidPixels)throw"Block and Mask do not match";
s++}}}d=v;v={width:c.width,height:c.height,pixelData:n,minValue:c.pixels.minValue,maxValue:c.pixels.maxValue,noDataValue:l};d&&(v.maskData=d);k.returnEncodedMask&&c.mask&&(v.encodedMaskData=c.mask.bitset?c.mask.bitset:null);if(k.returnFileInfo&&(v.fileInfo=e(c),k.computeUsedBitDepths)){d=v.fileInfo;E=c.pixels.numBlocksX*c.pixels.numBlocksY;B={};for(G=0;G<E;G++)l=c.pixels.blocks[G],0===l.encoding?B.float32=!0:1===l.encoding?B[l.bitsPerPixel]=!0:B[0]=!0;c=Object.keys(B);d.bitDepths=c}return v}},e=function(e){return{fileIdentifierString:e.fileIdentifierString,
fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:this.noDataValue}}};return m})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(m,e,h,k,d,l){return m(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(d){e.mixin(this,d);this.isDataUV=d&&d.isDataUV?d.isDataUV:!1;this.computeMagnitudeAndDirection=e.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(d,c){this.inputUnit=d;this.outputUnit=c;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var d=l.indexOf(this.speedUnits,this.inputUnit),c=l.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=d&&0<=c){var e=[1,0.277778,0.514444,0.3048,0.44704,0];this.unitConversionFactor=e[d]/e[c]}},computeMagnitudeAndDirection:function(e){if(!d.isDefined(e))throw"Could not compute magnitude and direction. No pixel data is available.";var c=e.pixelBlock;if(!d.isDefined(c)||2!==c.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var g=e.extent,a=(g.xmax-g.xmin)/c.width,h=(g.ymax-g.ymin)/c.height,k=g.xmin+a/2,g=g.ymax-h/2;c.statistics[0].minValue=0;c.statistics[0].maxValue=0;var l=180/Math.PI,f=[],p=0,m=0,b=0,v=!d.isDefined(c.mask),u,x,z,A,C,w,F,D;C=F=Infinity;w=D=-Infinity;for(p=0;p<c.height;p++)for(m=0;m<c.width;m++,b++)if(f.push([k+a*m,g-h*p]),v||c.mask[b])z=u=c.pixels[0][b]*this.unitConversionFactor,A=x=c.pixels[1][b],this.isDataUV&&(z=Math.sqrt(u*u+x*x),A=90-l*Math.atan2(x,u),c.pixels[0][b]=z*this.unitConversionFactor,
c.pixels[1][b]=A),z>w&&(w=z),z<C&&(C=z),A>D&&(D=A),A<F&&(F=A);c.statistics[0].maxValue=w;c.statistics[0].minValue=C;c.statistics[1].maxValue=D;c.statistics[1].minValue=F;e.locations=f;return e}})})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(m,e,h,k){var d;return e(null,{constructor:function(d){this.ctx=d.ctx;this._loadRasterFormatModule()},decode:function(d,e){if(!e.width||!e.height)throw"Native decoding requires the image format, width and height";
var c=new h,g,a=new Uint8Array(d),k=this._getFormat(d);if("error"===k)throw"invalid format";"jpeg"===k&&(g=this._getMask(a,e));var r="",q,f;for(q=0;q<a.length;q+=65535)f=a.subarray(q,q+65535>a.length-1?a.length-1:q+65535),r+=String.fromCharCode.apply(null,f);var a="data:image/"+k+";base64,"+window.btoa(r),p=new Image,m;p.src=a;var b=this;p.onload=function(){b.ctx.clearRect(0,0,e.width,e.height);b.ctx.drawImage(p,0,0);var a=b.ctx.getImageData(0,0,p.width,p.height);m=a.data;if(g)for(q=0;q<g.length;q++)m[4*
q+3]=g[q]?255:0;b.ctx.putImageData(a,0,0);c.resolve(null)};p.onerror=function(){c.reject("cannot load image")};return c},_getFormat:function(d){d=new Uint8Array(d,0,10);var e="error";255===d[0]&&216===d[1]?e="jpeg":137===d[0]&&(80===d[1]&&78===d[2]&&71===d[3])&&(e="png");return e},_getMask:function(e,h){var c;try{if(!d)throw"The zlib decoder module is not loaded.";var g=0,a=0,k=Math.round(e.length/2);1===k%2&&(k+=1);for(var r=e.length-2,g=k;g<r&&!(255===e[g]&&217===e[g+1]);g++);k=g+=2;if(k<e.length-
1){var q=(new d(e.subarray(k))).getBytes();c=new Uint8Array(h.width*h.height);for(g=k=0;g<q.length;g++)for(a=7;0<=a;a--)c[k++]=q[g]>>a&1}}catch(f){}return c},_loadRasterFormatModule:function(){10>k("ie")||m(["./Zlib"],function(e){d=e})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(m,e,h,k,d,l,n,c){m=m(n,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(c){this._url.path+="/identify";this._handler=e.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(d,a,e,h,k){try{var f=new c(d);this._successHandler([f],"onComplete",e,k)}catch(p){this._errorHandler(p,h,k)}},execute:function(c,a,h,k){var l=k.assembly;c=this._encode(e.mixin({},this._url.query,{f:"json"},c.toJson(l&&l[0])));var f=this._handler,p=this._errorHandler;return d({url:this._url.path,content:c,callbackParamName:"callback",
load:function(c,b){f(c,b,a,h,k.dfd)},error:function(a){p(a,h,k.dfd)}})},onComplete:function(){}});l._createWrappers(m);return m})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(m,e,h,k,d,l){return m(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(e){e.catalogItems&&(this.catalogItems=new l(e.catalogItems));e.location&&(this.location=d.fromJson(e.location));
this.catalogItemVisibilities=e.catalogItemVisibilities;this.name=e.name;this.objectId=e.objectId;this.value=e.value;this.processedValues=e.processedValues;this.properties=e.properties}})})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(m,e,h,k,d,l,n,c){return m(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,
renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(d){var a=d&&d.geometry||this.geometry;d={geometry:a,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?h.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?h.toJson(this.renderingRule.toJson()):null};a&&(d.geometryType=c.getJsonType(a));a=this.timeExtent;d.time=a?a.toJson().join(","):
null;n.isDefined(this.pixelSizeX)&&n.isDefined(this.pixelSizeY)?d.pixelSize=h.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(d.pixelSize=this.pixelSize?h.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(d.renderingRules=h.toJson(k.map(this.renderingRules,function(a){return a.toJson()})));return d}})})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(m,e){return m(e,{constructor:function(e,
k){this.noLegend=!0},getExtent:function(){},initVisible:function(){},_setTopLayerVisible:function(e){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(e){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred ./LayerInfoForDefault esri/layers/FeatureLayer".split(" "),function(m,e,h,k,d,l){return m(d,
{isTable:null,constructor:function(){this.newSubLayers=[];this.isTable=!0},init:function(){},getLayerObject:function(){var d=new k;if(this.layerObject.empty)if(this.layerObject.url){var c=this._getLayerOptionsForCreateLayerObject();this.layerObject=new l(this.layerObject.url,e.mixin(c,this.originOperLayer.options||{})||{});this.layerObject.on("load",e.hitch(this,function(){d.resolve(this.layerObject)}));this.layerObject.on("error",e.hitch(this,function(){d.resolve(null)}))}else this.layerObject.featureCollectionData?
(this.layerObject=new l(this.layerObject.featureCollectionData,this.originOperLayer.options||{}),d.resolve(this.layerObject)):d.resolve(null);else d.resolve(this.layerObject);return d},getLayerType:function(){var d=new k;d.resolve("Table");return d},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return h.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplate:void 0}},
getFilter:function(){return this.getFilterOfWebmap()}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all esri/request ./LayerInfoForDefault".split(" "),function(m,e,h,k,d,l,n,c){return m(c,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=this.layerObject.serviceDataType&&("esriImageServiceDataTypeVector-UV"===this.layerObject.serviceDataType||
"esriImageServiceDataTypeVector-MagDir"===this.layerObject.serviceDataType)?"ArcGISImageServiceVectorLayer":"ArcGISImageServiceLayer"},_initLegendsNode:function(c){10.2<=this.layerObject.version?this._legendRequestServer().then(k.hitch(this,function(a){e.empty(c);h.forEach(a.layers,function(a){h.forEach(a.legend,function(a){if("\x3call other values\x3e"!==a.label){var d=e.create("div",{"class":"legend-div"},c),f=e.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},
d),h=null,h=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;e.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:h},f);e.create("div",{"class":"legend-label jimu-float-leading",innerHTML:a.label||" "},d)}},this)},this)}),k.hitch(this,function(){e.empty(c)})):e.empty(c)},_legendRequestServer:function(){var c=this.layerObject.url+"/legend",a={f:"json"};this.layerObject._params.bandIds&&(a.bandIds=this.layerObject._params.bandIds);
this.layerObject._params.renderingRule&&(a.renderingRule=this.layerObject._params.renderingRule);return n({url:c,content:a,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var c=new d,a={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},e=this.getLayerType(),h=this.getLayerObject();l({type:e,layerObject:h}).then(k.hitch(this,function(d){var f=d.type;d=d.layerObject;a.layerType=f;0<=this._getLayerTypesOfSupportTable().indexOf(f)&&(a.isSupportedLayer=!0);d.capabilities&&
0<=d.capabilities.indexOf("Catalog")?a.isSupportQuery=!0:a.isSupportedLayer=!1;c.resolve(a)}),function(){c.resolve(a)});return c}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(m,e,h,k,d){return m(d,{getSupportTableInfo:function(){var d=new h,m={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},c=this.getLayerType(),g=this.getLayerObject();
k({type:c,layerObject:g}).then(e.hitch(this,function(a){var c=a.type;a=a.layerObject;m.layerType=c;0<=this._getLayerTypesOfSupportTable().indexOf(c)&&(m.isSupportedLayer=!0);if((c=a.getLatestObservations())&&0<c.length)m.otherReasonCanNotSupport=!1;d.resolve(m)}),function(){d.resolve(m)});return d}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(m,
e,h,k,d,l,n,c,g){return l("dijit.layout._LayoutWidget",[e,h,k],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);n.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var a=this.getParent&&this.getParent();if(!a||!a.isLayoutContainer)this.resize(),this.own(d.on("resize",m.hitch(this,"resize")))}},resize:function(a,d){var e=this.domNode;a&&c.setMarginBox(e,a);var h=d||{};m.mixin(h,
a||{});if(!("h"in h)||!("w"in h))h=m.mixin(c.getMarginBox(e),h);var f=g.getComputedStyle(e),k=c.getMarginExtents(e,f),l=c.getBorderExtents(e,f),h=this._borderBox={w:h.w-(k.w+l.w),h:h.h-(k.h+l.h)},k=c.getPadExtents(e,f);this._contentBox={l:g.toPixelValue(e,f.paddingLeft),t:g.toPixelValue(e,f.paddingTop),w:h.w-k.w,h:h.h-k.h};this.layout()},layout:function(){},_setupChild:function(a){n.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,c){this.inherited(arguments);
this._started&&this._setupChild(a)},removeChild:function(a){n.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t){s("dijit-legacy-requires")&&
t(0,function(){m(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return h("dijit.Menu",p,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):e.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return q.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(b){b=k.byId(b,this.ownerDocument);var f;if("iframe"==b.tagName.toLowerCase()){var e=b;f=this._iframeContentWindow(e);f=r.body(f.document)}else f=b==r.body(this.ownerDocument)?this.ownerDocument.documentElement:b;var h={node:b,
iframe:e};d.set(b,"_dijitMenu"+this.id,this._bindings.push(h));var p=g.hitch(this,function(b){var d=this.selector,f=d?function(b){return a.selector(d,b)}:function(a){return a},g=this;return[a(b,f(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<g._lastKeyDown+500||g._scheduleOpen(this,e,{x:a.pageX,y:a.pageY},a.target)}),a(b,f("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==c.F10||g.leftClickToOpen&&a.keyCode==c.SPACE)a.stopPropagation(),
a.preventDefault(),g._scheduleOpen(this,e,null,a.target),g._lastKeyDown=(new Date).getTime()})]});h.connects=f?p(f):[];e&&(h.onloadHandler=g.hitch(this,function(){var a=this._iframeContentWindow(e),a=r.body(a.document);h.connects=p(a)}),e.addEventListener?e.addEventListener("load",h.onloadHandler,!1):e.attachEvent("onload",h.onloadHandler))},unBindDomNode:function(a){var c;try{c=k.byId(a,this.ownerDocument)}catch(f){return}a="_dijitMenu"+this.id;if(c&&d.has(c,a)){for(var e=d.get(c,a)-1,g=this._bindings[e],
h;h=g.connects.pop();)h.remove();(h=g.iframe)&&(h.removeEventListener?h.removeEventListener("load",g.onloadHandler,!1):h.detachEvent("onload",g.onloadHandler));d.remove(c,a);delete this._bindings[e]}},_scheduleOpen:function(a,c,d,f){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:f,delegatedTarget:a,iframe:c,coords:d})},1))},_openMyself:function(a){function c(){m.refocus&&t&&t.focus();f.close(m)}var d=a.target,e=a.iframe,g=a.coords,h=!g;this.currentTarget=
a.delegatedTarget;if(g){if(e){a=l.position(e,!0);var d=this._iframeContentWindow(e),d=l.docScroll(d.document),p=n.getComputedStyle(e),q=n.toPixelValue,r=(s("ie")&&s("quirks")?0:q(e,p.paddingLeft))+(s("ie")&&s("quirks")?q(e,p.borderLeftWidth):0),e=(s("ie")&&s("quirks")?0:q(e,p.paddingTop))+(s("ie")&&s("quirks")?q(e,p.borderTopWidth):0);g.x+=a.x+r-d.x;g.y+=a.y+e-d.y}}else g=l.position(d,!0),g.x+=10,g.y+=10;var m=this,e=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var t=!a||
k.isDescendant(a,this.domNode)?e:a;f.open({popup:this,x:g.x,y:g.y,onExecute:c,onCancel:c,orient:this.isLeftToRight()?"L":"R"});this.focus();h||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);f.close(this)}},destroy:function(){e.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(m,e,h){return m("dgrid.OnDemandGrid",[e,h],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(m,e,h,k,d,l,n){function c(a,c){c&&c.nodeType&&a.appendChild(c)}function g(a,c,d,f){if(this.formatter){f=this.formatter;var e=this.grid.formatterScope;d.innerHTML="string"===typeof f&&e?e[f](c,a):this.formatter(c,a)}else null!=c&&d.appendChild(document.createTextNode(c))}var a=8>k("ie")&&
!k("quirks");e=e("dgrid.Grid",l,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!=typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,c){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);var d;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var f=a.columnId;if(f){c=f;d=a;break}a=a.parentNode}while(a&&a!=this.domNode)}if(!d&&"undefined"!=typeof c){var e=this.row(a);if(f=e&&e.element)for(var f=f.getElementsByTagName("td"),
g=0;g<f.length;g++)if(f[g].columnId==c){d=f[g];break}}if(null!=a)return{row:e||this.row(a),column:c&&this.column(c),element:d}},createRowCells:function(c,e,g,f){var h=d("table.dgrid-row-table[role\x3dpresentation]"),l=9>k("ie")||k("quirks")?d(h,"tbody"):h,b,m,u,x,z,A,C,w,F,D;g=g||this.subRows;m=0;for(u=g.length;m<u;m++){A=g[m];b=d(l,"tr");A.className&&d(b,"."+A.className);x=0;for(z=A.length;x<z;x++){C=A[x];w=C.id;F=C.field?".field-"+n.escapeCssIdentifier(C.field,"-"):"";(D="function"===typeof C.className?
C.className(f):C.className)&&(F+="."+D);F=d(c+(".dgrid-cell.dgrid-cell-padding"+(w?".dgrid-column-"+n.escapeCssIdentifier(w,"-"):"")+F.replace(/ +/g,"."))+"[role\x3d"+("th"===c?"columnheader":"gridcell")+"]");F.columnId=w;a?(w=d(F,"!dgrid-cell-padding div.dgrid-cell-padding"),F.contents=w):w=F;if(D=C.colSpan)F.colSpan=D;if(D=C.rowSpan)F.rowSpan=D;e(w,C);b.appendChild(F)}}return h},left:function(a,c){a.element||(a=this.cell(a));return this.cell(this._move(a,-(c||1),"dgrid-cell"))},right:function(a,
c){a.element||(a=this.cell(a));return this.cell(this._move(a,c||1,"dgrid-cell"))},renderRow:function(a,e){var h=this.createRowCells("td",function(d,h){var k=a;h.get?k=h.get(a):"field"in h&&"_item"!=h.field&&(k=k[h.field]);h.renderCell?c(d,h.renderCell(a,k,d,e)):g.call(h,a,k,d,e)},e&&e.subRows,a);return d("div[role\x3drow]\x3e",h)},renderHeader:function(){var e=this,g=this.headerNode,l=g.childNodes.length;for(g.setAttribute("role","row");l--;)d(g.childNodes[l],"!");l=this.createRowCells("th",function(d,
e){var g=e.headerNode=d;a&&(d=d.parentNode);var b=e.field;b&&(d.field=b);if(e.renderHeaderCell)c(g,e.renderHeaderCell(g));else if("label"in e||e.field)g.appendChild(document.createTextNode("label"in e?e.label:e.field));!1!==e.sortable&&(b&&"_item"!=b)&&(d.sortable=!0,d.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[l.id=this.id+"-header"]=this.columns;g.appendChild(l);this._sortListener&&this._sortListener.remove();this._sortListener=h(l,"click,keydown",
function(a){if("click"==a.type||32==a.keyCode||!k("opera")&&13==a.keyCode){var c=a.target,d,b,l;do if(c.sortable){l=[{attribute:d=c.field||c.columnId,descending:(b=e._sort[0])&&b.attribute==d&&!b.descending}];d={bubbles:!0,cancelable:!0,grid:e,parentType:a.type,sort:l};h.emit(a.target,"dgrid-sort",d)&&(e._sortNode=c,e.set("sort",l));break}while((c=c.parentNode)&&c!=g)}})},resize:function(){var a=this.headerNode.firstChild,c=this.contentNode,d;this.inherited(arguments);if(!k("ie")||7<k("ie")&&!k("quirks"))if(c.style.width=
"",c&&a&&(d=a.offsetWidth)!=c.offsetWidth)c.style.width=d+"px"},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(a,c){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(a){var c=this.columns,d;for(d in c){var f=c[d];if(f.field==a)return f.headerNode}},updateSortArrow:function(a,c){this._lastSortedArrow&&(d(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),d(this._lastSortedArrow,
"!"),delete this._lastSortedArrow);c&&(this._sort=a);if(a[0]){var e=a[0].attribute,f=a[0].descending,e=this._sortNode||this._findSortArrowParent(e),g;delete this._sortNode;e&&(e=e.contents||e,g=this._lastSortedArrow=d("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),g.innerHTML="\x26nbsp;",e.insertBefore(g,e.firstChild),d(e,f?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(a,c){return this.addCssRule("#"+n.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+n.escapeCssIdentifier(a,
"-"),c)},_configColumns:function(a,c){var d=[],f=c instanceof Array;n.each(c,function(e,g){"string"==typeof e&&(c[g]=e={label:e});!f&&!e.field&&(e.field=g);g=e.id=e.id||(isNaN(g)?g:a+g);this._configColumn&&(this._configColumn(e,g,c,a),g=e.id);f&&(this.columns[g]=e);e.grid=this;"function"===typeof e.init&&e.init();d.push(e)},this);return f?c:d},_destroyColumns:function(){var a=this.subRows,c=a&&a.length,d,f,e,g;this.cleanup();for(d=0;d<c;d++){f=0;for(g=a[d].length;f<g;f++)e=a[d][f],"function"===typeof e.destroy&&
e.destroy()}},configStructure:function(){var a=this.subRows,c=this._columns=this.columns;this.columns=!c||c instanceof Array?{}:c;if(a)for(c=0;c<a.length;c++)a[c]=this._configColumns(c+"-",a[c]);else this.subRows=[this._configColumns("",c)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=a;this._updateColumns()},setColumns:function(a){m.deprecated("setColumns(...)",
'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",a)},setSubRows:function(a){m.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",a)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});e.appendIfNode=c;e.defaultRenderCell=g;return e})},"put-selector/put":function(){(function(m){var e,
h=/[-+,> ]/;m([],e=function(k,d){function l(d){function e(){b&&(t&&b!=t)&&(t==d&&(q||(q=h.test(z)&&k.createDocumentFragment()))?q:t).insertBefore(b,p||null)}for(var q,f,p,t,b,v=arguments,u=v[0],x=0;x<v.length;x++){var z=v[x];if("object"==typeof z){f=!1;if(z instanceof Array){b=k.createDocumentFragment();for(var A=0;A<z.length;A++)b.appendChild(l(z[A]));z=b}if(z.nodeType)b=z,e(),t=z,p=0;else for(A in z)b[A]=z[A]}else if(f)f=!1,b.appendChild(k.createTextNode(z));else{1>x&&(d=null);f=!0;if(u=z.replace(m,
function(f,h,q,m,n,u){h&&(e(),"-"==h||"+"==h?(t=(p=b||t).parentNode,b=null,"+"==h&&(p=p.nextSibling)):("\x3c"==h?t=b=(b||t).parentNode:(","==h?t=d:b&&(t=b),b=null),p=0),b&&(t=b));if((f=!q&&m)||!b&&(q||n))"$"==f?(f=v[++x],t.appendChild(k.createTextNode(f))):(f=f||l.defaultTag,(h=a&&v[x+1]&&v[x+1].name)&&(f="\x3c"+f+' name\x3d"'+h+'"\x3e'),b=g&&~(c=f.indexOf("|"))?k.createElementNS(g[f.slice(0,c)],f.slice(c+1)):k.createElement(f));if(q)if("$"==m&&(m=v[++x]),"#"==q)b.id=m;else if(h=(f=b.className)&&
(" "+f+" ").replace(" "+m+" "," "),"."==q)b.className=f?(h+m).substring(1):m;else if("!"==z){var A;a?l("div",b,"\x3c").innerHTML="":(A=b.parentNode)&&A.removeChild(b)}else h=h.substring(1,h.length-1),h!=f&&(b.className=h);n&&("$"==u&&(u=v[++x]),"style"==n?b.style.cssText=u:(q="!"==n.charAt(0)?(n=n.substring(1))&&"removeAttribute":"setAttribute",u=""===u?n:u,g&&~(c=n.indexOf("|"))?b[q+"NS"](g[n.slice(0,c)],n.slice(c+1),u):b[q](n,u)));return""}))throw new SyntaxError("Unexpected char "+u+" in "+z);
e();t=u=b||t}}d&&q&&d.appendChild(q);return u}h=d||h;var m=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,c,g=!1;k=k||document;var a="object"==typeof k.createElement;l.addNamespace=function(a,c){k.createElementNS?(g||(g={}))[a]=c:k.namespaces.add(a,c)};l.defaultTag="div";l.forDocument=e;return l})})(function(m,e,h){h=h||e;"function"===typeof define?define([],function(){return h()}):"undefined"==typeof window?require("./node-html")(module,h):put=
h()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(m,e,h,k,d,l,n,c,g){function a(a,b){g(document.body,a,".dgrid-scrollbar-measure");var c=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return c}function s(a){var b=a?"."+a.replace(v,"."):"";this._class&&(b="!"+this._class.replace(v,"!")+
b);g(this.domNode,b);this._class=a}function r(){return this._class}function q(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function f(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}c("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var p,t;d.add("dom-scrollbar-width",function(b,c,d){return a(d,"Width")});d.add("dom-scrollbar-height",function(b,c,d){return a(d,"Height")});d.add("dom-rtl-scrollbar-left",
function(a,b,c){a=g("div");g(document.body,c,".dgrid-scrollbar-measure[dir\x3drtl]");g(c,a);b=!!d("ie")||!!d("trident")||a.offsetLeft>=d("dom-scrollbar-width");c.className="";document.body.removeChild(c);g(a,"!");c.removeAttribute("dir");return b});var b=0,v=/ +/g,u=7>d("ie")&&!d("quirks")?function(){var a,b,c;if(this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==a))this.resize(),this._prevWinDims=[b,a]}:function(){this._started&&this.resize()};
return e("dgrid.List",d("touch")?n:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,c){var f=
this.domNode=c||g("div"),h;a?(this.params=a,e.safeMixin(this,a),h=a["class"]||a.className||f.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=f.id=f.id||this.id||"dgrid_"+b++;null===this.useTouchScroll&&(this.useTouchScroll=!d("dom-scrollbar-width"));this.buildRendering();h&&s.call(this,h);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&
this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,c=this,f,e,h,p;p=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";g(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));f=this.headerNode=g(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(d("quirks")||8>d("ie"))&&g(a,"div.dgrid-spacer");e=this.bodyNode=g(a,"div.dgrid-scroller");
d("ff")&&(e.tabIndex=-1);this.headerScrollNode=g(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));h=this.footerNode=g("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));g(a,h);p&&(a.className+=" dgrid-rtl"+(d("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));k(e,"scroll",function(b){c.showHeader&&(f.scrollLeft=b.scrollLeft||e.scrollLeft);b.stopPropagation();k.emit(a,"scroll",{scrollTarget:e})});this.configStructure();this.renderHeader();this.contentNode=
this.touchNode=g(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=k(window,"resize",l.throttleDelayed(u,this)))},postCreate:d("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,b=this.headerNode,c=this.footerNode,f=b.offsetHeight,
e=this.showFooter?c.offsetHeight:0,g=d("quirks")||7>d("ie");this.headerScrollNode.style.height=a.style.marginTop=f+"px";a.style.marginBottom=e+"px";g&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-f-e,0)+"px",e&&(c.style.bottom="1px",setTimeout(function(){c.style.bottom=""},0)));p||(p=d("dom-scrollbar-width"),t=d("dom-scrollbar-height"),d("ie")&&(p++,t++),l.addCssRule(".dgrid-scrollbar-width","width: "+p+"px"),l.addCssRule(".dgrid-scrollbar-height","height: "+t+"px"),17!=p&&
!g&&(l.addCssRule(".dgrid-header-row","right: "+p+"px"),l.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+p+"px")));g&&(b.style.width=a.clientWidth+"px",setTimeout(function(){b.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,b){var c=l.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(c);return c},on:function(a,b){var c=k(this.domNode,a,b);d("dom-addeventlistener")||this._listeners.push(c);return c},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=
this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();g(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";
this.scrollTo({x:0,y:0})},newRow:function(a,b,c,d,f){if(b){var e=this.insertRow(a,b,c,d,f);g(e,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){g(e,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return e}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&g(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=
b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<r)for(var e=0;e<b.length;e++){var g=b[e],h=q[g?0:q.length-1];if(h=h&&f(h)){var l=h[g?"previousSibling":"nextSibling"];l&&(l=k.row(l));l&&l.element!=h&&(g=g?"unshift":"push",a[g](l.data),q[g](l.element),c.count++)}}}function f(a){return!h.isDescendant(a,k.domNode)&&document.getElementById(a.id)?k.row(a.id.slice(k.id.length+5)).element:a}function e(a){t=k.insertRow(a,s,null,l++,c);t.observerIndex=
r;return t}function g(a){v=a.slice(0);(m=b?b.parentNode:k.contentNode)&&m.parentNode&&(m!==k.contentNode||a.length)?(m.insertBefore(s,b||null),(t=a[a.length-1])&&k.adjustRowIndices(t)):p[r]&&k.cleanEmptyObservers&&"undefined"!==typeof r&&(p[r].cancel(),p[r]=0,k._numObservers--);q=a;n&&(n.rows=q)}c=c||{};var k=this,l=c.start||0,p=this.observers,q,m,r;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){k._numObservers++;var n=a.observe(function(e,g,h){var l,p,n;-1<g&&q[g]&&(l=q.splice(g,
1)[0],l.parentNode==m&&((p=l.nextSibling)&&g!=h&&p.rowIndex--,k.removeRow(l)),c.count--,k._processScroll&&k._processScroll());if(-1<h){if(q.length)if(0===h)n=(n=q[h])&&f(n);else{if(n=q[h-1])n=f(n),n=(n.connected||n).nextSibling}else n=k._getFirstRowSibling&&k._getFirstRowSibling(m);l&&(n&&l.id===n.id)&&(n=(n.connected||n).nextSibling);n&&!n.parentNode&&(n=document.getElementById(n.id));l=b&&b.parentNode||n&&n.parentNode||k.contentNode;if(l=k.newRow(e,l,n,c.start+h,c))if(l.observerIndex=r,q.splice(h,
0,l),!p||h<g)p=l.previousSibling,p=!p||p.rowIndex+1==l.rowIndex||0==l.rowIndex?l:p;c.count++}0===g?d(1,1):g===a.length-(-1===h?0:1)&&d(0,0);g!=h&&p&&k.adjustRowIndices(p);k._onNotification(q,e,g,h)},!0);r=p.push(n)-1}var s=document.createDocumentFragment(),t,v;if(a.map){if(q=a.map(e,console.error),q.then)return a.then(function(b){a=b;return q.then(function(a){g(a);d(1,1,0,0);return v})})}else{q=[];for(var u=0,M=a.length;u<M;u++)q[u]=e(a[u])}g(q);d(1,1,0,0);return v},_onNotification:function(a,b,c,
d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,f){var e=f.parentId,e=this.id+"-row-"+(e?e+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(e),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));g=this.renderRow(a,f);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=e]=a;b.insertBefore(g,
c||null);h&&this.adjustRowIndices(h);g.rowIndex=d;return g},renderRow:function(a,b){return g("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||g(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):
(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var f,e;e=f=a.element;b=b||1;do if(a=f[0>b?"previousSibling":"nextSibling"]){do if((f=a)&&-1<(f.className+" ").indexOf(c+" ")){e=f;b+=0>b?1:-1;break}while(a=(!d||!f.hidden)&&f[0>b?"lastChild":"firstChild"])}else if(f=f.parentNode,!f||f===this.bodyNode||f===this.headerNode)break;while(b);return e},up:function(a,b,c){a.element||
(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:d("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):f.call(this,a)}:f,getScrollPosition:d("touch")?function(){return this.useTouchScroll?this.inherited(arguments):q.call(this)}:q,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,
1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:r,_setClass:s,_getClassName:r,_setClassName:s,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,
d){var f=c[a],e=d[a];void 0===f&&(f="");void 0===e&&(e="");return f==e?0:f>e==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){m.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;g(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){m.deprecated("setShowHeader(...)",
'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;g(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(m,e){m.add("dom-contains",function(c,a,d){return!!d.contains});var h=[],k,d,l,n=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,c={defaultDelay:15,throttle:function(d,a,e){var h=!1;e=e||c.defaultDelay;return function(){h||(h=!0,d.apply(a,arguments),
setTimeout(function(){h=!1},e))}},throttleDelayed:function(d,a,e){var h=!1;e=e||c.defaultDelay;return function(){if(!h){h=!0;var c=arguments;setTimeout(function(){h=!1;d.apply(a,c)},e)}}},debounce:function(d,a,e){var h;e=e||c.defaultDelay;return function(){h&&(clearTimeout(h),h=null);var c=arguments;h=setTimeout(function(){d.apply(a,c)},e)}},each:function(c,a,d){var e,h;if(c)if("number"===typeof c.length){e=0;for(h=c.length;e<h;e++)a.call(d,c[e],e,c)}else for(e in c)a.call(d,c[e],e,c)},contains:function(c,
a){return m("dom-contains")?c.contains(a):c.compareDocumentPosition(a)&8},addCssRule:function(c,a){k||(k=e(document.getElementsByTagName("head")[0],"style"),k=k.sheet||k.styleSheet,d=k.deleteRule?"deleteRule":"removeRule",l=k.cssRules?"cssRules":"rules");var m=h.length;h[m]=(k.cssRules||k.rules).length;k.addRule?k.addRule(c,a):k.insertRule(c+"{"+a+"}",h[m]);return{get:function(a){return k[l][h[m]].style[a]},set:function(a,c){"undefined"!==typeof h[m]&&(k[l][h[m]].style[a]=c)},remove:function(){var a=
h[m],c,f;if(void 0!==a){k[d](a);h[m]=void 0;c=m+1;for(f=h.length;c<f;c++)h[c]>a&&h[c]--}}}},escapeCssIdentifier:function(c,a){return"string"===typeof c?c.replace(n,a||"\\$1"):c}};return c})},"xstyle/has-class":function(){define(["dojo/has"],function(m){var e={};return function(){for(var h,k=arguments,d=0;d<k.length;d++)if(h=k[d],!e[h]){e[h]=!0;var l=h.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),n=m(l[2]),c=-l[4];if((0<c?c<=n&&(-l[5]||c)>=n:!!n)==!l[1])document.documentElement.className+=" has-"+
h}}})},"xstyle/css":function(){define(["require"],function(m){function e(e,k,d){var l=document.documentElement;e=l.insertBefore(document.createElement(e),l.firstChild);e.id=k;k=(e.currentStyle||getComputedStyle(e,null)||{})[d];l.removeChild(e);return k}return{load:function(h,k,d,l){function n(a){var c=e("x-parse",null,"content"),g=a&&(a.sheet||a.styleSheet);c&&"none"!=c&&"normal"!=c?k([eval(c)],function(c){a?c.process(a,d):(c.processAll(),d(g))}):d(g)}var c=k.toUrl(h),g;c.match(/!$/)&&(g={wait:!1},
c=c.slice(0,-1));var a=k.cache&&k.cache["url:"+c];if(a)a.xCss&&(a=a.cssText),m(["./core/load-css"],function(c){n(c.insertCss(a))});else{if("none"==e("div",h.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return n();m(["./core/load-css"],function(a){a(c,n,g)})}}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(m,e,h,k,d,l,n,c,g){return h("dgrid.OnDemandList",
[m,e],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:c.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var a=this;n(this.bodyNode,"scroll",c[this.pagingMethod](function(c){a._processScroll(c)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(a,c){function e(a){g(x,
"!");if(a)throw h._refreshDeferred&&(h._refreshDeferred.reject(a),delete h._refreshDeferred),a;}var h=this,f=c&&c.container||this.contentNode,l={query:a,count:0,options:c},m,b=this.preload,n,u={node:g(f,"div.dgrid-preload",{rowIndex:0}),count:0,query:a,next:l,options:c};u.node.style.height="0";l.node=m=g(f,"div.dgrid-preload");l.previous=u;m.rowIndex=this.minRowsPerPage;b?((l.next=b.next)&&m.offsetTop>=b.node.offsetTop?l.previous=b:(l.next=b,l.previous=b.previous),l.previous.next=l,l.next.previous=
l):this.preload=l;var x=g(m,"-div.dgrid-loading");g(x,"div.dgrid-below").innerHTML=this.loadingMessage;c=k.mixin(this.get("queryOptions"),c,{start:0,count:this.minRowsPerPage},"level"in a?{queryLevel:a.level}:null);this._trackError(function(){return n=a(c)});if("undefined"===typeof n)e();else return d.when(h.renderArray(n,m,c),function(a){return d.when("undefined"===typeof n.total?n.length:n.total,function(b){var d=a.length,e=m.parentNode,f=h.noDataNode;g(x,"!");"queryLevel"in c||(h._total=b);0===
b&&e&&(f&&(g(f,"!"),delete h.noDataNode),h.noDataNode=f=g("div.dgrid-no-data"),e.insertBefore(f,h._getFirstRowSibling(e)),f.innerHTML=h.noDataMessage);for(f=e=0;f<d;f++)e+=h._calcRowHeight(a[f]);d&&e&&(h.rowHeight=e/d);b-=d;l.count=b;m.rowIndex=d;b?m.style.height=Math.min(b*h.rowHeight,h.maxEmptySpace)+"px":(m.style.display="none",c.count++);h._previousScrollPosition&&(h.scrollTo(h._previousScrollPosition),delete h._previousScrollPosition);h._processScroll();h._refreshDeferred&&(h._refreshDeferred.resolve(n),
delete h._refreshDeferred);return a},e)},e),n},refresh:function(a){var c=this,e=a&&a.keepScrollPosition,g;"undefined"===typeof e&&(e=this.keepScrollPosition);e&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return e=this._refreshDeferred=new d,g=c.renderQuery(function(a){return c.store.query(c.query,a)}),"undefined"===typeof g&&e.reject(),e.then(function(a){c._refreshTimeout=setTimeout(function(){n.emit(c.domNode,"dgrid-refresh-complete",{bubbles:!0,
cancelable:!1,grid:c,results:a});c._refreshTimeout=null},0);delete c._refreshDeferred;return a},function(a){delete c._refreshDeferred;throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var c=a.nextSibling;return c&&!/\bdgrid-preload\b/.test(c.className)?c.offsetTop-a.offsetTop:a.offsetHeight},lastScrollTop:0,_processScroll:function(a){function c(a,b,d,h){var k=f.farOffRemoval,l=a.node;if(b>2*
k){for(var p,m=l[d],q=0,n=0,t=[];p=m;){var s=f._calcRowHeight(p);if(q+s+k>b||0>m.className.indexOf("dgrid-row")&&0>m.className.indexOf("dgrid-loading"))break;m=p[d];q+=s;n+=p.count||1;f.removeRow(p,!0);t.push(p)}a.count+=n;h?(l.rowIndex-=n,e(a)):l.style.height=l.offsetHeight+q+"px";var v=g("div",t);setTimeout(function(){g(v,"!")},1)}}function e(a,b){a.node.style.height=Math.min(a.count*f.rowHeight,b?Infinity:f.maxEmptySpace)+"px"}function h(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);
return a}var f=this,l=f.bodyNode;a=a&&a.scrollTop||this.getScrollPosition().y;var l=l.offsetHeight+a,m,b,n=f.preload,u=f.lastScrollTop,x=f.bufferRows*f.rowHeight,z=x-f.rowHeight,A,C,w,F=!0;for(f.lastScrollTop=a;n&&!n.node.offsetWidth;)n=n.previous;for(;n&&n!=m;){m=f.preload;f.preload=n;b=n.node;var D=b.offsetTop;if(l+1+z<D)n=h(n,F=!1);else if(a-1-z>D+b.offsetHeight)n=h(n,F=!0);else{var B=((b.rowIndex?a-x:l)-D)/f.rowHeight,D=(l-a+2*x)/f.rowHeight,G=Math.max(Math.min((a-u)*f.rowHeight,f.maxRowsPerPage/
2),f.maxRowsPerPage/-2),D=D+Math.min(Math.abs(G),10);0==b.rowIndex&&(B-=D);B=Math.max(B,0);10>B&&(0<B&&D+B<f.maxRowsPerPage)&&(D+=Math.max(0,B),B=0);D=Math.min(Math.max(D,f.minRowsPerPage),f.maxRowsPerPage,n.count);if(0==D)n=h(n,F);else{var D=Math.ceil(D),B=Math.min(Math.floor(B),n.count-D),I=k.mixin(f.get("queryOptions"),n.options);n.count-=D;var K=b,Q,N=f.queryRowsOverlap;if(G=(0<b.rowIndex||b.offsetTop>a)&&n){var O=n.previous;O&&(c(O,a-(O.node.offsetTop+O.node.offsetHeight),"nextSibling"),0<B&&
O.node==b.previousSibling?(B=Math.min(n.count,B),n.previous.count+=B,e(n.previous,!0),b.rowIndex+=B,N=0):D+=B,n.count-=B);I.start=b.rowIndex-N;I.count=Math.min(D+N,f.maxRowsPerPage);b.rowIndex=I.start+I.count}else n.next&&(c(n.next,n.next.node.offsetTop-l,"previousSibling",!0),K=b.nextSibling,K==n.next.node?(n.next.count+=n.count-B,n.next.node.rowIndex=B+D,e(n.next),n.count=B,N=0):Q=!0),I.start=n.count,I.count=Math.min(D+N,f.maxRowsPerPage);Q&&(K&&K.offsetWidth)&&(Q=K.offsetTop);e(n);"level"in n.query&&
(I.queryLevel=n.query.level);if("queryLevel"in I||!(I.start>f._total||0>I.count)){b=g(K,"-div.dgrid-loading[style\x3dheight:"+D*f.rowHeight+"px]");g(b,"div.dgrid-"+(G?"below":"above")).innerHTML=f.loadingMessage;b.count=D;var J=n.query(I);if(void 0===f._trackError(function(){return J})){g(b,"!");return}(function(a,b,c,h){w=d.when(f.renderArray(h,a,I),function(k){C=h;K=a.nextSibling;g(a,"!");if(c&&K&&K.offsetWidth){var l=f.getScrollPosition();f.scrollTo({x:l.x,y:l.y+K.offsetTop-c,preserveMomentum:!0})}d.when(h.total||
h.length,function(a){"queryLevel"in I||(f._total=a);b&&(b.count=a-b.node.rowIndex,0===b.count&&I.count++,e(b))});f._processScroll();return k},function(b){g(a,"!");throw b;})}).call(this,b,G,Q,J);n=n.previous}}}}if(w&&(A=this._refreshDeferred))delete this._refreshDeferred,d.when(w,function(){A.resolve(C)})},removeRow:function(a,c){if(a){var d=a.previousSibling,e=a.nextSibling,d=d&&(null!=d.observerIndex?d.observerIndex:d.previousObserverIndex),f=e&&(null!=e.observerIndex?e.observerIndex:e.nextObserverIndex),
e=a.observerIndex;a.observerIndex=void 0;c&&(a.nextObserverIndex=f,a.previousObserverIndex=d);if(this.cleanEmptyObservers&&(-1<e&&e!==d&&e!==f)&&(d=this.observers,f=d[e])){if(!c)for(var g=f.rows,h=0;h<g.length;h++)if(g[h]!=a&&l.isDescendant(g[h],this.domNode))return this.inherited(arguments);f.cancel();this._numObservers--;d[e]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),
function(m,e,h,k,d,l,n){function c(a){return a}function g(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;a.grid=this;d.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return e("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};l.before(this,"configStructure",
h.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_updateNotifyHandle:function(a){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);a&&("function"===typeof a.notify&&this.shouldObserveStore)&&
(this._notifyHandle=l.after(a,"notify",h.hitch(this,"_onNotify"),!0),a=this.get("sort"),(!a||!a.length)&&console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(a,c,d){this._updateNotifyHandle(a);this.store=a;this.dirty={};this.set("query",c,d)},_setQuery:function(a,c){var d=c&&c.sort;this.query=void 0!==a?a:this.query;this.queryOptions=c||
this.queryOptions;this._started&&(d?this.set("sort",d):this.refresh())},setStore:function(a,c,d){m.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",a,c,d)},setQuery:function(a,c){m.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",a,c)},_getQueryOptions:function(){var a=h.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;
return"object"==typeof a&&null!=a?h.delegate(a,{}):a},_setSort:function(a,c){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(a,c){this.inherited(arguments);a&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var a=this.inherited(arguments);this.store||(this.noDataNode=n(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return a},renderArray:function(){var a=this,c=this.inherited(arguments);this.store||
k.when(c,function(c){c.length&&a.noDataNode&&n(a.noDataNode,"!")});return c},insertRow:function(a,c,d,e,f){var g=this.store,k=this.dirty,g=g&&g.getIdentity(a),b;g in k&&!(g in this._updating)&&(b=k[g]);b&&(a=h.delegate(a,b));return this.inherited(arguments)},updateDirty:function(a,c,d){var e=this.dirty,f=e[a];f||(f=e[a]={});f[c]=d},setDirty:function(a,c,d){m.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(a,c,d)},save:function(){function a(a,b){return function(f){var g=
c._columnsWithSet,h=c._updating,l,p;if("function"===typeof f.set)f.set(b);else for(l in b)f[l]=b[l];for(l in g)p=g[l].set(f),void 0!==p&&(f[l]=p);h[a]=!0;return k.when(d.put(f),function(){delete e[a];delete h[a]})}}var c=this,d=this.store,e=this.dirty,f=new k,g=f.promise,h=function(a){var b;return c.getBeforePut||!(b=c.row(a).data)?function(){return d.get(a)}:function(){return b}},b;for(b in e)var l=a(b,e[b]),g=g.then(h(b)).then(l);f.resolve();return g},revert:function(){this.dirty={};this.refresh()},
_trackError:function(a){var d;"string"==typeof a&&(a=h.hitch(this,a));try{d=a()}catch(e){g.call(this,e)}return k.when(d,c,h.hitch(this,g))},newRow:function(){var a=this.inherited(arguments);this.noDataNode&&(n(this.noDataNode,"!"),delete this.noDataNode);return a},removeRow:function(a,c){var d={element:a};!c&&(this.noDataMessage&&this.up(d).element===a&&this.down(d).element===a)&&(this.noDataNode=n(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},
"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(m,e,h,k,d,l,n,c,g){function a(a,c){for(var d=a.unselectable=c?"on":"",e=a.getElementsByTagName("*"),f=e.length;--f;)"INPUT"===e[f].tagName||"TEXTAREA"===e[f].tagName||(e[f].unselectable=d)}function s(b,c){var e=b.bodyNode,f=c?"text":21>d("ff")?"-moz-none":"none";q&&"msUserSelect"!==
q?e.style[q]=f:d("dom-selectstart")?!c&&!b._selectstartHandle?b._selectstartHandle=k(e,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):c&&b._selectstartHandle&&(b._selectstartHandle.remove(),delete b._selectstartHandle):(a(e,!c),!c&&!b._unselectableHandle?b._unselectableHandle=l.after(b,"renderRow",function(b){a(b,!0);return b}):c&&b._unselectableHandle&&(b._unselectableHandle.remove(),delete b._unselectableHandle))}d.add("dom-comparedocumentposition",
function(a,c,d){return!!d.compareDocumentPosition});d.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});d.add("css-user-select",function(a,c,d){a=d.style;c=["Khtml","O","ms","Moz","Webkit"];d=c.length;var e="userSelect";do if("undefined"!==typeof a[e])return e;while(d--&&(e=c[d]+"UserSelect"));return!1});d.add("dom-selectstart","undefined"!==typeof document.onselectstart);var r=d("mac")?"metaKey":"ctrlKey",q=d("css-user-select"),f=(n=d("pointer"))&&
"MS"===n.slice(0,2),p=n?n+(f?"Down":"down"):"mousedown",t=n?n+(f?"Up":"up"):"mouseup";"WebkitUserSelect"===q&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(q=!1);return e("dgrid.Selection",null,{selectionDelegate:".dgrid-row",selectionEvents:p+","+t+",dgrid-cellfocusin",selectionTouchEvents:d("touch")?c.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};
return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=
a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){m.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?s(this,a):s(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,c){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(c))&&!("dgrid-cellfocusin"===
a.type&&"mousedown"===a.parentType||a.type===t&&c!=this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===p&&this.isSelected(c))this._waitForMouseUp=c;else this[this._selectionHandlerName](a,c);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,c){var d=a.keyCode?a.ctrlKey:a[r];this._lastSelected===c?this.select(c,null,!d||!this.isSelected(c)):(this.clearSelection(),this.select(c),this._lastSelected=
c)},_multipleSelectionHandler:function(a,c){var d=this._lastSelected,e=a.keyCode?a.ctrlKey:a[r],f;a.shiftKey||(f=e?null:!0,d=null);this.select(c,d,f);d||(this._lastSelected=c)},_extendedSelectionHandler:function(a,c){(2===a.button?!this.isSelected(c):!(a.keyCode?a.ctrlKey:a[r]))&&this.clearSelection(null,!0);this._multipleSelectionHandler(a,c)},_toggleSelectionHandler:function(a,c){this.select(c,null,null)},_initSelectionEvents:function(){var a=this,e=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues=
{deselect:[],select:[]};d("touch")&&!d("pointer")&&this.selectionTouchEvents?(k(e,c.selector(f,this.selectionTouchEvents),function(c){a._handleSelect(c,this);a._ignoreMouseSelect=this}),k(e,k.selector(f,this.selectionEvents),function(c){a._ignoreMouseSelect!==this?a._handleSelect(c,this):c.type===t&&(a._ignoreMouseSelect=null)})):k(e,k.selector(f,this.selectionEvents),function(c){a._handleSelect(c,this)});this.addKeyHandler&&this.addKeyHandler(32,function(c){a._handleSelect(c,c.target)});if(this.allowSelectAll)this.on("keydown",
function(c){c[r]&&(65==c.keyCode&&!/\bdgrid-input\b/.test(c.target.className))&&(c.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setStore&&l.after(this,"_setStore",function(){a._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(b,d,e){b=d||b&&b[c.idProperty||"id"];if(null!=b&&(d=(b=c.row(b))&&c.selection[b.id]))c[e](b,null,d)}var c=this,d=this.store,e,f;this._removeDeselectSignals&&this._removeDeselectSignals();
d&&d.notify?(e=l.before(d,"notify",function(c,d){c||a(c,d,"deselect")}),f=l.after(d,"notify",function(c,d){a(c,d,"select")},!0),this._removeDeselectSignals=function(){e.remove();f.remove()}):(e=l.before(this,"removeRow",function(a,b){var c;b||(c=this.row(a))&&c.id in this.selection&&this.deselect(c)}),this._removeDeselectSignals=function(){e.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var c=this._selectionEventQueues[a],d=this._selectionTriggerEvent,e;e={bubbles:!0,
grid:this};d&&(e.parentType=d.type);e[this._selectionTargetType]=c;this._selectionEventQueues[a]=[];k.emit(this.contentNode,"dgrid-"+a,e)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,c;for(c in a)a[c].length&&this._fireSelectionEvent(c)},_select:function(a,c,d){var e,f,h;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(e=this.selection,f=!!e[a.id],null===d&&(d=!f),h=a.element,!d&&!this.allSelected?delete this.selection[a.id]:e[a.id]=
d,h&&(d?g(h,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):g(h,"!dgrid-selected!ui-state-active")),d!==f&&h&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),c)if(c.element||(c=this.row(c)),c){if(c=c.element){e=this._determineSelectionDirection(h,c);e||(c=document.getElementById(c.id),e=this._determineSelectionDirection(h,c));for(;a.element!=c&&(a=this[e](a));)this._select(a,null,d)}}else this._lastSelected=h,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},
_determineSelectionDirection:d("dom-comparedocumentposition")?function(a,c){var d=c.compareDocumentPosition(a);return d&1?!1:2===d?"down":"up"}:function(a,c){return 1>c.sourceIndex?!1:c.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,c,d){this._select(a,c,d);this._fireSelectionEvents()},deselect:function(a,c){this.select(a,c,!1)},clearSelection:function(a,c){this.allSelected=!1;for(var d in this.selection)a!==d&&this._select(d,null,!1);c||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var c=this.row(this._rowIdToObject[a]);this._select(c.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this,c=this.inherited(arguments);h.when(c,function(c){var d=a.selection,e,f,g;for(e=0;e<c.length;e++)f=a.row(c[e]),(g=f.id in d?d[f.id]:a.allSelected)&&a._select(f,null,g);a._fireSelectionEvents()});return c}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(m,e,h,k,d){function l(a){a=document.getElementsByTagName(a);for(var d=0;d<a.length;d++)c(a[d])}function n(){l("link");
l("style")}function c(a,d,e){function h(){m(["xstyle/core/load-imports"],function(b){b(a,function(){c(a,d,!0)})})}function f(a){for(var b=a.cssRules,c=0;c<b.length;c++){var e=b[c];if(e.selectorText&&"x-"==e.selectorText.substring(0,2)&&(l=!0,/^'/.test(e.style.content)))return g(eval(e.style.content),a,d),!0}}var k=a.sheet||a.styleSheet;if(k&&(!k.processed||e)){k.processed=!0;var l=k.needsParsing,b=k.rules||k.cssRules;if((k.href||k.imports&&k.imports.length)&&!e)return h();if(!l)for(var n=0;n<b.length;n++){var u=
b[n];if(u.href&&!e){if(!f(u.styleSheet))return h();return}}g(k.localSource||(k.ownerNode||k.owningElement).innerHTML,k,d)}}function g(a,c,d){c.addRule||(c.addRule=function(a,c,d){return this.insertRule(a+"{"+c+"}",0<=d?d:this.cssRules.length)});c.deleteRule||(c.deleteRule=c.removeRule);var g=1;(c.href||location.href).replace(/[^\/]+$/,"");h.css=a;e(h,a,c);0==--g&&d&&d(c);return h}k.ready(n);e.getStyleSheet=function(a,c){return a.styleSheet||a};return{process:c,processAll:n,parse:g,generate:d,update:k.update,
load:function(a,d,e,g){d(["xstyle/css"],function(f){f.load(a,d,function(a){a?c({sheet:a},e):(n(),e())},g)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function m(){this.push.apply(this,arguments)}function e(a){this.value=a}function h(){var a,c=this.args[0];if("string"==typeof c)a=c.split(/\s*,\s*/);else if(c){a=[];for(var d=0,e=0;e<c.length+1;e++){var g=c[e];if("string"==typeof g||void 0===g)if(g=g&&g.split(/\s*,\s*/),1<a.length||void 0===g){var b=c.slice(d,e);
0<d&&b.unshift(a.pop());d=e+1;a.push(b);g&&a.push.apply(a,g.slice(1))}}}else return[];return a}function k(r,q,f){function p(f,q){function z(a){F=!1;var c=b.lastIndex;a.then(function(){F=!0;d&&(b.lastIndex=c,A())});var d=!0}function A(){function n(a){a&&("string"==typeof a&&O)&&(a=O+a);E?E.push?"string"==typeof E[E.length-1]&&"string"==typeof a?E[E.length-1]+=a:a&&E.push(a):"string"==typeof E&&"string"==typeof a?E+=a:E=new m(E,a):E=a}for(F=!0;F;){var r=b.exec(f);if(!r)break;var A=r[5],O=r[1],J=r[2],
H=r[3],P=r[4],L,M,E,y,P=P&&a(P),J=J&&a(J);I?(H?(M=J,L=H.charAt(0),y="?"==H.charAt(1),-1<H.indexOf("\n")&&(P=H.slice(1))):P=J,E=P,I=!1):(P=H?J+H:J,n(P));"{"!=A&&(G+=r[0]);switch(A){case "'":case '"':var T="'"==A?d:l;T.lastIndex=b.lastIndex;(A=T.exec(f))||C("unterminated string");J=A[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});b.lastIndex=T.lastIndex;n(new e(J));G+=A[0];continue;case "\\":A=T.lastIndex++;n(f.charAt(A));continue;case "(":case "{":case "[":if("{"==
A){I=!0;":"==L&&H&&(J+=H);G=a((G+J).replace(/\s+/g," "));n(H=w.newRule(G));"\x3d"==L&&(B=!1,E.creating=!0);var S=null,$=D;if(r[6]&&(P=q.cssRules||q.rules,H.cssRule=S=P[r[6].slice(1)]))G=S.selectorText;if(w.root&&B)for(P=q.cssRules||q.rules;S=P[D++];)if(S.selectorText==G||S.selectorText&&S.selectorText.replace(/::/g,":").replace(/'/g,'"')==G.replace(/::/g,":").replace(/'/g,'"')){H.cssRule=S;break}S||(H.ruleIndex=D=$);H.styleSheet=q;E.creating?(H.selector="."+("\x3d"==L?J.match(/[\w-]*$/g,"")[0]:"")+
"-x-"+g++,H.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(G)?H.setMediaSelector(G):H.selector=w.root?G:w.selector+" "+G;G=""}else J=P.match(/(.*?)([\w-]*)$/),n(H=w.newCall(J[2],E,w)),H.ref=w.getDefinition(J[2]),H.getArgs=h,(E.calls||(E.calls=[])).push(H);w.currentName=M;w.currentSequence=E;w.assignmentOperator=L;var W;if("{"==A&&(W=H.selector.match(/[@:]\w+/)))W=W[0],(M=w.getDefinition(W))&&M.selector&&M.selector(H);s.push(w=H);w.operator=A;w.start=b.lastIndex;E=M=null;continue}if(E)if(J="string"==
typeof E?E:E[0],J.charAt&&"@"==J.charAt(0))if(r=J.match(/\w+/)[0],"import"==r)J=k.getStyleSheet((q.cssRules||q.imports)[D++],E,q),r=b.lastIndex,p(J.localSource,J),b.lastIndex=r;else{if("xstyle"==r){if("start"==J.slice(8,13))H=w?w.newRule(""):aa,H.root=w.root,s.push(w=H);else{var aa=w||aa;s.pop();w=s[s.length-1]}b=w?t:/(@[\w\s])/g}}else if("\x3d"===L)try{var U=w.declareDefinition(M,E,y);U&&U.then&&z(U)}catch(ba){C(ba)}switch(A){case ":":"\x3d"==L?(I=!0,L=":"):n(":");break;case "}":if(M&&!w.root&&!w.isMediaBlock)try{w[":"==
L?"setValue":"declareDefinition"](M,E,y)}catch(ca){C(ca)}case ")":case "]":c[w.operator]!=A&&C("Incorrect opening operator "+w.operator+" with closing operator "+A);M=null;M=f.slice(w.start,b.lastIndex-1);w.cssText=w.cssText?w.cssText+";"+M:M;if("}"==A){"}"==V&&(V=w.parent.selector)&&"@"==!V.charAt(0)&&C("A nested rule must end with a semicolon");if(w.root)C("Unmatched "+A);else{try{w.onRule(w.selector,w)}catch(da){C(da)}B=!0}G=""}if(")"==A||"]"==A)w.args=[E];if(")"==A&&!L){try{U=s[s.length-2].onArguments(w)}catch(ea){C(ea)}U&&
U.then&&z(U)}s.pop();w=s[s.length-1];E=w.currentSequence;M=w.currentName;L=w.assignmentOperator;if(w.root&&"}"==A){if(L)try{w[":"==L?"setValue":"declareDefinition"](M,E,y)}catch(fa){C(fa)}I=!0;L=!1}break;case "":case void 0:return;case ";":if(w&&M){try{(U=w[":"==L?"setValue":"declareDefinition"](M,E,y))&&U.then&&z(U)}catch(Z){C(Z)}M}E=null;I=!0;L=B=!1;G=""}var V=A}}function C(a){var c=f.slice(0,b.lastIndex).split("\n"),d=c[c.length-1],c=(q.href||"in-page stylesheet")+":"+c.length+":"+d.length+" near:\n"+
d.slice(-40);if(p.onerror)p.onerror(a,c);console.error(a.message||a,c);a.stack&&console.error(a.stack)}f=f.replace(n,function(a){return a.replace(/[^\n]/g,"")});var w=r;b.lastIndex=0;var F,D=0,B=!0,G="",I=!0;A()}f=f||{addRule:function(){},cssRules:[]};var t,b=t=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,s=[r];r.parse=p;p(q,f)}var d=/((?:\\.|[^'])*)'/g,l=/((?:\\.|[^"])*)"/g,n=/\/\*[\w\W]*?\*\//g,
c={"{":"}","[":"]","(":")"},g=0,a="".trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},s=m.prototype=[];s.toString=function(){return this.join("")};s.isSequence=!0;e.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};e.prototype.isLiteralString=!0;return k})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),
function(m,e,h,k,d,l,n){function c(a,d,e){function f(c){return{selectElement:function(d){e.newElement&&(d=d.parentNode);if(c&&c.selector)for(;!b(d,c);)if(d=d.parentNode,!d)throw Error("Rule not found");if(e.inherit)for(;!(a in d);)if(d=d.parentNode,!d)throw Error(a?a+" not found":"Property was never defined");return d},forElement:function(b){var d=b;b=this.selectElement(b);e.newElement&&(b["_"+a+"Node"]=d);b=e.get?e.get(b,a):b[a];return void 0===b&&c?r(a).valueOf().forRule(c):b},forRule:e.inherit&&
function(a){return f(a)}}}var g=new h(function(){return f(d)});g.define=function(b,d){return c(a||d,b,e)};g.keepCSSValue=!0;g.put=e.inherit?function(b,c){return r(a).put(b,c,a)}:function(c){return{forElement:function(f){if(d&&d.selector)for(;!b(f,d);)if(f=f.parentNode,!f)throw Error("Rule not found");e.set?e.set(f,a,c):f[a]=c;g.invalidate({elements:[f]})}}};return g}function g(a,b,c,d){return k.when(e.evaluate(a,c),function(b){b.forElement?m.addRenderer(a,function(a){d(b.forElement(a),a)}):d(b)})}
function a(a,b){return{apply:function(c,d,e){g(c,e,d[0],function(d,f){d.observe(function(d){d=d?a:b;value.toString().replace(RegExp(a+"\\([^)]+\\)","g"),d);f?f.style[e]=d:c.setStyle(e,d)})})}}}function s(a,b){var c=a.variables;if(c&&b in c)return c[b];if(c=a.bases)for(var d=0;d<c.length;d++){var e=s(c[d],b);if(void 0!==e)return e}}function r(a){var b=v[a];b||(b=v[a]=new h(function(){return{forRule:function(b){a:{do{var c=s(b,a);if(void 0!==c){b=c;break a}b=b.parent}while(b);b=void 0}return b}}}),
b.put=function(a,c,d){return{forRule:function(c){function e(a){f.push(a);for(var b in a.rules)e(a.rules[b])}(c.variables||(c.variables={}))[d]=a;for(var f=[];c;)e(c),c=c.parent;b.invalidate({rules:f})}}});return b}var q=d("div"),f=navigator.userAgent,p=-1<f.indexOf("WebKit")?"-webkit-":-1<f.indexOf("Firefox")?"-moz-":-1<f.indexOf("MSIE")?"-ms-":-1<f.indexOf("Opera")?"-o-":"",t;l=new l;var b=m.matchesRule;l.root=!0;var v={};l.definitions={Math:Math,window:window,global:window,module:e.selfResolving(function(a,
b){a[0].value&&(a=a[0].value);b||require([a]);return{then:function(b){return(new n.Promise(function(b){require([a],function(a){b(a)})})).then(b)}}}),item:c("item",null,{inherit:!0}),pageContent:new h,content:c("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:c(null,null,{}),elementClass:c(null,null,{get:function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")},set:function(a,b,c){this.get(a,b)!=c&&(a.className=c?a.className+(" "+b):(" "+a.className+" ").replace(" "+
b+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(c){for(;!b(c,a);)if(c=c.parentNode,!c)throw Error("Rule not found");return c}}}},event:{observe:function(a){a(t)},valueOf:function(){return t}},each:{put:function(a){return{forRule:function(b){b.each=a}}}},prefix:{put:function(a,b,c){return{forRule:function(b){if("string"==typeof q.style[p+c])return b._setStyleFromValue(p+c,a),!0}}}},"var":{define:function(a,b){return r(b)},
selfResolving:!0,apply:function(a,b){return r(k.convertCssNameToJs(b[0]))}},inline:a("inline","none"),block:a("block","none"),visible:a("visible","hidden"),"extends":{apply:function(a,b){for(;0<b.length;)return k.extend(a,b[0],console.error)}},set:{selfExecuting:!0,apply:function(a,b){return b[0].put(b[1].valueOf())}},get:{apply:function(a,b){return b[0]},put:function(a,b){e.evaluate(b,a)}},toggle:{selfExecuting:!0,apply:function(a,b){return b[0].put(!b[0].valueOf())}},on:{put:function(a,b,c){return{forRule:function(b){m.on(document,
c.charAt(2).toLowerCase()+c.slice(3),b,function(d){t=d;try{k.when(e.evaluate(b,a).valueOf(),function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&a.forElement(d.target);t=null},function(b){console.error("Error in "+c+" event handler, executing "+a,b)})}catch(f){console.error("Error in "+c+" event handler, executing "+a,f)}})}}}},title:{put:function(a){return{forRule:function(b){e.observe(e.evaluate(b,a),function(a){document.title=a})}}}},"@supports":{selector:function(a){function b(a){var c;
if(c=a.match(/^\s*not(.*)/))return!b(c[1]);if(c=a.match(/\((.*)\)/))return b(c[1]);if(c=a.match(/([^:]*):(.*)/))return a=k.convertCssNameToJs(c[1]),c=q.style[a]=c[2],q.style[a]==c;if(c=a.match(/\w+\[(.*)=(.*)\]/))return d(c[0])[c[1]]==c[2];if(c=a.match(/\w+/))return k.isTagSupported(c);throw Error("can't parse @supports string");}b(a.selector.slice(10))?a.selector="":a.disabled=!0}},"true":!0,"false":!1,"null":null};l.elementProperty=c;return l})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",
["put-selector/put","xstyle/core/utils"],function(m,e){function h(a,b,c,d){function e(a){if(!c)return d(a);var b=a.target;do if(A(b,c))return d(a);while((b=b.parentNode)&&1===b.nodeType)}r?a.addEventListener(b,e,!!q[b]):k(a,q[b]||b,e)}function k(a,b,c){b="on"+b;var d=a[b];a[b]=function(a){a=a||window.event;a.target=a.target||a.srcElement;d&&d(a);c(a)}}function d(b){/e/.test(a.readyState||"")?b():a.addEventListener("DOMContentLoaded",b)}function l(b){for(var c=a.querySelectorAll(b.selector),d=b.name,
e=0,f=c.length;e<f;e++){var g=c[e],h=g.elementalStyle;h||(h=g.elementalStyle={},g.elementalSpecificities={});var k=g.renderings;k||(k=g.renderings=[],u.push(g));k.push({name:d,rendered:h[d]==b.propertyValue,renderer:b});h[d]=b.propertyValue}}function n(){for(;u.length;){for(var a=u.shift(),b=a.renderings,c=a.elementalStyle;b.length;){var d=b.shift(),e=d.renderer,f=e.rendered;z=c[d.name]==e.propertyValue;if(!f&&z)try{e.render(a)}catch(g){console.error(g,g.stack),m(a,"div.error",g.toString())}f&&(!z&&
e.unrender)&&e.unrender(a)}a.renderings=void 0}}function c(a,c){for(var d=0,e=b.length;d<e;d++){var f=b[d];(!c||c==f.selector)&&A(a,f.rule)&&f.render(a)}}function g(a,c){var d={selector:a.selector,rule:a,render:c};b.push(d);x&&l(d);n();return{remove:function(){b.splice(b.indexOf(d),1)}}}var a=document,s=1,r=!!a.addEventListener,q={blur:"focusout",focus:"focusin"};h(a,"change",null,function(a){a=a.target;for(var b=0,c=v.length;b<c;b++){var d=v[b];if(-1<(" "+a.className+" ").indexOf(d.rule.selector.slice(1))){var e=
d.definition.valueOf();e&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&(e=e.forElement(a));var f="checkbox"===a.type?a.checked:a.value;"number"===typeof e&&isFinite(f)&&(f=+f);(e=d.definition.put(f))&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&e.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&h(a,"keydown",null,function(a){if(13==a.keyCode){var b=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),b.dispatchEvent(a);else document.onchange({target:b})}});
var f=a.createElement("div"),p={"dom-qsa2.1":!!f.querySelectorAll},t=f.matches||f.matchesSelector||f.webkitMatchesSelector||f.mozMatchesSelector||f.msMatchesSelector||f.oMatchesSelector,b=[],v=[],u=[],x;d(function(){if(!x)if(x=!0,p["dom-qsa2.1"]){for(var d=0,e=b.length;d<e;d++)l(b[d]);n()}else for(var f=a.all,d=0,e=f.length;d<e;d++)c(f[d])});var z,A=t?function(a,b){return t.call(a,b.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId="x-ie-"+s++,"true");return!!a.currentStyle[b.ieId]};return{ready:d,
on:h,matchesRule:A,addRenderer:g,addInputConnector:function(a,b){v.push({rule:a,definition:b})},update:c,clearRenderers:function(){b=[]},observeForElement:function(a,b,c){return e.when(a,function(a){function d(a){a.observe?a.observe(c):c(a)}a.forElement?g(b,function(b){d(a.forElement(b))}):d(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function m(d,e){for(var h=0,c=d.length;h<c;h++){var g=d[h];if(g&&"object"==typeof g&&e in g)return!0}}function e(d,e){return e.toUpperCase()}
var h="div"==document.createElement("div").tagName,k={};return{when:function(d,e,h){return d&&d.then?d.then(e,h)||d:e(d)},whenAll:function(d,e){return m(d,"then")?{then:function(h,c){function g(){a--;a||h(e(k))}for(var a=1,k=[],m=0;m<d.length;m++){var q=d[m];a++;q&&q.then?function(a){q.then(function(c){k[a]=c;g()},c)}(m):(k[m]=q,g())}g()},inputs:d}:e(d)},convertCssNameToJs:function(d){return d.replace(/-(\w)/g,e)},isTagSupported:function(d){if(d in k)return k[d];var e=document.createElement(d);h?
(e=e.toString(),e=!("[object HTMLUnknownElement]"==e||"[object]"==e)):e=e.tagName==d.toUpperCase();return k[d]=e},extend:function(d,e){var h=e.split(".");e=h[0];var c=d.getDefinition(e,"rules");h[0]="";d.selector+=d.extraSelector=h.join(".");if(c)return this.when(c,function(c){if(c.extend)c.extend(d,!0);else for(var a in c)d[a]=c[a]});d.tagName=e;if(!this.isTagSupported(e))throw Error("Extending undefined definition "+e);},someHasProperty:m}})},"xstyle/core/expression":function(){define("xstyle/core/expression",
["xstyle/core/utils","xstyle/core/Definition"],function(m,e){function h(a,c){var d=c[0];return d&&a?(d=g(d),h(a.property?a.property(d):a[d],c.slice(1))):a}function k(c,d,e){if(a(d,c)){var b={};b[c]=function(a){for(var b=[],g=0,h=d.length;g<h;g++){var k=d[g];k&&"function"==typeof k[c]&&(k=k[c](a));b[g]=k}return e(b)};return b}return e(d)}function d(a,c){return{apply:function(d,b,e){for(var g=0,h=b.length;g<h;g++){var l=b[g];l.dependencyOf&&l.dependencyOf(e)}g=function(){var c=[];if(a.selfExecuting)return a.apply(d,
b,e);for(var g=0,h=b.length;g<h;g++)c[g]=b[g].valueOf();if(a.selfWaiting)return a.apply(d,c,e);c.push(d);return m.whenAll(c,function(b){var c=b.pop();return k("forRule",b,function(b){return k("forElement",b,function(b){return a.apply(c,b,e)})})})};g.reverse=function(a){return c(a,b)};return g}}}function l(a){return r[a]||(r[a]=new Function("a","b","return "+a))}function n(a,c,e,b,g){function h(a){a.skipResolve=!0;a.precedence=c;a.infix=!1!==g}var k=function(a,c){var d=c[0],e=c[1];if(d&&d.put)e=b(a,
e&&e.valueOf()),e!==s&&d.put(e);else if(e&&e.put)e.put(g(a,d&&d.valueOf()));else throw new TypeError("Can not put");},m={apply:function(c,p,m){var n;e=l(e);b=b&&l(b);g=g&&l(g);q[a]=n=d(e,k);h(n);return n.apply(c,p,m)}};h(m);q[a]=m}function c(a,g){function k(a){for(;r<=a.precedence;){var b=s.pop(),c=q[s.pop()],d=new e;d.setCompute(c.apply(null,c.infix?[s.pop(),b]:[b],d));A=s.length?s[s.length-1]:void 0;s.push(d);r=A&&q[A]&&q[A].precedence}}var b,l;g=g.join?g.slice():[g];for(b=0;b<g.length;b++)if(l=
g[b],"string"==typeof l){var n=l.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);l=[b,1];n&&l.push.apply(l,n);g.splice.apply(g,l);b+=l.length-3}var r,s=[],A,n={};for(b=0;b<g.length;b++){l=g[b];if("("==l.operator){var C=s[s.length-1];void 0===C||q.hasOwnProperty(C)?l=c(a,l.getArgs()[0]):(s.pop(),l=function(b,g){function h(e){return m.when(b.valueOf(),function(h){var m=b.parent&&b.parent.valueOf();if(!h.selfResolving){if(!k){k=[];for(var n=0,q=g.length;n<q;n++)k[n]=c(a,g[n]);l=h.selfReacting?
h.apply(m,k,p):d(h).apply(m,k,p)}return l()}h=h.apply(m,g,p);return e?h:h.valueOf()})}var k,l,p=new e(h);p.setReverseCompute(function(){var a=arguments;return m.when(h(!0),function(b){return b.put.apply(b,a)})});return p}(C,l.getArgs()))}else if(q.hasOwnProperty(l))C=q[l],k(C),r=(A||C).precedence;else if(-1<l)l=+l;else if(l.isLiteralString)l=l.value;else{l=l.split(/\s*\/\s*/);var C=l[0],w=a.getDefinition(C);if("string"==typeof w||w instanceof Array)w=c(a,w);else if(void 0===w)throw Error('Could not find reference "'+
C+'"');n[C]=w;1<l.length&&(w=h(w,l.slice(1)));l=w}s.push(l)}k({precedence:100});if(1<s.length)throw Error("Could not reduce expression");l=s[0];l.inputs=n;return l}var g=m.convertCssNameToJs,a=m.someHasProperty,s={},r={},q={};n("+",6,"a+b","a-b","a-b");n("-",6,"a-b","a+b","b-a");n("*",5,"a*b","a/b","a/b");n("/",5,"a/b","a*b","b/a");n("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");n(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");n("!",4,"!a","!a",!1);n("%",5,"a%b");n("\x3e",
8,"a\x3eb");n("\x3e\x3d",8,"a\x3e\x3db");n("\x3c",8,"a\x3cb");n("\x3c\x3d",8,"a\x3c\x3db");n("\x3d\x3d",9,"a\x3d\x3d\x3db");n("\x26",8,"a\x26\x26b");n("|",8,"a||b");return{react:d,evaluate:c,selfResolving:function(a){a.selfResolving=!0;return a}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(m,e){function h(c){(this.computeValue=c)&&c.reverse&&this.setReverseCompute(c.reverse)}function k(c,g,a){if(g&&g.forElement)return{forElement:function(h){h=g.selectElement?
g.selectElement(h):h;var k=["_cache_"+c.id];if(k in h){var l=h[k+"observe"];l.addKey&&l.addKey(a);return h[k][a]}var f=h[k]=g.forElement(h),p=h[k+"observe"]=d(c,f,a,{elements:[h]});h.xcleanup=function(a){a&&e.unobserve(f,p)};return f[a]}}}function d(c,d,a,h){var k=c._properties,l;"object"==typeof d&&(l=function(a){for(var c=0;c<a.length;c++){var d=k[a[c].name];d&&d.invalidate&&d.invalidate(h)}},e.observe(d,l),l.addKey&&l.addKey(a));return l}var l={},n=1;h.prototype={id:"x-variable-"+n++,cache:l,valueOf:function(){if((this.dependents||
this._properties)&&this.cache!==l)return this.cache;var c=this,d=this.computeValue;if(d.then)return this.cache=d.then(function(a){c.computeValue=a;(a=c.cache=a())&&a.then&&a.then(function(a){c.cache=a});return a});(d=c.cache=d())&&d.then&&d.then(function(a){c.cache=a});return d},property:function(c){var e=this._properties||(this._properties={}),a=e[c];if(!a){var l=this,a=e[c]=new h(function(){return m.when(l.valueOf(),function(a){if(a&&a.forRule)return{forRule:function(e){e=a.selectRule?a.selectRule(e):
e;var g=["_cache_"+l.id],h;if((h=g in e?e[g]:e[g]=a.forRule(e))&&h.forElement)return k(l,h,c);var b=e[g+"observe"];b&&(b.addKey?b.addKey(c):e[g+"observe"]=d(l,h,c,{rules:[e]}));return h[c]}};if(a&&a.forElement)return k(l,a,c);var e=l.cacheObserve;e?e.addKey&&e.addKey(c):e=l.cacheObserve=d(l,a,c);return a[c]})});a.key=c;a.parent=this;a.put=function(a){return m.when(l.valueOf(),function(d){function e(d){if(d.forElement)return{forElement:function(e){d.forElement(e)[c]=a}};d[c]=a}if(d.forRule)return{forRule:function(a){return e(d.forRule(a))}};
e(d)})};a.id=this.id+"-"+c}return a},invalidate:function(c){var d=this.cacheObserve;d&&(e.unobserve(this.cache,d),this.cacheObserve=null);this.cache=l;var a,d=this._properties;for(a in d)d[a].invalidate(c);var h=this.dependents||0;a=0;for(d=h.length;a<d;a++)try{h[a].invalidate(c)}catch(k){console.error(k,"invalidating a definition")}},dependencyOf:function(c){(this.dependents||(this.dependents=[])).push(c)},notDependencyOf:function(c){for(var d=this.dependents||0,a=0;a<d.length;a++)d[a]===c&&d.splice(a--,
1)},setReverseCompute:function(c){this.put=function(){var d=c.apply(this,arguments);this.invalidate();return d}},setCompute:function(c){(this.computeValue=c)&&c.reverse&&this.setReverseCompute(c.reverse);this.invalidate()},setSource:function(c){this.computeValue=function(){return c};this.invalidate()},observe:function(c){this.computeValue&&c(this.valueOf());var d=this;return this.dependencyOf({invalidate:function(){c(d.valueOf())}})},newElement:function(){return m.when(this.valueOf(),function(c){return c&&
c.newElement&&c.newElement()})}};return h})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function m(a,c,d){n?-1===n.indexOf(a)&&n.push(a):(n=[a],setTimeout(function(){n.forEach(function(a){var c=[];a.properties.forEach(function(d){c.push({target:a.object,name:d})});a(c);a.object=null;a.properties=null});n=null},0));a.object=c;a=a.properties||(a.properties=[]);-1===a.indexOf(d)&&a.push(d)}function e(){return e}var h=Object.observe,k;if(k=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});k=!0;break a}catch(d){}k=void 0}var l={observe:h,defineProperty:k,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},h=l.observe?Object.observe:l.defineProperty?function(a,c){c.addKey=function(d){var b="key"+d;if(!this[b]){this[b]=!0;var e=a[d];if((b=Object.getOwnPropertyDescriptor(a,d))&&b.set){var g=b.set,h=b.get;Object.defineProperty(a,d,{get:function(){return e=h.call(this)},set:function(a){g.call(this,a);e!==a&&(e=a,c&&m(c,this,d))}})}else Object.defineProperty(a,
d,{get:function(){return e},set:function(a){e!==a&&(e=a,c&&m(c,this,d))}})}};c.remove=function(){c=null}}:function(d,e){s||(s=!0,setInterval(function(){for(var b=0,d=c.length;b<d;b++){var e=g[b],f=c[b],h=a[b],k=void 0,l=void 0;for(l in e)e.hasOwnProperty(l)&&e[l]!==f[l]&&(e[l]=f[l],(k||(k=[])).push({name:l}));for(l in f)f.hasOwnProperty(l)&&!e.hasOwnProperty(l)&&(e[l]=f[l],(k||(k=[])).push({name:l}));k&&h(k)}},20));var h={},b;for(b in d)d.hasOwnProperty(b)&&(h[b]=d[b]);c.push(d);g.push(h);a.push(e)},
n;k=l.observe?Object.unobserve:function(d,e){e.remove&&e.remove();for(var h=0,b=c.length;h<b;h++)if(c[h]===d&&a[h]===e){c.splice(h,1);g.splice(h,1);a.splice(h,1);break}};var c=[],g=[],a=[],s=!1,r=1,q=function(){};q.prototype.toJSON=e;return{Promise:l.promise?Promise:function(){function a(c){function d(a){a&&a.then?a.then(d,b):(h=a,e())}function b(a){k=a;e()}function e(){g=!0;for(var a=0,b=l.length;a<b;a++)l[a]();l=0}var g,h,k,l=0;c(d,b);return{then:function(b,c){return new a(function(a,d){function e(){try{k&&
!c?d(k):a(k?c(k):b?b(h):h)}catch(f){d(f)}}g?e():(l||(l=[])).push(e)})}}}return a}(),WeakMap:l.WeakMap?WeakMap:function(a,c){var d="__"+(c||"")+r++;return l.defineProperty?{get:function(a){return a[d]},set:function(a,c){Object.defineProperty(a,d,{value:c,enumerable:!1})}}:{get:function(a){return(a=a[d])&&a.value},set:function(a,c){(a[d]||(a[d]=new q)).value=c}}},observe:h,unobserve:k,copy:function(a,c){for(var d in c)a[d]=c[d];return a}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(m,e,h,k,d){function l(a,c,d){try{a[c]=d}catch(e){}}function n(){}function c(a,c,d,f){if(a.calls){var h;for(d=0;d<a.length;d++){var k=a[d];if(k instanceof g){a.hasOwnProperty(d)||(a[d]=k=r(k));var l=k.ref&&(k.ref.selfResolving?k.ref.apply(c,k.getArgs(),c):m.evaluate(c,[k.caller,k]));void 0!==l&&((h||(h=[])).push(l),k.evaluated=!0)}}}if(h)return c=m.react(function(){for(var c=0,d=a.slice(),e=0;e<a.length;e++){var f=
a[e];f instanceof g&&f.evaluated&&(d[e-1]=a[e-1].slice(0,-f.caller.length),d[e]=arguments[c++])}return d.join("")}),c.skipResolve=!0,f=new e,f.setCompute(c.apply(f,h,f)),f;if(!f)return a.toString()}function g(a){this.caller=a;this.args=[]}function a(a,c,e,f){return d.when(c,function(c){var d=c;c&&c.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=d.forRule(a,!0);b&&b.forElement?s(a,b,f):e&&e(b)}),c=c.forRule(a));if(c&&c.forElement)return s(a,c,f);e&&e(c)})}function s(a,
c,d){return require(["xstyle/core/elemental"],function(e){e.addRenderer(a,function(a){var b=c.forElement(a);d&&d(b,a)})})}var r=Object.create||function(a){function c(){}c.prototype=a;return new c},q=d.convertCssNameToJs,f={"{":"}","[":"]","(":")"},p=h("div").style;n.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var c=this.values||0,d=0;d<c.length;d++){var e=c[d];a.call(this,e||"unnamed",
c[e])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new n;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new g(a);a.parent=this;return a},addSheetRule:function(a,c){if("@"!=a.charAt(0)){var d=this.styleSheet,e=d.cssRules||d.rules,f=-1<this.ruleIndex?this.ruleIndex:e.length;try{d.addRule(a,c||" ",f)}catch(g){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,c)}return e[f]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var c=0;c<this.installStyles.length;c++){var d=this.installStyles[c];l(a.style,d[0],d[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,c){this.cssRule?l(this.cssRule.style,a,c):(this.installStyles||(this.installStyles=[])).push([a,c])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var c=this;require(["xstyle/core/elemental"],function(d){d.addRenderer(c,function(c){a(c)})})},declareDefinition:function(a,c,e){a=a&&q(a);if(!this.disabled){var f=this;if(c.length)if("\x3e"==c[0].toString().charAt(0))a||(this.generator=c,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,b){c=a.forSelector(c,f);b.addRenderer(f,c)}));else{var g=a in p||this.getDefinition(a);if(!e||!g){e=this.definitions||(this.definitions={});var h=c[0];if(h.indexOf&&-1<h.indexOf(","))for(var h=
c.join("").split(/\s*,\s*/),k=[],l=0;l<h.length;l++)k[l]=m.evaluate(this,h[l]);c[0]&&"{"==c[0].operator?k=c[0]:c[1]&&"{"==c[1].operator&&(k=c[1],d.extend(k,c[0]));k=k||m.evaluate(this,c);if(k.then)var n=k,k={then:function(a){return n.then(function(b){return a(r(b))})}};var r=function(c){c.define&&(c=c.define(f,a));return c};g&&console.warn('Overriding existing property "'+a+'"');return e[a]=r(k)}}else return e=this.definitions||(this.definitions={}),e[a]=c}},onArguments:function(a){var c=a.ref;return c&&
c.apply(this,a.getArgs(),this)},setValue:function(b,c,d){var e=q(b);if(!this.disabled){var f=this.values||(this.values=[]);f.push(b);f[b]=c;if(b){do{f=(d||this).getDefinition(b);if(void 0!==f){if(this.cssRule&&(!f||!f.keepCSSValue)){var g=this.cssRule.style;e in g&&l(g,e,"")}a(this,f.put(c,this,e))}b=b.substring(0,b.lastIndexOf("-"))}while(b)}e in p&&this._setStyleFromValue(e,c,!0)}},_setStyleFromValue:function(a,e,f){var g=e[0];if(g instanceof n){f=g.values;for(g=0;g<f.length;g++){var h=f[g];this._setStyleFromValue(a+
("main"==h?"":h.charAt(0).toUpperCase()+h.slice(1)),f[h])}}else{if(e.calls){var k=this;if(e.expression=c(e,this,a,!0)){var p=e.expression&&e.expression.valueOf(),m=function(c,d){var e=p&&p.forRule?p.forRule(c,!0):p;if(e&&e.forElement){var f=d&&d.elements;if(f)for(var g=0;g<f.length;g++)for(var h=f[g].querySelectorAll(c.selector),k=0;k<h.length;k++){var m=h[k];l(m.style,a,e.forElement(m))}else s(c,e,function(c,d){l(d.style,a,c)})}else c.setStyle(a,e)},q=[k];d.when(p,function(a){if((p=a)&&p.forRule)(k._subRuleListeners||
(k._subRuleListeners=[])).push(function(a){q.push(a);m(a)});m(k)});e.expression.dependencyOf({invalidate:function(a){d.when(e.expression.valueOf(),function(b){p=b;for(b=0;b<q.length;b++){var c=!0,d=q[b];if(a&&a.rules)for(var c=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){c=!0;break}c&&m(d,a)}})}})}}f||this.setStyle(a,e)}},put:function(a){var c=this;return{forRule:function(d){c.extend(d);if("defaults"!=a&&a&&"string"==typeof a&&c.values)for(var e=a.toString().split(/,\s*/),f=0;f<e.length;f++){var g=
c.values[f];g&&d.setValue(g,e[f],c)}}}},extend:function(a,c){(this.derivatives||(this.derivatives=[])).push(a);var d=this.extraSelector;d&&(a.selector+=d);for(var e=this.cssRule.style,f=a.getCssRule().style,g=a.inheritedStyles||(a.inheritedStyles={}),d=0;d<e.length;d++){var h=q(e[d]);if(!f[h]||g[h])f[h]=e[h],g[h]=!0}if(d=this.values){var d=r(d),l=a.values;a.values=l?k.copy(d,l):d}if(c){if(d=this.definitions){var d=r(d),m=a.definitions;a.definitions=m?k.copy(d,m):d}a.tagName=this.tagName||a.tagName}(a.bases||
(a.bases=[])).push(this);h=this._subRuleListeners||0;for(d=0;d<h.length;d++)h[d](a);var n=a.getCssRule().style;this.eachProperty(function(c,d){var e=q(c);"object"==typeof d&&(d=r(d));e in p&&!n[e]&&a._setStyleFromValue(e,d)});if(l&&a.definitions){d=0;for(e=l.length;d<e;d++)h=l[d],f=q(h),a.definitions[f]!==(m&&m[f])&&a.setValue(h,l[f])}if(l=this.generator){if(l instanceof Array){l=l.slice(0);for(d=0;d<l.length;d++)m=l[d],"{"===m.operator&&(h=a.newRule(),h.selector=m.selector+a.selector.slice(1),h.styleSheet=
a.styleSheet||a.cssRule.parentStyleSheet,m.extend(h,!0),l[d]=h)}a.declareDefinition(null,l)}},getDefinition:function(a,c){a=q(a);var d=this;do{var e=d.definitions&&d.definitions[a];void 0===e&&(c&&d[c])&&(e=d[c][a]);d=d.parent}while(void 0===e&&d);return e},newElement:function(){return h((this.tagName||"span")+(this.selector||""))},cssText:""};m.evaluateText=c;var t=g.prototype=new n;t.declareDefinition=t.setValue=function(a,c){this.args.push(c)};t.toString=function(){var a=this.operator;return a+
this.args+f[a]};n.updateStaleProperties=function(){};return n})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(m,e,h,k,d){function l(b,c){b=b.sort?b:[b];return function(d,f,k){var l=d,q;"content"in d||(d.content=void 0);if(void 0===k){var r=(d._contentNode||d).childNodes||0,s=r[0];if(s){var t=p.createDocumentFragment();do t.appendChild(s);while(s=r[0]);d.content=
t}if(d._contentNode){d._contentNode=void 0;try{d.innerHTML=""}catch(B){}}}for(var G=0,I=[d],K=[],r=0,s=b.length;r<s;r++){var Q=N,N=b[r];try{if(N.eachProperty){if(N.args)if("("==N.operator){var O=b[r+1];n(N,O,l,function(b,d,e){a(b,d,e,c)})}else{var J=N.args[0];if("string"===typeof J){var H=J.split("\x3d");try{l.setAttribute(H[0],H[1])}catch(P){console.error(P)}}else{var L=J[0].replace(/=$/,""),M=J[1];"("==M.operator?n(J[1],L,l,function(a,b,d){g(a,b,d,c)}):l.setAttribute(L,M.value)}}}else if("string"==
typeof N){"\x3d"==N.charAt(0)&&(N=N.slice(1));var E=l,O=b[r+1],H=[];N.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){H.push(arguments)});for(var y=0;y<H.length;y++)(function(a,b,g,p,m,n,r){function s(){var a=E._contentNode;a&&(a.innerHTML="",E=a)}b?(a=g?g.length:0,a>G?(s(),I[a]=E):E=I[a]||E,G=a):s();var t;if(p)t=(Q&&Q.args?"":"span")+p+m;else{p=m.match(/^[-\w]+/);if(!p)throw new SyntaxError("Unable to parse selector",m);p=p[0];var w;y===H.length-
1&&O&&O.selector?(O.bases||h.extend(O,p),w=O):w=c.getDefinition(p);w&&(w.then||w.newElement)?E=function(a,b,c,d){var f,g;h.when(w&&w.newElement&&w.newElement(),function(a){(f=a)?(c=c.slice(d.length))&&e(f,c):f=e(c);if(g){g.parentNode.replaceChild(f,g);a=g.childNodes;var b;for(f=f._contentNode||f;b=a[0];)f.appendChild(b)}});if(f)return a.insertBefore(f,b||null);g=e("span");return a.insertBefore(g,b||null)}(E,k,m,p):t=m}t&&(E=e(k||E,(k?"-":"")+t));k=null;n&&E.setAttribute(n,""===r?n:r);f&&(E.item=f);
q=q||E;(y<H.length-1||E!=l&&E!=d)&&K.push(y==H.length-1&&O&&O.selector,E);l=E}).apply(this,H[y])}else l.appendChild(p.createTextNode(N.value))}catch(T){console.error(T,T.stack),l.innerHTML&&(l.innerHTML=""),l.appendChild(p.createTextNode(T))}}for(;N=K.pop();)m.update(N,K.pop());return q}}function n(a,c,d,f){var g,h;c&&c.eachProperty?(e(d,g=c.selector),h=c):(e(d,g=a.selector||(a.selector=".-xbind-"+t++)),h=a);var l=a.getArgs()[0],p=a.expressionResult,n=a.expressionDefinition;n||(n=a.expressionDefinition=
k.evaluate(a.parent,l),p=n.valueOf(),m.addInputConnector(h,n),function(c,d,e){a.expressionResult=p;e.dependencyOf&&e.dependencyOf({invalidate:function(a){a=a?m.matchesRule(a.elements[0],h)?a.elements:a.elements[0].querySelectorAll(d):document.querySelectorAll(d);for(var b=0,g=a.length;b<g;b++)f(a[b],c,e.valueOf())}})}(c,g,n));f(d,c,p)}function c(a,c,d,e){return h.when(a,function(a){a&&a.forRule&&(a=a.forRule(c));a&&a.forElement&&(a=a.forElement(d));e(a)})}function g(a,d,e,f){c(e,f,a,function(c){a.setAttribute(d,
c)})}function a(a,d,g,h){a._defaultBinding=!0;if(g&&g.then&&"INPUT"!==a.tagName)try{a.appendChild(p.createTextNode("Loading"))}catch(k){}c(g,h,a,function(c){if(a._defaultBinding)if(s(a),a.childNodes.length&&(a.innerHTML=""),c&&c.sort)if(c.isSequence)l(c,h)(a);else{var g=d&&d.definitions&&d.definitions.each,k=h.newRule(),g=g?l(g,k):function(a,b,c){return e(c||a,(c?"-":"")+(q[a.tagName]||"span"),""+b)},m=[],n;c.track&&(c=c.track(),n=c.tracking);c.forEach(function(c){m.push(g(a,c,null))});if(c.on)var r=
c.on("add,delete,update",function(c){var d=c.target,e=c.previousIndex;c=c.index;if(-1<e){var f=m[e];s(f,!0);f.parentNode.removeChild(f);m.splice(e,1)}-1<c&&m.splice(c,0,g(a,d,m[c]||null))});if(n=n||r)a.xcleanup=function(){n.remove()}}else c&&c.nodeType?a.appendChild(c):(c=void 0===c?"":c,a.tagName in f?"checkbox"===a.type?a.checked=c:a.value=c:a.appendChild(p.createTextNode(c)))})}function s(a,c){a.xcleanup&&a.xcleanup(c);for(var d=a.getElementsByTagName("*"),e=0,f=d.length;e<f;e++){var g=d[e];g.xcleanup&&
g.xcleanup(!0)}}function r(a,c){return l(c,d)(a)}var q={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},f={INPUT:1,TEXTAREA:1,SELECT:1},p=document,t=1;r.forSelector=l;return r})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(m,e,h){return m("dojo.store.Memory",null,{constructor:function(e){for(var d in e)this[d]=e[d];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:h,get:function(e){return this.data[this.index[e]]},
getIdentity:function(e){return e[this.idProperty]},put:function(e,d){var h=this.data,m=this.index,c=this.idProperty,c=e[c]=d&&"id"in d?d.id:c in e?e[c]:Math.random();if(c in m){if(d&&!1===d.overwrite)throw Error("Object already exists");h[m[c]]=e}else m[c]=h.push(e)-1;return c},add:function(e,d){(d=d||{}).overwrite=!1;return this.put(e,d)},remove:function(e){var d=this.index,h=this.data;if(e in d)return h.splice(d[e],1),this.setData(h),!0},query:function(h,d){return e(this.queryEngine(h,d)(this.data))},
setData:function(e){e.items?(this.idProperty=e.identifier||this.idProperty,e=this.data=e.items):this.data=e;this.index={};for(var d=0,h=e.length;d<h;d++)this.index[e[d][this.idProperty]]=d}})})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(m){return function(e,h){function k(d){d=m.filter(d,e);var k=h&&h.sort;k&&d.sort("function"==typeof k?k:function(c,a){for(var d,e=0;d=k[e];e++){var h=c[d.attribute],f=a[d.attribute],h=null!=h?h.valueOf():h,f=null!=f?f.valueOf():
f;if(h!=f)return!!d.descending==(null==h||h>f)?-1:1}return 0});if(h&&(h.start||h.count)){var c=d.length;d=d.slice(h.start||0,(h.start||0)+(h.count||Infinity));d.total=c}return d}switch(typeof e){default:throw Error("Can not query with a "+typeof e);case "object":case "undefined":var d=e;e=function(e){for(var h in d){var c=d[h];if(c&&c.test){if(!c.test(e[h],e))return!1}else if(c!=e[h])return!1}return!0};break;case "string":if(!this[e])throw Error("No filter function "+e+" was found in store");e=this[e];
case "function":}k.matches=e;return k}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r){h.isAsync||c(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var q=e("dojo.dnd.Source",s,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],
generateText:!0,constructor:function(a,c){k.mixin(this,k.mixin({},c));var e=this.accept;if(e.length){this.accept={};for(var b=0;b<e.length;++b)this.accept[e[b]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&d.add(this.node,"dojoDndSource");this.targetState="";this.accept&&d.add(this.node,"dojoDndTarget");this.horizontal&&d.add(this.node,"dojoDndHorizontal");this.topics=[g.subscribe("/dnd/source/over",
k.hitch(this,"onDndSourceOver")),g.subscribe("/dnd/start",k.hitch(this,"onDndStart")),g.subscribe("/dnd/drop",k.hitch(this,"onDndDrop")),g.subscribe("/dnd/cancel",k.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,c){if(this==a)return!this.copyOnly||this.selfAccept;for(var d=0;d<c.length;++d){for(var b=a.getItem(c[d].id).type,e=!1,g=0;g<b.length;++g)if(b[g]in this.accept){e=!0;break}if(!e)return!1}return!0},copyState:function(a,c){if(a)return!0;2>arguments.length&&(c=this==r.manager().target);
if(c){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){q.superclass.destroy.call(this);m.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(c){if(!(this.isDragging&&"Disabled"==this.targetState)){q.superclass.onMouseMove.call(this,c);var d=r.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(c.pageX-this._lastX)>this.delay||Math.abs(c.pageY-this._lastY)>this.delay)){var e=this.getSelectedNodes();
e.length&&d.startDrag(this,e,this.copyState(a.getCopyKeyState(c),!0))}if(this.isDragging){e=!1;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current)this.targetBox=l.position(this.current,!0);e=this.horizontal?c.pageX-this.targetBox.x<this.targetBox.w/2==l.isBodyLtr(this.current.ownerDocument):c.pageY-this.targetBox.y<this.targetBox.h/2}if(this.current!=this.targetAnchor||e!=this.before)this._markTargetAnchor(e),d.canDrop(!this.current||d.source!=this||!(this.current.id in this.selection))}}},
onMouseDown:function(c){if(!this.mouseDown&&this._legalMouseDown(c)&&(!this.skipForm||!a.isFormElement(c)))this.mouseDown=!0,this._lastX=c.pageX,this._lastY=c.pageY,q.superclass.onMouseDown.call(this,c)},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,q.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=r.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||
!(this.current.id in this.selection))))},onDndStart:function(a,c,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");c=this.accept&&this.checkAcceptance(a,c);this._changeState("Target",c?"":"Disabled");this==a&&r.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,c,d,b){if(this==b)this.onDrop(a,c,d);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=
this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,c,d){if(this!=a)this.onDropExternal(a,c,d);else this.onDropInternal(c,d)},onDropExternal:function(c,d,e){var b=this._normalizedCreator;this._normalizedCreator=this.creator?function(a,d){return b.call(this,c.getItem(a.id).data,d)}:e?function(b){var d=c.getItem(b.id);b=b.cloneNode(!0);b.id=a.getUniqueId();return{node:b,data:d.data,type:d.type}}:function(a){var b=c.getItem(a.id);c.delItem(a.id);return{node:a,
data:b.data,type:b.type}};this.selectNone();!e&&!this.creator&&c.selectNone();this.insertNodes(!0,d,this.before,this.current);!e&&this.creator&&c.deleteSelectedNodes();this._normalizedCreator=b},onDropInternal:function(c,d){var e=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(d)this._normalizedCreator=this.creator?function(a,c){return e.call(this,this.getItem(a.id).data,c)}:function(b){var c=this.getItem(b.id);b=b.cloneNode(!0);b.id=a.getUniqueId();return{node:b,
data:c.data,type:c.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var c=this.getItem(a.id);return{node:a,data:c.data,type:c.type}}}this._removeSelection();this.insertNodes(!0,c,this.before,this.current);this._normalizedCreator=e}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){q.superclass.onOverEvent.call(this);r.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){q.superclass.onOutEvent.call(this);
r.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){this.current==this.targetAnchor&&this.before==a||(this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!n.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(d.contains(a,"dojoDndHandle"))return!0;if(d.contains(a,"dojoDndItem")||d.contains(a,"dojoDndIgnore"))break}return!1}});return q})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(m,e,h,k,d,l,n,c,g,a,s,r){var q=e("dojo.dnd.Selector",r,{constructor:function(c,d){d||(d={});this.singular=d.singular;this.autoSync=d.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(g(this.node,a.press,k.hitch(this,"onMouseDown")),g(this.node,a.release,k.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new c,e=s._empty,g;for(g in this.selection)g in e||a.push(d.byId(g));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(a,c){this._addItemClass(d.byId(c),"Selected");this.selection[c]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=s._empty,c;for(c in this.selection)if(!(c in a)){var e=d.byId(c);this.delItem(c);l.destroy(e)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,c){c=c||h.global;var d=this.selection,b=s._empty,e;for(e in d)e in b||a.call(c,this.getItem(e),e,this)},sync:function(){q.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],c=s._empty,d;for(d in this.selection)d in c||this.getItem(d)||a.push(d);m.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,c,d,b){var e=this._normalizedCreator;this._normalizedCreator=function(b,c){var d=e.call(this,b,c);a?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,"Selected"),this._removeItemClass(d.node,"Anchor"));return d};q.superclass.insertNodes.call(this,c,d,b);this._normalizedCreator=e;return this},destroy:function(){q.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!s.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,n.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){s.getCopyKeyState(a)||this._removeSelection();var c=this.getAllNodes();if(c.length&&(this.anchor||(this.anchor=c[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,b;d<c.length&&!(b=c[d],b==this.anchor||b==this.current);++d);for(++d;d<c.length;++d){b=c[d];if(b==this.anchor||b==this.current)break;this._addItemClass(b,"Selected");this.selection[b.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?s.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):s.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=g(this.node,a.move,k.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=s._empty,c;for(c in this.selection)if(!(c in a)){var e=d.byId(c);e&&this._removeItemClass(e,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return q})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f){e=e("dojo.dnd.Container",g,{skipForm:!1,allowNested:!1,constructor:function(a,c){this.node=l.byId(a);
c||(c={});this.creator=c.creator||null;this.skipForm=c.skipForm;this.parent=c.dropParent&&l.byId(c.dropParent);this.map={};this.current=null;this.containerState="";n.add(this.node,"dojoDndContainer");(!c||!c._skipStartup)&&this.startup();this.events=[s(this.node,q.over,k.hitch(this,"onMouseOver")),s(this.node,q.out,k.hitch(this,"onMouseOut")),s(this.node,"dragstart",k.hitch(this,"onSelectStart")),s(this.node,"selectstart",k.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},
setItem:function(a,c){this.map[a]=c},delItem:function(a){delete this.map[a]},forInItems:function(a,c){c=c||h.global;var b=this.map,d=f._empty,e;for(e in b)e in d||a.call(c,b[e],e,this);return c},clearItems:function(){this.map={}},getAllNodes:function(){return r((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(c){if(c.id){var b=this.getItem(c.id);if(b){a[c.id]=b;return}}else c.id=f.getUniqueId();var b=c.getAttribute("dndType"),
d=c.getAttribute("dndData");a[c.id]={data:d||c.innerHTML,type:b?b.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,c,b){this.parent.firstChild?c?b||(b=this.parent.firstChild):b&&(b=b.nextSibling):b=null;var d;if(b)for(c=0;c<a.length;++c)d=this._normalizedCreator(a[c]),this.setItem(d.node.id,{data:d.data,type:d.type}),b.parentNode.insertBefore(d.node,b);else for(c=0;c<a.length;++c)d=this._normalizedCreator(a[c]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);
return this},destroy:function(){m.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,c,b){a._skipStartup=!0;return new b(c,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=f._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var c=a.relatedTarget;c&&
c!=this.node;)try{c=c.parentNode}catch(b){c=null}c||(this._changeState("Container","Over"),this.onOverEvent());c=this._getChildByEvent(a);this.current!=c&&(this.current&&this._removeItemClass(this.current,"Over"),c&&this._addItemClass(c,"Over"),this.current=c)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(c){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){if(!this.skipForm||
!f.isFormElement(a))a.stopPropagation(),a.preventDefault()},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,c){var b="dojoDnd"+a,d=a.toLowerCase()+"State";n.replace(this.node,b+c,b+this[d]);this[d]=c},_addItemClass:function(a,c){n.add(a,"dojoDndItem"+c)},_removeItemClass:function(a,c){n.remove(a,"dojoDndItem"+c)},_getChildByEvent:function(a){if(a=a.target)for(var c=a.parentNode;c;a=c,c=a.parentNode)if((c==this.parent||this.allowNested)&&n.contains(a,"dojoDndItem"))return a;
return null},_normalizedCreator:function(a,c){var b=(this.creator||this.defaultCreator).call(this,a,c);k.isArray(b.type)||(b.type=["text"]);b.node.id||(b.node.id=f.getUniqueId());n.add(b.node,"dojoDndItem");return b}});f._createNode=function(a){return!a?f._createSpan:function(d){return c.create(a,{innerHTML:d})}};f._createTrTd=function(a){var d=c.create("tr");c.create("td",{innerHTML:a},d);return d};f._createSpan=function(a){return c.create("span",{innerHTML:a})};f._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};f._defaultCreator=function(a){a=a.tagName.toLowerCase();var c="tbody"==a||"thead"==a?f._createTrTd:f._createNode(f._defaultCreatorNodes[a]);return function(a,d){var e=a&&k.isObject(a),g,h;e&&a.tagName&&a.nodeType&&a.getAttribute?(g=a.getAttribute("dndData")||a.innerHTML,e=(e=a.getAttribute("dndType"))?e.split(/\s*,\s*/):["text"],h=a):(g=e&&a.data?a.data:a,e=e&&a.type?a.type:["text"],h=("avatar"==d?f._createSpan:c)(String(g)));h.id||(h.id=f.getUniqueId());return{node:h,data:g,type:e}}};
return e})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f){var p=e("dojo.dnd.Manager",[l],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:n("touch")?0:16,OFFSET_Y:n("touch")?-64:16,overSource:function(c){this.avatar&&
(this.target=c&&"Disabled"!=c.targetState?c:null,this.canDropFlag=Boolean(this.target),this.avatar.update());a.publish("/dnd/source/over",c)},outSource:function(c){this.avatar?this.target==c&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),a.publish("/dnd/source/over",null)):a.publish("/dnd/source/over",null)},startDrag:function(c,b,e){function f(a){a.preventDefault();a.stopPropagation()}q.autoScrollStart(k.doc);this.source=c;this.nodes=b;this.copy=Boolean(e);this.avatar=this.makeAvatar();
k.body().appendChild(this.avatar.node);a.publish("/dnd/start",c,b,this.copy);this.events=[g(k.doc,s.move,h.hitch(this,"onMouseMove")),g(k.doc,s.release,h.hitch(this,"onMouseUp")),g(k.doc,"keydown",h.hitch(this,"onKeyDown")),g(k.doc,"keyup",h.hitch(this,"onKeyUp")),g(k.doc,"dragstart",f),g(k.body(),"selectstart",f)];d.add(k.body(),"dojoDnd"+(e?"Copy":"Move"))},canDrop:function(a){a=Boolean(this.target&&a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){d.remove(k.body(),
["dojoDndCopy","dojoDndMove"]);m.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new f(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(q.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=Boolean(this.source.copyState(r.getCopyKeyState(a))),this.copy!=b&&this._setCopyStatus(b));
n("touch")&&a.preventDefault()},onMouseUp:function(c){if(this.avatar){if(this.target&&this.canDropFlag){var b=Boolean(this.source.copyState(r.getCopyKeyState(c)));a.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,c);a.publish("/dnd/drop",this.source,this.nodes,b,this.target,c)}else a.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(d){if(this.avatar)switch(d.keyCode){case c.CTRL:d=Boolean(this.source.copyState(!0));this.copy!=d&&this._setCopyStatus(d);break;case c.ESCAPE:a.publish("/dnd/cancel"),
this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==c.CTRL&&(a=Boolean(this.source.copyState(!1)),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();d.replace(k.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});r._manager=null;p.manager=r.manager=function(){r._manager||(r._manager=new p);return r._manager};return p})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),
function(m,e,h,k,d,l,n,c){return m("dojo.dnd.Avatar",null,{constructor:function(c){this.manager=c;this.construct()},construct:function(){var c=l.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),a=this.manager.source,d,e=l.create("tbody",null,c),h=l.create("tr",null,e),f=l.create("td",null,h),m=Math.min(5,this.manager.nodes.length),t=0;n("highcontrast")&&l.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},f);l.create("span",{innerHTML:a.generateText?
this._generateText():""},f);for(k.set(h,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});t<m;++t)a.creator?d=a._normalizedCreator(a.getItem(this.manager.nodes[t].id).data,"avatar").node:(d=this.manager.nodes[t].cloneNode(!0),"tr"==d.tagName.toLowerCase()&&(h=l.create("table"),l.create("tbody",null,h).appendChild(d),d=h)),d.id="",h=l.create("tr",null,e),f=l.create("td",null,h),f.appendChild(d),k.set(h,{"class":"dojoDndAvatarItem",style:{opacity:(9-t)/10}});this.node=c},destroy:function(){l.destroy(this.node);
this.node=!1},update:function(){d.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(n("highcontrast")){var e=h.byId("a11yIcon"),a="+";this.manager.canDropFlag&&!this.manager.copy?a="\x3c ":!this.manager.canDropFlag&&!this.manager.copy?a="o":this.manager.canDropFlag||(a="x");e.innerHTML=a}c("tr.dojoDndAvatarHeader td span"+(n("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},
"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(m,e,h,k){return m("dijit.CheckedMenuItem",h,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:k,checked:!1,_setCheckedAttr:function(d){this.domNode.setAttribute("aria-checked",d?"true":"false");this._set("checked",d)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(d){this.disabled||
(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(d)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),function(m,e,h,k,d,l,n,c,g,a,s){var r=g("dijit.ColorPalette",[h,k,d],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:e,baseClass:"dijitColorPalette",_dyeFactory:function(a,c,d,e){return new this._dyeClass(a,c,d,e)},buildRendering:function(){this.inherited(arguments);this._dyeClass=g(r._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],n.getLocalization("dojo","colors",
this.lang))}});r._Color=g("dijit._Color",c,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":m.toUrl("./themes/a11y/colors7x10.png"),"3x4":m.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,d,e,g){this._title=g;this._row=d;this._col=e;this.setColor(c.named[a])},getValue:function(){return this.toHex()},fillCell:function(c,d){var e=s.substitute(l("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:d,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});a.place(e,c)}});return r})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(m,e,h,k,d,l,n,c,g,a,s){return m("dijit._PaletteMixin",c,{defaultTimeout:500,timeoutChangeRate:0.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?l.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,c){this._cells=[];var e=this._blankGif;this.own(n(this.gridNode,g,l.hitch(this,"_onCellClick")));for(var h=0;h<a.length;h++)for(var m=k.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),b=0;b<a[h].length;b++){var v=a[h][b];if(v){var u=this._dyeFactory(v,h,b,c[v]),v=k.create("td",{"class":this.cellClass,tabIndex:"-1",title:c[v],role:"gridcell"},m);u.fillCell(v,e);v.idx=this._cells.length;this._cells.push({node:v,
dye:u})}}this._xDim=a[0].length;this._yDim=a.length;var x={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},z;for(z in x)this.own(s.addKeyListener(this.domNode,{keyCode:d[z],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=x[z];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){a.focus(this._currentFocus)},
_onCellClick:function(c){for(var d=c.target;"TD"!=d.tagName;){if(!d.parentNode||d==this.gridNode)return;d=d.parentNode}var e=this._getDye(d).getValue();this._setCurrent(d);a.focus(d);this._setValueAttr(e,!0);c.stopPropagation();c.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&e.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&e.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,c){0<=this._selectedCell&&h.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var d=0;d<this._cells.length;d++)if(a==this._cells[d].dye.getValue()){this._selectedCell=d;h.add(this._cells[d].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(c||void 0===c)this.onChange(a)},onChange:function(){},_navigateByKey:function(c,d){if(-1!=d){var e=this._currentFocus.idx+c;e<this._cells.length&&-1<e&&(e=this._cells[e].node,this._setCurrent(e),this.defer(l.hitch(a,"focus",e)))}},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(m){return m})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(m,e,h,k,d,l,n,c,g){k("dijit-legacy-requires")&&l(0,function(){m(["dijit/form/RadioButton"])});return e("dijit.form.CheckBox",[n,c],{templateString:g,baseClass:"dijitCheckBox",_setValueAttr:function(a,
c){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,c)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&d("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&d("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(m,e){return m("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(h){this._set("readOnly",h);e.set(this.focusNode,"readOnly",h)},_setLabelAttr:void 0,_getSubmitValue:function(e){return null==e||""===e?"on":e},_setValueAttr:function(h){h=this._getSubmitValue(h);this._set("value",h);e.set(this.focusNode,
"value",h)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));e.set(this.focusNode,"value",this.value)},_onClick:function(e){return this.readOnly?(e.stopPropagation(),e.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(m,e,h){return m("dijit.form.ComboBox",[e,h],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(m,e,h,k,d,l,n,c,g){return m("dijit.form.ComboBoxMixin",[c,l],{dropDownClass:n,hasDownArrow:!0,templateString:g,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(a){a.get||k.mixin(a,{_oldAPI:!0,get:function(a){var c=new e;this.fetchItemByIdentity({identity:a,
onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(a,c){var g=new e(function(){f.abort&&f.abort()});g.total=new e;var f=this.fetch(k.mixin({query:a,onBegin:function(a){g.total.resolve(a)},onComplete:function(a){g.resolve(a)},onError:function(a){g.reject(a)}},c));return d(g)}});this._set("store",a)},postMixInProperties:function(){var a=this.params.store||this.store;a&&this._setStoreAttr(a);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var c=this.declaredClass;k.mixin(this.store,{getValue:function(a,d){h.deprecated(c+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[d]},getLabel:function(a){h.deprecated(c+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(a){h.deprecated(c+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
k.hitch(this,function(c){(new c({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(m,e,h,k,d,l,n,c,g,a,s){e=e("dijit.form._AutoCompleterMixin",s,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var d=0;if("number"==typeof a.selectionStart)d=a.selectionStart;else if(c("ie")){var e=a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();e.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",e),d=String(a.text).replace(/\r/g,"").length}catch(g){}}return d},_setCaretPos:function(c,d){d=parseInt(d);a.selectInputText(c,d,d)},_setDisabledAttr:function(a){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var c=a.charCode||a.keyCode;if(!(c==k.ALT||c==k.CTRL||c==k.META||c==k.SHIFT)){var d=this.dropDown,e=null;this._abortQuery();this.inherited(arguments);if(!a.altKey&&!a.ctrlKey&&!a.metaKey)switch(this._opened&&(e=d.getHighlightedOption()),c){case k.PAGE_DOWN:case k.DOWN_ARROW:case k.PAGE_UP:case k.UP_ARROW:this._opened&&this._announceOption(e);a.stopPropagation();a.preventDefault();break;case k.ENTER:if(e){if(e==
d.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(e==d.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case k.TAB:c=this.get("displayedValue");if(d&&(c==d._messages.previousMessage||c==d._messages.nextMessage))break;e&&this._selectOption(e);case k.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(c){var d=this.focusNode;a.selectInputText(d,d.value.length);var e=this.ignoreCase?"toLowerCase":"substr";0==c[e](0).indexOf(this.focusNode.value[e](0))?(e=this.autoComplete?this._getCaretPos(d):d.value.length,e+1>d.value.length&&(d.value=c,a.selectInputText(d,e))):(d.value=c,a.selectInputText(d))},_openResultList:function(a,c,e){var g=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();!a.length&&0==e.start?this.closeDropDown():(this._nextSearch=this.dropDown.onPage=
d.hitch(this,function(c){a.nextPage(-1!==c);this.focus()}),this.dropDown.createOptions(a,e,d.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in e?(e.direction?this.dropDown.highlightFirstOption():e.direction||this.dropDown.highlightLastOption(),g&&this._announceOption(this.dropDown.getHighlightedOption())):this.autoComplete&&(!this._prev_key_backspace&&!/^[*]+$/.test(c[this.searchAttr].toString()))&&this._announceOption(this.dropDown.containerNode.firstChild.nextSibling))},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),c=this.dropDown;c&&(a==c._messages.previousMessage||a==c._messages.nextMessage)?this._setValueAttr(this._lastValueReported,
!0):"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState());this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,c,d){var e="";a&&(d||(d=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),e=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):d);this.set("value",e,c,d,a)},_announceOption:function(a){if(a){var c;if(a==
this.dropDown.nextButton||a==this.dropDown.previousButton)c=a.innerHTML,this.item=void 0,this.value="";else{var d=this.dropDown.items[a.getAttribute("item")];c=(this.store._oldAPI?this.store.getValue(d,this.searchAttr):d[this.searchAttr]).toString();this.set("item",d,!1,c)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",h.get(a,"id"));this._autoCompleteText(c)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);
this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var c=this.id+"_popup";this.dropDown=new (d.isString(this.dropDownClass)?d.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:d.hitch(this,this._selectOption),id:c,
dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new g({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var c=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,c):a[c]}}},postCreate:function(){var a=l('label[for\x3d"'+this.id+'"]');a.length&&
(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);m.after(this,"onSearch",d.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var c=this.labelType;"none"!=this.highlightMatch&&("text"==this.labelType&&this._lastInput)&&(a=this.doHighlight(a,this._lastInput),c="html");return{html:"html"==c,label:a}},doHighlight:function(a,c){var d=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?
"g":""),e=this.queryExpr.indexOf("${0}");c=n.escapeString(c);return this._escapeHtml(a.replace(RegExp((0==e?"^":"")+"("+c+")"+(e==this.queryExpr.length-4?"$":""),d),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,
c){return(c._oldAPI?c.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,c,d,e){this._set("item",e||null);null==a&&(a="");this.inherited(arguments)}});c("dojo-bidi")&&e.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return e})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(m,
e,h,k,d,l){function n(c){return{id:c.value,value:c.value,name:h.trim(c.innerText||c.textContent||"")}}return m("dijit.form.DataList",d,{constructor:function(c,d){this.domNode=e.byId(d);h.mixin(this,c);this.id&&l.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:k("option",this.domNode).map(n)}])},destroy:function(){l.remove(this.id)},fetchSelectedItem:function(){var c=k("\x3e option[selected]",this.domNode)[0]||k("\x3e option",this.domNode)[0];return c&&n(c)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),
function(m,e,h,k,d,l,n){return m("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(c){this._set("list",c)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(c){return RegExp("^"+c.replace(/(\\.)|(\*)|(\?)|\W/g,function(c,a,d,e){return d?".*":e?".":a?a:"\\"+c})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&
(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(c){if(!this.disabled&&!this.readOnly){c=c.charOrCode;var d=!1;this._prev_key_backspace=!1;switch(c){case e.DELETE:case e.BACKSPACE:d=this._maskValidSubsetError=this._prev_key_backspace=
!0;break;default:d="string"==typeof c||229==c}if(d)if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(c){this._abortQuery();var e=this,a=h.clone(this.query),k={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},m=d.substitute(this.queryExpr,[c.replace(/([\\\*\?])/g,"\\$1")]),n,f=function(){var c=e._fetchHandle=e.store.query(a,
k);!e.disabled&&!(e.readOnly||n!==e._lastQuery)&&l(c,function(d){e._fetchHandle=null;!e.disabled&&(!e.readOnly&&n===e._lastQuery)&&l(c.total,function(b){d.total=b;var c=e.pageSize;if(isNaN(c)||c>d.total)c=d.total;d.nextPage=function(b){k.direction=b=!1!==b;k.count=c;b?(k.start+=d.length,k.start>=d.total&&(k.count=0)):(k.start-=c,0>k.start&&(k.count=Math.max(c+k.start,0),k.start=0));0>=k.count?(d.length=0,e.onSearch(d,a,k)):f()};e.onSearch(d,a,k)})},function(a){e._fetchHandle=null;e._cancelingQuery||
console.error(e.declaredClass+" "+a.toString())})};h.mixin(k,this.fetchProperties);this.store._oldAPI?n=m:(n=this._patternToRegExp(m),n.toString=function(){return m});this._lastQuery=a[this.searchAttr]=n;this._queryDeferHandle=this.defer(f,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var c=this.list;c&&(this.store=n.byId(c))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),
function(m,e,h,k,d,l,n,c){return m("dijit.form._ComboBoxMenu",[d,l,c,n],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(e.add(this.previousButton,"dijitMenuItemRtl"),e.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var c=this.ownerDocument.createElement("div");c.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");c.setAttribute("role","option");return c},onHover:function(c){e.add(c,"dijitMenuItemHover")},onUnhover:function(c){e.remove(c,
"dijitMenuItemHover")},onSelect:function(c){e.add(c,"dijitMenuItemSelected")},onDeselect:function(c){e.remove(c,"dijitMenuItemSelected")},_page:function(c){var a=0,d=this.domNode.scrollTop,e=h.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();a<e;){var k=this.getHighlightedOption();if(c){if(!k.previousSibling||"none"==k.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!k.nextSibling||"none"==k.nextSibling.style.display)break;this.selectNextNode()}k=
this.domNode.scrollTop;a+=(k-d)*(c?-1:1);d=k}},handleKey:function(c){switch(c.keyCode){case k.DOWN_ARROW:return this.selectNextNode(),!1;case k.PAGE_DOWN:return this._page(!1),!1;case k.UP_ARROW:return this.selectPreviousNode(),!1;case k.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(m,e,h,k,d){var l=e("dijit.form._ComboBoxMenuMixin"+
(k("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=d.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(d){this._set("value",d);this.onChange(d)},onClick:function(d){if(d==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(d==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(d)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(d,c){var e=this._createMenuItem(),a=c(d);a.html?e.innerHTML=a.label:e.appendChild(e.ownerDocument.createTextNode(a.label));""==e.innerHTML&&(e.innerHTML="\x26#160;");return e},createOptions:function(d,c,e){this.items=d;this.previousButton.style.display=0==c.start?"none":"";h.set(this.previousButton,"id",this.id+
"_prev");m.forEach(d,function(a,c){var d=this._createOption(a,e);d.setAttribute("item",c);h.set(d,"id",this.id+c);this.nextButton.parentNode.insertBefore(d,this.nextButton)},this);var a=!1;d.total&&!d.total.then&&-1!=d.total?c.start+c.count<d.total?a=!0:c.start+c.count>d.total&&c.count==d.length&&(a=!0):c.count==d.length&&(a=!0);this.nextButton.style.display=a?"":"none";h.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var d=this.containerNode;2<d.childNodes.length;)d.removeChild(d.childNodes[d.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});k("dojo-bidi")&&(l=e("dijit.form._ComboBoxMenuMixin",
l,{_createOption:function(){var d=this.inherited(arguments);this.applyTextDir(d);return d}}));return l})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(m,e,h,k){return m("dijit.form._ListMouseMixin",k,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(d,e){this._setSelectedAttr(e,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(e)})},_onMouseDown:function(d,e){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(e,!1)},_onMouseUp:function(d,e){this._isDragging=!1;var h=this.selected,c=this._hoveredNode;h&&e==h?this.defer(function(){this._onClick(d,
h)}):c&&this.defer(function(){this._onClick(d,c)})},_onMouseOut:function(d,e){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(d,e){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=e;this.onHover(e);this._isDragging&&this._setSelectedAttr(e,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(m,e,h){return m("dijit.form._ListBase",null,{selected:null,_listConnect:function(h,d){var l=this;return l.own(e(l.containerNode,e.selector(function(d,c,e){return d.parentNode==e},h),function(e){l[d](e,this)}))},selectFirstNode:function(){for(var e=this.containerNode.firstChild;e&&"none"==e.style.display;)e=e.nextSibling;this._setSelectedAttr(e,!0)},selectLastNode:function(){for(var e=this.containerNode.lastChild;e&&"none"==e.style.display;)e=e.previousSibling;this._setSelectedAttr(e,
!0)},selectNextNode:function(){var e=this.selected;if(e){for(e=e.nextSibling;e&&"none"==e.style.display;)e=e.nextSibling;e?this._setSelectedAttr(e,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var e=this.selected;if(e){for(e=e.previousSibling;e&&"none"==e.style.display;)e=e.previousSibling;e?this._setSelectedAttr(e,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(e,d){if(this.selected!=e){var l=this.selected;if(l)this.onDeselect(l);
e&&(d&&h.scrollIntoView(e),this.onSelect(e));this._set("selected",e)}else if(e)this.onSelect(e)}})})},"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'0\' selected\x3d"selected"\x3e${nls.basic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'1\'\x3eA-Z\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'2\'\x3e${nls.arrows}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'3\'\x3e${nls.business}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'4\'\x3e${nls.cartographic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'5\'\x3e${nls.nationalParkService}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'6\'\x3e${nls.outdoorRecreation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'7\'\x3e${nls.peoplePlaces}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'8\'\x3e${nls.safetyHealth}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'9\'\x3e${nls.shapes}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'10\'\x3e${nls.transportation}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e0%\x3c/li\x3e\r\n      \x3cli\x3e50%\x3c/li\x3e\r\n      \x3cli\x3e100%\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(m){m(['dojo/i18n!*preload*jimu/nls/main*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(m,e,h,k,d,l,n,c,g,a,s,r,q,f,p,t,b,v,u,x,z,A,C,w,F,D){function B(a){G=a}f={};var G;v.defaults.io.timeout=
18E4;"function"!==typeof q.getAll&&(q.getAll=function(a){var b=[];(a=q(a))&&b.push(a);return b});window.jimuNls=D;z.setProtocolErrorHandler(function(){return!0});v=C.getAncestorWindow();var I=!1;try{I=0===v.location.href.indexOf("https://")}catch(K){console.log(K),I="https:"===window.location.protocol}u.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);I&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));-1!==a.url.indexOf("/queryRelatedRecords?")&&!C.isHostedService(a.url)&&
(a.url=a.url.replace("FeatureServer","MapServer"));!window.isBuilder&&(G&&!G.mode&&G.appProxies&&0<G.appProxies.length)&&g.some(G.appProxies,function(b){if(0<=a.url.indexOf(b.sourceUrl))return a.url=a.url.replace(b.sourceUrl,b.proxyUrl),!0});return a});a(window,"mousedown",function(a){if(s.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-
a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=c.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.1";window.productVersion="Online 4.2";window.isBuilder?(r.subscribe("app/appConfigLoaded",B),r.subscribe("app/appConfigChanged",B)):(r.subscribe("appConfigLoaded",B),r.subscribe("appConfigChanged",
B));f.initApp=function(){var a,b;console.log("jimu.js init...");a=window.location.search;a=""===a?{}:t.queryToObject(a.substr(1));if(a.mobileBreakPoint)try{b=parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=b}catch(c){console.error("mobileBreakPoint URL parameter must be a number.",c)}h.getInstance(k.getInstance());d.getInstance();l.getInstance();n.setStyle(jimuConfig.loadingId,"display","none");n.setStyle(jimuConfig.mainPageId,"display","block");b=e.getInstance({mapId:jimuConfig.mapId,urlParams:a},
jimuConfig.layoutId);a=m.getInstance(a);b.startup();a.loadConfig();w(["dynamic-modules/preload"])};return f});