// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(p,e,h,l,d){p=p(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(a){this.messages=[];e.mixin(this,a);a=this.messages;var l,h=a.length;for(l=0;l<h;l++)a[l]=new d(a[l])},jobId:"",jobStatus:""});e.mixin(p,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",
STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});return p})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,e,h,l){p=p(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(d){e.mixin(this,d)}});e.mixin(p,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",
TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});return p})},"esri/dijit/analysis/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/json dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/number dojo/_base/window dojo/when dojo/dom dojo/data/ItemFileWriteStore dojo/topic dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter ./FeatureRecordSetLayer ./PluginLayers ../../layers/ArcGISImageServiceLayer".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f,v,z,D,F,E,c,n,k,A,x,M,H,C,I,N,J,G,K,O,P,L,Q,T,R){p={};e.mixin(p,{_helpDialog:null,i18n:null,initHelpLinks:function(b,c,k){this._helpDialog||(this._helpDialog=new N);if(b){var a=A.byNode(b),n=a?a.get("helpFileName"):k&&k.helpFileName?k.helpFileName:null,f=a?a.get("isSingleTenant"):k&&k.isSingleTenant?k.isSingleTenant:!1;a&&(a.showGeoAnalyticsParams||a.showBigData)||k&&k.analysisMode&&"bigdata"===k.analysisMode?n+="_bd":k&&(k.analysisMode&&"raster"===k.analysisMode)&&
(n+="_ro");m("[esriHelpTopic]",b).forEach(function(a,S,x){a&&(B.set(a,"display",!C.isDefined(c)||!0===c?"":"none"),l.connect(a,"onclick",e.hitch(this,function(c){d.stop(c);this._helpDialog.show(c,{helpId:t.get(a,"esriHelpTopic"),helpFileName:n,analysisGpServer:k&&k.analysisGpServer?k.analysisGpServer:null,helpParentNode:b,isPortal:f})})))},this)}},constructAnalysisFeatColl:function(b){var c={},k;c.featureCollection=b.layerDefinition;for(k in c.featureCollection)c.featureCollection.hasOwnProperty(k)&&
"objectIdField"===k&&(c.featureCollection.objectIdFieldName=e.clone(c.featureCollection.objectIdField),delete c.featureCollection.objectIdField);c.featureCollection.features=b.featureSet.features;return c},constructAnalysisInputLyrObj:function(b,c){var k={},a,n=b.getMap()||b._map,d;if(b.url&&!b._collection){k={url:b.url};a=this.isHostedService(b.url);d=10.2<=b.version&&b._useStandardizedQueries;b.getDefinitionExpression&&b.getDefinitionExpression()?k.filter=b.getDefinitionExpression():C.isDefined(b.definitionExpression)&&
""!==b.definitionExpression&&(k.filter=b.definitionExpression);if(b.useMapTime&&b.timeInfo&&n&&n.timeExtent&&(d||a||10.2<=b.version))d="",b.timeInfo.startTimeField&&!b.timeInfo.endTimeField?(n.timeExtent.startTime&&(d=b.timeInfo.startTimeField+" \x3e "+(a?"":"timestamp ")+"'"+this.formatDate(n.timeExtent.startTime)+"'"),n.timeExtent.endTime&&(n.timeExtent.startTime&&(d+=" AND "),d+=b.timeInfo.startTimeField+" \x3c "+(a?"":"timestamp ")+"'"+this.formatDate(n.timeExtent.endTime)+"'")):!b.timeInfo.startTimeField&&
b.timeInfo.endTimeField?(n.timeExtent.startTime&&(d=b.timeInfo.endTimeField+" \x3e "+(a?"":"timestamp ")+"'"+this.formatDate(n.timeExtent.startTime)+"'"),n.timeExtent.endTime&&(n.timeExtent.startTime&&(d+=" AND "),d+=b.timeInfo.endTimeField+" \x3c "+(a?"":"timestamp ")+"'"+this.formatDate(n.timeExtent.endTime)+"'")):b.timeInfo.startTimeField&&b.timeInfo.endTimeField&&(n.timeExtent.startTime&&(d=b.timeInfo.startTimeField+" \x3e "+(a?"":"timestamp ")+"'"+this.formatDate(n.timeExtent.startTime)+"'"),
n.timeExtent.endTime&&(n.timeExtent.startTime&&(d+=" AND "),d+=b.timeInfo.endTimeField+" \x3c "+(a?"":"timestamp ")+"'"+this.formatDate(n.timeExtent.endTime)+"'")),k.filter=k.filter?k.filter+(" AND "+d):d;b.credential&&(k.serviceToken=b.credential.token);-1!==k.url.indexOf("?")&&(a=k.url.substring(k.url.indexOf("?")+1,k.url.length),a=r.queryToObject(a),e.mixin(k,a),k.url=k.url.substring(0,k.url.indexOf("?")))}else if(!b.url||b._collection)try{k=b.toJson()}catch(f){b._json=u.parse(b._json),k=b.toJson()}c&&
(k=new Q(k));return k},formatDate:function(b){return w.format(b,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+w.format(b,{selector:"time",timePattern:"HH:mm:ss"})},isHostedService:function(b){if(!b)return!1;var c=-1!==b.indexOf(".arcgis.com/");b=-1!==b.indexOf("//services")||-1!==b.indexOf("//tiles")||-1!==b.indexOf("//features");return c&&b},isTimeEnabled:function(b){var c=10.2<=b.version&&b._useStandardizedQueries;return b.useMapTime&&b.timeInfo&&(c||10.2<=b.version)},isTimeInstantLayer:function(b){return C.isDefined(b.timeInfo)&&
C.isDefined(b.timeInfo.startTimeField)&&!C.isDefined(b.timeInfo.endTimeField)||C.isDefined(b.time)&&C.isDefined(b.time.timeType)&&"instant"===b.time.timeType},buildReport:function(b,c){var k="";c||(c={},e.mixin(c,s.analysisMsgCodes));h.forEach(b,function(b,a){var n,d,f;"string"===typeof b.message?(n=C.isDefined(c[b.messageCode])?c[b.messageCode]:b.message,k+=b.style.substring(0,b.style.indexOf("\x3c/"))+(!this._isEmptyObject(b.params)?q.substitute(n,b.params):n)+b.style.substring(b.style.indexOf("\x3c/"))):
e.isArray(b.message)&&(f=[],d=e.clone(b.style),h.forEach(b.message,function(k,a){d=d.replace(/<\//,"${"+a+"}");n=C.isDefined(c[b.messageCode+"_"+a])?c[b.messageCode+"_"+a]:k;n=!this._isEmptyObject(b.params)?q.substitute(n,b.params):n;f.push(n+"\x3c/")},this),d=q.substitute(d,f),k+=d)},this);return k},getLayerFeatureCount:function(b,c){var k=new J;k.geometry=c.geometry||"";k.where=c.where||"1\x3d1";k.geometryType=c.geometryType||"esriGeometryEnvelope";return b.queryCount(k)},createPolygonFeatureCollection:function(b){var c;
c={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPolygon"}};c.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:b,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",
allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",
length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return c},createPointFeatureCollection:function(b){var c;c={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}};c.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",
drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:b,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:"esriGeometryPoint",fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",
name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return c},createFolderStore:function(b,c){var k=new n({data:{identifier:"id",label:"name",items:[]}});k.newItem({name:c,id:""});h.forEach(b,function(b){k.newItem({name:b.title,id:b.id})});return k},
setupFoldersUI:function(b){b.folderSelect.set("store",b.folderStore);b.folderSelect.set("required",!0);b.folderSelect.set("searchAttr","name");C.isDefined(b.folderId)?b.folderStore.get(b.folderId).then(e.hitch(this,function(c){C.isDefined(c)?b.folderSelect.set("item",c):b.folderStore.get("").then(function(c){b.folderSelect.set("item",c)},this)})):b.folderName?b.folderStore.fetch({query:{name:b.folderName},onComplete:e.hitch(this,function(c){C.isDefined(c)&&0<c.length?b.folderSelect.set("item",c[0]):
b.folderStore.get("").then(function(c){b.folderSelect.set("item",c)},this)})}):b.username?b.folderSelect.set("displayedValue",b.username):b.folderStore.get("").then(function(c){b.folderSelect.set("item",c)},this)},_isEmptyObject:function(b){for(var c in b)if(b.hasOwnProperty(c))return!1;return!0},validateServiceName:function(b,c){var k=/(:|&|<|>|%|#|\?|\\|\"|\/|\+)/.test(b),a=!0,n,d;C.isDefined(c)&&c.textInput&&(d=c.textInput);this.initI18n();0===b.length||0===q.trim(b).length?(n=this.i18n.requiredValue,
a=!1):k?(n=this.i18n.invalidServiceName,a=!1):98<b.length?(n=this.i18n.invalidServiceNameLength,a=!1):170<encodeURIComponent(b).length&&(n=this.i18n.invalidEncodedServiceNameLength,a=!1);d&&!a&&d.set("invalidMessage",n);return a},getStepNumber:function(b){m(".esriAnalysisNumberLabel",b).forEach(function(b,c){var k=this._getNumberLabel(c);t.set(b,"innerHTML",k)},this)},_getNumberLabel:function(b){var c="";this.initI18n();switch(b){case 0:c=this.i18n.oneLabel;break;case 1:c=this.i18n.twoLabel;break;
case 2:c=this.i18n.threeLabel;break;case 3:c=this.i18n.fourLabel;break;case 4:c=this.i18n.fiveLabel;break;case 5:c=this.i18n.sixLabel;break;case 6:c=this.i18n.sevenLabel;break;case 7:c=this.i18n.eightLabel;break;case 8:c=this.i18n.nineLabel}return c},populateAnalysisLayers:function(b,c,k,a){if(b){var n=[],d=b.get(c);b._titleRow&&B.set(b._titleRow,"display","none");b._analysisLabelRow&&B.set(b._analysisLabelRow,"display","table-row");b._selectAnalysisRow&&(B.set(b._selectAnalysisRow,"display","table-row"),
f.add(b._analysisSelect.domNode,"esriTrailingMargin3"),B.set(b._analysisSelect.domNode.parentNode,"padding-bottom","1em"));b.domNode&&this.getStepNumber(b.domNode);C.isDefined(a)&&a.chooseLabel&&n.push({value:-1,label:this.i18n.chooseLabel});if(!C.isDefined(a)||!C.isDefined(a.posIncrement))C.isDefined(a)||(a={}),a.posIncrement=0;h.forEach(b.get(k),function(b,c){c+=a.posIncrement;var k={value:C.isDefined(a)&&a.chooseLabel?c+1:c,label:b.name};d&&b.name===d.name&&(k.selected=!0);n.push(k)},this);b._analysisSelect.addOption(n);
b._analysisSelect.set("required",!0)}},isValidAnalysisLayer:function(b){var c,k,a,n,d,e,f,x="",A=!0;c={isValid:A,validationMessage:x};var g,l,v=0,z=0,B=0,m,w,s;if(!C.isDefined(b)||!C.isDefined(b.toolName))return c;this.initI18n();C.isDefined(this.i18n.cblPointMsg)||(this.i18n.cblPointMsg="You need to have at least one point feature layer to run ${toolName}.");c=b.toolName;k=b.featureLayers;a=b.analysisLayer;n=c.charAt(0).toLowerCase()+c.substring(1);f=this.i18n;b=b.showReadyToUseLayers||!1;h.forEach(k,
function(b){b instanceof R&&(m=!0);m&&1<b.bandCount&&(w=!0);m&&1===b.bandCount&&(s=!0);"esriGeometryPoint"===b.geometryType&&(e=!0,v++);if("esriGeometryPoint"===b.geometryType||"esriGeometryMultipoint"===b.geometryType)g=!0;"esriGeometryPolyline"===b.geometryType&&(l=!0,B++);"esriGeometryPolygon"===b.geometryType&&(d=!0,z++)},this);-1!==h.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],c)&&(!e||a&&"esriGeometryPoint"!==a.geometryType)?(x=q.substitute(this.i18n.selectPointLayer,
{toolName:f[n]}),A=!1):("AggregatePoints"===c||"InterpolatePoints"===c)&&(a&&!("esriGeometryPoint"===a.geometryType||"esriGeometryMultipoint"===a.geometryType)||!g)?(x=q.substitute(this.i18n.selectPointLayer,{toolName:f[n]}),A=!1):"CalculateDensity"===c&&(!g&&!l||a&&!("esriGeometryPoint"===a.geometryType||"esriGeometryMultipoint"===a.geometryType||"esriGeometryPolyline"===a.geometryType))?(x=q.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:f[n]}),A=!1):"FindHotSpots"===c&&(!g&&!d||a&&!("esriGeometryPoint"===
a.geometryType||"esriGeometryMultipoint"===a.geometryType||"esriGeometryPolygon"===a.geometryType))?(x=q.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:f[n]}),A=!1):("OverlayLayers"===c||"AggregatePoints"===c||"SummarizeWithin"===c||"SummarizeNearby"===c||"FindNearest"===c||"MergeLayers"===c)&&!b&&(0===k.length||1===k.length&&(k[0]===a||!C.isDefined(a)))?(x=q.substitute(this.i18n.overlayValidationMsg,{toolName:f[n]}),A=!1):"ConnectOriginsToDestinations"===c&&!b&&(0===k.length||2>v)?(x=q.substitute(this.i18n.odPointMsg,
{toolName:f[n]}),A=!1):"ChooseBestFacilities"===c&&(0===k.length||0===v)?(x=q.substitute(this.i18n.cblPointMsg,{toolName:f[n]}),A=!1):"AggregatePoints"===c&&!b&&1<k.length?(d=h.some(k,function(b){return"esriGeometryPolygon"===b.geometryType}),d||(x=q.substitute(this.i18n.aggregatePolyMsg,{toolName:f[n]}),A=!1)):"MergeLayers"===c&&!b&&1<k.length?1<v||(1<B||1<z)||(x=this.i18n.mergeValidationMsg,A=!1):("SummarizeWithin"===c||"DissolveBoundaries"===c)&&(a&&"esriGeometryPolygon"!==a.geometryType||!d)?
(x=q.substitute(this.i18n.selectPolyLayer,{toolName:f[n]}),A=!1):"ExtractData"===c?(A=h.some(k,function(b){return-1!==b.capabilities.indexOf("Extract")}))||(x=q.substitute(this.i18n.extractValidationMsg)):("ConnectOriginsToDestinations"===c||"ChooseBestFacilities"===c)&&1<k.length?(e=h.some(k,function(b){var c=C.isDefined(a)&&a.id===b.id;return"esriGeometryPoint"===b.geometryType&&!c}),e||(x=q.substitute("ChooseBestFacilities"===c?this.i18n.cblPointMsg:this.i18n.odPointMsg,{toolName:f[n]}),A=!1)):
"CalculateSlope"===c||"DeriveAspect"===c||"RemapValues"===c?m?s||(A=!1,x=q.substitute(this.i18n.noSingleBandISMsg,{toolName:f[n]})):(A=!1,x=q.substitute(this.i18n.noImageServiceMsg,{toolName:f[n]})):"ExtractRaster"===c?m||(A=!1,x=q.substitute(this.i18n.noImageServiceMsg,{toolName:f[n]})):"MonitorVegetation"===c&&(m?w||(A=!1,x=q.substitute(this.i18n.noMultiBandISMsg,{toolName:f[n]})):(A=!1,x=q.substitute(this.i18n.noImageServiceMsg,{toolName:f[n]})));return c={isValid:A,validationMessage:x}},initI18n:function(){this.i18n||
(this.i18n={},e.mixin(this.i18n,s.common),e.mixin(this.i18n,s.analysisTools),e.mixin(this.i18n,s.analysisMsgCodes),e.mixin(this.i18n,s.browseLayersDlg),e.mixin(this.i18n,s.driveTimes))},addBrowseAnalysisDialog:function(b){if(b&&b.widget){this.i18n||this.initI18n();var c="esri/dijit/analysis/PluginAnalysisLayers",k=function(b){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(b.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},
a=function(b){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(b.title||b.name||"\x3cNo Title\x3e")+"'\x3e"+(b.title.replace(/_/g," ")||b.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},n=function(b){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+b.iconUrl+"'/\x3e"},d=function(b){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+b.iconUrl+"'/\x3e"},f=F.doc.createDocumentFragment(),
f=v.create("div",{style:"width:100%;height:100%;"},f),A=v.create("div",{style:"width:100%;height:10%;","class":""}),g=v.create("div",{style:"width:100%"},f),l,h,z,m=this._isCustomAnalysisQuery(b.widget);1===b.browseType?(c="esri/dijit/analysis/PluginLayers",c={portalUrl:b.widget.get("portalUrl"),message:"",plugin:c,sortDescending:!0,sort:"title",self:b.widget.get("portalSelf"),pagingLinks:3,itemsPerPage:15,extent:b.widget.get("map").extent,useExtent:!1,fetchTimeout:600,galleryTemplate:"\x3cdiv class\x3d'listServiceTitle'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cdiv  style\x3d\"position:absolute;left:80px; top:10px; width:1px; height:1px; background: transparent;\"\x3e\x3c/div\x3e\x3cdiv style\x3d'overflow:hidden;'\x3e\x3ca style\x3d\"height:16px;\"\x3e${item.title}\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%' class\x3d'bottomRowTable'\x3e\x3ctd width\x3d'20'\x3e  \x3cspan class\x3d'esriAlignLeading'\x3e${item:_formatThumbnail}\x3c/span\x3e\x3c/td\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cspan class\x3d'esriAlignLeading' style\x3d'color:#656565;'\x3e${item.owner}\x3c/span\x3e\x3c/td\x3e\x3ctd style\x3d'padding-right:5px;padding-left:3px;'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",
showInfoPanel:!0,isAutoClose:!1,formatThumbnail:d,formatInfoPanelImage:n,"class":"esriAnalysisLayersItems"}):c={portalUrl:b.widget.get("portalUrl"),message:"",plugin:c,sortDescending:!0,sort:"title",self:b.widget.get("portalSelf"),pagingLinks:3,rowsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",extent:b.widget.get("map").extent,useExtent:!m,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatItemTitle:a,showInfoPanel:!1,showTooltip:!0,formatThumbnail:k,style:"width:48em;height:100%;clear:both;"};a=v.toDom('\x3cdiv class\x3d"esriBrowseOptions"\x3e');v.place(a,A);k=v.create("div",{"class":"esriBrowseOption"},a);if(!b.browseType||1!==b.browseType)a=v.create("div",{"class":"esriBrowseOption"},a),h=new M({name:"addlayer",id:b.widget.id+(b.browseType?b.browseType:"")+"_addlayercheck","class":"",value:!1,checked:!1},v.create("input",{},a)),v.create("label",{"for":b.widget.id+"_addlayercheck",
"class":"esriBrowseOption_label",innerHTML:this.i18n.addLayer},a);a=!0;b.browseType&&1===b.browseType?a=!1:m&&(a=!1);a=new M({name:"extentcheck",id:b.widget.id+(b.browseType?b.browseType:"")+"_addextentcheck","class":"",value:a,checked:a},v.create("input",{},k));v.create("label",{"for":b.widget.id+(b.browseType?b.browseType:"")+"_addextentcheck","class":"esriBrowseOption_label",innerHTML:this.i18n.withinMapArea},k);c.messageRight=A;l=new G(c,g);a.on("change",e.hitch(this,function(b){l.set("useExtent",
b)}));z=new x({title:1===b.browseType?this.i18n.browseLayers:m?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle,content:f,doLayout:b.browseType&&1===b.browseType,browseItems:l,addlayerCheckBox:h,style:"padding:.75em 0;background-color: #fff;width:50em;"});b.widget.own(b.widget.get("map").on("extent-change",e.hitch(b.widget,function(c){l.set("extent",b.widget.get("map").extent)})),z.on("hide",e.hitch(z,function(b){z.browseItems.reset()})));return z}},addAnalysisReadyLayer:function(b){function c(a){var n,
d,f=new K(k.url,{outFields:["*"]});e.mixin(k,f);e.mixin(k,a);k.id=k.title+"_"+a.id;b.item.selectedLayer?(k.title=k.title+"-"+a.name,a.name=k.title):(k.title=k.title.replace(/_/g," "),k.name=k.title);k.version=k.currentVersion;n=b.layersSelect.getOptions();if(b.widget.showBrowseLayers&&b.widget.showReadyToUseLayers)d=3;else if(b.widget.showBrowseLayers||b.widget.showReadyToUseLayers)d=2;n=n.splice(n.length-d,d);b.layersSelect.removeOption(n);d=b.layers.length;b.posIncrement&&(d+=b.posIncrement);n.unshift({value:d,
label:k.title,selected:!0});b.layersSelect.addOption(n);b.layersSelect.set("value",d);k.lyr=f;k.linfo=a;b.layers.push(k);f.name=k.name;var U;m(".js-add-layer-checkbox",b.browseDialog.browseItems.infoPanel).forEach(function(b){U=b.checked});if(b.browseDialog.addlayerCheckBox&&b.browseDialog.addlayerCheckBox.get("checked")||U)this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=b.widget.map.on("layer-add",e.hitch(this,function(c){this._addLayerHandle.remove();b.widget.emit("add-ready-to-use-layer",
{layer:c.layer,layerInfo:a,item:k})})),b.widget.map.addLayer(f);b.browseDialog.browseItems.clear()}if(C.isDefined(b)&&C.isDefined(b.item)&&C.isDefined(b.layersSelect)&&C.isDefined(b.layers)&&C.isDefined(b.browseDialog)){b.browseDialog.hide();var k={url:b.item.url&&-1!==window.location.protocol.indexOf("https:")?b.item.url.replace("http:","https:")+"/0":b.item.url+"/0",itemId:b.item.id,title:b.item.title,analysisReady:!0},a,n=h.some(b.layers,function(b,c){var n=b.analysisReady&&k.analysisReady&&b.itemId===
k.itemId;n&&(a=c);return n}),d=new z,f,x="sync";if(n){b.posIncrement&&(a+=b.posIncrement);var A;m(".js-add-layer-checkbox",b.browseDialog.browseItems.infoPanel).forEach(function(b){A=b.checked});if(b.browseDialog.addlayerCheckBox&&b.browseDialog.addlayerCheckBox.get("checked")||A)b.posIncrement||(b.posIncrement=0),f=b.layers[a-b.posIncrement],b.widget.map.getLayer(f.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=b.widget.map.on("layer-add",e.hitch(this,function(c){this._addLayerHandle.remove();
b.widget.emit("add-ready-to-use-layer",{layer:c.layer,layerInfo:f.linfo,item:f})})),b.widget.map.addLayer(f.lyr));b.layersSelect.set("value",a);b.browseDialog.browseItems.clear();d.resolve()}else b.item.selectedLayer?(k.url=b.item.selectedLayer.url,d.then(e.hitch(this,c)),setTimeout(d.resolve(b.item.selectedLayer),500)):(x=b.item.itemDataUrl?I({url:b.item.itemDataUrl,content:{f:"json"}}):"sync",E(x,e.hitch(this,function(b){b&&(b.layers&&b.layers[0].id)&&(k.url=k.url.replace("/0","/"+b.layers[0].id));
d=I({url:k.url,content:{f:"json"}});d.then(e.hitch(this,c))})));return d.promise}},addReadyToUseLayerOption:function(b,c){if(b&&(b.showReadyToUseLayers||b.showBrowseLayers))c||(c=[]),b.signInPromise.then(e.hitch(this,function(){h.forEach(c,function(c){(b.showReadyToUseLayers||b.showBrowseLayers)&&c.addOption({type:"separator",value:""});if(b.showReadyToUseLayers){var k=b.i18n.browseAnalysisTitle;this._isCustomAnalysisQuery(b)&&(k=this.i18n.browseAnalysisLayers);c.addOption({value:"browse",label:k})}b.showBrowseLayers&&
c.addOption({value:"browselayers",label:b.i18n.browseLayers})},this);b.showReadyToUseLayers&&!C.isDefined(b._browsedlg)&&(b._browsedlg=this.addBrowseAnalysisDialog({widget:b}),b.own(b._browsedlg.browseItems.on("select-change",e.hitch(b,b._handleBrowseItemsSelect)),b._browsedlg.on("hide",e.hitch(b,function(){h.forEach(c,function(b){"browse"===b.get("value")&&b.reset()})}))));b.showBrowseLayers&&!C.isDefined(b._browseLyrsdlg)&&(b._browseLyrsdlg=this.addBrowseAnalysisDialog({widget:b,browseType:1}),
b.own(k.subscribe("/esri/browseitems/close",e.hitch(this,function(c,k){"add-layer"===c&&(console.log(c,k),b._browseLyrsdlg.browseItems.plugIn._grid&&(k.selectedLayer=b._browseLyrsdlg.browseItems.plugIn._selectedLayer,b._handleBrowseItemsSelect({dialog:b._browseLyrsdlg,selection:k})),b._browseLyrsdlg.browseItems.closeInfoPanel())})),b._browseLyrsdlg.on("hide",e.hitch(b,function(){h.forEach(c,function(b){"browselayers"===b.get("value")&&b.reset()})}))))}))},_isCustomAnalysisQuery:function(b){var c=
!1;b.portalSelf&&b.portalSelf.analysisLayersGroupQuery&&'title:"Living Atlas Analysis Layers" AND owner:esri'!==b.portalSelf.analysisLayersGroupQuery?c=!0:b._portal&&(b._portal.analysisLayersGroupQuery&&'title:"Living Atlas Analysis Layers" AND owner:esri'!==b._portal.analysisLayersGroupQuery)&&(c=!0);return c},getMaxInputByMode:function(b){var c;if(b&&b.units&&b.type){if("StraightLine"===b.type)"Miles"===b.units?c=1E3:"Yards"===b.units?c=176E4:"Kilometers"===b.units?c=D.format(1609.34,{places:2}):
"Meters"===b.units?c=D.format(1609340,{places:2}):"Feet"===b.units&&(c=528E4);else if("DrivingDistance"===b.type||"TruckingDistance"===b.type||"WalkingDistance"===b.type)"Miles"===b.units?c=300:"Yards"===b.units?c=528E3:"Kilometers"===b.units?c=D.format(482.802,{places:2}):"Meters"===b.units?c=D.format(482802,{places:2}):"Feet"===b.units&&(c=1584E3);else if("DrivingTime"===b.type||"TruckingTime"===b.type||"WalkingTime"===b.type)"Minutes"===b.units?c=300:"Seconds"===b.units?c=18E3:"Hours"===b.units&&
(c=5);return c}},updateModeConstraints:function(b){var c;b&&(b.validateWidget&&b.units&&b.type)&&(c=b.validateWidget.get("constraints"),c.max=this.getMaxInputByMode(b),b.validateWidget.set(c))},getTravelModes:function(b){var c=new z,k,n,d,f;C.isDefined(this.travelModes)&&0<this.travelModes.length?c.resolve(this.travelModes):!b||!b.widget?c.reject(Error("Missing parameter: params.widget required parameter")):b.widget.signInPromise.then(e.hitch(this,function(x){(f=b.widget.get("helperServices"))&&f.routingUtilities?
(d=f.routingUtilities.url,k="sync"):k=b.widget._getSelf(b.widget.portalUrl);E(k,e.hitch(this,function(b){var k={};b&&(b.helperServices&&b.helperServices.routingUtilities)&&(d=b.helperServices.routingUtilities.url);C.isDefined(d)?(n=new P(d+"/GetTravelModes"),n.execute(k).then(e.hitch(this,function(b){this.travelModes=h.map(b[0].value&&b[0].value.features,function(b){return a.fromJson(b.attributes.TravelMode)});b[1]&&(b[1].paramName&&"defaultTravelMode"===b[1].paramName)&&(this.defaultTravelModeId=
b[1].value);c.resolve(this.travelModes)}),e.hitch(this,function(b){c.reject(b)}))):c.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(b){c.reject(b)})}));return c.promise},populateTravelModes:function(b){if(b&&b.selectWidget&&b.widget){var c=[],k=b.allowmode||"all";this.initI18n();b.addStraightLine&&c.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+
this.i18n.straightLineDistance+"\x3c/div\x3e"});this.getTravelModes({widget:b.widget}).then(e.hitch(this,function(a){h.forEach(a,function(a,n){var d=a.name,e=d.replace(/\s/g,b.separator||""),f="AUTOMOBILE"===a.type?"Driving":"TRUCK"===a.type?"Trucking":"WALK"===a.type?"Walking":"Other",x=f.toLowerCase(),A=a.units||d.split(/\s/)[1],g=C.isDefined(b.enableTravelModes)&&!b.enableTravelModes,A=a.impedanceAttributeName===a.timeAttributeName?"Time":a.impedanceAttributeName===a.distanceAttributeName?"Distance":
"Other",d={label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+f+A+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+d+"\x3c/div\x3e",value:e,travelMode:a,disabled:g,modei18nKey:x,units:A};if("all"===k||k===A.toLowerCase())"all"!==k&&(d.value=d.value.replace(A,"")),b.selectDefaultMode&&(this.defaultTravelModeId&&this.defaultTravelModeId===a.id)&&(d.selected=!0),c.push(d)},this);b.selectWidget.removeOption();b.selectWidget.addOption(c);
b.selectWidget.set("value",b.value);b.widget.emit("travelmodes-added",{travelOptions:c})}),e.hitch(this,function(k){c&&0<c.length&&(b.selectWidget.removeOption(),b.selectWidget.addOption(c),b.selectWidget.set("value",b.value),b.widget.emit("travelmodes-added",{travelOptions:c}))}))}},updateDisplay:function(b,c,k){(new m.NodeList(b)).style("display",c?k?k:"block":"none")}});return p})},"esri/dijit/analysis/HelpWindow":function(){define("require dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/_base/kernel dojo/aspect dojo/has dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/query dojo/window dojo/dom-geometry dijit/_Widget dijit/TooltipDialog dijit/popup ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f,v,z,D,F,E,c,n){return h([f],{declaredClass:"esri.dijit.analysis.HelpWindow",i18n:null,onlineHelpMap:null,showLearnMore:!1,"class":"esriAnalyisHelpWindow",postMixInProperties:function(){this.inherited(arguments);this.i18n={};l.mixin(this.i18n,n.common);l.mixin(this.i18n,n.analysisHelp)},postCreate:function(){this.inherited(arguments);var c=["ar","he"],a,n;this.onlineHelpMap={};for(a=0;a<c.length;a+=1)n=c[a],t.locale&&-1!==t.locale.indexOf(n)&&(-1!==t.locale.indexOf("-")?
-1!==t.locale.indexOf(n+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);c=p.toUrl("./help/helpmap.json");E({url:c}).then(l.hitch(this,function(c){this.onlineHelpMap=c.map}))},_getAbsoluteUrl:function(c){if(/^https?\:/i.test(c))return c;if(/^\/\//i.test(c))return window.location.protocol+c;if(/^\//i.test(c))return window.location.protocol+"//"+window.location.host+c},_computeSize:function(c){var a={w:400,h:200};g("esri-mobile")?a={w:"50%",h:"90%"}:-1!==c.indexOf("Category")?(a.w=400,a.h=320):
-1!==c.indexOf("Tool")?(a.w=400,a.h=320):-1!==c.indexOf("toolDescription")&&(a.w=400,a.h=520);return a},_setHelpTopicAttr:function(c){this.tooltipHelpDlg&&(z.close(this.tooltipHelpDlg),this.tooltipHelpDlg.destroy(),this.tooltipHelpDlg=null);var a,n,d,f,g="";this.showLearnMore=!1;n=this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("dev")?"dev":this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("qa")?"uat":"";g=this.isPortal?"-PortalOnly":"-OnlineOnly";a=l.clone(t.locale);"nb"===
a&&(a="no");d=p.toUrl("esri/dijit/analysis/help/"+this.helpFileName+".html");F.isDefined(this.onlineHelpMap[this.helpFileName])&&F.isDefined(this.onlineHelpMap[this.helpFileName][c])&&(this.showLearnMore=!0,f="http://doc"+n+".arcgis.com/en/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][c]);-1!==e.indexOf("ar cs da de es el et fi fr hr it ja ko lt lv ru nl no pl pt-br pt-pt ro sv sr th tr vi zh-cn zh-hk zh-tw".split(" "),a)&&(-1!==a.indexOf("-")&&(d=a.split("-"),a=d[0]+"-"+d[1].toUpperCase()),
d=p.toUrl("esri/dijit/analysis/help/"+a+"/"+this.helpFileName+".html"));-1!==e.indexOf("ar de es fr it ja ko ru nl pl pt-br pt-pt ro zh-cn zh-hk zh-tw".split(" "),a)&&this.showLearnMore&&(f="http://doc"+n+".arcgis.com/"+a+"/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][c]);this._size=n=this._computeSize(c);this.tooltipHelpDlg=new v({preload:!0,content:"\x3cdiv class\x3d'' style\x3d'position:relative'\x3cdiv class\x3d'sizer content'\x3e\x3cdiv class\x3d'contentPane'\x3e\x3cdiv class\x3d'esriFloatTrailing' style\x3d'padding:0;'\x3e\x3ca href\x3d'#' class\x3d'esriAnalysisCloseIcon' title\x3d'"+
this.i18n.close+"'\x3e\x3c/a\x3e\x3c/div\x3e\x3ciframe frameborder\x3d'0'  id\x3d'"+c+"' src\x3d'"+d+"#"+c+g+"' width\x3d'"+n.w+"' height\x3d'"+n.h+"' marginheight\x3d'0' marginwidth\x3d'0'\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'actionsPane'\x3e\x3cdiv class\x3d'actionList"+(this.showLearnMore?"'\x3e":" hidden'\x3e")+"\x3ca class\x3d'action zoomTo' href\x3d'"+(this.showLearnMore?f:"#")+"' target\x3d'_help'\x3e"+this.i18n.learnMore+"\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
"class":"esriHelpPopup esriHelpPopupWrapper esriAnalyisHelpWindow"});this.tooltipHelpDlg.startup()},show:function(c,a){this.helpFileName=a.helpFileName;this._analysisGpServer=a.analysisGpServer;this.isPortal=a.isPortal;this.set("helpTopic",a.helpId);var n=y.after(z,"open",l.hitch(this,function(){m(".esriAnalysisCloseIcon",this.tooltipHelpDlg.domNode).on("click",l.hitch(this,this.close));n.remove()})),d=c.pageX,e=w.getBox(),f,g,v;v=!1;a.helpParentNode&&(f=a.helpParentNode);f&&(g=B.position(f));g&&
e.w-c.pageX<g.w?(v=!0,d=g.x-this._size.w-10,this._isRightToLeft&&(d-=10)):this._isRightToLeft&&d-40<this._size.w&&(d=g.w+this._size.w+80);z.open({popup:this.tooltipHelpDlg,x:!0===this._isRightToLeft||v?d-40:d+40,y:c.screenY-c.pageY+10,onCancel:l.hitch(this,function(){this.close()}),onExecute:function(){this.close()}});this.tooltipHelpDlg.domNode.parentNode&&q.set(this.tooltipHelpDlg.domNode.parentNode,"overflowY","hidden")},close:function(c,a){z.close(this.tooltipHelpDlg)}})})},"esri/dijit/BrowseItems":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/event dojo/dom-class dojo/dom-style dojo/dom-attr dojo/string dojo/on dojo/aspect dojo/has dojo/dom dojo/dom-construct dojo/mouse dojo/topic dojo/query dojo/parser dijit/registry dijit/TooltipDialog dijit/popup dojo/promise/all dojo/Deferred dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/util/mouse dgrid/util/touch put-selector/put dojo/store/Observable dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../arcgis/Portal ../Evented ../PluginTarget dojo/i18n!../nls/jsapi ./_AppTemplateFiltersMixin ./_RefreshMixin ../kernel ../lang ../config ../geometry/webMercatorUtils ../tasks/GeometryService ../SpatialReference dojo/NodeList-dom".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f,v,z,D,F,E,c,n,k,A,x,M,H,C,I,N,J,G,K,O,P,L,Q,T,R,b,U,Z,S,W,V,X,$){var Y=p(null,{idProperty:"id",constructor:function(b){p.safeMixin(this,b)},get:function(b,c){return L.PortalUtil.request(this.portalUrl+"content/items/"+b,c).then(function(b){return new L.PortalItem(e.mixin(b,{portal:this.portal}))})},getIdentity:function(b){return b[this.idProperty]},query:function(b,c){var a=e.isObject(b)?b:{q:b},k=null;if(c){a=e.mixin(a,{num:c.count,start:(c.start||0)+1});
if(c.sort&&c.sort.length)var n=c.sort[0],a=e.mixin(a,{sortField:encodeURIComponent("created"===n.attribute?"uploaded":n.attribute),sortOrder:n.descending?"desc":"asc"});c.useExtent&&c.extent&&(a.bbox=c.extent);c.queryType&&"group"===c.queryType&&(k="group")}a="group"===k?this.portal.queryGroups(a,!0).then(function(b){b.results.total=b.total;return b.results}):this.portal.queryItems(a,!0).then(function(b){b.results.total=b.total;return b.results});return L.PortalResult(a)}});return p([K,O,P,T],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"top-bar"\x3e\x3cdiv  class\x3d"esriFloatLeading instructions"\x3e\x3cspan class\x3d"messageLeft hide" data-dojo-attach-point\x3d"messageNodeLeft"\x3e\x3c/span\x3e\x3cspan class\x3d"messageRight hide" data-dojo-attach-point\x3d"messageNodeRight"\x3e\x3c/span\x3e\x3ca tabIndex\x3d"-1" data-dojo-attach-point\x3d"helpLink" class\x3d"esriHelpIcon hide" title\x3d"${i18n.browseItems.learnMoreConfigurableApps}" href\x3d"#" target\x3d"_blank"\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"${id}_search"class\x3d"searchBar esriFloatTrailing"\x3e\x3cinput tabIndex\x3d"1" placeholder\x3d"${i18n.browseItems.searchTitle}" class\x3d"esriSearchBox dijitTextBox" type\x3d"search"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"gallery"\x3e\x3cdiv class\x3d"gallery-left  quiet-scroll"\x3e\x3cul class\x3d"filters"\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d"templates gallery-right"\x3e\x3cp id\x3d"${id}_filterTitle" class\x3d"filter-title hide" data-dojo-attach-point\x3d"filterDescription"\x3e\x3c/p\x3e\x3cdiv id\x3d"${id}_grid"class\x3d"dgrid-autoheight quiet-scroll"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv  class\x3d"loaderWrap" data-dojo-attach-point\x3d"loaderWrap"\x3e\x3c/div\x3e\x3cdiv  class\x3d"js-info-panel templateInfoPanel" data-dojo-attach-point\x3d"infoPanel"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
galleryTemplate:"\x3cdiv style\x3d'opacity:1;' class\x3d'grid-item gallery-view'\x3e${item:_formatThumbnail}${item:_formatItemTitle}\x3cp class\x3d\"template-overlay\" style\x3d\"display:none;\"\x3e${i18n.browseItems.selectDetails}\x3c/p\x3e\x3c/div\x3e",infoPanelTemplate:'\x3cdiv\x3e\x3cdiv class\x3d"template-info-showing"\x3e\x3cdiv class\x3d"thumbnail"\x3e\x3cimg src\x3d"${item:_formatInfoPanelImage}"\x3e\x3c/div\x3e\x3ch4\x3e${item.title}\x3c/h4\x3e\x3cdiv class\x3d"template-info"\x3e\x3cp class\x3d"quiet-scroll"\x3e${item.snippet}\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-actions"\x3e\x3cbutton class\x3d"btn blue btn-main" id\x3d"on-next"\x3e${i18n.browseItems.configure}\x3c/button\x3e\x3cbutton class\x3d"btn btn-cancel" id\x3d"close-panel"\x3e${i18n.common.close}\x3c/button\x3e\x3c/div\x3e\x3cdiv\x3e',
_popupTemplate:'\x3cdiv class\x3d"esriBrowsePopup quiet-scroll"\x3e\x3cp\x3e{summary}\x3c/p\x3e\x3c/div\x3e',showInfoPanel:!0,isAutoClose:!0,showTooltip:!1,baseClass:"esriBrowseItemsCtr",i18n:R,postMixInProperties:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.self?(this._portal=new L.Portal({url:this.portalUrl,self:this.self}),this._init(),this._portal.on("load",e.hitch(this,this._fetchData))):(this._portal=new L.Portal(this.portalUrl),this._portal.signIn().then(e.hitch(this,
function(){this._init();this._fetchData()})))},_init:function(){this._canSearchPublic=this.self?this.self.canSearchPublic:this._portal.canSearchPublic;this.query=e.mixin(this.query||{},{get:function(b){return this[b]&&this[b].length?"("+this[b].join(" OR ")+") ":""},toString:function(){return{q:this.get("groups")+this.get("tags")+this.get("persistentTypekeywords")+this.get("typekeywords")+this.get("types")+this.get("owners")+this.get("orgids")+this.get("custom")+(this.query||"")+(this.search||"")+
' -type:"Attachment"'}}});this.self?this.self.canSearchPublic=!0:this._portal.canSearchPublic=!0;this.galleryTemplate=this.plugIn&&this.plugIn.galleryTemplate||this.galleryTemplate;this.infoPanelTemplate=this.plugIn&&this.plugIn.infoPanelTemplate||this.infoPanelTemplate;if(this.helpLinkUrl=this.plugIn&&this.plugIn.helpLinkUrl||"")y.set(this.helpLink,"href",this.helpLinkUrl),a.remove(this.helpLink,"hide");f(".templates",this.domNode).addClass("fade");f(".dgrid-footer",this.domNode).addClass("hide");
t.set(this.infoPanel,"display",this.showInfoPanel?"block":"none")},destroy:function(){this.inherited(arguments);this._grid&&this._grid.destroy();this._img_connect&&(this._img_connect.remove(),this._img_connect_error.remove());this._queryTimer&&clearTimeout(this._queryTimer);this._grid=this._portal=null},closeInfoPanel:function(){q.byId("close-panel").click()},_setItemQueryAttr:function(b){this.itemQuery=b},_setPluginAttr:function(b){this.addPlugin(b)},_setMessageAttr:function(b){this.set("messageRight",
b)},_setMessageRightAttr:function(b){"string"===typeof b?y.set(this.messageNodeRight,"innerHTML",b):b instanceof HTMLElement&&m.place(b,this.messageNodeRight);a.remove(this.messageNodeRight,"hide")},_setMessageLeftAttr:function(b){"string"===typeof b?y.set(this.messageNodeLeft,"innerHTML",b):b instanceof HTMLElement&&m.place(b,this.messageNodeLeft);a.remove(this.messageNodeLeft,"hide")},_setDisabledAttr:function(b){var c=z.findWidgets(this.domNode).concat(z.findWidgets(this._content));h.forEach(c,
function(c){c.set("disabled",b)});a[b?"add":"remove"](this._interval.domNode,"dijitTextBoxDisabled")},_setSortAttr:function(b){this.sortAttribute=b},_setSortDescendingAttr:function(b){this.sortDescending=b},_getSelectionAttr:function(){var b=this._grid.selection,c;for(c in b)if(b.hasOwnProperty(c))break;return c&&this._grid.row(c).data},_setGalleryTemplateAttr:function(b){S.isDefined(b)&&(this.galleryTemplate=b)},_setFormatThumbnailAttr:function(b){S.isDefined(b)&&"function"===typeof b&&(this._formatThumbnail=
b)},_setFormatItemTitleAttr:function(b){S.isDefined(b)&&"function"===typeof b&&(this._formatItemTitle=b)},_setRowsPerPageAttr:function(b){this._set("rowsPerPage",b)},_setPagingLinksAttr:function(b){this._set("pagingLinks",b)},_getQueryAttr:function(){return this.query},_setQueryAttr:function(b){this._set("query",b);this._grid&&this._grid.set("query",b.toString())},_setExtentAttr:function(b){b&&this._set("extent",this._extentToString(b))},_setUseExtentAttr:function(b){this._set("useExtent",b)},_setQueryTypeAttr:function(b){this._set("queryType",
b)},_setFetchTimeoutAttr:function(b){this._set("fetchTimeout",b)},_setShowInfoPanelAttr:function(b){this._set("showInfoPanel",b)},_setSelectionModeAttr:function(b){-1===h.indexOf(["extended","toggle","multiple","single","none"],b)&&(console.log("Incorrect Value provided for selectionMode. It is one of the following: extended, toggle, multiple, single, none"),b="single");this._set("selectionMode",b)},_validate:function(){return!!this.get("selection")},reset:function(){f(".esriSearchBox",q.byId(this.id+
"_search")).forEach(function(b){y.set(b,"value","")});this.query.search="";if(this.plugIn.filters){var b=[],c=[],k=[],n=[];f("li.active",this.domNode).forEach(function(d){a.remove(d,"active");var e=this.plugIn.filters[d.childNodes[0].id];d=h.map(e.tags,function(b){return'tags:"'+b+'"'},this);var f=h.map(e.owners,function(b){return'owner:"'+b+'"'},this),x=h.map(e.orgids,function(b){return'orgid:"'+b+'"'},this),e=h.map(e.typekeywords,function(b){return'typekeywords:"'+b+'"'},this);b.push(d);k.push(f);
n.push(x);c.push(e)},this);this.query.tags=h.filter(this.query.tags,function(c){return-1!==h.indexOf(b,c)});this.query.owners=h.filter(this.query.owners,function(b){return-1!==h.indexOf(k,b)});this.query.orgids=h.filter(this.query.orgids,function(b){return-1!==h.indexOf(n,b)});this.query.typekeywords=h.filter(this.query.typekeywords,function(b){return-1!==h.indexOf(c,b)});q.byId("all").click()}},_showPopup:function(b){if(!this._isInsideTooltipDialog){this._closePopup();var c=this._grid.row(b);b=f("img",
c.element)[0];if((c={summary:c.data.snippet})&&c.summary)this._tooltip=new D({content:e.replace(this._popupTemplate,c),onMouseEnter:e.hitch(this,function(){this._isInsideTooltipDialog=!0}),onMouseLeave:e.hitch(this,function(){this._isInsideTooltipDialog=!1;this._closePopup()})}),F.open({className:"esriBrowsePopupCtr",popup:this._tooltip,around:b,orient:["after-centered","before-centered"]}),this._onCloseConnect=f(".dijitDialogCloseIcon",this._tooltip.domNode).on("click",e.hitch(this,function(b){b.preventDefault();
this._closePopup()}))}},_closePopup:function(){this._tooltip&&(this._onCloseConnect&&this._onCloseConnect.remove(),F.close(this._tooltip),this._tooltip.destroyRecursive(),this._tooltip=this._onCloseConnect=void 0)},_clearQueryTimeout:function(){clearTimeout(this._queryTimer);this._queryTimer=null},_clearClosePanelTimeout:function(){clearTimeout(this._panelClosing);this._panelClosing=null;h.forEach(this._panelClickHandles,"item.remove();");m.empty(this.infoPanel)},_createGrid:function(){var b=p([n,
k,M,U,A]),c=new G(new Y({portal:this._portal})),x=this.query,l=e.hitch(this,function(b){b.snippet=b.snippet||"";var c=J("div");b=g.substitute(this.galleryTemplate,{item:b,i18n:this.i18n},null,this);m.place(b,c);return c}),v={};this.get("useExtent")&&(v.extent=this.get("extent"),v.useExtent=this.get("useExtent"));this.get("queryType")&&(v.queryType=this.get("queryType"));this._grid=new b({store:c,query:x.toString(),selectionMode:this.selectionMode||"single",pagingLinks:this.get("pagingLinks")||2,rowsPerPage:this.plugIn&&
this.plugIn.rowsPerPage||this.get("itemsPerPage")||6,loadingMessage:"Loading items...",showLoadingMessage:!1,renderRow:l,noDataMessage:this.i18n.gallery.noItemsToDisplay,deselectOnRefresh:!("multiple"===this.selectionMode||"extended"===this.selectionMode||"toggle"===this.selectionMode),sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}],queryOptions:v},this.id+"_grid");this._grid.startup();this.own(r(this.domNode,"click",e.hitch(this,function(b){q.byId("close-panel")&&
this.isAutoClose&&q.byId("close-panel").click()})),this._grid.on(I.enterRow,e.hitch(this,function(b){!1===a.contains(this.domNode,"showing")&&this.showInfoPanel&&this._showOverlay(!0,b);this.showTooltip&&!this.showInfoPanel&&this._showPopup(b)})),this._grid.on(I.leaveRow,e.hitch(this,function(b){this._showOverlay(!1,b);this.showTooltip&&!this.showInfoPanel&&this._closePopup(b)})),this._grid.on(".dgrid-row:click",e.hitch(this,function(b){var c;!1===a.contains(this.domNode,"showing")&&this.showInfoPanel&&
(b.preventDefault(),d.stop(b),this._clearClosePanelTimeout(),c=this.get("selection"),this._showOverlay(!1,b),this.showInfoPanel&&this.infoPanelTemplate?m.place(g.substitute(this.infoPanelTemplate,{item:c,i18n:this.i18n},function(b){return S.isDefined(b)?b:""},this),this.infoPanel):t.set(this.infoPanel,"display","none"),a.add(this.domNode,"showing"),this._panelClickHandles=[f(".template-info-showing .thumbnail img",this.domNode).on("error",e.hitch(this,function(b){y.set(b.target,"src",c.thumbnailUrl)})),
f(".panel-actions .btn").on("click",e.hitch(this,function(b){b.preventDefault();d.stop(b);"close-panel"===b.target.id?(a.remove(this.domNode,"showing"),this._panelClosing=setTimeout(e.hitch(this,function(){h.forEach(void 0,"item.remove();");m.empty(this.infoPanel)},250))):B.publish("/esri/browseitems/close",b.target.id,this.get("selection"))})),f(".js-info-panel",this.domNode).on("click",e.hitch(this,function(b){this.isAutoClose&&(b.preventDefault(),d.stop(b))})),r(f(".dgrid-footer,.dgrid-header",
this._grid.domNode),w.leave,e.hitch(this,function(b){this.showTooltip&&!this.showInfoPanel&&this._closePopup()}))])})),this._grid.on("dgrid-refresh-complete",e.hitch(this,function(b){f(".templates",this.domNode).removeClass("fade");f(".loaderWrap",this.domNode).addClass("hide");f(".dgrid-footer",this.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide");this.showTooltip&&!this.showInfoPanel&&this._closePopup()})),this._grid.on("refresh",e.hitch(this,function(){this.showTooltip&&
!this.showInfoPanel&&this._closePopup();this._img_connect&&(this._img_connect.remove(),this._img_connect_error.remove(),this._img_connect_error=this._img_connect=null);this._img_connect=f(".grid-item-thumb",this._grid.domNode).on("load",e.hitch(this,function(b){(b=this._grid.row(b))&&b.element&&f(".grid-item",b.element).addClass("fadeIn").style("opacity","1")}));this._img_connect_error=f(".grid-item-thumb",this._grid.domNode).on("error",e.hitch(this,function(b){y.set(b.target,"src",this._portal.staticImagesUrl+
"/desktopapp.png")}))})),r(q.byId(this.id+"_search"),"keyup",e.hitch(this,function(b){b.preventDefault();this._clearQueryTimeout();this._queryTimer=setTimeout(e.hitch(this,function(){this.query.search=y.get(b.target,"value");this._fetchItems(this.query).then(e.hitch(this,function(){this._clearQueryTimeout()}))}),this.searchKeypressDelay||450)})),r(q.byId(this.id+"_search"),"search",e.hitch(this,function(b){this._queryTimer||(b.preventDefault(),this.query.search=y.get(b.target,"value"),this._fetchItems(this.query))})),
this.watch("extent",e.hitch(this,function(b,c,a){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=this.get("useExtent");this._grid.query.bbox=this._grid.queryOptions.useExtent?this._grid.queryOptions.extent:"";this._grid.refresh()})),this.watch("useExtent",e.hitch(this,function(b,c,a){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=a;this._grid.query.bbox=this._grid.queryOptions.useExtent?this._grid.queryOptions.extent:"";this._grid.refresh()})));
this.showInfoPanel||("single"===this._grid.selectionMode?this.own(this._grid.on("dgrid-select,dgrid-deselect",e.hitch(this,function(b){b={selection:this.get("selection")};this.emit("select-change",b)}))):-1!==h.indexOf(["toggle","multiple","extended"],this._grid.selectionMode)&&this.own(this._grid.on("dgrid-select,dgrid-deselect",e.hitch(this,function(b){b=b.grid.selection;var c,a=[];for(c in b)b[c]&&a.push(this._grid.row(c).data);this.emit("select-change",{selection:a})}))));this.emit("grid-ready",
{grid:this._grid,ready:!0})},_createFilters:function(){if(this.plugIn&&this.plugIn.filters){var b=this.plugIn.filters,c=this.plugIn.filterStrings,k,n=f(".filters",this.domNode)[0];for(k in b)m.create("li",{"class":"all"===k?"active":"",innerHTML:"\x3ca id\x3d'"+k+"'  href\x3d'#'\x3e"+c[k].title+"\x3c/a\x3e"},n);this.own(r(n,"li a:click",e.hitch(this,function(k){k.preventDefault();var d=k.target;f(".active",n).removeClass("active");a.add(d.parentNode,"active");f(".templates",this.domNode).addClass("fade");
setTimeout(e.hitch(this,function(){a["all"===d.id?"add":"remove"](this.filterDescription,"hide");y.set(this.filterDescription,"innerHTML",c[d.id].description||"")}),225);k=e.mixin({},b[d.id]||{});this.query.tags=h.map(k.tags||[],function(b){return'tags:"'+b+'"'});this.query.owners=h.map(k.owners,function(b){return'owner:"'+b+'"'});this.query.orgids=h.map(k.orgids,function(b){return'orgid:"'+b+'"'});this.query.typekeywords=[].concat(h.map(k.typekeywords||[],function(b){return'typekeywords:"'+b+'"'}));
this._fetchItems(this.query)})));a.add(this.domNode,"filters")}else a.add(this.domNode,"nofilters"+(this.plugIn&&this.plugIn.extraClasses?" "+this.plugIn.extraClasses.join(" "):""))},_showOverlay:function(b,c){var k=this._grid.row(c);k&&f(".template-overlay",k.element).style("display",b?"":"none")},_fetchData:function(){this._user=this._portal.getPortalUser();return this.plugIn&&this.plugIn.fetchData?this.plugIn.fetchData():this._fetchItems(this.itemQuery)},_fetchItems:function(b,k){var a={sort:[{attribute:this.sortAttribute||
"title",descending:this.sortDescending||!1}]},n=new c;this.get("useExtent")&&(a.extent=this.get("extent"),a.useExtent=this.get("useExtent"));this.get("queryType")&&(a.queryType=this.get("queryType"));f(".templates",this.domNode).addClass("fade");f(".dgrid-footer",this.domNode).addClass("hide");f(".loaderWrap",this.domNode).removeClass("hide");setTimeout(e.hitch(this,function(){this.query=e.mixin(this.query,b);this._grid?this._grid.set("query",this.query.toString(),a):(this._createFilters(),this._createGrid());
n.resolve(this._grid)}),60);return n},_formatThumbnail:function(b){var c=b.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png";b.thumbnailUrl=c;return"\x3cimg class\x3d'grid-item-thumb' width\x3d'187px' height\x3d'125px' alt\x3d'' src\x3d'"+c+"'\x3e"},_formatInfoPanelImage:function(b){var c=b.screenshots&&b.screenshots.length?b.screenshots[0]:null;return c?b.itemUrl+"/info/"+c:b.thumbnailUrl},_formatItemTitle:function(b){return"\x3ch5\x3e"+(b.title||b.name||"\x3cNo Title\x3e")+"\x3c/h5\x3e"},
clear:function(){this._grid.clearSelection()},doProject:function(b,a){var k=[102113,102100,3857],n=new c,d,e,f;d=function(b,c){b&&0<b.length&&b[0]&&"extent"==b[0].type&&!isNaN(b[0].xmin)&&!isNaN(b[0].ymin)&&!isNaN(b[0].xmax)&&!isNaN(b[0].ymax)?n.resolve(b,c):b&&(0<b.length&&b[0]&&"point"==b[0].type&&!isNaN(b[0].x)&&!isNaN(b[0].y))&&n.resolve(b,c)};if(null!=b.spatialReference.wkid&&4326==b.spatialReference.wkid&&null!=a.wkid&&this.contains(k,a.wkid)){b.ymin=Math.max(b.ymin,-89.99);b.ymax=Math.min(b.ymax,
89.99);k=V.geographicToWebMercator(b);if((d=k.spatialReference._getInfo())&&k.xmin>k.xmax)e=d.valid[1]-k.xmin,f=k.xmax-d.valid[0],e>f?k.xmax=d.valid[1]+f:k.xmin=d.valid[0]-e;k.spatialReference.wkid=a.wkid;n.resolve([k])}else if(null!=b.spatialReference.wkid&&this.contains(k,b.spatialReference.wkid)&&null!=a.wkid&&4326==a.wkid){k=V.webMercatorToGeographic(b);if((d=k.spatialReference._getInfo())&&k.xmin>k.xmax)e=d.valid[1]-k.xmin,f=k.xmax-d.valid[0],e>f?k.xmax=d.valid[1]+f:k.xmin=d.valid[0]-e;n.resolve([k])}else this.geometryService||
(this.geometryService=new X(W.defaults.geometryService)),this.geometryService.project([b],a,d);return n},contains:function(b,c){for(var k=b.length;k--;)if(b[k]===c)return!0;return!1},_extentToGCS:function(b){b=b.shiftCentralMeridian(!0);return V.webMercatorToGeographic(b)},_extentToString:function(b){var c="";null!=b&&(b=this._extentToGCS(b),c=this._roundValue(b.xmin,1E4)+","+this._roundValue(b.ymin,1E4)+","+this._roundValue(b.xmax,1E4)+","+this._roundValue(b.ymax,1E4));return c},_roundValue:function(b,
c){return Math.round(b*c)/c}})})},"dgrid/extensions/Pagination":function(){define("../_StoreMixin dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/on dojo/query dojo/string dojo/has put-selector/put ../util/misc dojo/i18n!./nls/pagination dojo/_base/sniff xstyle/css!../css/extensions/Pagination.css".split(" "),function(p,e,h,l,d,a,t,y,g,r,s,u){function q(a){a.noDataNode?(r(a.noDataNode,"!"),delete a.noDataNode):a.cleanup();a.contentNode.innerHTML=""}function m(a){if(a.loadingNode)r(a.loadingNode,
"!"),delete a.loadingNode;else if(a._oldPageNodes){for(var d in a._oldPageNodes)a.removeRow(a._oldPageNodes[d]);delete a._oldPageNodes;a._oldPageObserver&&(a._oldPageObserver.cancel(),a._numObservers--,delete a._oldPageObserver)}delete a._isLoading}return e("dgrid.extensions.Pagination",p,{rowsPerPage:10,pagingTextBox:!1,previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,i18nPagination:u,showFooter:!0,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);
var d=this,e=this.paginationNode=r(this.footerNode,"div.dgrid-pagination"),f=this.paginationStatusNode=r(e,"div.dgrid-status"),g=this.i18nPagination;f.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();f.innerHTML=y.substitute(g.status,{start:1,end:1,total:0});e=this.paginationNavigationNode=r(e,"div.dgrid-navigation");this.firstLastArrows&&(f=this.paginationFirstNode=r(e,"span.dgrid-first.dgrid-page-link","\u00ab"),f.setAttribute("aria-label",g.gotoFirst),f.tabIndex=0);
this.previousNextArrows&&(f=this.paginationPreviousNode=r(e,"span.dgrid-previous.dgrid-page-link","\u2039"),f.setAttribute("aria-label",g.gotoPrev),f.tabIndex=0);this.paginationLinksNode=r(e,"span.dgrid-pagination-links");this.previousNextArrows&&(f=this.paginationNextNode=r(e,"span.dgrid-next.dgrid-page-link","\u203a"),f.setAttribute("aria-label",g.gotoNext),f.tabIndex=0);this.firstLastArrows&&(f=this.paginationLastNode=r(e,"span.dgrid-last.dgrid-page-link","\u00bb"),f.setAttribute("aria-label",
g.gotoLast),f.tabIndex=0);this._listeners.push(a(e,".dgrid-page-link:click,.dgrid-page-link:keydown",function(a){if(!("keydown"===a.type&&13!==a.keyCode)){a=this.className;var e,f;d._isLoading||-1<a.indexOf("dgrid-page-disabled")||(e=d._currentPage,f=Math.ceil(d._total/d.rowsPerPage),this===d.paginationPreviousNode?d.gotoPage(e-1):this===d.paginationNextNode?d.gotoPage(e+1):this===d.paginationFirstNode?d.gotoPage(1):this===d.paginationLastNode?d.gotoPage(f):"dgrid-page-link"===a&&d.gotoPage(+this.innerHTML))}}))},
destroy:function(){this.inherited(arguments);this._pagingTextBoxHandle&&this._pagingTextBoxHandle.remove()},_updatePaginationSizeSelect:function(){var d=this.pageSizeOptions,e=this.paginationSizeSelect,f;if(d&&d.length){e||(e=this.paginationSizeSelect=r(this.paginationNode,"select.dgrid-page-size[aria-label\x3d"+this.i18nPagination.rowsPerPage+"]"),f=this._paginationSizeChangeHandle=a(e,"change",l.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)})),this._listeners.push(f));
for(f=e.options.length=0;f<d.length;f++)r(e,"option",d[f],{value:d[f],selected:this.rowsPerPage===d[f]});this._updateRowsPerPageOption()}else if((!d||!d.length)&&e)r(e,"!"),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove()},_setPageSizeOptions:function(a){this.pageSizeOptions=a&&a.sort(function(a,d){return a-d});this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var a=this.rowsPerPage,d=this.pageSizeOptions,e=this.paginationSizeSelect;e&&(0>h.indexOf(d,
a)?this._setPageSizeOptions(d.concat([a])):e.value=""+a)},_setRowsPerPage:function(a){this.rowsPerPage=a;this._updateRowsPerPageOption();this.gotoPage(1)},_updateNavigation:function(){function d(n,e){var m,q;f.pagingTextBox&&n==h&&1<c?(m=r(l,"input.dgrid-page-input[type\x3dtext][value\x3d$]",h),m.setAttribute("aria-label",g.jumpPage),f._pagingTextBoxHandle=a(m,"change",function(){var a=+this.value;!isNaN(a)&&(0<a&&a<=c)&&f.gotoPage(+this.value)}),k&&"INPUT"===k.tagName&&m.focus()):(q=n===h,m=r(l,
"span"+(q?".dgrid-page-disabled":"")+".dgrid-page-link",n+(e?" ":"")),m.setAttribute("aria-label",g.gotoPage),m.tabIndex=q?-1:0,A===n&&(q?n<c?A++:x.focus():m.focus()),q||(x=m))}function e(c,a){r(c,(a?".":"!")+"dgrid-page-disabled");c.tabIndex=a?-1:0}var f=this,g=this.i18nPagination,l=this.paginationLinksNode,h=this._currentPage,m=this.pagingLinks,q=this.paginationNavigationNode,c=Math.ceil(this._total/this.rowsPerPage),n=this._pagingTextBoxHandle,k=document.activeElement,A,x;!k||!s.contains(this.paginationNavigationNode,
k)?k=null:"dgrid-page-link"===k.className&&(A=+k.innerHTML);n&&n.remove();l.innerHTML="";t(".dgrid-first, .dgrid-previous",q).forEach(function(c){e(c,1===h)});t(".dgrid-last, .dgrid-next",q).forEach(function(a){e(a,h>=c)});if(m&&0<c){d(1,!0);q=h-m;for(2<q?r(l,"span.dgrid-page-skip","..."):q=2;q<Math.min(h+m+1,c);q++)d(q,!0);h+m+1<c&&r(l,"span.dgrid-page-skip","...");1<c&&d(c)}else f.pagingTextBox&&d(h);k&&-1===k.tabIndex&&(m=t("[tabindex\x3d'0']",this.paginationNavigationNode),k===this.paginationPreviousNode||
k===this.paginationFirstNode?k=m[0]:m.length&&(k=m[m.length-1]),k&&k.focus())},refresh:function(){var d=this;this.inherited(arguments);if(this.store)return this.gotoPage(1).then(function(e){setTimeout(function(){a.emit(d.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:d,results:e})},0);return e});console.warn("Pagination requires a store to operate.")},_onNotification:function(a){a.length!==this._rowsOnPage&&this.gotoPage(this._currentPage)},renderArray:function(a,e){var f=this,g=
this.inherited(arguments);this._lastCollection=null;e||(this._topLevelRequest&&this._topLevelRequest!==a&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"===typeof a.cancel&&(this._topLevelRequest=a),d.when(a,function(){f._topLevelRequest&&delete f._topLevelRequest}));return g},insertRow:function(){var a=this._oldPageNodes,d=this.inherited(arguments);a&&d===a[d.id]&&delete a[d.id];return d},gotoPage:function(a){var e=this,f=new d;this._trackError(function(){var h=e.rowsPerPage,
z=(a-1)*h,s=l.mixin(e.get("queryOptions"),{start:z,count:h}),t,p=e.contentNode,c,n,k;if(e.showLoadingMessage)q(e),c=e.loadingNode=r(p,"div.dgrid-loading"),c.innerHTML=e.loadingMessage;else{e._oldPageNodes=c={};p=p.children;n=0;for(k=p.length;n<k;n++)c[p[n].id]=p[n];e._oldPageObserver=e.observers.pop()}e._isLoading=!0;t=e.store.query(e.query,s);d.when(e.renderArray(t,null,s),function(c){m(e);e.scrollTo({y:0});d.when(t.total,function(k){k||(e.noDataNode&&(r(e.noDataNode,"!"),delete e.noDataNode),e.noDataNode=
r(e.contentNode,"div.dgrid-no-data"),e.noDataNode.innerHTML=e.noDataMessage);e.paginationStatusNode.innerHTML=y.substitute(e.i18nPagination.status,{start:Math.min(z+1,k),end:Math.min(k,z+h),total:k});e._total=k;e._currentPage=a;e._rowsOnPage=c.length;e._updateNavigation()});(7>g("ie")||g("ie")&&g("quirks"))&&e.resize();f.resolve(t)},function(c){m(e);f.reject(c)});return f.promise})||f.reject();return f.promise}})})},"dgrid/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry",
"dijit/registry"],function(p,e,h){return p("dgrid.extensions.DijitRegistry",null,{minSize:0,maxSize:Infinity,layoutPriority:0,showTitle:!0,buildRendering:function(){h.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);var e=h.getEnclosingWidget(this.domNode.parentNode);e&&e.isLayoutContainer&&this._resizeHandle.remove()}},destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);
h.remove(this.id)},getChildren:function(){return[]},isLeftToRight:function(){return!this.isRTL},resize:function(l){l&&e.setMarginBox(this.domNode,l);this.inherited(arguments)},_set:function(e,d){this[e]=d},watch:function(){},getParent:function(){return h.getEnclosingWidget(this.domNode.parentNode)}})})},"dgrid/selector":function(){define("dojo/_base/kernel dojo/_base/array dojo/_base/lang dojo/on dojo/aspect dojo/_base/sniff put-selector/put".split(" "),function(p,e,h,l,d,a,t){h.getObject("dgrid.selector",
!0);return dgrid.selector=function(h,g){function l(a){return!w.allowSelect(w.row(a))}function s(a){return function(d){var e=d.rows,f=e.length;d="false";var g;for(g=0;g<f;g++){var c=w.cell(e[g],h.id).element;if(c&&(c=(c.contents||c).input)&&!c.disabled)c.checked=a,c.setAttribute("aria-checked",a)}if("checkbox"==B.type){e=w.selection;f=!1;for(g in e)if(e[g]!=w.allSelected){f=!0;break}B.indeterminate=f;B.checked=w.allSelected;f?d="mixed":w.allSelected&&(d="true");B.setAttribute("aria-checked",d)}}}function u(d){if("click"==
d.type||32==d.keyCode||!a("opera")&&13==d.keyCode||0===d.keyCode){var e=w.row(d);w._selectionTriggerEvent=d;if(e){if(w.allowSelect(e)){var f=w._lastSelected&&w.row(w._lastSelected);if("radio"==g){if(!f||f.id!=e.id)w.clearSelection(),w.select(e,null,!0),w._lastSelected=e.element}else e&&(d.shiftKey?s(!0)({rows:[e]}):f=null,f=d.shiftKey?f:null,w.select(f||e,e,f?void 0:null),w._lastSelected=e.element)}}else t(this,(w.allSelected?"!":".")+"dgrid-select-all"),w[w.allSelected?"clearSelection":"selectAll"]();
w._selectionTriggerEvent=null}}function q(){w._hasSelectorInputListener=!0;m.push(w.on(".dgrid-selector:click,.dgrid-selector:keydown",u));var a=w._handleSelect;w._handleSelect=function(d){this.cell(d).column!=h&&a.apply(this,arguments)};if("function"==typeof h.disabled){var d=w.allowSelect,e=h.disabled;w.allowSelect=function(a){var f=d.call(this,a);return e===l?f:f&&!e.call(h,a.data)}}h.disabled=l;m.push(w.on("dgrid-select",s(!0)));m.push(w.on("dgrid-deselect",s(!1)))}var m=[],w,B;h||(h={});h.type&&
(h.selectorType=h.type,p.deprecated("columndef.type","use columndef.selectorType instead","dgrid 0.4"));h.selectorType=g=g||h.selectorType||"checkbox";h.sortable=!1;var f="function"==typeof g?g:function(a,d,e){var f=d.parentNode,l;w._hasSelectorInputListener||q();l=h.disabled;t(f&&f.contents?f:d,".dgrid-selector");d=d.input||(d.input=t(d,"input[type\x3d"+g+"]",{tabIndex:isNaN(h.tabIndex)?-1:h.tabIndex,disabled:l&&("function"==typeof l?l.call(h,e):l),checked:a}));d.setAttribute("aria-checked",!!a);
return d};d.after(h,"init",function(){w=h.grid});d.after(h,"destroy",function(){e.forEach(m,function(a){a.remove()});w._hasSelectorInputListener=!1});h.renderCell=function(a,d,e,g,h){d=(d=a&&w.row(a))&&w.selection[d.id];f(d,e,a)};h.renderHeaderCell=function(a){var d="label"in h?h.label:h.field||"";"radio"==g||!w.allowSelectAll?(a.appendChild(document.createTextNode(d)),w._hasSelectorInputListener||q()):f(!1,a,{});B=a.lastChild};return h}})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),
function(p,e,h,l,d,a,t,y){function g(c){c.preventDefault()}var r={checkbox:1,radio:1,button:1},s=/\bdgrid-cell\b/,u=/\bdgrid-row\b/,q=p("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=l.mixin({},q.defaultKeyMap));this.headerKeyMap||(this.headerKeyMap=l.mixin({},q.defaultHeaderKeyMap))},postCreate:function(){function c(a){var d=a.target;return d.type&&(!r[d.type]||32==a.keyCode)}function a(n){function f(){d._focusedHeaderNode&&
(d._focusedHeaderNode.tabIndex=-1);if(d.showHeader){if(g)for(var c=0,a,k=d.headerNode.getElementsByTagName("th");a=k[c];++c){if(l.test(a.className)){d._focusedHeaderNode=m=a;break}}else d._focusedHeaderNode=m=d.headerNode;m&&(m.tabIndex=d.tabIndex)}}var g=d.cellNavigation,l=g?s:u,A=n===d.headerNode,m=n;A?(f(),e.after(d,"renderHeader",f,!0)):e.after(d,"renderArray",function(c){return y.when(c,function(c){var a=d._focusedNode||m;if(l.test(a.className)&&t.contains(n,a))return c;for(var k=0,e=n.getElementsByTagName("*"),
f;f=e[k];++k)if(l.test(f.className)){a=d._focusedNode=f;break}a.tabIndex=d.tabIndex;return c})});d._listeners.push(h(n,"mousedown",function(a){c(a)||d._focusOnNode(a.target,A,a)}));d._listeners.push(h(n,"keydown",function(a){if(!a.metaKey&&!a.altKey){var e=d[A?"headerKeyMap":"keyMap"][a.keyCode];e&&!c(a)&&e.call(d,a)}}))}this.inherited(arguments);var d=this;this.tabableHeader&&(a(this.headerNode),h(this.headerNode,"dgrid-cellfocusin",function(){d.scrollTo({x:this.scrollLeft})}));a(this.contentNode);
this._debouncedEnsureRowScroll=t.debounce(this._ensureRowScroll,this)},removeRow:function(c){if(!this._focusedNode)return this.inherited(arguments);var a=this,d=document.activeElement===this._focusedNode,e=this[this.cellNavigation?"cell":"row"](this._focusedNode),n=e.row||e,f;c=c.element||c;if(c===n.element){f=this.down(n,!0);if(!f||f.element===c)f=this.up(n,!0);this._removedFocus={active:d,rowId:n.id,columnId:e.column&&e.column.id,siblingId:!f||f.element===c?void 0:f.id};setTimeout(function(){a._removedFocus&&
a._restoreFocus(n.id)},0);this._focusedNode=null}this.inherited(arguments)},insertRow:function(c){var a=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(a);return a},_restoreFocus:function(c){var d=this._removedFocus,e;if((c=(c=c&&this.row(c))&&c.element&&c.id===d.rowId?c:"undefined"!==typeof d.siblingId&&this.row(d.siblingId))&&c.element){if(!c.element.parentNode.parentNode){d.wait=!0;return}"undefined"!==typeof d.columnId&&(e=this.cell(c,d.columnId))&&e.element&&
(c=e);d.active&&0!==c.element.offsetHeight?this._focusOnNode(c,!1,null):(a(c.element,".dgrid-focus"),c.element.tabIndex=this.tabIndex,this._focusedNode=c.element)}delete this._removedFocus},addKeyHandler:function(c,a,d){return e.after(this[d?"headerKeyMap":"keyMap"],c,a,!0)},_ensureRowScroll:function(c){var a=this.getScrollPosition().y;a>c.offsetTop?this.scrollTo({y:c.offsetTop}):a+this.contentNode.offsetHeight<c.offsetTop+c.offsetHeight&&this.scrollTo({y:c.offsetTop-this.contentNode.offsetHeight+
c.offsetHeight})},_focusOnNode:function(c,e,n){var f="_focused"+(e?"Header":"")+"Node",g=this[f],m=this.cellNavigation?"cell":"row",q=this[m](c),v,t,r,p,z;if(c=q&&q.element){if(this.cellNavigation){v=c.getElementsByTagName("input");z=0;for(r=v.length;z<r;z++)if(t=v[z],(-1!=t.tabIndex||"_dgridLastValue"in t)&&!t.disabled){8>d("ie")&&(t.style.position="relative");t.focus();8>d("ie")&&(t.style.position="");p=!0;break}}null!==n&&(n=l.mixin({grid:this},n),n.type&&(n.parentType=n.type),n.bubbles||(n.bubbles=
!0));g&&(a(g,"!dgrid-focus[!tabIndex]"),8>d("ie")&&(g.style.position=""),n&&(n[m]=this[m](g),h.emit(g,"dgrid-cellfocusout",n)));g=this[f]=c;n&&(n[m]=q);f=this.cellNavigation?s:u;!p&&f.test(c.className)&&(8>d("ie")&&(c.style.position="relative"),c.tabIndex=this.tabIndex,c.focus());a(c,".dgrid-focus");n&&h.emit(g,"dgrid-cellfocusin",n);this.cellNavigation&&((this.columnSets||1<this.subRows.length)&&!e)&&this._debouncedEnsureRowScroll(q.row.element)}},focusHeader:function(c){this._focusOnNode(c||this._focusedHeaderNode,
!0)},focus:function(c){(c=c||this._focusedNode)?this._focusOnNode(c,!1):this.contentNode.focus()}}),m=q.moveFocusVertical=function(c,a){var d=this.cellNavigation,e=this[d?"cell":"row"](c),e=d&&e.column.id,n=this.down(this._focusedNode,a,!0);d&&(n=this.cell(n,e));this._focusOnNode(n,!1,c);c.preventDefault()};p=q.moveFocusUp=function(c){m.call(this,c,-1)};var w=q.moveFocusDown=function(c){m.call(this,c,1)},B=q.moveFocusPageUp=function(c){m.call(this,c,-this.pageSkip)},f=q.moveFocusPageDown=function(c){m.call(this,
c,this.pageSkip)},v=q.moveFocusHorizontal=function(c,a){if(this.cellNavigation){var d=!this.row(c);this._focusOnNode(this.right(this["_focused"+(d?"Header":"")+"Node"],a),d,c);c.preventDefault()}},z=q.moveFocusLeft=function(c){v.call(this,c,-1)},D=q.moveFocusRight=function(c){v.call(this,c,1)},F=q.moveHeaderFocusEnd=function(c,a){var d;this.cellNavigation&&(d=this.headerNode.getElementsByTagName("th"),this._focusOnNode(d[a?0:d.length-1],!0,c));c.preventDefault()},E=q.moveHeaderFocusHome=function(c){F.call(this,
c,!0)},c=q.moveFocusEnd=function(c,a){var n=this,f=this.cellNavigation,g=this.contentNode,h=g.scrollTop+(a?0:g.scrollHeight),g=g[a?"firstChild":"lastChild"],m=-1<g.className.indexOf("dgrid-preload"),q=m?g[(a?"next":"previous")+"Sibling"]:g,s=q.offsetTop+(a?0:q.offsetHeight),t;if(m){for(;q&&0>q.className.indexOf("dgrid-row");)q=q[(a?"next":"previous")+"Sibling"];if(!q)return}!m||1>g.offsetHeight?(f&&(q=this.cell(q,this.cell(c).column.id)),this._focusOnNode(q,!1,c)):(d("dom-addeventlistener")||(c=l.mixin({},
c)),t=e.after(this,"renderArray",function(d){t.remove();return y.when(d,function(d){d=d[a?0:d.length-1];f&&(d=n.cell(d,n.cell(c).column.id));n._focusOnNode(d,!1,c)})}));h===s&&c.preventDefault()},n=q.moveFocusHome=function(a){c.call(this,a,!0)};q.defaultKeyMap={32:g,33:B,34:f,35:c,36:n,37:z,38:p,39:D,40:w};q.defaultHeaderKeyMap={32:g,35:F,36:E,37:z,39:D};return q})},"dgrid/util/mouse":function(){define(["dojo/_base/lang","dojo/on","dojo/dom","dojo/query"],function(p,e,h){function l(a,d){return function(l,
g){return e(l,a+":"+d,function(a){if(!h.isDescendant(a.relatedTarget,this))return g.call(this,a)})}}var d={enterRow:l(".dgrid-content .dgrid-row","mouseover"),enterCell:l(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:l(".dgrid-header .dgrid-cell","mouseover"),leaveRow:l(".dgrid-content .dgrid-row","mouseout"),leaveCell:l(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:l(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:l};p.getObject("dgrid.util.mouse",!0);p.mixin(dgrid.util.mouse,
d);return d})},"dgrid/util/touch":function(){define(["dojo/on","dojo/query"],function(p,e){function h(d,a,e,h){if(!(1<e.targetTouches.length)){var g=e.changedTouches[0],r=g.screenX,s=g.screenY;h&&e.preventDefault();var u=p(d,"touchend",function(d){var e=d.changedTouches[0];d.targetTouches.length||(Math.abs(e.screenX-r)<l.tapRadius&&Math.abs(e.screenY-s)<l.tapRadius&&(h&&d.preventDefault(),a.call(this,d)),u.remove())})}}var l={tapRadius:10,dbltapTime:250,selector:function(d,a,h){return function(l,
g){var r=a.bubble;r?a=r:!1!==h&&(h=!0);return p(l,a,function(a){var r=a.target;3==r.nodeType&&(r=r.parentNode);for(;!e.matches(r,d,l);)if(r==l||!h||!(r=r.parentNode))return;return g.call(r,a)})}},countCurrentTouches:function(d,a){if(!("touches"in d))return-1;var e,h,g;for(h=e=0;g=d.touches[e];++e)a.contains(g.target)&&++h;return h},tap:function(d,a){return p(d,"touchstart",function(e){h(d,a,e)})},dbltap:function(d,a){var e,y;return p(d,"touchstart",function(g){e?h(d,function(d){if(e){var g=d.changedTouches[0];
Math.abs(g.screenX-e.screenX)<l.tapRadius&&Math.abs(g.screenY-e.screenY)<l.tapRadius&&(y&&clearTimeout(y),e=y=null,a.call(this,d))}},g,!0):h(d,function(a){e=a.changedTouches[0];y=setTimeout(function(){e=y=null},l.dbltapTime)},g)})}};return l})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(p,e,h,l){p=function(d){function a(a,e){var g=d[a];g&&(d[a]=function(l){var p;"put"===a&&(p=d.getIdentity(l));if(r)return g.apply(this,arguments);
r=!0;try{var t=g.apply(this,arguments);h(t,function(a){e("object"==typeof a&&a||l,p)});return t}finally{r=!1}})}var p=[],y=0;d=e.delegate(d);d.notify=function(a,d){y++;for(var e=p.slice(),g=0,h=e.length;g<h;g++)e[g](a,d)};var g=d.query;d.query=function(a,r){r=r||{};var q=g.apply(this,arguments);if(q&&q.forEach){var m=e.mixin({},r);delete m.start;delete m.count;var w=d.queryEngine&&d.queryEngine(a,m),B=y,f=[],v;q.observe=function(a,e){1==f.push(a)&&p.push(v=function(a,c){h(q,function(n){var k=n.length!=
r.count,g,h;if(++B!=y)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var m,q=-1,v=-1;if(void 0!==c){var s=[].concat(n);w&&!a&&(s=w(n));g=0;for(h=n.length;g<h;g++){var p=n[g];if(d.getIdentity(p)==c&&!(0>s.indexOf(p))){m=p;q=g;(w||!a)&&n.splice(g,1);break}}}if(w){if(a&&(w.matches?w.matches(a):w([a]).length))g=-1<q?q:n.length,n.splice(g,0,a),v=l.indexOf(w(n),a),n.splice(g,1),r.start&&0==v||!k&&v==n.length?v=-1:n.splice(v,0,a)}else a&&(void 0!==c?v=q:
r.start||(v=d.defaultIndex||0,n.splice(v,0,a)));if((-1<q||-1<v)&&(e||!w||q!=v)){k=f.slice();for(g=0;n=k[g];g++)n(a||m,q,v)}})});var g={};g.remove=g.cancel=function(){var d=l.indexOf(f,a);-1<d&&(f.splice(d,1),f.length||p.splice(l.indexOf(p,v),1))};return g}}return q};var r;a("put",function(a,e){d.notify(a,e)});a("add",function(a){d.notify(a)});a("remove",function(a){d.notify(void 0,a)});return d};e.setObject("dojo.store.Observable",p);return p})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../Evented ../IdentityManager".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s){var u={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},q=function(c){function a(e){c[e]||(c[e]=function(){var a=arguments;return l.when(c,function(c){Array.prototype.unshift.call(a,c.results||c);return q(d[e].apply(d,a))})})}if(!c)return c;c.then&&(c=e.delegate(c));c.total||(c.total=l.when(c,function(c){return g.isDefined(c.total)?c.total:c.length||0}));a("forEach");a("filter");a("map");a("some");a("every");return c},m={useSSL:function(c,a){var d=u&&u.self||
{};if(d&&!d.isPortal)return-1!==c.indexOf("https:")||d.allSSL?a.replace("http:","https:"):a;var e=m.getLocation(a);if(-1<d.portalHostname.toLowerCase().indexOf(e.hostname.toLowerCase())&&e.port&&"80"!==e.port&&"443"!==e.port){var f=e.pathname,f=0===f.indexOf("/")?f:"/"+f;return d.allSSL||-1<c.indexOf("https:")?"https://"+e.hostname+(d.httpsPort&&"443"!==d.httpsPort?":"+d.httpsPort:"")+f+e.search:"http://"+e.hostname+(d.httpPort&&"80"!==d.httpPort?":"+d.httpPort:"")+f+e.search}return-1!==c.indexOf("https:")||
d.allSSL?a.replace("http:","https:"):a},formatUrl:function(c){var a=u.currentToken;return-1!==c.indexOf("null")?null:m.useSSL(window.location.protocol,a?c+(-1!==c.indexOf("?")?"\x26":"?")+("token\x3d"+a):c)},getLocation:function(c){var a=document.createElement("a");a.href=c;return{protocol:a.protocol,hostname:a.hostname,port:a.port,pathname:a.pathname,search:a.search,hash:a.hash,host:a.host}},resultsToTypedArray:function(c,a,k){k=k?k.listings||k.notifications||k.userInvitations||k.tags||k.items||
k.groups||k.comments||k.provisions||k.results||k:[];return d.map(k,function(d){d=e.mixin(d,a||{});return c?new c(d):d})},clearFieldsFromObject:function(c,a){var d,f=c.length;if(e.isArray(c))for(d=0;d<f;d++)delete a[c[d]];else for(d in c)delete a[d];return a},requestToTypedArray:function(c,a,d,f,g){return q(m.request(c,a,d).then(e.partial(m.resultsToTypedArray,f,g)))},request:function(c,a,d){var f;a&&a.portal&&delete a.portal;a&&a.form&&(f=a.form,delete a.form);a=e.mixin(e.mixin({},a||{}),u.requestParams);
d=e.mixin(d||{},u.options);return r({url:m.useSSL(window.location.protocol,c.url||c),content:a,callbackParamName:"callback",timeout:d&&d.timeout||0,form:f},d)},formatQueryParams:function(c,a,d){c=e.mixin(e.mixin({},c),e.isString(a)?{q:a}:a||{});c.q=!d&&u.extraQuery?"("+c.q+")"+u.extraQuery:c.q;return c}},w=p([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(c){e.mixin(this,c);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),
B=p([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(c){e.mixin(this,c);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),f=p([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(c){e.mixin(this,c);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("/content","/content/users/"+this.owner+
(this.folderId?"/"+this.folderId:"")):null;this.itemDataUrl=m.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=m.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var c=this.type;return{source:-1<
d.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===c?c:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(c){var a=e.isString(c)?{comment:c}:c;return m.request(this.itemUrl+"/addComment",a,{usePost:!0}).then(e.hitch(this,function(c){return new w(e.mixin(a,{id:c.commentId,item:this}))}))},updateComment:function(c){if(c&&c.url&&c.comment)return m.request(c.url+"/update",{comment:c.comment},
{usePost:!0}).then(function(a){c.id=a.commentId;return c});throw Error();},getComments:function(){return m.requestToTypedArray(this.itemUrl+"/comments",null,null,w,{item:this})},deleteComment:function(c){if(c&&c.url)return m.request(c.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(c){var a=e.isObject(c)?c:{rating:parseFloat(c)};return m.request(this.itemUrl+"/addRating",a,{usePost:!0}).then(e.hitch(this,function(c){return new B(e.mixin(a,{id:c.ratingId,item:this}))}))},getRating:function(){return m.request(this.itemUrl+
"/rating").then(e.hitch(this,function(c){return new B(e.mixin(c,{item:this}))}))},deleteRating:function(){return m.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var c=this.type,a=this.typeKeywords||[],e=c;"Feature Service"===c||"Feature Collection"===c?e=-1<d.indexOf(a,"Table")?"Table":-1<d.indexOf(a,"Route Layer")?"Route Layer":"Feature Layer":"Image Service"===c?e=-1<d.indexOf(a,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===c?e="Scene Layer":
"Scene Package"===c?e="Scene Layer Package":"Stream Service"===c?e="Feature Layer":"Microsoft Powerpoint"===c?e="Microsoft PowerPoint":"GeoJson"===c?this.type=e="GeoJSON":"Globe Service"===c?e="Globe Layer":"Vector Tile Service"===c?e="Tile Layer":"Map Service"===c?e=-1<d.indexOf(a,"Hosted Service")||-1<d.indexOf(a,"Tiled")?"Tile Layer":"Map Image Layer":c&&-1<c.toLowerCase().indexOf("add in")&&(e=c.replace(/(add in)/ig,"Add-In"));return e},_getIconUrl:function(){var c=this.type&&this.type.toLowerCase()||
"",a=this.typeKeywords||[],e=!1,f=!1,g=!1;0<c.indexOf("service")||"feature collection"===c||"kml"===c||"wms"===c||"wmts"===c||"wfs"===c?(e=-1<d.indexOf(a,"Hosted Service"),"feature service"===c||"feature collection"===c||"kml"===c||"wfs"===c?(g=-1<d.indexOf(a,"Table"),f=-1<d.indexOf(a,"Route Layer"),c=g?"table":e?"featureshosted":f?"routelayer":"features"):c="map service"===c||"wms"===c||"wmts"===c?e||-1<d.indexOf(a,"Tiled")||"wmts"===c?"maptiles":"mapimages":"scene service"===c?-1<d.indexOf(a,"Line")?
"sceneweblayerline":-1<d.indexOf(a,"3DObject")?"sceneweblayermultipatch":-1<d.indexOf(a,"Point")?"sceneweblayerpoint":-1<d.indexOf(a,"IntegratedMesh")?"sceneweblayermesh":-1<d.indexOf(a,"PointCloud")?"sceneweblayerpointcloud":-1<d.indexOf(a,"Polygon")?"sceneweblayerpolygon":"sceneweblayer":"image service"===c?-1<d.indexOf(a,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===c?"streamlayer":"vector tile service"===c?"vectortile":"datastore catalog service"===c?"datastorecollection":
"layers"):c="web map"===c||"cityengine web scene"===c?"maps":"web scene"===c?-1<d.indexOf(a,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===c||"mobile application"===c||"application"===c||"operation view"===c||"desktop application"===c?"apps":"map document"===c||"map package"===c||"published map"===c||"scene document"===c||"globe document"===c||"basemap package"===c||"mobile basemap package"===c||"mobile map package"===c||"project package"===c||"project template"===
c||"pro map"===c||"layout"===c||"layer"===c&&-1<d.indexOf(a,"ArcGIS Pro")||"explorer map"===c&&d.indexOf(a,"Explorer Document")?"mapsgray":"service definition"===c||"csv"===c||"shapefile"===c||"cad drawing"===c||"geojson"===c?"datafiles":"explorer add in"===c||"desktop add in"===c||"windows viewer add in"===c||"windows viewer configuration"===c?"appsgray":"arcgis pro add in"===c?"addindesktop":"rule package"===c||"file geodatabase"===c||"csv collection"===c||"kml collection"===c||"windows mobile package"===
c||"map template"===c||"desktop application template"===c||"arcpad package"===c||"code sample"===c||"form"===c||"document link"===c||"vector tile package"===c||"operations dashboard add in"===c||"rules package"===c||"image"===c||"workflow manager package"===c||"desktop style"===c||"explorer map"===c&&-1<d.indexOf(a,"Explorer Mapping Application")||-1<d.indexOf(a,"Document")?"datafilesgray":"geocoding service"===c||"network analysis service"===c||"geoprocessing service"===c||"geodata service"===c||
"geometry service"===c||"geoprocessing package"===c||"locator package"===c||"geoprocessing sample"===c||"workflow manager service"===c||"raster function template"===c?"toolsgray":"layer"===c||"layer package"===c||"explorer layer"===c?"layersgray":"scene package"===c?"scenepackage":"tile package"===c?"tilepackage":"task file"===c?"taskfile":"report template"===c?"report-template":"statistical data collection"===c?"statisticaldatacollection":"maps";return c?t.toUrl("../css/images/item_type_icons/"+
c+"16.png"):null},_getIsPremiumContent:function(){var c=this.typeKeywords,a=!1;if(-1<d.indexOf(c,"Requires Subscription")||-1<d.indexOf(c,"Requires Credits"))a=!0;return a},_getPremiumIconUrl:function(){var c=this.typeKeywords,a;this.isPremiumContent&&(a=-1<d.indexOf(c,"Requires Credits")?"premiumcredits":"premiumitem");return a?t.toUrl("../css/images/item_type_icons/"+a+"16.png"):null}}),v=p([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(c){e.mixin(this,c);this.id=this.itemId;
this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?m.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?m.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?m.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||
0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var a in this.listingProperties)this[a]&&(this.listingProperties[a]=this[a]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=d.map(this.screenshots,e.hitch(this,function(c){return m.formatUrl(this.url+"/info/"+c)}));this.vendorName=this.vendor.name;
this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?m.formatUrl(this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail):m.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return m.requestToTypedArray(this.commentsUrl,null,null,w,{item:this})},getVendor:function(){return this.vendor}}),z=p([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(c){e.mixin(this,c);this.created=this.created?new Date(this.created):null;this.startDate=
this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=c.listing?new v(e.mixin(c.listing,{portal:this.portal})):null}}),D=p([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(c){e.mixin(this,c);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=m.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?
new Date(this.created):null},getMembers:function(){return m.request(this.url+"/users")},queryItems:function(c,a){c=m.formatQueryParams({},c,a);c.q="group:"+this.id+(c.q?" "+c.q:"");return this.portal.queryItems(c)}}),F=p([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(c){e.mixin(this,c);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return m.requestToTypedArray(this.url,
null,null,f,{portal:this.portal,folderId:this.id})}}),E=p([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(c){e.mixin(this,c);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=m.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return q(m.request(this.url).then(e.hitch(this,
function(c){return m.resultsToTypedArray(D,{portal:this.portal},c.groups)})))},getNotifications:function(){return m.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return m.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return m.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return q(this.getContent().then(function(c){return c.folders}))},
getItems:function(c){return q(this.getContent(c).then(function(c){return c.items}))},getItem:function(c){return m.request(this.portal.portalUrl+"content/items/"+c).then(e.hitch(this,function(c){return new f(e.mixin(c,{portal:this.portal}))}))},getContent:function(c){var a=this.url.replace("community","content")+(c?"/"+c:"");return m.request(a).then(e.hitch(this,function(a){a.folders=m.resultsToTypedArray(F,{portal:this.portal},a.folders);a.items=m.resultsToTypedArray(f,{portal:this.portal,folderId:c},
a.items);return a}))}});return{Portal:p([s],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(c){c=e.isObject(c)?c:{url:c};this.registerConnectEvents();u={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};c.self?(u.self=c.self,e.mixin(this,{url:c.url||window.location.protocol+"//"+(c.self.urlKey?c.self.urlKey+"."+c.self.customBaseUrl:c.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",
c=c.self.user?this.signIn():this.init(this.url)):(c.url&&e.mixin(this,{url:c.url}),c=this.init(this.url));c.then(e.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(c,a){c=(c||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==c.indexOf("/sharing")?c+"/":c+"/sharing/rest/";return this._getSelf(this.portalUrl).then(e.hitch(this,function(c){u.self=e.mixin({},c);if((c=c.user)&&a)u.currentToken=a&&a.token,u.loggedInUser=new E(e.mixin(c,{portal:this,credential:a}));
u.self.id&&!1===u.self.canSearchPublic&&(u.extraQuery=" AND orgid:"+u.self.id);e.mixin(this,u.self);this.thumbnailUrl=m.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length||!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),e.hitch(this,function(c){this.onError(c);throw c;}))},signIn:function(){var c=new l,a=e.hitch(this,function(){this._onSignIn().then(e.hitch(this,
function(){c.resolve(u.loggedInUser)}),e.hitch(this,function(a){c.reject(a)}))});if(!u||!u.self)this.on("load",e.hitch(this,function(){a()}));else u&&u.loggedInUser?setTimeout(function(){c.resolve(u.loggedInUser)},0):a();return c},signOut:function(){u.loggedInUser.credential&&u.loggedInUser.credential.destroy();u.loggedInUser=null;u.options.disableIdentityLookup=!0;m.clearFieldsFromObject(u.self,this);u.self=null;return this.init(this.url)},getPortalUser:function(){return u.loggedInUser},addResource:function(c,
a){return m.request(this.portalUrl+"portals/self/addResource",{key:c,text:a},{usePost:!0})},update:function(c){return m.request(this.portalUrl+"portals/self/update",c,{usePost:!0})},queryGroups:function(c,a){return this._queryPortal(this.portalUrl+"community/groups",m.formatQueryParams({},c,a),D)},queryItems:function(c,a){return this._queryPortal(this.portalUrl+"search",m.formatQueryParams({},c,a),f)},queryListings:function(c){c=m.formatQueryParams({},c,!0);var a="";c.q&&-1<c.q.toLowerCase().indexOf("mylistings:true")?
(c.q=c.q.toLowerCase().replace("mylistings:true",""),a="?mylistings\x3dtrue"):c.q||(c.q='""');return this._queryPortal(this.portalUrl+"content/listings"+a,c,v)},queryCustomerList:function(c,a){var d=m.formatQueryParams({},c,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",d)},getProvisions:function(){return this.getCustomers().then(e.hitch(this,function(c){return c.purchases}))},getInterests:function(){return this.getCustomers().then(e.hitch(this,function(c){return c.interests}))},
getTrials:function(){return this.getCustomers().then(e.hitch(this,function(c){return c.trials}))},getCustomers:function(c){return m.request(this.portalUrl+"portals/self/customers",{status:c||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(c){return c.purchases})},getMyInterests:function(){return this.getPurchases().then(function(c){return c.interests})},getPurchases:function(){return m.request(this.portalUrl+"portals/self/purchases").then(e.hitch(this,function(c){c.interests=
d.map(c.interests,function(c){return e.mixin(c.provision,{listing:c.listing})});c.purchases=d.map(c.purchases,function(c){return e.mixin(c.provision,{listing:c.listing})});c.trials=d.map(c.trials,function(c){return e.mixin(c.provision,{listing:c.listing})});c.interests=m.resultsToTypedArray(z,{portal:this},c.interests);c.trials=m.resultsToTypedArray(z,{portal:this},c.trials);c.purchases=m.resultsToTypedArray(z,{portal:this},c.purchases);return c}))},queryUsers:function(c,a){return this._queryPortal(this.portalUrl+
"community/users",m.formatQueryParams({sortField:"username"},c,a),E)},_onSignIn:function(){u.options.disableIdentityLookup=!1;if(!u.self||!u.self.user)u.self=null;return y.id.getCredential(this.portalUrl).then(e.hitch(this,"init",this.url)).then(function(){return u.loggedInUser},e.hitch(this,function(c){u.options.disableIdentityLookup=!0;this.onError(c);throw c;}))},_getSelf:function(c){var a;c+="portals/self";u.self?(a=new l,setTimeout(function(){a.resolve(u.self)},0)):a=m.request(c,{culture:h.locale});
return a},_queryPortal:function(c,a,d){var f=e.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},a),g=["start","query","num","nextStart"];c=m.request(c,f).then(e.hitch(this,function(c){c.results=m.resultsToTypedArray(d,{portal:this},c);c.queryParams=e.mixin({},f);c.nextQueryParams=e.mixin(f,{start:c.nextStart});return m.clearFieldsFromObject(g,c)}));c=e.delegate(c);c.queryParams=e.mixin({},f);c.nextQueryParams=l.when(c,function(c){return c.nextQueryParams});return q(c)}}),PortalFolder:F,PortalGroup:D,
PortalItem:f,PortalUser:E,PortalComment:w,PortalRating:B,PortalUtil:m,PortalResult:q,PortalListing:v}})},"esri/dijit/_AppTemplateFiltersMixin":function(){define(["dojo/_base/declare"],function(){return{rootNodes:{app:{all:{},narrate:{typekeywords:["story"]},collect:{typekeywords:["collect"]},compare:{typekeywords:["compare"]},"3dscene":{typekeywords:["3Dscene"]},analyze:{typekeywords:["summarize"]},present:{typekeywords:["gallery"]},social:{typekeywords:["social"]},local:{typekeywords:["local"]},
route:{typekeywords:["route"]},showcase:{typekeywords:["showcase"]}}}}})},"esri/dijit/_RefreshMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/has ../kernel".split(" "),function(p,e,h,l,d,a){function t(a){"object"!==typeof a&&(a=Error(a));a.grid=this;l.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return p(null,{_trackError:function(a){var d;"string"===typeof a&&(a=e.hitch(this,a));try{d=a()}catch(r){t.call(this,
r)}return h.when(d,e.hitch(this,function(){l.emit(this.domNode,"refresh",{cancelable:!0,bubbles:!0})}),e.hitch(this,t))}})})},"esri/dijit/analysis/PluginAnalysisLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/has ../../kernel dojo/i18n!../../nls/jsapi".split(" "),function(p,e,h,l,d,a,t){var y=p(null,{filters:{all:{},categoryBoundaries:{tags:["boundaries","places"]},subCategoryBoundaries:{tags:["boundaries"]},subCategoryPlaces:{tags:["places"]},
categoryHexBins:{tags:["hex"]},categoryTransportation:{tags:["transportation"]}},constructor:function(a){e.mixin(this,a);this.i18n=e.mixin({},t.browseLayersDlg);this.filterStrings={all:{title:this.i18n.categoryAll},categoryBoundaries:{title:this.i18n.categoryBoundaries},subCategoryBoundaries:{title:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryBoundaries},subCategoryPlaces:{title:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryPlaces},categoryHexBins:{title:this.i18n.categoryHexBins},
categoryTransportation:{title:this.i18n.categoryTransportation}}},fetchData:function(){this._portal=this.parent._portal;var a;return this._fetchGroups().then(e.hitch(this,function(d){a=h.map(d||[],function(a){if(a)return'group:"'+a.id+'"'});return this._fetchGroupItems(a)}))},_fetchGroup:function(a,d){this._groups=this._groups||[];return this._groups[a]||this._portal.queryGroups(d,!0).then(e.hitch(this,function(d){0<d.total&&d.results&&(this._groups[a]=d.results);return this._groups[a]||[]}))},_fetchGroupItems:function(a,
d){var e=this._isCustom?['-typekeywords:"Multilayer"']:['typekeywords:"Analysis Ready"'];this._portal.user.demographics||e.push('-typekeywords:"Requires Credits"');return this.parent._fetchItems({groups:a,query:d,types:['type:"Map Service"','type:"Feature Service"'],typekeywords:e})},_fetchGroups:function(){return this._fetchEsriAnalysisLayers()},_fetchEsriAnalysisLayers:function(){var a;this._portal&&this._portal.analysisLayersGroupQuery&&(a=this._portal.analysisLayersGroupQuery,this._isCustomAnalysisQuery()&&
(this.filterStrings=this.filters=null));return this._fetchGroup("esriAnalysisLayers",{q:a,num:100,start:0}).then(e.hitch(this,function(a){a&&0<a.length&&(this.parent.sortAttribute=a[0].sortField,this.parent.sortDescending="asc"!==a[0].sortOrder);return a}))},_isCustomAnalysisQuery:function(){var a=!1;this._portal&&(this._portal.analysisLayersGroupQuery&&'title:"Living Atlas Analysis Layers" AND owner:esri'!==this._portal.analysisLayersGroupQuery)&&(a=!0);return this._isCustom=a}});e.mixin(y,{add:function(a,
d){if(!a.plugIn){var e=d||{};e.parent=a;a.plugIn=new y(e)}},remove:function(a){a.plugIn&&(a.plugIn.destroy(),delete a.plugIn)}});return y})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f,v,z,D,F,E,c){p=p(u,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(c){this._jobUpdateHandler=e.hitch(this,this._jobUpdateHandler);this._getJobStatus=e.hitch(this,this._getJobStatus);this._getResultDataHandler=
e.hitch(this,this._getResultDataHandler);this._getResultImageHandler=e.hitch(this,this._getResultImageHandler);this._executeHandler=e.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(c){this.updateDelay=c},setProcessSpatialReference:function(c){this.processSpatialReference=c},setOutputSpatialReference:function(c){this._setOutSR(c)},setOutSpatialReference:function(c){this._setOutSR(c)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(c){this.outSpatialReference=this.outputSpatialReference=c},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(c,a,f){for(var g in c){var l=c[g];e.isArray(l)?c[g]=d.toJson(h.map(l,function(c){return this._gpEncode({item:c},!0).item},this)):l instanceof Date&&(c[g]=l.getTime())}return this._encode(c,a,f)},_decode:function(a){var d=a.dataType,
g=new D(a);if(-1!==h.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],d))return g;if("GPLinearUnit"===d)g.value=new B(g.value);else if("GPFeatureRecordSetLayer"===d||"GPRecordSet"===d)g.value=new q(g.value);else if("GPDataFile"===d)g.value=new f(g.value);else if("GPDate"===d)a=g.value,e.isString(a)?g.value=new z({date:a}):g.value=new Date(a);else if("GPRasterData"===d||"GPRasterDataLayer"===d)a=a.value.mapImage,g.value=a?new c(a):new v(g.value);else if(-1!==d.indexOf("GPMultiValue:")){var l=d.split(":")[1];
a=g.value;g.value=h.map(a,function(c){return this._decode({paramName:"_name",dataType:l,value:c}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+g.dataType),g=null;return g},submitJob:function(c,a,f,h,l){var m=this._getOutSR(),q=l.assembly;c=this._gpEncode(e.mixin({},this._url.query,{f:"json","env:outSR":m?m.wkid||d.toJson(m.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||d.toJson(this.processSpatialReference.toJson()):
null},c),null,q&&q[0]);var v=this._jobUpdateHandler,p=this._errorHandler;return g({url:this._url.path+"/submitJob",content:c,callbackParamName:"callback",load:function(c,d){v(c,d,!1,a,f,l.dfd)},error:function(c){p(c,h,l.dfd)}})},_jobUpdateHandler:function(c,a,d,e,f,g){var h=c.jobId;a=new m(c);this._successHandler([a],"onStatusUpdate",f,d&&g);if(!d)switch(clearTimeout(this._updateTimers[h]),this._updateTimers[h]=null,g&&g.progress(a),c.jobStatus){case m.STATUS_SUBMITTED:case m.STATUS_EXECUTING:case m.STATUS_WAITING:case m.STATUS_NEW:var l=
this._getJobStatus;this._updateTimers[h]=setTimeout(function(){l(h,d,e,f,g)},this.updateDelay);break;default:this._successHandler([a],"onJobComplete",e,g)}},_getJobStatus:function(c,a,d,f,h){var l=this._jobUpdateHandler;g({url:this._url.path+"/jobs/"+c,content:e.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(c,e){l(c,e,a,d,f,h)},error:this._errorHandler})},_getResultDataHandler:function(c,a,d,e,f){try{var g=this._decode(c);this._successHandler([g],"onGetResultDataComplete",
d,f)}catch(h){this._errorHandler(h,e,f)}},getResultData:function(c,a,d,f){var h=this._getResultDataHandler,m=this._errorHandler,q=new l(r._dfdCanceller);q._pendingDfd=g({url:this._url.path+"/jobs/"+c+"/results/"+a,content:e.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(c,a){h(c,a,d,f,q)},error:function(c){m(c,f,q)}});return q},checkJobStatus:function(c,a,d){var f=this._jobUpdateHandler,h=this._errorHandler,m=new l(r._dfdCanceller);m._pendingDfd=
g({url:this._url.path+"/jobs/"+c,content:e.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(c,d){f(c,d,!0,null,a,m)},error:function(c){h(c,d,m)}});return m},cancelJob:function(c,a,d){var f=this._errorHandler,h=new l(r._dfdCanceller);h._pendingDfd=g({url:this._url.path+"/jobs/"+c+"/cancel",content:e.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:e.hitch(this,function(c,d){this._successHandler([c],"onJobCancel",a,h)}),error:function(c){f(c,d,h)}});
return h},execute:function(c,a,f,h){var l=this._getOutSR(),m=h.assembly;c=this._gpEncode(e.mixin({},this._url.query,{f:"json","env:outSR":l?l.wkid||d.toJson(l.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||d.toJson(this.processSpatialReference.toJson()):null},c),null,m&&m[0]);var q=this._executeHandler,v=this._errorHandler;return g({url:this._url.path+"/execute",content:c,callbackParamName:"callback",load:function(c,d){q(c,d,a,f,h.dfd)},error:function(c){v(c,
f,h.dfd)}})},_executeHandler:function(c,a,d,e,f){try{var g=c.results,h,l,m=c.messages;h=0;for(l=g.length;h<l;h++)g[h]=this._decode(g[h]);h=0;for(l=m.length;h<l;h++)m[h]=new w(m[h]);this._successHandler([g,m],"onExecuteComplete",d,f)}catch(q){this._errorHandler(q,e,f)}},_getResultImageHandler:function(c,a,d,e,f){try{var g=this._decode(c);this._successHandler([g],"onGetResultImageComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},getResultImage:function(c,a,d,f,h){var m=this._getResultImageHandler,
q=this._errorHandler;d=this._gpEncode(e.mixin({},this._url.query,{f:"json"},d.toJson()));var v=new l(r._dfdCanceller);v._pendingDfd=g({url:this._url.path+"/jobs/"+c+"/results/"+a,content:d,callbackParamName:"callback",load:function(c,a){m(c,a,f,h,v)},error:function(c){q(c,h,v)}});return v},cancelJobStatusUpdates:function(c){clearTimeout(this._updateTimers[c]);this._updateTimers[c]=null},getResultImageLayer:function(c,a,d,e){if(null==a){var f=this._url.path.indexOf("/GPServer/");c=this._url.path.substring(0,
f)+"/MapServer/jobs/"+c}else c=this._url.path+"/jobs/"+c+"/results/"+a;this._url.query&&(c+="?"+t.objectToQuery(this._url.query));a=null==a?new E(c,{imageParameters:d}):new F(c,{imageParameters:d},!0);this.onGetResultImageLayerComplete(a);e&&e(a);return a},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});s._createWrappers(p);
return p})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,e,h,l){return p(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(d){d&&e.mixin(this,d)},distance:0,units:null,toJson:function(){var d={};this.distance&&(d.distance=this.distance);this.units&&(d.units=this.units);return d}})})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,e,h,l){return p(null,
{declaredClass:"esri.tasks.DataFile",constructor:function(d){d&&e.mixin(this,d)},url:null,itemID:null,toJson:function(){var d={};this.url&&(d.url=this.url);this.itemID&&(d.itemID=this.itemID);return d}})})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,e,h,l){return p(null,{declaredClass:"esri.tasks.RasterData",constructor:function(d){d&&e.mixin(this,d)},url:null,format:null,itemID:null,toJson:function(){var d={};this.url&&(d.url=
this.url);this.format&&(d.format=this.format);this.itemID&&(d.itemID=this.itemID);return d}})})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(p,e,h,l,d){return p(null,{declaredClass:"esri.tasks.Date",constructor:function(a){a&&(a.format&&(this.format=a.format),this.date=h.parse(a.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:h.format(this.date,
{selector:"date",datePattern:this.format}),format:this.format}}})})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,e,h,l){return p(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(d){e.mixin(this,d)}})})},"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(p,e,h,
l,d,a,t){return p(t,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(a,d){d&&(d.imageParameters&&d.imageParameters.extent)&&(this.initialExtent=this.fullExtent=d.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=e.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(a,g,l,p){var t=a.spatialReference.wkid;p(this._url.path+"?"+d.objectToQuery(e.mixin(this._params,{f:"image",bbox:h.toJson(a.toJson()),
bboxSR:t,imageSR:t,size:g+","+l})))}})})},"esri/dijit/SingleFilter":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/has dojo/json dojo/string dojo/number dojo/dom dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/_base/event dojo/Evented dojo/data/ItemFileWriteStore dojo/date/locale dojo/parser dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/TextBox dijit/form/FilteringSelect dijit/form/RadioButton dijit/form/DateTextBox dijit/form/NumberTextBox ../kernel ../lang ../tasks/GenerateRendererTask ../tasks/UniqueValueDefinition ../tasks/GenerateRendererParameters ../layers/FeatureLayer ../layers/GeoRSSLayer dojo/i18n!../nls/jsapi dojo/text!./templates/SingleFilter.html".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f,v,z,D,F,E,c,n,k,A,x,M,H,C,I,N,J,G,K,O,P,L,Q,T,R){return e([E,c,n,k,A,v],{declaredClass:"esri.dijit.SingleFilter",widgetsInTemplate:!0,templateString:R,valueHandlers:[],onFieldChangeEnabled:!0,onOperatorChangeEnabled:!0,onPromptChangeHandler:null,onHintChangeHandler:null,fieldDomains:{},fieldsStore:null,fieldsInfo:{stringFieldsCount:0,numberFieldsCount:0,dateFieldsCount:0},stringOperatorStore:null,dateOperatorStore:null,numberOperatorStore:null,uniqueValuesStore:null,
isEnableInteractiveFilter:!0,uniqueValuesResults:{},partsObj:null,dayInMS:86399E3,allowAllDateTypes:!1,postMixInProperties:function(){this.inherited(arguments);this.i18n={};this.i18n=h.mixin(this.i18n,T.filterDlg)},parseExpressionTemplate:function(){var b=function(b,f){s.byId(f).className="attributeValueContainer";"field_dropdown"===b?s.byId(f).innerHTML=c:"operator_dropdown"===b?s.byId(f).innerHTML=a:"values_input"===b?s.byId(f).innerHTML=d+e:console.error("problem with expressionTemplate from localization file")},
c='\x3cselect id\x3d"'+this.id+'.fieldsList" class\x3d"attributeField" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"true"\x3e\x3c/select\x3e',a='\x3cselect id\x3d"'+this.id+'.operatorList" class\x3d"operator" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\x3c/select\x3e',d='\x3cdiv id\x3d"'+this.id+'.attributeValueContainer"\x3e\x3c/div\x3e',e='\x3cdiv class\x3d"attributeValueOptions"\x3e\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e  \x3ctbody\x3e    \x3ctr\x3e      \x3ctd nowrap\x3d"nowrap"\x3e        \x3cinput id\x3d"'+
this.id+'.radioValue" class\x3d"radioValue attributeValueRadio" checked\x3d"checked" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.valueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.valueTooltip+'"\x3e'+this.i18n.value+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioFields" class\x3d"radioFields attributeValueRadio" name\x3d"'+
this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.fieldTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.fieldTooltip+'"\x3e'+this.i18n.field+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd id\x3d"'+this.id+'.radioUniqueColumn" nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioUnique" class\x3d"radioUnique attributeValueRadio" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+
this.i18n.uniqueValueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.uniqueValueTooltip+'"\x3e'+this.i18n.uniqueValues+"        \x3c/label\x3e      \x3c/td\x3e    \x3c/tr\x3e  \x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e",f=this.i18n.expressionTemplate,g=f.indexOf("${"),k=f.substring(0,g).trim();s.byId(this.id+".column1").innerHTML=k.length?"\x3cdiv class\x3d'attributeText'\x3e"+k+"\x3c/div\x3e":"";var k=f.indexOf("}",g+1),h=f.substring(g+2,k);b(h,this.id+".column2");g=f.indexOf("${",
g+1);k=f.substring(k+1,g).trim();s.byId(this.id+".column3").innerHTML=k.length?"\x3cdiv class\x3d'attributeText'\x3e"+k+"\x3c/div\x3e":"";k=f.indexOf("}",g+1);h=f.substring(g+2,k);b(h,this.id+".column4");g=f.indexOf("${",g+1);k=f.substring(k+1,g).trim();s.byId(this.id+".column5").innerHTML=k.length?"\x3cdiv class\x3d'attributeText'\x3e"+k+"\x3c/div\x3e":"";k=f.indexOf("}",g+1);h=f.substring(g+2,k);b(h,this.id+".column6");k=f.substring(k+1,f.length).trim();s.byId(this.id+".column7").innerHTML=k.length?
"\x3cdiv class\x3d'attributeText'\x3e"+k+"\x3c/div\x3e":""},postCreate:function(){this.inherited(arguments);this.parseExpressionTemplate();this.createOperatorStores();this.createFieldsStore(this.fields);this.readCodedValues();F.parse(s.byId(this.id+".exprTable")).then(h.hitch(this,function(b){d.connect(this.getFieldsList(),"onChange",this,"onChangeField");d.connect(this.getOperatorList(),"onChange",this,"onChangeOperator");d.connect(x.byId(this.id+".radioValue"),"onClick",this,"showValueInput");d.connect(x.byId(this.id+
".radioFields"),"onClick",this,"showFields");d.connect(x.byId(this.id+".radioUnique"),"onClick",this,"showUniqueList");this.version&&(10.1>this.version&&this.mapLayer.url)&&u.set(s.byId(this.id+".radioUniqueColumn"),"display","none");d.connect(s.byId(this.id+".deleteExpression"),"onclick",this,"onClickDeleteExpression");d.connect(this.interactiveCheck,"onclick",this,"onInteractiveClick");d.connect(this.interactiveArrow,"onclick",this,"onClickShowHideInteractive");this.enableInteractiveHandlers();
this.isEnableInteractiveFilter||u.set(this._interactiveFilterRow,"display","none")}))},constructor:function(b,c){this.id=b.id||"";this.owner=b.owner;this.version=b.version;this.part=b.part;this.fields=b.fields;this.mapLayer=b.mapLayer;!1===b.enableEvents&&(this.onOperatorChangeEnabled=this.onFieldChangeEnabled=!1)},init:function(b){b.part||(this.clearAttributeValueDijits(),this.mapLayer=b.mapLayer,this.version=b.version,this.fields=b.fields,this.createOperatorStores(),this.createFieldsStore(this.fields),
this.readCodedValues(),this.fillFieldsList(this.fieldsStore),this.onChangeField());b.part&&(this.part=b.part,this.buildEditUIField(this.part,this))},destroy:function(){this.clearAttributeValueDijits();l.forEach(x.findWidgets(s.byId(this.id)),function(b){b.destroyRecursive()});this.inherited(arguments)},toJson:function(){var b=null;this.isInteractiveChecked()&&(b={prompt:this.promptText.attr("value"),hint:this.hintText.attr("value")});return{fieldObj:this.getField(),operator:this.getOperator(),valueObj:this.getValue(),
interactiveObj:b}},buildFriendlyTextExpr:function(b){var c=this.i18n.expressionTemplate,a=function(b,a,d){return g.substitute(c,{field_dropdown:b,operator_dropdown:a,values_input:d})};if(!1===b.valueObj.isValid)return"\x26lt;expression is missing value\x26gt;";var d="";if("string"===b.fieldObj.shortType)b.operator===this.i18n.stringOperatorIsBlank||b.operator===this.i18n.stringOperatorIsNotBlank?d=a(b.fieldObj.label,b.operator,""):"field"===b.valueObj.type?d=a(b.fieldObj.label,b.operator,b.valueObj.label):
(d=this.getDecodedValue(b.interactiveObj?b.interactiveObj.value:b.valueObj.value,b.fieldObj.name),d=a(b.fieldObj.label,b.operator,"'"+d+"'"));else if("number"===b.fieldObj.shortType)if(b.operator===this.i18n.numberOperatorIsBetween||b.operator===this.i18n.numberOperatorIsNotBetween)d=b.interactiveObj?b.interactiveObj.value2:b.valueObj.value2,d=a(b.fieldObj.label,b.operator,r.format(b.interactiveObj?b.interactiveObj.value1:b.valueObj.value1,{pattern:"#####0.##########"})+" "+this.i18n.andBetweenValues+
" "+r.format(d,{pattern:"#####0.##########"}));else if(b.operator===this.i18n.numberOperatorIsBlank||b.operator===this.i18n.numberOperatorIsNotBlank)d=a(b.fieldObj.label,b.operator,"");else if("field"===b.valueObj.type)d=a(b.fieldObj.label,b.operator,b.valueObj.label);else var d=b.interactiveObj?b.interactiveObj.value:b.valueObj.value,e=this.getDecodedValue(d,b.fieldObj.name),d=a(b.fieldObj.label,b.operator,d!==e?"'"+e+"'":r.format(d,{pattern:"#####0.##########"}));else G.isDefined(b.valueObj.value)&&
("field"!==b.valueObj.type&&"string"===typeof b.valueObj.value)&&(b.valueObj.value=new Date(b.valueObj.value)),d=b.operator===this.i18n.dateOperatorIsBetween||b.operator===this.i18n.dateOperatorIsNotBetween?a(b.fieldObj.label,b.operator,(b.interactiveObj?this.formatFriendlyDate(b.interactiveObj.value1):this.formatFriendlyDate(b.valueObj.value1))+" "+this.i18n.andBetweenValues+" "+(b.interactiveObj?this.formatFriendlyDate(b.interactiveObj.value2):this.formatFriendlyDate(this.addDay(b.valueObj.value2)))):
b.operator===this.i18n.dateOperatorIsBlank||b.operator===this.i18n.dateOperatorIsNotBlank?a(b.fieldObj.label,b.operator,""):"field"===b.valueObj.type?a(b.fieldObj.label,b.operator,b.valueObj.label):a(b.fieldObj.label,b.operator,b.interactiveObj?this.formatFriendlyDate(b.interactiveObj.value):this.formatFriendlyDate(b.valueObj.value));return d},builtSingleFilterString:function(b,c){if(G.isDefined(b.valueObj.isValid)&&!b.valueObj.isValid)return{whereClause:null};var a=b.valueObj.value,d=b.valueObj.value1,
e=b.valueObj.value2,f=!1;if(b.interactiveObj){if(!b.interactiveObj.prompt||!b.interactiveObj.hint)return{whereClause:null};G.isDefined(c)&&(f=!0,G.isDefined(b.valueObj.value)&&(a="{"+c+"}"),G.isDefined(b.valueObj.value1)&&(d="{"+c+"}"),G.isDefined(b.valueObj.value2)&&(e="{"+(c+1)+"}"))}var g="";if("string"===b.fieldObj.shortType)switch(d="",a&&"field"!==b.valueObj.type&&this.isHostedService(this.mapLayer.url)&&this.containsNonLatinCharacter(a)&&(d="N"),b.operator){case this.i18n.stringOperatorIs:g=
"field"===b.valueObj.type?b.fieldObj.name+" \x3d "+a:b.fieldObj.name+" \x3d "+d+"'"+a.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorIsNot:g="field"===b.valueObj.type?b.fieldObj.name+" \x3c\x3e "+a:b.fieldObj.name+" \x3c\x3e "+d+"'"+a.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorStartsWith:g=b.fieldObj.name+" LIKE "+d+"'"+a.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorEndsWith:g=b.fieldObj.name+" LIKE "+d+"'%"+a.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorContains:g=
b.fieldObj.name+" LIKE "+d+"'%"+a.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorDoesNotContain:g=b.fieldObj.name+" NOT LIKE "+d+"'%"+a.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorIsBlank:g=b.fieldObj.name+" IS NULL";break;case this.i18n.stringOperatorIsNotBlank:g=b.fieldObj.name+" IS NOT NULL"}else if("number"===b.fieldObj.shortType)switch(b.operator){case this.i18n.numberOperatorIs:g=b.fieldObj.name+" \x3d "+a;break;case this.i18n.numberOperatorIsNot:g=b.fieldObj.name+
" \x3c\x3e "+a;break;case this.i18n.numberOperatorIsAtLeast:g=b.fieldObj.name+" \x3e\x3d "+a;break;case this.i18n.numberOperatorIsLessThan:g=b.fieldObj.name+" \x3c "+a;break;case this.i18n.numberOperatorIsAtMost:g=b.fieldObj.name+" \x3c\x3d "+a;break;case this.i18n.numberOperatorIsGreaterThan:g=b.fieldObj.name+" \x3e "+a;break;case this.i18n.numberOperatorIsBetween:g=b.fieldObj.name+" BETWEEN "+d+" AND "+e;break;case this.i18n.numberOperatorIsNotBetween:g=b.fieldObj.name+" NOT BETWEEN "+d+" AND "+
e;break;case this.i18n.numberOperatorIsBlank:g=b.fieldObj.name+" IS NULL";break;case this.i18n.numberOperatorIsNotBlank:g=b.fieldObj.name+" IS NOT NULL"}else switch(G.isDefined(a)&&("field"!==b.valueObj.type&&"string"===typeof a)&&(a=this.parseFriendlyDate(a)),b.operator){case this.i18n.dateOperatorIsOn:g="field"===b.valueObj.type?b.fieldObj.name+" \x3d "+a:f?b.fieldObj.name+" BETWEEN '{"+c+"}' AND '{"+(c+1)+"}'":b.fieldObj.name+" BETWEEN '"+this.formatDate(a)+"' AND '"+this.formatDate(this.addDay(a))+
"'";break;case this.i18n.dateOperatorIsNotOn:g="field"===b.valueObj.type?b.fieldObj.name+" \x3c\x3e "+a:f?b.fieldObj.name+" NOT BETWEEN '{"+c+"}' AND '{"+(c+1)+"}'":b.fieldObj.name+" NOT BETWEEN '"+this.formatDate(a)+"' AND '"+this.formatDate(this.addDay(a))+"'";break;case this.i18n.dateOperatorIsBefore:g="field"===b.valueObj.type?b.fieldObj.name+" \x3c "+a:b.fieldObj.name+" \x3c '"+this.formatDate(a)+"'";break;case this.i18n.dateOperatorIsAfter:g="field"===b.valueObj.type?b.fieldObj.name+" \x3e "+
a:b.fieldObj.name+" \x3e '"+this.formatDate(this.addDay(a))+"'";break;case this.i18n.dateOperatorIsBetween:g=f?b.fieldObj.name+" BETWEEN '"+d+"' AND '"+e+"'":b.fieldObj.name+" BETWEEN '"+this.formatDate(d)+"' AND '"+this.formatDate(this.addDay(e))+"'";break;case this.i18n.dateOperatorIsNotBetween:g=f?b.fieldObj.name+" NOT BETWEEN '"+d+"' AND '"+e+"'":b.fieldObj.name+" NOT BETWEEN '"+this.formatDate(d)+"' AND '"+this.formatDate(this.addDay(e))+"'";break;case this.i18n.dateOperatorIsBlank:g=b.fieldObj.name+
" IS NULL";break;case this.i18n.dateOperatorIsNotBlank:g=b.fieldObj.name+" IS NOT NULL"}return{whereClause:g}},showDeleteIcon:function(){u.set(s.byId(this.id+".deleteExpression"),"display","block")},hideDeleteIcon:function(){u.set(s.byId(this.id+".deleteExpression"),"display","none")},createFieldsStore:function(b){if(b&&b.length){b=h.clone(b);b=b.sort(function(b,c){b.label=b.alias||b.name;c.label=c.alias||c.name;return b.label<c.label?-1:b.label>c.label?1:0});var c=this.isHostedService(this.mapLayer.url),
a=10.2<=this.version;b=l.filter(b,function(b,d){return"esriFieldTypeString"===b.type||"esriFieldTypeDouble"===b.type||"esriFieldTypeSingle"===b.type||"esriFieldTypeInteger"===b.type||"esriFieldTypeSmallInteger"===b.type||"esriFieldTypeDate"===b.type&&(this.allowAllDateTypes||c||a)?!0:!1},this);b=l.map(b,function(b,c){var a;switch(b.type){case "esriFieldTypeString":a="string";this.fieldsInfo.stringFieldsCount++;break;case "esriFieldTypeDate":a="date";this.fieldsInfo.dateFieldsCount++;break;default:a=
"number",this.fieldsInfo.numberFieldsCount++}return{id:c,label:b.label,shortType:a,alias:b.alias,editable:b.editable,name:b.name,nullable:b.nullable,type:b.type}},this);b.length&&(this.fieldsStore=new z({data:{identifier:"id",label:"label",items:b}}))}},createOperatorStores:function(){var b=[];b.push({name:this.i18n.stringOperatorIs,name_:this.i18n.stringOperatorIs,id:0});b.push({name:this.i18n.stringOperatorIsNot,name_:this.i18n.stringOperatorIsNot,id:1});b.push({name:this.i18n.stringOperatorStartsWith,
name_:this.i18n.stringOperatorStartsWith,id:2});b.push({name:this.i18n.stringOperatorEndsWith,name_:this.i18n.stringOperatorEndsWith,id:3});b.push({name:this.i18n.stringOperatorContains,name_:this.i18n.stringOperatorContains,id:4});b.push({name:this.i18n.stringOperatorDoesNotContain,name_:this.i18n.stringOperatorDoesNotContain,id:5});b.push({name:this.i18n.stringOperatorIsBlank,name_:this.i18n.stringOperatorIsBlank,id:6});b.push({name:this.i18n.stringOperatorIsNotBlank,name_:this.i18n.stringOperatorIsNotBlank,
id:7});this.stringOperatorStore=new z({data:{label:"name",identifier:"id",items:b}});b=[];b.push({name:this.i18n.dateOperatorIsOn,id:0});b.push({name:this.i18n.dateOperatorIsNotOn,id:1});b.push({name:this.i18n.dateOperatorIsBefore,id:2});b.push({name:this.i18n.dateOperatorIsAfter,id:3});b.push({name:this.i18n.dateOperatorIsBetween,id:6});b.push({name:this.i18n.dateOperatorIsNotBetween,id:7});b.push({name:this.i18n.dateOperatorIsBlank,id:8});b.push({name:this.i18n.dateOperatorIsNotBlank,id:9});this.dateOperatorStore=
new z({data:{label:"name",identifier:"id",items:b}});b=[];b.push({name:this.i18n.numberOperatorIs,name_:this.i18n.numberOperatorIs,id:0});b.push({name:this.i18n.numberOperatorIsNot,name_:this.i18n.numberOperatorIsNot,id:1});b.push({name:this.i18n.numberOperatorIsAtLeast,name_:this.i18n.numberOperatorIsAtLeast,id:2});b.push({name:this.i18n.numberOperatorIsLessThan,name_:this.i18n.numberOperatorIsLessThan,id:3});b.push({name:this.i18n.numberOperatorIsAtMost,name_:this.i18n.numberOperatorIsAtMost,id:4});
b.push({name:this.i18n.numberOperatorIsGreaterThan,name_:this.i18n.numberOperatorIsGreaterThan,id:5});b.push({name:this.i18n.numberOperatorIsBetween,name_:this.i18n.numberOperatorIsBetween,id:6});b.push({name:this.i18n.numberOperatorIsNotBetween,name_:this.i18n.numberOperatorIsNotBetween,id:7});b.push({name:this.i18n.numberOperatorIsBlank,name_:this.i18n.numberOperatorIsBlank,id:8});b.push({name:this.i18n.numberOperatorIsNotBlank,name_:this.i18n.numberOperatorIsNotBlank,id:9});this.numberOperatorStore=
new z({data:{label:"name",identifier:"id",items:b}})},readCodedValues:function(){l.forEach(this.mapLayer.fields,function(b){b.domain&&b.domain.codedValues&&(this.fieldDomains[b.name]=b.domain.codedValues)},this)},getDecodedValue:function(b,c){var a=this.getCodedValues(c),d,e;if(a)for(d=0;d<a.length;d+=1)if(e=a[d],e.code===b)return e.name;return b},getCodedValues:function(b){return this.fieldDomains[b]},getFieldsList:function(){return x.byId(this.id+".fieldsList")},getOperatorList:function(){return x.byId(this.id+
".operatorList")},getValueFieldsList:function(){return x.byId(this.id+".valueFields")},getAttrValContNode:function(){return s.byId(this.id+".attributeValueContainer")},getField:function(){var b=this.getFieldsList();return{name:b.store.getValue(b.item,"name"),label:b.store.getValue(b.item,"label"),shortType:b.store.getValue(b.item,"shortType"),type:b.store.getValue(b.item,"type")}},getOperator:function(){var b=this.getOperatorList();return!b.item?"":b.store.getValue(b.item,"name")},getValue:function(){return{}},
isInteractiveChecked:function(){return this.interactiveCheck.checked},setInteractiveSection:function(b,c,a){this.disableInteractiveHandlers();this.interactiveCheck.checked=b;this.promptText.attr("value",c);this.hintText.attr("value",a);u.set(this.interactiveSpace,"display","block");this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;";this.enableInteractiveHandlers()},enableInteractiveHandlers:function(){this.onPromptChangeHandler=d.connect(this.promptText,"onChange",this,"onChangeInteractive");this.onHintchangeHandler=
d.connect(this.hintText,"onChange",this,"onChangeInteractive")},disableInteractiveHandlers:function(){d.disconnect(this.onPromptChangeHandler);d.disconnect(this.onHintChangeHandler)},fillFieldsList:function(b){var c=this.getFieldsList();c.set("labelAttr","label");c.set("searchAttr","label");c.set("store",b);c.set("value",0)},fillOperatorList:function(b,c,a){var d=this.getOperatorList();d.set("labelAttr","name");d.set("searchAttr","name");d.set("query",a?a:{});d.set("store",b);if(c){var e=!1;for(a=
0;20>a&&!(b.fetchItemByIdentity({identity:a,onItem:h.hitch(this,function(b){b&&b.name[0]===c&&(d.set("value",b.id[0]),e=!0)})}),e);a++);}else d.set("value",0)},createValueString:function(b){var c=this.getAttrValContNode();this.clearAttributeValueDijits();m.empty(c);if(b){var c=new H({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},m.create("div",{},c)),a=this.buildCodedValuesStore(b);c.set("store",a);c.set("value",0)}else c=new M({id:this.id+".value","class":"attributeValue",
required:!0,placeHolder:"",intermediateChanges:!0},m.create("div",{},c));this.valueHandlers.push(d.connect(c,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var c=x.byId(this.id+".value"),a=!0;b?c.item?c=c.item.code[0]:(c="",a=!1):a=c=c.get("value");return{value:c,isValid:a}}},createValueDate:function(){var b=this.getAttrValContNode();this.clearAttributeValueDijits();m.empty(b);b=new I({id:this.id+".value","class":"attributeValue",trim:!0,required:!0,placeHolder:"",
constraints:{formatLength:"short"}},m.create("div",{},b));this.checkDefaultOption();this.valueHandlers.push(d.connect(b,"onChange",this,"onValueChange"));this.getValue=function(){var b=x.byId(this.id+".value").get("value");return{value:b,isValid:G.isDefined(b)}}},createValueNumber:function(b){var c=this.getAttrValContNode();this.clearAttributeValueDijits();m.empty(c);if(b){var c=new H({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},m.create("div",{},c)),a=this.buildCodedValuesStore(b);
c.set("store",a);c.set("value",0)}else c=new N({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},m.create("div",{},c));this.valueHandlers.push(d.connect(c,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var c=x.byId(this.id+".value"),a=!0;b?c.item?c=c.item.code[0]:(c="",a=!1):(c=c.get("value"),a=G.isDefined(c)&&!isNaN(c));return{value:c,isValid:a}}},createValueBetweenDate:function(){var b=
this.getAttrValContNode();this.clearAttributeValueDijits();m.empty(b);var c=new I({id:this.id+".value1","class":"attributeValue1",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},m.create("div",{},b));m.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},b);b=new I({id:this.id+".value2","class":"attributeValue2",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},m.create("div",{},b));this.checkDefaultOption();this.valueHandlers.push(d.connect(c,
"onChange",this,"onValueChange"));this.valueHandlers.push(d.connect(b,"onChange",this,"onValueChange"));this.getValue=function(){var b=x.byId(this.id+".value1").get("value"),c=x.byId(this.id+".value2").get("value");return{value1:b,value2:c,isValid:G.isDefined(b)&&G.isDefined(c)}}},createValueBetweenNumber:function(){var b=this.getAttrValContNode();this.clearAttributeValueDijits();m.empty(b);var c=new N({id:this.id+".value1","class":"attributeValue1",required:!0,placeHolder:"",intermediateChanges:!0,
constraints:{pattern:"#####0.##########"}},m.create("div",{},b));m.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},b);b=new N({id:this.id+".value2","class":"attributeValue2",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},m.create("div",{},b));this.checkDefaultOption();this.valueHandlers.push(d.connect(c,"onChange",this,"onValueChange"));this.valueHandlers.push(d.connect(b,"onChange",this,"onValueChange"));this.getValue=
function(){var b=x.byId(this.id+".value1").get("value"),c=x.byId(this.id+".value2").get("value");return{value1:b,value2:c,isValid:G.isDefined(b)&&G.isDefined(c)&&!isNaN(b)&&!isNaN(c)&&b<=c}}},createValueInTheLastDate:function(){},createValueIsBlank:function(){var b=this.getAttrValContNode();this.clearAttributeValueDijits();m.empty(b);b.innerHTML="\x3cinput id\x3d'"+this.id+".value' class\x3d'attributeValue' type\x3d'text' disabled\x3d'true'/\x3e";this.checkDefaultOption();this.getValue=function(){return{value:null,
isValid:!0}}},createValueFields:function(b,c,a){var e=this.getAttrValContNode();this.clearAttributeValueDijits();m.empty(e);var f=new H({id:this.id+".valueFields","class":"attributeValue",maxHeight:150,labelAttr:"label",searchAttr:"label",store:b,query:c},m.create("div",{},e));if(a)for(var g=!1,e=0;100>e&&!(b.fetchItemByIdentity({identity:e,onItem:h.hitch(this,function(b){b&&(b.shortType[0]===c.shortType&&b.name[0]!==a)&&(f.set("value",b.id),g=!0)})}),g);e++);this.valueHandlers.push(d.connect(f,"onChange",
this,"onValueChange"));this.getValue=function(){var b=x.byId(this.id+".valueFields");return{value:b.store.getValue(b.item,"name"),label:b.store.getValue(b.item,"label"),type:"field",isValid:!0}}},createValueUnique:function(b){var c=this.getAttrValContNode();this.clearAttributeValueDijits();m.empty(c);b=new H({id:this.id+".valueUnique","class":"attributeValue",maxHeight:150,store:b},m.create("div",{},c));b.set("value",0);this.valueHandlers.push(d.connect(b,"onChange",this,"onValueChange"));this.getValue=
function(){var b=x.byId(this.id+".valueUnique");return{value:b.store.getValue(b.item,"value"),isValid:!0}}},setValue:function(b,c){if(c)for(var a=0;a<c.length;a++){if(b===c[a].code){x.byId(this.id+".value").set("value",a);break}}else"date"===this.part.fieldObj.shortType?x.byId(this.id+".value").set("value",new Date(b)):("number"===this.part.fieldObj.shortType&&(b=Number(b)),x.byId(this.id+".value").set("value",b))},setValue1:function(b){"date"===this.part.fieldObj.shortType?b=new Date(b):"number"===
this.part.fieldObj.shortType&&(b=Number(b));x.byId(this.id+".value1").set("value",b)},setValue2:function(b){"date"===this.part.fieldObj.shortType?b=new Date(b):"number"===this.part.fieldObj.shortType&&(b=Number(b));x.byId(this.id+".value2").set("value",b)},setValueFieldById:function(b){this.getValueFieldsList().set("value",b)},enableOnFieldChange:function(){this.onFieldChangeEnabled=!0},enableOnOperatorChange:function(){this.onOperatorChangeEnabled=!0},onChangeField:function(b){this.onFieldChangeEnabled&&
this._onChangeField(this.getFieldsList(),this)},onChangeOperator:function(b){this.onOperatorChangeEnabled&&this._onChangeOperator(this.getOperatorList(),this)},onClickDeleteExpression:function(b){this._deleteExpression(this)},_onChangeField:function(b,c,a){var e=c.getOperatorList();switch(this.fieldsStore.getValue(b.item,"type")){case "esriFieldTypeString":var f=null;b=this.fieldsStore.getValue(b.item,"name");this.getCodedValues(b)&&(f=this.i18n.stringOperatorStartsWith,f+="|"+this.i18n.stringOperatorEndsWith,
f+="|"+this.i18n.stringOperatorContains,f+="|"+this.i18n.stringOperatorDoesNotContain,f={name_:RegExp("^(?!("+f+")$)")});e.attr("value")===this.i18n.stringOperatorIs?(c.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,f),this.onChangeOperator(e,c,a)):c.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,f);c.createValueString(this.getCodedValues(b));break;case "esriFieldTypeDate":c.fillOperatorList(this.dateOperatorStore,this.i18n.dateOperatorIsOn);c.createValueDate();
break;default:f=null,b=this.fieldsStore.getValue(b.item,"name"),this.getCodedValues(b)&&(f=this.i18n.numberOperatorIsBetween,f+="|"+this.i18n.numberOperatorIsNotBetween,f+="|"+this.i18n.numberOperatorIsAtLeast,f+="|"+this.i18n.numberOperatorIsLessThan,f+="|"+this.i18n.numberOperatorIsAtMost,f+="|"+this.i18n.numberOperatorIsGreaterThan,f={name_:RegExp("^(?!("+f+")$)")}),e.attr("value")===this.i18n.numberOperatorIs?(c.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,f),this.onChangeOperator(e,
c,a)):c.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,f),c.createValueNumber(this.getCodedValues(b))}"date"===this.fieldsStore.getValue(c.getFieldsList().item,"shortType")?c.disableInteractiveCheck():c.enableInteractiveCheck();d.publish("filter-expression-change",this)},_onChangeOperator:function(b,c,a){b=b.item?b.item.name[0]:b.value;a=this.fieldsStore.getValue(c.getFieldsList().item,"shortType");var e=this.fieldsStore.getValue(c.getFieldsList().item,"name");c.enableOptions();
if(("date"===a||"number"===a)&&(b===this.i18n.dateOperatorIsBetween||b===this.i18n.numberOperatorIsBetween||b===this.i18n.dateOperatorIsNotBetween||b===this.i18n.numberOperatorIsNotBetween))"date"===a?c.createValueBetweenDate():c.createValueBetweenNumber();else if("date"===a&&(b===this.i18n.dateOperatorInTheLast||b===this.i18n.dateOperatorNotInTheLast))c.createValueInTheLastDate();else if(b===this.i18n.stringOperatorIsBlank||b===this.i18n.dateOperatorIsBlank||b===this.i18n.numberOperatorIsBlank||
b===this.i18n.stringOperatorIsNotBlank||b===this.i18n.dateOperatorIsNotBlank||b===this.i18n.numberOperatorIsNotBlank)c.createValueIsBlank(),c.disableOptions();else switch(a){case "string":c.createValueString(this.getCodedValues(e));break;case "date":c.createValueDate();break;default:c.createValueNumber(this.getCodedValues(e))}d.publish("filter-expression-change",this)},onInteractiveClick:function(b){this.isInteractiveChecked()?(u.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML=
"\x26nbsp;\x26#9650;"):(u.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;");d.publish("filter-expression-change",this)},onClickShowHideInteractive:function(b){this.interactiveCheck.disabled||("none"===u.set(this.interactiveSpace,"display")?(u.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(u.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;"))},onChangeInteractive:function(){d.publish("filter-expression-change",
this)},showValueInput:function(b){this._showValueInput(x.byNode(b.target),this)},showFields:function(b){this._showFields(x.byNode(b.target),this)},showUniqueList:function(b){this._showUniqueList(x.byNode(b.target),this)},onValueChange:function(){this.onValueChangeHandler&&clearTimeout(this.onValueChangeHandler);this.onValueChangeHandler=setTimeout(h.hitch(this,function(){this.onValueChangeHandler=null;d.publish("filter-expression-change",this)}),800)},_showValueInput:function(b,c,a){c.onChangeOperator(b,
c,a);c.enableInteractiveCheck()},_showFields:function(b,c,a){a=c.getFieldsList().item;b=this.fieldsStore.getValue(a,"shortType");a=this.fieldsStore.getValue(a,"name");c.createValueFields(this.fieldsStore,{shortType:b,name:RegExp("^(?!"+a+"$)")},a);c.disableInteractiveCheck()},_showUniqueList:function(b,c,a){this.uniqueValuesStore&&delete this.uniqueValuesStore;a=this.fieldsStore.getValue(c.getFieldsList().item,"name");if(10.1<=this.version||!this.mapLayer.url){var d=null;this.mapLayer.queryServiceUrl?
d=this.mapLayer.queryServiceUrl:this.mapLayer.itemLayers&&l.forEach(this.mapLayer.itemLayers,function(b){b.id===this.layerInfo.id&&b.layerUrl&&(d=b.layerUrl)},this);d||(d=this.mapLayer.url);if(this.uniqueValuesResults[this.mapLayer.id+"_"+a])this.onGenerateRendererResults(c,b,this.uniqueValuesResults[this.mapLayer.id+"_"+a]);else this.generateRendererUniqueValues(a,d,h.hitch(this,"onGenerateRendererResults",c,b),h.hitch(this,function(){this.showValueInput(b,c)}))}else b&&this.showValueInput(b,c)},
onGenerateRendererResults:function(b,c,a){var d=this.fieldsStore.getValue(b.getFieldsList().item,"name"),e=this.fieldsStore.getValue(b.getFieldsList().item,"shortType"),f=this.fieldsStore.getValue(b.getFieldsList().item,"type");this.uniqueValuesResults[this.mapLayer.id+"_"+d]=a;var g=null;l.forEach(this.mapLayer.fields,function(b){b.name===d&&b.domain&&(g=b.domain)});a=l.filter(a,function(b,c){return"string"===e?"\x3cNull\x3e"!==b&&""!==b.trim():"\x3cNull\x3e"!==b&&""!==b});a.length?("date"===e?(a=
l.map(a,function(b){return new Date(b)}),a=a.sort(function(b,c){var a=b.getTime(),d=c.getTime();return a<d?-1:a>d?1:0}),a=l.map(a,function(b){return this.formatFriendlyDate(b)},this)):"number"===e?(a=l.map(a,function(b){return"esriFieldTypeDouble"===f||"esriFieldTypeSingle"===f?parseFloat(b):parseInt(b,10)}),a=a.sort(function(b,c){return b<c?-1:b>c?1:0})):a=a.sort(function(b,c){return b<c?-1:b>c?1:0}),c=l.map(a,function(b,c){var a=b;"string"===e&&(a=""===b?"\x3c"+this.i18n.emptyString+"\x3e":b);if(g&&
g.codedValues){for(var d=0;d<g.codedValues.length;d++){var k=g.codedValues[d];if(b===k.code)return{id:c,name:k.name||a,value:b}}return{id:c,name:""+a,value:b}}if("esriFieldTypeDouble"===f||"esriFieldTypeSingle"===f)a=r.format(b,{pattern:"#####0.##########"});return{id:c,name:""+a,value:b}},this),this.uniqueValuesStore=new z({data:{label:"name",identifier:"id",items:c}}),b.createValueUnique(this.uniqueValuesStore)):this.showValueInput(c,b)},generateRendererUniqueValues:function(b,c,a,d){b instanceof
Array&&(b=b.toString());var e=new O;e.attributeField=b;b=new P;b.classificationDefinition=e;this.mapLayer instanceof Q?c=new K(this.mapLayer):this.mapLayer instanceof L&&!this.mapLayer.url?c=new K(this.mapLayer):this.hasDynamicLayers(this.mapLayer)?(e=this.mapLayer.layerDefinitions&&this.mapLayer.layerDefinitions[this.mapLayer.id]?this.mapLayer.layerDefinitions[this.mapLayer.id]:null,b.where=e?e:null,c=new K(this.mapLayer.url+"/dynamicLayer",{source:this.layerInfo.source})):(e=this.mapLayer.getDefinitionExpression(),
b.where=e?e:null,c=new K(c));J.config.defaults.io.timeout=1E4;c.execute(b,function(b){J.config.defaults.io.timeout=6E4;b=l.map(b.infos,function(b){return b.value});a(b)},h.hitch(this,function(b){J.config.defaults.io.timeout=6E4;d()}))},hasDynamicLayers:function(b){return b&&b.supportsDynamicLayers?!0:!1},formatDate:function(b){return D.format(b,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+D.format(b,{selector:"time",timePattern:"HH:mm:ss"})},formatFriendlyDate:function(b){return D.format(b,{formatLength:"short",
selector:"date"})},parseFriendlyDate:function(b){return D.parse(b,{formatLength:"short",selector:"date"})},parseDate:function(b){var c=D.parse(b,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=D.parse(b.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(c=D.parse(b.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return c},addDay:function(b){return new Date(b.getTime()+this.dayInMS)},subtractDay:function(b){return new Date(b.getTime()-this.dayInMS)},
containsNonLatinCharacter:function(b){for(var c=0;c<b.length;c++)if(255<b.charCodeAt(c))return!0;return!1},buildCodedValuesStore:function(b){b=l.map(b,function(b,c){return{name:b.name,code:b.code,id:c}});return new z({data:{label:"name",identifier:"id",items:b}})},clearAttributeValueDijits:function(){this.valueHandlers&&0!==this.valueHandlers.length&&(l.forEach(this.valueHandlers,h.hitch(this,function(b){d.disconnect(b)})),this.valueHandlers=[],x.byId(this.id+".value")?x.byId(this.id+".value").destroy():
s.byId(this.id+".value")&&this.getAttrValContNode().removeChild(s.byId(this.id+".value")),x.byId(this.id+".value1")?x.byId(this.id+".value1").destroy():s.byId(this.id+".value1")&&this.getAttrValContNode().removeChild(s.byId(this.id+".value1")),x.byId(this.id+".value2")?x.byId(this.id+".value2").destroy():s.byId(this.id+".value2")&&this.getAttrValContNode().removeChild(s.byId(this.id+".value2")),x.byId(this.id+".valueFields")&&x.byId(this.id+".valueFields").destroy(),x.byId(this.id+".valueUnique")&&
x.byId(this.id+".valueUnique").destroy())},checkDefaultOption:function(){w(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(b){x.byNode(b).set("checked",-1<b.className.indexOf("radioValue"))})},disableOptions:function(){w(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(b){x.byNode(b).set("disabled",!0)})},enableOptions:function(){w(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(b){x.byNode(b).set("disabled",!1)})},
checkFieldOption:function(){x.byId(this.id+".radioFields").set("checked",!0)},disableFieldOption:function(){x.byId(this.id+".radioFields").set("disabled",!0)},disableUniqueOption:function(){x.byId(this.id+".radioUnique").set("disabled",!0)},enableInteractiveCheck:function(){this.interactiveCheck.disabled=!1},disableInteractiveCheck:function(){this.interactiveCheck.checked=!1;this.interactiveCheck.disabled=!0},isHostedService:function(b){if(!b)return!1;var c=-1!==b.indexOf(".arcgis.com/");b=-1!==b.indexOf("//services")||
-1!==b.indexOf("//tiles")||-1!==b.indexOf("//features");return c&&b},buildEditUIField:function(b,c,a){this.getFieldItemByName({name:b.fieldObj.name},h.hitch(this,function(d){c.getFieldsList().set("value",d.id[0]);this.buildEditUIOperator(b,c,a)}),h.hitch(this,function(){c.getFieldsList().set("value",0);this.buildEditUIOperator(b,c,a)}))},buildEditUIOperator:function(b,c,a){switch(b.fieldObj.shortType){case "string":c.fillOperatorList(this.stringOperatorStore,b.operator);break;case "date":c.fillOperatorList(this.dateOperatorStore,
b.operator);break;default:c.fillOperatorList(this.numberOperatorStore,b.operator)}this.getOperatorItemByName(c.getOperatorList().store,{name:b.operator},h.hitch(this,function(d){c.getOperatorList().set("value",d.id[0]);this.buildEditUIValue(b,c,a)}),h.hitch(this,function(){c.getOperatorList().set("value",0);this.buildEditUIValue(b,c,a)}))},buildEditUIValue:function(b,c,a){a=b.operator;this.onChangeOperator(c.getOperatorList(),c);c.enableOptions();a===this.i18n.stringOperatorIsBlank||a===this.i18n.dateOperatorIsBlank||
a===this.i18n.numberOperatorIsBlank||a===this.i18n.stringOperatorIsNotBlank||a===this.i18n.dateOperatorIsNotBlank||a===this.i18n.numberOperatorIsNotBlank?(c.createValueIsBlank(),c.disableOptions()):"field"===b.valueObj.type?(c.createValueFields(this.fieldsStore,{shortType:b.fieldObj.shortType,name:RegExp("^(?!"+b.fieldObj.name+"$)")}),c.checkFieldOption(),this.getFieldItemByName({name:b.valueObj.value},h.hitch(this,function(b){c.setValueFieldById(b.id[0])}),h.hitch(this,function(){c.setValueFieldById(0)}))):
G.isDefined(b.valueObj.value1)?(c.setValue1(b.valueObj.value1),c.setValue2(b.valueObj.value2)):c.setValue(b.valueObj.value,this.getCodedValues(b.fieldObj.name))},getFieldItemByName:function(b,c,a){this.fieldsStore.fetch({query:b,onComplete:h.hitch(this,function(b){b&&b.length?c(b[0]):a()})})},getOperatorItemByName:function(b,c,a,d){b.fetch({query:c,onComplete:h.hitch(this,function(b){b&&b.length?a(b[0]):d()})})}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/when","./MappedTextBox","./ComboBoxMixin"],function(p,e,h,l,d){return p("dijit.form.FilteringSelect",[l,d],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(a,d,e,g){d&&d[this.searchAttr]!==this._lastQuery||!d&&a.length&&this.store.getIdentity(a[0])!=this._lastQuery||(a.length?this.set("item",
a[0],g):this.set("value","",g||void 0===g&&!this.focused,this.textbox.value,null))},_openResultList:function(a,d,e){d[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(a,d,l,g){this._onChangeActive||(d=null);if(void 0===g){if(null===a||""===a)if(a="",!e.isString(l)){this._setDisplayedValueAttr(l||"",d);return}var p=this;this._lastQuery=
a;h(this.store.get(a),function(a){p._callbackSetLabel(a?[a]:[],void 0,void 0,d)})}else this.valueNode.value=a,this.inherited(arguments,[a,d,l,g])},_setItemAttr:function(a,d,e){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(a){return a.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(a,d){null==a&&(a="");if(!this._created){if(!("displayedValue"in this.params))return;d=!1}if(this.store){this.closeDropDown();var l=e.clone(this.query),
g=this._getDisplayQueryString(a),p;this.store._oldAPI?p=g:(p=this._patternToRegExp(g),p.toString=function(){return g});this._lastQuery=l[this.searchAttr]=p;this._lastDisplayedValue=this.textbox.value=a;this._set("displayedValue",a);var s=this,u={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};e.mixin(u,this.fetchProperties);this._fetchHandle=this.store.query(l,u);h(this._fetchHandle,function(a){s._fetchHandle=null;s._callbackSetLabel(a||[],l,u,d)},function(a){s._fetchHandle=null;s._cancelingQuery||
console.error("dijit.form.FilteringSelect: "+a.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(p,e,h){return p("dijit.form.RadioButton",[e,h],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),function(p,e,h,l,d,a){return e("dijit.form._RadioButtonMixin",
null,{type:"radio",_getRelatedWidgets:function(){var e=[];d("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(l.hitch(this,function(d){d.name==this.name&&d.form==this.focusNode.form&&(d=a.getEnclosingWidget(d))&&e.push(d)}));return e},_setCheckedAttr:function(a){this.inherited(arguments);this._created&&a&&p.forEach(this._getRelatedWidgets(),l.hitch(this,function(a){a!=this&&a.checked&&a.set("checked",!1)}))},_getSubmitValue:function(a){return null==a?"on":a},_onClick:function(a){if(this.checked||
this.disabled)return a.stopPropagation(),a.preventDefault(),!1;if(this.readOnly)return a.stopPropagation(),a.preventDefault(),p.forEach(this._getRelatedWidgets(),l.hitch(this,function(a){h.set(this.focusNode||this.domNode,"checked",a.checked)})),!1;var d=!1,e;p.some(this._getRelatedWidgets(),function(a){return a.checked?(e=a,!0):!1});this.checked=!0;e&&(e.checked=!1);if(!1===this.onClick(a)||a.defaultPrevented)d=!0;this.checked=!1;e&&(e.checked=!0);d?a.preventDefault():this.set("checked",!0);return!d}})})},
"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(p,e,h){return p("dijit.form.DateTextBox",h,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:e,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f){var v=l("dijit.Calendar",[q,m,w],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){y.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new v._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:r.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(s(this.domNode,"keydown",r.hitch(this,"_onKeyDown")),s(this.dateRowsNode,"mouseover",r.hitch(this,"_onDayMouseOver")),s(this.dateRowsNode,"mouseout",r.hitch(this,"_onDayMouseOut")),s(this.dateRowsNode,"mousedown",r.hitch(this,"_onDayMouseDown")),s(this.dateRowsNode,"mouseup",r.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var d=
new this.dateClassObj(this.currentFocus);d.setDate(1);d.setMonth(a);a=this.dateModule.getDaysInMonth(d);var e=this.currentFocus.getDate();d.setDate(Math.min(e,a));this._setCurrentFocusAttr(d)},_onDayMouseOver:function(d){if((d=a.contains(d.target,"dijitCalendarDateLabel")?d.target.parentNode:d.target)&&(d.dijitDateValue&&!a.contains(d,"dijitCalendarDisabledDate")||d==this.previousYearLabelNode||d==this.nextYearLabelNode))a.add(d,"dijitCalendarHoveredDate"),this._currentNode=d},_onDayMouseOut:function(d){this._currentNode&&
!(d.relatedTarget&&d.relatedTarget.parentNode==this._currentNode)&&(d="dijitCalendarHoveredDate",a.contains(this._currentNode,"dijitCalendarActiveDate")&&(d+=" dijitCalendarActiveDate"),a.remove(this._currentNode,d),this._currentNode=null)},_onDayMouseDown:function(d){if((d=d.target.parentNode)&&d.dijitDateValue&&!a.contains(d,"dijitCalendarDisabledDate"))a.add(d,"dijitCalendarActiveDate"),this._currentNode=d},_onDayMouseUp:function(d){(d=d.target.parentNode)&&d.dijitDateValue&&a.remove(d,"dijitCalendarActiveDate")},
handleKey:function(a){var d=-1,e,f=this.currentFocus;switch(a.keyCode){case g.RIGHT_ARROW:d=1;case g.LEFT_ARROW:e="day";this.isLeftToRight()||(d*=-1);break;case g.DOWN_ARROW:d=1;case g.UP_ARROW:e="week";break;case g.PAGE_DOWN:d=1;case g.PAGE_UP:e=a.ctrlKey||a.altKey?"year":"month";break;case g.END:f=this.dateModule.add(f,"month",1),e="day";case g.HOME:f=new this.dateClassObj(f);f.setDate(1);break;default:return!0}e&&(f=this.dateModule.add(f,e,d));this._setCurrentFocusAttr(f);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});v._MonthDropDownButton=l("dijit.Calendar._MonthDropDownButton",f,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new v._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(a){var d=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.dropDown.set("months",
d);this.containerNode.innerHTML=(6==u("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+d[a.getMonth()]+"\x3c/div\x3e"}});v._MonthDropDown=l("dijit.Calendar._MonthDropDown",[m,B,w],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";p.forEach(a,function(a,d){t.create("div",{className:"dijitCalendarMonthLabel",month:d,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(d.get(a.target,"month"))},onChange:function(){}});return v})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w){var B=e("dijit.CalendarLite",[q,m],{templateString:w,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var d=
new this.dateClassObj(a);d.setHours(0,0,0,0);d.getDate()<a.getDate()&&(d=this.dateModule.add(d,"hour",1));return d}return null},_setValueAttr:function(d,e){"string"==typeof d&&(d=a.fromISOString(d));d=this._patchDate(d);if(this._isValidDate(d)&&!this.isDisabledDate(d,this.lang)){if(this._set("value",d),this.set("currentFocus",d),this._markSelectedDates([d]),this._created&&(e||"undefined"==typeof e))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){a&&
(a=new this.dateClassObj(a),a.setHours(1,0,0,0));return a},_setText:function(a,d){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(d))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),d=a.getDay(),e=this.dateModule.getDaysInMonth(a),g=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),l=new this.dateClassObj,m=0<=this.dayOffset?this.dayOffset:h.getFirstDayOfWeek(this.lang);m>d&&
(m-=7);if(!this.summary){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",c[a.getMonth()])}this._date2cell={};p.forEach(this.dateCells,function(c,k){var h=k+m,q=new this.dateClassObj(a),p="dijitCalendar",s=0;h<d?(h=g-d+h+1,s=-1,p+="Previous"):h>=d+e?(h=h-d-e+1,s=1,p+="Next"):(h=h-d+1,p+="Current");s&&(q=this.dateModule.add(q,"month",s));q.setDate(h);this.dateModule.compare(q,l,"date")||(p="dijitCalendarCurrentDate "+p);this.isDisabledDate(q,
this.lang)?(p="dijitCalendarDisabledDate "+p,c.setAttribute("aria-disabled","true")):(p="dijitCalendarEnabledDate "+p,c.removeAttribute("aria-disabled"),c.setAttribute("aria-selected","false"));(s=this.getClassForDate(q,this.lang))&&(p=s+" "+p);c.className=p+"Month dijitCalendarDateTemplate";p=q.valueOf();this._date2cell[p]=c;c.dijitDateValue=p;this._setText(this.dateLabels[k],q.getDateLocalized?q.getDateLocalized(this.lang):q.getDate())},this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);
a.setDate(1);this.monthWidget.set("month",a);var d=a.getFullYear()-1,e=new this.dateClassObj;p.forEach(["previous","current","next"],function(a){e.setFullYear(d++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(e,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?g.getObject(a.datePackage,!1):l;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?
g.getObject(a.datePackage+".locale",!1):d},_createMonthWidget:function(){return B._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var a=this.dowTemplateString,d=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),e=0<=this.dayOffset?this.dayOffset:h.getFirstDayOfWeek(this.lang);this.dayCellsHtml=u.substitute([a,a,a,a,a,a,a].join(""),{d:""},function(){return d[e++%7]});a=u.substitute(this.weekTemplateString,
{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);t.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=g.hitch(this,function(a,d,e){this[a].dojoClick=!0;return r(this[a],"click",g.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,
d,e))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,d){var e=this.currentFocus,g=this._getNodeByDate(e);a=this._patchDate(a);this._set("currentFocus",a);if(!this._date2cell||0!=this.dateModule.difference(e,a,"month"))this._populateGrid(),this._populateControls(),this._markSelectedDates([this.value]);e=this._getNodeByDate(a);e.setAttribute("tabIndex",this.tabIndex);(this.focused||
d)&&e.focus();g&&g!=e&&(s("webkit")?g.setAttribute("tabIndex","-1"):g.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue;a=a.parentNode);a&&!y.contains(a,"dijitCalendarDisabledDate")&&this.set("value",a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function d(a,
e){y.toggle(e,"dijitCalendarSelectedDate",a);e.setAttribute("aria-selected",a?"true":"false")}p.forEach(this._selectedCells||[],g.partial(d,!1));this._selectedCells=p.filter(p.map(a,this._getNodeByDate,this),function(a){return a});p.forEach(this._selectedCells,g.partial(d,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});B._MonthWidget=e("dijit.CalendarLite._MonthWidget",q,{_setMonthAttr:function(a){var d=this.dateLocaleModule.getNames("months","wide","standAlone",
this.lang,a),e=6==s("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+p.map(d,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=e+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+d[a.getMonth()]+"\x3c/div\x3e"}});return B})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(p,e,h,l,d,a,t,y){new Date("X");return l("dijit.form._DateTimeTextBox",[a,t],{templateString:y,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:e.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(a,d){var e=this._isInvalidDate(a),h=this._isInvalidDate(d);if(e||h)return e&&h?0:!e?1:-1;var e=this.format(a,this._unboundedConstraints),h=this.format(d,this._unboundedConstraints),
l=this.parse(e,this._unboundedConstraints),m=this.parse(h,this._unboundedConstraints);return e==h?0:p.compare(l,m,this._selector)},autoWidth:!0,format:function(a,d){return!a?"":this.dateLocaleModule.format(a,d)},parse:function(a,d){return this.dateLocaleModule.parse(a,d)||(this._isEmpty(a)?null:void 0)},serialize:function(a,d){a.toGregorian&&(a=a.toGregorian());return h.toISOString(a,d)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(a){a=
a||{};this.dateModule=a.datePackage?d.getObject(a.datePackage,!1):p;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=a.datePackage?d.getObject(a.datePackage+".locale",!1):e;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(a){a.selector=this._selector;a.fullYear=!0;var e=h.fromISOString;"string"==typeof a.min&&(a.min=e(a.min),this.dateClassObj instanceof Date||(a.min=new this.dateClassObj(a.min)));"string"==typeof a.max&&(a.max=e(a.max),this.dateClassObj instanceof Date||(a.max=new this.dateClassObj(a.max)));this.inherited(arguments);this._unboundedConstraints=d.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(a){return!a||
isNaN(a)||"object"!=typeof a||a.toString()==this._invalidDate},_setValueAttr:function(a,d,e){void 0!==a&&("string"==typeof a&&(a=h.fromISOString(a)),this._isInvalidDate(a)&&(a=null),a instanceof Date&&!(this.dateClassObj instanceof Date)&&(a=new this.dateClassObj(a)));this.inherited(arguments,[a,d,e]);this.value instanceof Date&&(this.filterString="");!1!==d&&this.dropDown&&this.dropDown.set("value",a,!1)},_set:function(a,d){if("value"==a){d instanceof Date&&!(this.dateClassObj instanceof Date)&&
(d=new this.dateClassObj(d));var e=this._get("value");if(e instanceof this.dateClassObj&&0==this.compare(d,e))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(a){this._isInvalidDate(a)&&(a=new this.dateClassObj);this._set("dropDownDefaultValue",a)},openDropDown:function(a){this.dropDown&&this.dropDown.destroy();var e=d.isString(this.popupClass)?d.getObject(this.popupClass,!1):this.popupClass,h=this,l=this.get("value");this.dropDown=new e({onChange:function(a){h.set("value",
a,!0)},id:this.id+"_popup",dir:h.dir,lang:h.lang,value:l,textDir:h.textDir,currentFocus:!this._isInvalidDate(l)?l:this.dropDownDefaultValue,constraints:h.constraints,filterString:h.filterString,datePackage:h.datePackage,isDisabledDate:function(a){return!h.rangeCheck(a,h.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(a,d){this._setValueAttr(this.parse(a,this.constraints),d,a)}})})},"esri/tasks/GenerateRendererTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/number dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ../urlUtils ../renderers/jsonUtils ./StatisticDefinition ./Task ./QueryTask ./query require require require require require require require".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f){return e(w,{declaredClass:"esri.tasks.GenerateRendererTask",_eventMap:{complete:["renderer"]},constructor:function(a,d){h.isObject(a)&&("esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?a.url&&h.isString(a.url)&&"esri.layers.CSVLayer"!==a.declaredClass?(this.url=a.url,this._url=u.urlToObject(this.url),this._url.path+="/generateRenderer"):this._features=a.graphics:(this.url=a,this._url.path+="/generateRenderer");this._handler=
h.hitch(this,this._handler);this.source=d&&d.source;this.gdbVersion=d&&d.gdbVersion;this.checkValueRange=d&&d.checkValueRange;this.registerConnectEvents()},_handler:function(a,d,e,g,l){try{var c;"esri.renderer.ClassBreaksRenderer"===a.declaredClass||"esri.renderer.UniqueValueRenderer"===a.declaredClass?c=a:(c=q.fromJson(a),"classBreaks"===a.type&&c.setMaxInclusive(!0));if(this.checkValueRange){var n=new B(this.url),k=new f,p=new m;p.statisticType="min";p.onStatisticField=this._field;var s=new m;s.statisticType=
"max";s.onStatisticField=this._field;k.outStatistics=[p,s];n.execute(k).then(h.hitch(this,function(a){a=a.features[0].attributes;for(var d in a)if(0===d.toLowerCase().indexOf("min"))var f=a[d];else var k=a[d];c=this._processRenderer(c,this._prefix,this._unitLabel,this._formatLabel,this._precision,f,k);this._successHandler([c],"onComplete",e,l)}))}else c=this._processRenderer(c,this._prefix,this._unitLabel,this._formatLabel,this._precision),this._successHandler([c],"onComplete",e,l)}catch(t){this._errorHandler(t,
g,l)}},_processRenderer:function(a,e,f,h,g,c,n){"esri.renderer.ClassBreaksRenderer"===a.declaredClass?l.forEach(a.infos,function(k,l){0===l&&(void 0!==c&&null!==c)&&(k.minValue=c);l===a.infos.length-1&&(void 0!==n&&null!==n)&&(k.classMaxValue=k.maxValue=n);g&&(k.classMaxValue=k.maxValue=Math.round(k.maxValue/g)*g,k.minValue=Math.round(k.minValue/g)*g);h&&(k.label=d.format(k.minValue)+" - "+d.format(k.maxValue));e&&(k.label=e+" "+k.label);f&&(k.label=k.label+" "+f)}):l.forEach(a.infos,function(k,g){0===
g&&(void 0!==c&&null!==c)&&(k.value=c);g===a.infos.length-1&&(void 0!==n&&null!==n)&&(k.value=n);h&&(k.label=d.format(k.value));e&&(k.label=e+" "+k.label);f&&(k.label=k.label+" "+f)});return a},execute:function(d,e,f){var g,l=this._handler,c=this._errorHandler;this._precision=d.precision;this._prefix=d.prefix;this._unitLabel=d.unitLabel;this._formatLabel=d.formatLabel;if(this._features=d.features||this._features){g=new t;var n=this._features;p(["./generateRenderer"],function(a){var k;"esri.tasks.ClassBreaksDefinition"===
d.classificationDefinition.declaredClass?k=a.createClassBreaksRenderer({features:n,definition:d.classificationDefinition}):"esri.tasks.UniqueValueDefinition"===d.classificationDefinition.declaredClass&&(k=a.createUniqueValueRenderer({features:n,definition:d.classificationDefinition}));k?l(k,null,e,f,g):c(null,f,g)})}else{var k=h.mixin(d.toJson(),{f:"json"});this._field="esri.tasks.ClassBreaksDefinition"===d.classificationDefinition.declaredClass?d.classificationDefinition.classificationField:d.classificationDefinition.attributeField;
if(this.source){var m={source:this.source.toJson()};k.layer=a.toJson(m)}this.gdbVersion&&(k.gdbVersion=this.gdbVersion);g=new t(s._dfdCanceller);g._pendingDfd=r({url:this._url.path,content:k,callbackParamName:"callback",load:function(a,c){l(a,c,e,f,g)},error:function(a){c(a,f,g)}})}return g},onComplete:function(){}})})},"esri/tasks/UniqueValueDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./ClassificationDefinition"],function(p,e,h,l,d){return p(d,{declaredClass:"esri.tasks.UniqueValueDefinition",
type:"uniqueValueDef",attributeField:null,attributeField2:null,attributeField3:null,fieldDelimiter:null,toJson:function(){var a=this.inherited(arguments);this.uniqueValueFields=[];this.attributeField&&this.uniqueValueFields.push(this.attributeField);this.attributeField2&&this.uniqueValueFields.push(this.attributeField2);this.attributeField3&&this.uniqueValueFields.push(this.attributeField3);e.mixin(a,{type:this.type,uniqueValueFields:this.uniqueValueFields});this.fieldDelimiter&&e.mixin(a,{fieldDelimiter:this.fieldDelimiter});
return a}})})},"esri/tasks/ClassificationDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,e,h,l){return p(null,{declaredClass:"esri.tasks.ClassificationDefinition",type:null,baseSymbol:null,colorRamp:null,toJson:function(){var d={};this.baseSymbol&&e.mixin(d,{baseSymbol:this.baseSymbol.toJson()});this.colorRamp&&!e.isString(this.colorRamp)&&e.mixin(d,{colorRamp:this.colorRamp.toJson()});return d}})})},"esri/tasks/GenerateRendererParameters":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(p,e,h,l,d){return p(null,{declaredClass:"esri.tasks.GenerateRendererParameters",classificationDefinition:null,where:null,precision:null,prefix:null,unitLabel:null,formatLabel:null,toJson:function(){return{classificationDef:h.toJson(this.classificationDefinition.toJson()),where:this.where}}})})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../config ../request ./ServiceGeneratedFeatureCollection".split(" "),
function(p,e,h,l,d,a,t,y){return p([y],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(d,e){a.defaults.geoRSSService&&(this.serviceUrl=a.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=t({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?h.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(a){this.inherited(arguments);
this.loaded||(this.loaded=!0,this.onLoad(this))}})})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/webMercatorUtils ../renderers/SimpleRenderer ./layer ./FeatureLayer ../dijit/PopupTemplate".split(" "),function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w){return p([q],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",
constructor:function(a,d){this.pointSymbol=d&&d.pointSymbol;this.polylineSymbol=d&&d.polylineSymbol;this.polygonSymbol=d&&d.polygonSymbol;this._outSR=d&&(d.outSpatialReference||d.outSR)||new g({wkid:4326});this._options=h.mixin({},d)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var a=[];this._fLayers&&(a=a.concat(this._fLayers));return a},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&(this._map&&!this._io&&
this.visible)&&this._createLayer()},_createLayer:function(a){var d=this;this._fireUpdateStart();a=this.parse(a);a.addCallback(function(a){d._io=null;d._initLayer(a)});a.addErrback(function(a){d._io=null;a=h.mixin(Error(),a);a.message="Unable to load resource: "+d.url+" "+(a.message||"");d._fireUpdateEnd(a);d.onError(a)})},_initLayer:function(a){this.loaded&&this._removeInternalLayers();this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.defaultVisibility=void 0!==a.visibility?
this.visible=!!a.visibility:this.visible=!0;this.featureInfos=a.featureInfos;this.fullExtent=this.initialExtent=new r(a.lookAtExtent);this.copyright=a.author||a.copyright;var d;if((a=h.getObject("featureCollection.layers",!1,a))&&0<a.length)this._fLayers=[],l.forEach(a,function(a,e){var g=h.getObject("featureSet.features",!1,a);g&&0<g.length&&(d=h.mixin({outFields:["*"],infoTemplate:a.popupInfo?new w(a.popupInfo):null,editable:!1},this._options),d.id&&(d.id=d.id+"_"+e),a.layerDefinition.capabilities=
"Query,Data",g=new m(a,d),g.geometryType&&(this["_"+g.geometryType]=g),this._fLayers.push(g))},this),0===this._fLayers.length&&delete this._fLayers;this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(a=new u(this.pointSymbol),this._esriGeometryPoint.setRenderer(a)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(a=new u(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(a)));
this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),this.polygonSymbol&&(a=new u(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(a)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();var d=a.spatialReference,e=this._outSR,g;if(d.wkid)g=d._isWebMercator()&&e._isWebMercator()||d.wkid===e.wkid;else if(d.wkt)g=d.wkt===e.wkt;else{console.log("_setMap - map has invalid spatial reference");
return}if(!g)if(d._isWebMercator()&&4326===e.wkid)this._converter=s.geographicToWebMercator;else if(e._isWebMercator()&&4326===d.wkid)this._converter=s.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(d=this._fLayers)&&0<d.length&&l.forEach(d,function(d){if(this._converter){var e=d.graphics,f,c,g=e?e.length:0;for(f=0;f<g;f++)(c=e[f].geometry)&&e[f].setGeometry(this._converter(c))}a.addLayer(d)},
this);this.setVisibility(this.visible);this._fireUpdateEnd()},_removeInternalLayers:function(){var a=this._map;a&&l.forEach(this.getFeatureLayers(),a.removeLayer,a)},setScaleRange:function(a,d){this.inherited(arguments);l.forEach(this.getFeatureLayers(),function(e){e.setScaleRange(a,d)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(a){this.opacity!=a&&(l.forEach(this.getFeatureLayers(),function(d){d.setOpacity(a)}),this.opacity=this._options.opacity=
a,this.onOpacityChange(a))},onVisibilityChange:function(a){this._fireUpdateStart();l.forEach(this.getFeatureLayers(),function(d){d.setVisibility(a)});this._fireUpdateEnd()},_setMap:function(e,f){this.inherited(arguments);this._map=e;var g=this._div=d.create("div",null,f);a.set(g,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return g},_unsetMap:function(a,f){this._io&&this._io.cancel();e.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();
var g=this._div;g&&(f.removeChild(g),d.destroy(g));this._div=null;this.inherited(arguments)}})})},"esri/dijit/analysis/FeatureRecordSetLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../tasks/DataFile","../../kernel"],function(p,e,h,l,d){return p(l,{declaredClass:"esri.dijit.analysis.FeatureRecordSetLayer",constructor:function(a){a&&e.mixin(this,a)},toJson:function(){var a={};this.url&&(a.url=this.url);return a}})})},"esri/dijit/analysis/PluginLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/Deferred dojo/promise/all dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-style dojo/query dojo/store/Memory dojo/store/Observable dojo/Evented dojo/has ../../request ../../kernel ../../lang dgrid/OnDemandGrid dgrid/Selection dojo/i18n!../../nls/jsapi".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f,v,z,D,F){var E=p([m],{infoPanelTemplate:'\x3cdiv\x3e\x3cdiv class\x3d"template-info-showing"\x3e\x3cdiv\x3e\x3cimg width\x3d\'16px\' height\x3d\'16px\' alt\x3d\'\' src\x3d\'${item.iconUrl}\'\x3e\x3c/div\x3e\x3ch4\x3e${item.title}\x3c/h4\x3e\x3cdiv class\x3d"template-info"\x3e\x3cp class\x3d""\x3e${item.snippet}\x3c/p\x3e${item:plugIn._showLayers}\x3cdiv id\x3d"${item.id}_details" class\x3d"quiet-scroll layer-container"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-actions"\x3e${item:plugIn._addLayerToMap}\x3cbutton class\x3d"btn blue btn-main disabled" id\x3d"add-layer"\x3e${i18n.common.addLayerBtnLabel}\x3c/button\x3e\x3cbutton class\x3d"btn btn-cancel" id\x3d"close-panel"\x3e${i18n.common.close}\x3c/button\x3e\x3c/div\x3e\x3cdiv\x3e',
geometryTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],checkTimeFilter:!1,constructor:function(a){e.mixin(this,a);this.filters={all:{},mycontent:{owners:[this.self.user.username]}};this.i18n=e.mixin({},F.browseLayersDlg);e.mixin(this.i18n,F.browseItems);e.mixin(this.i18n,F.common);this.filterStrings={all:{title:this.self&&this.self.isPortal?this.i18n.items.portalOrg:this.i18n.items.organizationLabel},mycontent:{title:this.i18n.items.contentLabel}}},
fetchData:function(){this._portal=this.parent._portal;this._user=this._portal.getPortalUser();this.filters.mycontent.owner=this._user;return this._fetchItems()},_fetchItems:function(){return this.parent._fetchItems({types:['type:"Map Service"','type:"Feature Service"']})},_fetchServiceInfo:function(a){var f=new d,g,h={f:"json",token:this._portal.user.credential.token};a.url?B({url:a.url,content:h}).then(function(a){f.resolve(a)},e.hitch(this,function(d){g=d.details&&d.details.length?d.details.shift():
"";d&&403===d.httpCode&&-1<g.indexOf("SSL Required")?(a.set("url",a.url.replace("http:","https:")),this._fetchServiceInfo(a).then(function(a){f.resolve(a)})):(a.isLoaded=!0,f.resolve({error:d}))})):f.resolve(null);return f},_addLayerToMap:function(a){return"Big Data File Share"===a.type?"":'\x3cdiv class\x3d"left gutter-left-1 padding-trailer-half js-add-layer-node"\x3e\x3clabel\x3e\x3cinput name\x3d"addlayertomap" class\x3d"js-add-layer-checkbox" type\x3d"checkbox"\x3e\x3cspan class\x3d"gutter-left-1"\x3e'+
this.i18n.common.addLayer+"\x3c/span\x3e\x3c/label\x3e\x3c/div\x3e"},_showLayers:function(a){a&&-1!==h.indexOf(["Feature Service","Map Service","Image Service","Big Data File Share"],a.type)&&this.plugIn._fetchServiceInfo(a).then(e.hitch(this,function(d){var f,g={f:"json",token:this._portal.user.credential.token};d.layers&&(f=d.layers);d.children&&(f=d.children);this.plugIn._createLayerGrid(l.create("div",null,t.byId(a.id+"_details")));h.forEach(f,function(d,f){d.url="Big Data File Share"===a.type?
a.url+"/"+d.name:a.url+"/"+f;B({url:d.url,content:g}).then(e.hitch(this,function(a){d=e.mixin(d,a);this.plugIn._store.put(d);this.plugIn._grid.refresh()}))},this)}));return""},_getLayerHead:function(){return"\x3ctr\x3e\x3cth\x3e\x3c/th\x3e\x3cth\x3eLayer Name\x3c/th\x3e\x3cth\x3e Geometry Type\x3c/th\x3e\x3c/tr\x3e"},_getLayerNode:function(a,d,e){d=a.name;var f='\x3ctr\x3e\x3ctd\x3e\x3cinput type\x3d"checkbox" class\x3d"js-layer-check" name\x3d"layers" value\x3d"'+d+' checked"\x3e\x3c/td\x3e\x3ctd\x3e',
g="\x3c/td\x3e\x3ctd\x3e"+a.geometryType+"\x3c/td\x3e\x3c/tr\x3e";return a.itemUrl||a.url?f+'\x3ca class\x3d"'+(e||"")+'"\x3e'+d+"\x3c/a\x3e"+g:f+d+g},_createLayerGrid:function(a){var d=p([z,D]);this._store=q(new u({idProperty:"name"}));this._grid=new d({store:this._store,query:e.hitch(this,function(a){var c=!0,d;this.checkTimeFilter&&(c=v.isDefined(a.timeInfo)&&v.isDefined(a.timeInfo.startTimeField)&&!v.isDefined(a.timeInfo.endTimeField)||v.isDefined(a.time)&&v.isDefined(a.time.timeType)&&"instant"===
a.time.timeType);d=a&&-1!==h.indexOf(this.geometryTypes,a.geometryType)&&c;s(".js-add-layer-checkbox",this.parent.infoPanel).forEach(function(a){y.set(a,"disabled",!d)},this);return d}),selectionMode:"single","class":"esriAnalysisLayersGrid",noDataMessage:this.i18n.noValidLayerMsg,allowSelect:e.hitch(this,function(a){return a&&a.data&&-1!==h.indexOf(this.geometryTypes,a.data.geometryType)}),renderRow:e.hitch(this,this._renderer)},a);this._grid.startup();this._grid.on("dgrid-select,dgrid-deselect",
e.hitch(this,function(a){a=a.grid.selection;var c,d=[];for(c in a)a[c]&&d.push(this._grid.row(c).data);c={selection:d};s(".panel-actions .btn-main",this.parent.infoPanel).forEach(function(a){g.toggle(a,"disabled",0===d.length)},this);this._selectedLayer=d[0];this.emit("layer-change",c)}))},hasTimeInfo:function(a){return a&&a.timeInfo},getDateFields:function(a){return h.filter(a&&a.fields||[],function(a){return a&&"esriFieldTypeDate"===a.type})},_renderer:function(a){a.snippet=a.snippet||"";var d=
l.create("div"),e=this._getLabel(a.geometryType);l.place('\x3cdiv class\x3d"panel panel-white panel-bordered panel-compact border-bottom-clear"\x3e\x3ch5 class\x3d"trailer-0 font-size-0 word-break"\x3e\x3ca\x3e'+a.name+'\x3c/a\x3e\x3c/h5\x3e\x3cnav class\x3d"inline-block"\x3e\x3ca class\x3d"link-gray font-size--3 gutter-right-1 '+e.icon+'"\x3e'+e.name+"\x3c/a\x3e"+(a.timeInfo||a.time&&"instant"===a.time.timeType?'\x3ca class\x3d"link-gray esri-icon-time-clock  font-size--3 gutter-right-1" data-action\x3d"timeSettings" data-layerid\x3d"0"\x3e'+
this.i18n.timeEnabled+"\x3c/a\x3e":'\x3ca class\x3d"gutter-right-1"\x3e\x3c/a\x3e')+"\x3c/nav\x3e\x3c/div\x3e",d);5<this._grid.store.data.length&&r.set(this._grid.domNode,"height","30em");return d},_getLabel:function(a){var d={};"esriGeometryPoint"===a||"esriGeometryMultipoint"===a?(d.name=this.i18n.points,d.icon="esri-icon-map-pin"):"esriGeometryPolygon"===a?(d.name=this.i18n.areas,d.icon="esri-icon-left-triangle"):"esriGeometryPolyline"===a&&(d.name=this.i18n.lines,d.icon="esri-icon-down-arrow");
return d}});e.mixin(E,{add:function(a,d){if(!a.plugIn){var e=d||{};e.parent=a;e.self=a.self;a.plugIn=new E(e)}},remove:function(a){a.plugIn&&(a.plugIn.destroy(),delete a.plugIn)}});return E})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(p,e,h,l,d,a,t){return p([a,t],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(a,d){this._initialize(a,
d);this.useMapImage=d&&d.useMapImage||!1},refresh:function(a){if(a)this.inherited(arguments);else{var d=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=d}},exportMapImage:function(a,g){var h=d.defaults.map,h=e.mixin({size:h.width+","+h.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete h._ts;this._exportMapImage(this._url.path+"/exportImage",h,g)}})})},"jimu/dijit/ExportChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/ExportChooser.html dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/on dojo/Evented".split(" "),
function(p,e,h,l,d,a,t,y,g,r,s,u,q){return p([e,h,l,q],{templateString:d,baseClass:"jimu-export-chooser",declaredClass:"jimu.dijit.ExportChooser",dataSource:null,nls:null,postMixInProperties:function(){this.nls=window.jimuNls.exportTo},postCreate:function(){this.inherited(arguments);if(this.dataSource){var d=this.dataSource.getSupportExportFormats();0<d.length&&(this.initFormats(d),this.own(u(this.exportFormats,"click",a.hitch(this,this._onFormatClick))),this.own(u(this.exportMask,"click",a.hitch(this,
this.hide))))}},initFormats:function(a){t.forEach(a,function(a){a=y.create("div",{"class":"export-item jimu-ellipsis","data-value":a.value,innerHTML:a.label});y.place(a,this.exportFormats)},this)},_onFormatClick:function(a){a.preventDefault();a.stopPropagation();a=a.target||a.srcElement;g.contains(a,"export-item")&&(this.hide(),a=a.getAttribute("data-value"),this.dataSource.setFormat(a),this.dataSource.download(),this.emit("start-downloading",a))},show:function(a,d){var e;r.set(this.domNode,{left:"-1000px",
top:"0px",display:"block"});e=s.getMarginSize(this.domNode);r.set(this.domNode,{left:(window.isRTL?a+e.w>window.innerWidth?window.innerWidth-e.w:0>a?0:a:0>a-e.w?0:a>window.innerWidth?window.innerWidth-e.w:a-e.w)+"px",top:(e.h>window.innerHeight?0:d+e.h>window.innerHeight?window.innerHeight-e.h:d+e.h+5<window.innerHeight?d+5:d)+"px"})},hide:function(){r.set(this.domNode,"display","none")}})})},"widgets/Analysis/layerUtil":function(){define("dojo/_base/array dojo/promise/all dojo/Deferred esri/layers/FeatureLayer esri/layers/GeoRSSLayer jimu/LayerInfos/LayerInfos".split(" "),
function(p,e,h,l,d,a){return{getLayerObjects:function(t){var y=new h;a.getInstance(t,t.itemInfo).then(function(a){var h=[];a.traversal(function(a){h.push(a)});a=p.map(h,function(a){return a.getLayerType().then(function(d){"GeoRSSLayer"===d&&(a.isLeaf()||p.forEach(a.getSubLayers(),function(a){a.layerObject.name||(a.layerObject.name=a.title)}));return a.getLayerObject()})});return e(a).then(function(a){var e=[];p.forEach(a,function(a,g){if(a instanceof l&&"esri.layers.StreamLayer"!==a.declaredClass||
a instanceof d)a.id=a.id||h[g].id,e.push(a)});y.resolve(e)})},function(){y.resolve([])});return y}}})},"widgets/Analysis/toolValidate":function(){define(["dojo/_base/lang","dojo/_base/array"],function(p,e){return{isValid:function(e,l,d){var a=!1;-1!==l.dijitID.indexOf("MergeLayers")?a=this.mergeAvailable(e):-1!==l.dijitID.indexOf("ExtractData")?a=this.extractAvailable(e,d):(d=null,"requiredParam"in l&&(d=l.requiredParam),a=this.paramAvailable(e,l.analysisLayer,d));return a},mergeAvailable:function(h){return e.some(h,
function(l){return e.some(h,function(d){return d!==l&&d.geometryType===l.geometryType})})},extractAvailable:function(h,l){var d,a=!1;e.forEach(h,function(e){var h="esri.layers.GeoRSSLayer"===e.declaredClass,g="esri.layers.CSVLayer"===e.declaredClass,p="esri.layers.FeatureLayer"===e.declaredClass;p&&!e.url||h||g?a=this._addExtractCapability(e):p&&e.url&&(d=l.getUser(),l.isAdmin()&&-1<e.url.indexOf("/"+d.orgId+"/")&&(a=this._addExtractCapability(e)))},this);return a},_addExtractCapability:function(e){e.capabilities?
-1===e.capabilities.indexOf("Extract")&&(e.capabilities+=",Extract"):e.capabilities="Extract";return!0},paramAvailable:function(e,l,d){var a,p=!1;a=l.geomTypes;l=this.findMatchedFeatureLayers(e,a);0<l.length&&(d?(a=d.geomTypes,e=this.findMatchedFeatureLayers(e,a),0<e.length&&(l.length!==e.length?p=!0:1<l.length?p=!0:l[0]!==e[0]&&(p=!0))):p=!0);return p},findMatchedFeatureLayers:function(h,l){var d=[];e.forEach(h,p.hitch(this,function(a){a&&(1===l.length?("*"===l[0]||l[0]===a.geometryType)&&d.push(a.id):
-1<l.indexOf(a.geometryType)&&d.push(a.id))}));return d}}})},"widgets/Analysis/PrivilegeUtil":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred jimu/portalUtils jimu/portalUrlUtils jimu/Role esri/kernel ./PortalAnalysis".split(" "),function(p,e,h,l,d,a,t,y){var g=null,r=p([],{userRole:null,userPortalUrl:null,portalAnalysis:null,portalSelf:null,portalUrl:null,constructor:function(a){this.portalUrl=a},_clearLoadedInfo:function(){this.portalUrl=this.portalSelf=this.portalAnalysis=this.userPortalUrl=
this.userRole=null},loadPrivileges:function(a){a&&this.portalUrl!==a&&(this._clearLoadedInfo(),this.portalUrl=a);if(this._privilegeLoaded())return a=new h,a.resolve(!0),a;a=l.getPortal(this.portalUrl);return a.haveSignIn()?this._loadUserInfo(a):this._signIn(a)},_signIn:function(a){return a.loadSelfInfo().then(e.hitch(this,function(a){var d=l.getPortal(a.portalHostname);return null===d?!1:d.signIn().then(e.hitch(this,function(a){return this._loadUserInfo(d,a)}),function(){return!1})}),function(){return!1})},
_registerOrgCredential:function(a,g){g=d.getStandardPortalUrl(g);var h=e.clone(a.toJson()),l=g+"/sharing/rest";h.server=l;h.resources=[l];t.id.registerToken(h)},_loadUserInfo:function(d,g){return d.loadSelfInfo().then(e.hitch(this,function(d){this.userPortalUrl=d.urlKey?d.urlKey+"."+d.customBaseUrl:this.portalUrl;return d&&d.user?(this.userRole=new a({id:d.user.roleId?d.user.roleId:d.user.role,role:d.user.role}),d.user.privileges&&this.userRole.setPrivileges(d.user.privileges),this.portalSelf=d,g&&
this._registerOrgCredential(g,this.userPortalUrl),this.portalAnalysis=new y(this.userRole,this.portalSelf),!0):!1}),function(){return!1})},_privilegeLoaded:function(){return null!==this.portalSelf},getUser:function(){return this._privilegeLoaded()?this.portalSelf.user:null},isAdmin:function(){return this._privilegeLoaded()?this.userRole.isAdmin():!1},getUserPortal:function(){return this._privilegeLoaded()?this.userPortalUrl:null},isPortal:function(){return null!==this.portalSelf&&!0===this.portalSelf.isPortal},
canPerformAnalysis:function(){return null!==this.portalAnalysis&&this.portalAnalysis.canPerformAnalysis()},hasPrivileges:function(a){return null!==this.portalAnalysis&&this.portalAnalysis.hasPrivileges(a)}});r.getInstance=function(a){null===g&&(g=new r(a));return g};return r})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(p,e,h,l,d){return p(null,{id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,
constructor:function(a){a=a||{};this.id=a.id;this.baseRole=a.role;this.name=a.name;this.description=a.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,
publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(a){d.isDefined(a)&&a instanceof Array&&
h.forEach(a,e.hitch(this,function(a){this._readPrivilege(a)}))},_readPrivilege:function(a){this._applyEffectToAction(!0,a)},_applyEffectToAction:function(a,d){switch(d){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=a;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=a;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=a;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=a;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=
a;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=a;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=a;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=a;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=a;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=a;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=
a;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=a;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=a;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=a;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=a;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=a;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=
a;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=a;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=a;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=a;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=a;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=a;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=
a;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=a;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=a;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=a;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=a;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=a;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=
a;break;case "features:user:edit":this.privilegeObj.features.user.edit=a;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=a;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=a;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=a;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=a;break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=a;break;
case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=a;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=a;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=a;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=a;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=a;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=
a;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=a}},_applyToAll:function(a){this.privilegeObj.portal.admin.inviteUsers=a;this.privilegeObj.portal.admin.disableUsers=a;this.privilegeObj.portal.admin.viewUsers=a;this.privilegeObj.portal.admin.updateUsers=a;this.privilegeObj.portal.admin.deleteUsers=a;this.privilegeObj.portal.admin.changeUserRoles=a;this.privilegeObj.portal.admin.viewGroups=a;this.privilegeObj.portal.admin.updateGroups=a;this.privilegeObj.portal.admin.deleteGroups=
a;this.privilegeObj.portal.admin.reassignGroups=a;this.privilegeObj.portal.admin.assignToGroups=a;this.privilegeObj.portal.admin.manageEnterpriseGroups=a;this.privilegeObj.portal.admin.viewItems=a;this.privilegeObj.portal.admin.updateItems=a;this.privilegeObj.portal.admin.deleteItems=a;this.privilegeObj.portal.admin.reassignItems=a;this.privilegeObj.portal.admin.manageLicenses=a;this.privilegeObj.portal.publisher.publishFeatures=a;this.privilegeObj.portal.publisher.publishTiles=a;this.privilegeObj.portal.publisher.publishScenes=
a;this.privilegeObj.portal.user.createGroup=a;this.privilegeObj.portal.user.joinGroup=a;this.privilegeObj.portal.user.joinNonOrgGroup=a;this.privilegeObj.portal.user.createItem=a;this.privilegeObj.portal.user.shareToGroup=a;this.privilegeObj.portal.user.shareToOrg=a;this.privilegeObj.portal.user.shareToPublic=a;this.privilegeObj.portal.user.shareGroupToOrg=a;this.privilegeObj.portal.user.shareGroupToPublic=a;this.privilegeObj.features.user.edit=a;this.privilegeObj.opendata.user.openDataAdmin=a;this.privilegeObj.opendata.user.designateGroup=
a;this.privilegeObj.premium.user.geocode=a;this.privilegeObj.premium.user.networkanalysis=a;this.privilegeObj.premium.user.spatialanalysis=a;this.privilegeObj.premium.user.geoenrichment=a;this.privilegeObj.premium.user.demographics=a;this.privilegeObj.premium.user.elevation=a;this.privilegeObj.marketplace.admin.purchase=a;this.privilegeObj.marketplace.admin.manage=a;this.privilegeObj.marketplace.admin.startTrial=a},_buildPrivilegesArray:function(){var a=[];!0===this.privilegeObj.portal.admin.inviteUsers&&
a.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&a.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&a.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&a.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&a.push("portal:admin:deleteUsers");!0===this.privilegeObj.portal.admin.changeUserRoles&&a.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&
a.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&a.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&a.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&a.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&a.push("portal:admin:assignToGroups");!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&a.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&
a.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&a.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&a.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&a.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&a.push("portal:admin:manageLicenses");!0===this.privilegeObj.portal.publisher.publishFeatures&&a.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&
a.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&a.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&a.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&a.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&a.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&a.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&
a.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&a.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&a.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&a.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&a.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&a.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&
a.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&a.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&a.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&a.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&a.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&a.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&
a.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&a.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&a.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&a.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&a.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&a.push("marketplace:admin:startTrial");return a},isUser:function(){return d.isDefined(this.id)&&
("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return d.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return d.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||d.isDefined(this.baseRole)&&("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||d.isDefined(this.baseRole)&&("org_publisher"===
this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||d.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&d.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},
canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},
canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},
canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(a){this.privileges=a;this._initPrivilegesObject();d.isDefined(a)&&this._readPrivileges(a)},stringify:function(){return l.stringify({id:this.id,
name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return l.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return l.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return l.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"widgets/Analysis/PortalAnalysis":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","esri/lang"],function(p,e,h,l){return p([],{userRole:null,portalSelf:null,constructor:function(d,a){this.userRole=d;this.portalSelf=a},canPerformAnalysis:function(){var d=!1;this.userRole&&(this.userRole.isAdmin()||this.userRole.isPublisher())?d=!0:this.userRole&&this.userRole.isCustom()&&(d=this.userRole.canCreateItem()&&this.userRole.canPublishFeatures()&&this.userRole.canUseSpatialAnalysis());this.portalSelf&&this.portalSelf.isPortal&&(d=d&&l.isDefined(this.portalSelf.helperServices.analysis)&&
l.isDefined(this.portalSelf.helperServices.analysis.url));return d},hasPrivileges:function(d){return e.isArray(d)?h.every(d,function(a){return"networkanalysis"===a?this._canPerformNetworkAnalysis():"geoenrichment"===a?this._canPerformGeoEnrichment():"elevation"===a?this._canPerformElevationAnalysis():"drivetimearea"===a?this._canPerformDriveAnalysis():"planroutes"===a?this._canPerformPlanRoutesAnalysis():"od"===a?this._canPerformODAnalysis():!1},this):!0},_canPerformNetworkAnalysis:function(){var d=
l.isDefined(this.portalSelf.helperServices.asyncClosestFacility)&&l.isDefined(this.portalSelf.helperServices.asyncServiceArea)&&l.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&d&&this.userRole.canUseNetworkAnalysis()},_canPerformGeoEnrichment:function(){var d=l.isDefined(this.portalSelf.helperServices.geoenrichment);return this.canPerformAnalysis()&&d&&this.userRole.canUseGeoenrichment()},_canPerformElevationAnalysis:function(){var d=l.isDefined(this.portalSelf.helperServices.elevation);
return this.canPerformAnalysis()&&d&&this.userRole.canUseElevation()},_canPerformPlanRoutesAnalysis:function(){var d=l.isDefined(this.portalSelf.helperServices.routingUtilities)&&l.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&d&&this.userRole.canUseNetworkAnalysis()},_canPerformODAnalysis:function(){var d=l.isDefined(this.portalSelf.helperServices.routingUtilities)&&l.isDefined(this.portalSelf.helperServices.asyncRoute);return this.canPerformAnalysis()&&d&&
this.userRole.canUseNetworkAnalysis()},_canPerformDriveAnalysis:function(){var d=l.isDefined(this.portalSelf.helperServices.routingUtilities)&&l.isDefined(this.portalSelf.helperServices.asyncServiceArea);return this.canPerformAnalysis()&&d&&this.userRole.canUseNetworkAnalysis()},_canPerformNearestAnalysis:function(){var d=l.isDefined(this.portalSelf.helperServices.routingUtilities)&&l.isDefined(this.portalSelf.helperServices.asyncClosestFacility);return this.canPerformAnalysis()&&d&&this.userRole.canUseNetworkAnalysis()}})})},
"widgets/Analysis/toolSettings":function(){define(["dojo/_base/lang","dojo/_base/array"],function(p,e){var h={},l="AggregatePoints CalculateDensity ChooseBestFacilities ConnectOriginsToDestinations CreateBuffers CreateDriveTimeAreas CreateViewshed CreateWatersheds DeriveNewLocations DissolveBoundaries EnrichLayer ExtractData FindExistingLocations FindHotSpots FindNearest FindSimilarLocations InterpolatePoints MergeLayers OverlayLayers PlanRoutes SummarizeNearby SummarizeWithin TraceDownstream".split(" "),
d=0,a=[{id:d++,dijitID:"esri/dijit/analysis/AggregatePoints",title:"aggregateTool",imgDisplay:"images/aggregate-points.png",usage:"aggregatePointsUsage",analysisLayer:{name:"pointLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},requiredParam:{name:"polygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},icon:"images/AggregatePoints32.png"},{id:d++,dijitID:"esri/dijit/analysis/CalculateDensity",title:"calculateDensity",imgDisplay:"images/calculate-density.png",usage:"calculateDensityUsage",
analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/CreateDensitySurface32.png"},{id:d++,dijitID:"esri/dijit/analysis/ChooseBestFacilities",title:"chooseBestFacilities",imgDisplay:"images/choose-best-facilities.png",analysisLayer:{name:"demandLocationLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},optionalParams:[{name:"demandLocationLayers",
isArray:!0,geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},{name:"featureLayers",isArray:!0,geomTypes:["*"]}],icon:"images/ChooseBestFacilities32.png"},{id:d++,dijitID:"esri/dijit/analysis/ConnectOriginsToDestinations",title:"connectOriginsToDestinations",imgDisplay:"images/connect-origins-to-destinations.png",usage:"connectOriginsToDestinationsUsage",analysisLayer:{name:"originsLayer",geomTypes:["esriGeometryPoint"]},requiredParam:{name:"featureLayers",isArray:!0,geomTypes:["esriGeometryPoint"]},
icon:"images/ConnectOriginstoDestinations32.png",privileges:["od"]},{id:d++,dijitID:"esri/dijit/analysis/CreateBuffers",title:"createBuffers",imgDisplay:"images/create-buffers.png",usage:"createBuffersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},icon:"images/CreateBuffers32.png"},{id:d++,dijitID:"esri/dijit/analysis/CreateDriveTimeAreas",title:"createDriveTimeAreas",imgDisplay:"images/create-drivetime.png",usage:"createDriveTimeAreasUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},
icon:"images/CreateDriveTimeAreas32.png",cannotCancel:!0,privileges:["drivetimearea"]},{id:d++,dijitID:"esri/dijit/analysis/CreateViewshed",title:"createViewshed",imgDisplay:"images/create-viewshed.png",usage:"createViewshedUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/Viewshed32.png",privileges:["elevation"]},{id:d++,dijitID:"esri/dijit/analysis/CreateWatersheds",title:"createWatershed",imgDisplay:"images/create-watersheds.png",usage:"createWatershedsUsage",
analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/Watershed32.png",privileges:["elevation"]},{id:d++,dijitID:"esri/dijit/analysis/DeriveNewLocations",title:"deriveNewLocations",imgDisplay:"images/derive-new-locations.png",usage:"deriveNewLocationsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},optionalParams:[{name:"inputLayers",isArray:!0,geomTypes:["*"]}],icon:"images/FindNewLocations32.png"},{id:d++,dijitID:"esri/dijit/analysis/DissolveBoundaries",title:"dissolveBoundaries",
imgDisplay:"images/dissolve-boundaries.png",usage:"dissolveBoundariesUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPolygon"]},icon:"images/DissolveBoundaries32.png"},{id:d++,dijitID:"esri/dijit/analysis/EnrichLayer",title:"enrichLayer",imgDisplay:"images/enrich-layer.png",usage:"enrichLayerUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},icon:"images/GeoenrichFeatures32.png",privileges:["geoenrichment"]},{id:d++,dijitID:"esri/dijit/analysis/ExtractData",title:"extractData",
imgDisplay:"images/extract-data.png",usage:"extractDataDesc",optionalParams:[{name:"featureLayers",isArray:!0,geomTypes:["*"]}],icon:"images/ClipAndShip32.png"},{id:d++,dijitID:"esri/dijit/analysis/FindExistingLocations",title:"findExistingLocations",imgDisplay:"images/find-existing-locations.png",usage:"findExistingLocationsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},optionalParams:[{name:"inputLayers",isArray:!0,geomTypes:["*"]}],icon:"images/FindExistingLocations32.png"},{id:d++,
dijitID:"esri/dijit/analysis/FindHotSpots",title:"findHotSpots",imgDisplay:"images/find-hot-spots.png",usage:"findHotSpotsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolygon"]},optionalParams:[{name:"aggregationPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/FindHotSpots32.png"},{id:d++,dijitID:"esri/dijit/analysis/FindNearest",
title:"findNearest",imgDisplay:"images/find-nearest.png",usage:"findNearestUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},requiredParam:{name:"nearLayers",isArray:!0,geomTypes:["*"]},icon:"images/FindNearest32.png",cannotCancel:!0},{id:d++,dijitID:"esri/dijit/analysis/FindSimilarLocations",title:"findSimilarLocations",imgDisplay:"images/find-similar-locations.png",usage:"findSimilarLocationsUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},optionalParams:[{name:"searchLayers",
isArray:!0,geomTypes:["*"]}],icon:"images/FindSimilarLocations32.png"},{id:d++,dijitID:"esri/dijit/analysis/InterpolatePoints",title:"interpolatePoints",imgDisplay:"images/interpolate-points.png",usage:"interpolatePointsUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},{name:"predictAtPointLayers",isArray:!0,geomTypes:["esriGeometryPoint"]}],icon:"images/CreateInterpolatedSurface32.png"},
{id:d++,dijitID:"esri/dijit/analysis/MergeLayers",title:"mergeLayers",imgDisplay:"images/merge-layers.png",usage:"mergeLayersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},requiredParam:{name:"mergeLayers",isArray:!0,geomTypes:["*"]},icon:"images/MergeLayers32.png"},{id:d++,dijitID:"esri/dijit/analysis/OverlayLayers",title:"overlayLayers",imgDisplay:"images/overlay-layers.png",usage:"overlayLayersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},requiredParam:{name:"overlayLayer",
isArray:!0,geomTypes:["*"]},icon:"images/OverlayLayers32.png"},{id:d++,dijitID:"esri/dijit/analysis/PlanRoutes",title:"planRoutes",imgDisplay:"images/plan-routes.png",usage:"planRoutesUsage",analysisLayer:{name:"stopsLayer",geomTypes:["esriGeometryPoint"]},optionalParams:[{name:"featureLayers",isArray:!0,geomTypes:["esriGeometryPoint"]}],icon:"images/PlanRoutes32.png",cannotCancel:!0,privileges:["planroutes"]},{id:d++,dijitID:"esri/dijit/analysis/SummarizeNearby",title:"summarizeNearby",imgDisplay:"images/summarize-nearby.png",
usage:"summarizeNearbyUsage",analysisLayer:{name:"sumNearbyLayer",geomTypes:["*"]},requiredParam:{name:"summaryLayers",isArray:!0,geomTypes:["*"]},icon:"images/SummarizeNearby32.png"},{id:d++,dijitID:"esri/dijit/analysis/SummarizeWithin",title:"summarizeWithin",imgDisplay:"images/summarize-within.png",usage:"summarizeWithinUsage",analysisLayer:{name:"sumWithinLayer",geomTypes:["esriGeometryPolygon"]},requiredParam:{name:"summaryLayers",isArray:!0,geomTypes:["*"]},icon:"images/SummarizeWithin32.png"},
{id:d++,dijitID:"esri/dijit/analysis/TraceDownstream",title:"traceDownstream",imgDisplay:"images/trace-downstream.png",usage:"traceDownstreamUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/TraceDownstream32.png",privileges:["elevation"]}];h.findToolSetting=function(d){d=e.indexOf(l,d);return-1!==d?p.clone(a[d]):null};h.getToolName=function(a){return"id"in a&&0<=a.id&&
a.id<l.length?l[a.id]:null};h.getAllSettings=function(){return p.clone(a)};return h})},"widgets/Analysis/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/SingleFilter.html":'\x3cdiv class\x3d"esriSingleFilterForm singleFilter" id\x3d"${id}.singleFilter"\x3e\r\n  \x3cdiv\x3e\r\n    \x3ctable id\x3d"${id}.exprTable" class\x3d"rowTable" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column1"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column2"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column3"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column4"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column5"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column6"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column7"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3ca id\x3d"${id}.deleteExpression" href\x3d"JavaScript:void(0);" style\x3d"margin:0 5px;display:none;" class\x3d"esriAGOFilterRemoveIcon" title\x3d"${i18n.deleteExpression}"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_interactiveFilterRow"\x3e\r\n          \x3ctd colspan\x3d"8"\x3e\r\n            \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"interactiveFilter"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3cinput dojoAttachPoint\x3d"interactiveCheck" type\x3d"checkbox" class\x3d"promptCheckBox" title\x3d"${i18n.promptMsg}"/\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3clabel class\x3d"labels" for\x3d"promptCheckBox"\x3e\r\n                              \x26nbsp;\x26nbsp;${i18n.askForValues}\r\n                            \x3c/label\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cspan dojoAttachPoint\x3d"interactiveArrow" style\x3d"color:#cbcbcb;cursor:pointer;" class\x3d"showHidePromptDiv"\x3e\x26nbsp;\x26#9660;\x3c/span\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr dojoAttachPoint\x3d"interactiveSpace" style\x3d"display:none"\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.prompt}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"promptText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.hint}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"hintText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"promptDiv" style\x3d"display:none;padding:10px 0px;"\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtPrompt"\x3e\r\n      ${i18n.prompt}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtPrompt" type\x3d"text"/\x3e\r\n    \x3cbr/\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtHint"\x3e\r\n      ${i18n.hint}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtHint" type\x3d"text" /\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ExportChooser.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"export-mask" data-dojo-attach-point\x3d"exportMask"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"export-format jimu-corner-all" data-dojo-attach-point\x3d"exportFormats"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/Analysis/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"widgetContent" class\x3d"analysis-widget-content"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"toolListPanel" class\x3d"tool-list"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolsSection" class\x3d"toolsSection"\x3e\r\n        \x3cdiv class\x3d"execute-tip"\x3e\r\n          ${nls.executeAnalysisTip}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"tools-table-container"\x3e\r\n          \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"tools-table" onselectstart\x3d"return false;"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"toolsTbody"\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noQueryTipSection" class\x3d"jimu-widget"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"toolPanel" class\x3d"tool-panel"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolCtr" style\x3d"width:100%;height:90%"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolLoadErrorNode" class\x3d"analysis-error-tip" style\x3d"display:none"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"messagePanel" class\x3d"message-panel"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"inputHeader" class\x3d"input-header esriAnalysis"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"smallIcon" class\x3d"small-icon"/\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"toolTitle" class\x3d"tool-title"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3chr\x3e\r\n      \x3cdiv class\x3d"message-title"\x3e${nls.messages}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"messageSection" class\x3d\'message-section\'\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"resultSection" style\x3d"display:none" \x3e\r\n        \x3cdiv class\x3d"message-title outputs"\x3e${nls.outputs}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"outputSection" class\x3d\'result-section\'\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"job-message outputtip" data-dojo-attach-point\x3d"outputtip"\x3e${nls.outputtip}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"resultLoading" class\x3d"result-loading" style\x3d"display:none"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"buttonSection" style\x3d"display:none" class\x3d"buttonNode"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"backBtn"\r\n            data-dojo-attach-event\x3d"onclick: _switchToPrevious"\x3e${nls.back}\x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"homeBtn"\r\n            data-dojo-attach-event\x3d"onclick: _switchToHome"\x3e${nls.home}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Analysis/css/style.css":".esriAnalysis .dijitComboBox{height: 30px !important;}.jimu-widget-analysis{position: relative; width: 100%; height: 100%; min-width: 300px; min-height: 237px; overflow-x: hidden; -ms-overflow-x: hidden; overflow-y: auto; -ms-overflow-y: auto;}.jimu-widget-analysis .execute-tip{font-size: 14px; color: #66699c; font-weight: bold;}.jimu-widget-analysis .tools-table-container{width: 100%;}.jimu-widget-analysis .tools-table{margin: 0 auto; padding-top: 10px; width: 100%; border-collapse: collapse;}.jimu-widget-analysis .tool-name{font-size: 14px; margin-left: 10px; margin-top: 10px; color: #686868;}.jimu-rtl .jimu-widget-analysis .tool-name{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .tools-table-tr{height:107px; display: block; cursor: pointer;}.jimu-widget-analysis .tools-table-tr.even{background-color: #ffffff;}.jimu-widget-analysis .tools-table-tr.odd{background-color: #f0f0f0;}.jimu-widget-analysis .tools-table-tr.disabled{background-color: #979797; cursor: default; border-bottom: 1px solid #ffffff;}.jimu-widget-analysis .tools-table-tr .icon-div{margin: 10px; width: 220px;}.jimu-widget-analysis .tools-table-tr .icon-div .tool-icon{height: 60px; width: auto;}.jimu-widget-analysis .tools-table-tr .tooltip-td{margin: 10px;}.jimu-widget-analysis .tooltip-icon{width: 16px; height: 16px; cursor: pointer; margin-left: 30px;}.jimu-rtl .jimu-widget-analysis .tooltip-icon{margin-left: auto; margin-right: 30px;}.jimu-widget-analysis .tools-table-tr:hover{background: #d9dde0;}.jimu-widget-analysis .tools-table-tr.disabled:hover{background-color: #979797;}.jimu-widget-analysis .tool-params{width: 100%; height: 100%;}.jimu-widget-analysis .input-header{position: relative; width: 100%;}.jimu-widget-analysis .input-header .small-icon{margin-left: 15px;}.jimu-rtl .jimu-widget-analysis .input-header .small-icon{margin-left: auto; margin-right: 15px;}.jimu-widget-analysis .input-header .tool-title{margin-left: 15px; margin-bottom: 15px; font-size: 16px;}.jimu-rtl .jimu-widget-analysis .input-header .tool-title{margin-left: auto; margin-right: 15px;}.jimu-widget-analysis .input-header .help-icon{margin-top: 15px; cursor: pointer;}.jimu-widget-analysis .input-tip{width: 100%; height: auto; margin-top: 20px; font-size: 14px;}.jimu-widget-analysis .layerNode{position: relative; width:100%; margin: 0 auto; margin-top: 10px;}.jimu-widget-analysis .layerNode .param-name{margin-top: 15px; margin-bottom: 10px;}.jimu-widget-analysis .layer-name {height: 30px; line-height: 30px; width: 100%; border: solid 1px rgba(0,0,0,0.1); cursor: pointer;}.jimu-widget-analysis .tool-params .buttonNode{width: 100%; height: auto; margin-top: 20px; text-align: center;}.jimu-widget-analysis .switch-button{margin-left: 20px;}.jimu-rtl .jimu-widget-analysis .switch-button{margin-left: auto; margin-right: 20px;}.jimu-widget-analysis .tool-panel{width: 100%; height: auto; position: relative; top:-20px;}.jimu-widget-analysis .tool-panel .esriAnalysisCloseIcon{display:none !important;}.jimu-widget-analysis .jimu-btn{margin-left: 10px; margin-right: 10px;}.jimu-widget-analysis .toolpanel-button{text-align: center;}.jimu-widget-analysis .analysis-error-tip{width: 100%; min-height: 150px; margin-top: 30px; margin-left: 15px; margin-right: 15px; color:#ff0000; font-size: 14px;}.jimu-widget-analysis .message-panel{width: 100%; margin-bottom: 15px; position: relative;}.jimu-widget-analysis .message-panel .message-title{margin-top: 20px; font-size: 14px; color: #66696c; font-weight: bold;}.jimu-widget-analysis .message-panel .message-title.outputs{margin-top: 30px;}.jimu-widget-analysis .message-panel .job-message{margin-top: 10px; font-size: 12px; color: #686868;}.jimu-widget-analysis .message-panel .job-message.outputtip{margin-top: 30px;}.jimu-widget-analysis .message-panel .job-message.success{color: #00B050;}.jimu-widget-analysis .message-panel .job-message.failed{color:#E84B4B;}.jimu-widget-analysis .message-panel .job-message.cancelled{color: #51B1FE;}.jimu-widget-analysis .message-panel .job-running-icon{width: 16px; height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-analysis .message-panel .job-running-icon{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .message-panel .job-cancel-icon{width: 16px; height: 16px; cursor: pointer; margin-left: 10px;}.jimu-rtl .jimu-widget-analysis .message-panel .job-cancel-icon{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .message-panel .output-item{margin-top: 10px; color: #51B1FE; font-size: 12px; display: inline-block;}.jimu-widget-analysis .message-panel .output-item\x3ea{color: #51B1FE;}.jimu-widget-analysis .message-panel .button-section{width: 100%; margin-top: 20px;}.jimu-widget-analysis .message-panel .buttonNode{width: 100%; height: auto; margin-top: 20px; text-align: center;}.jimu-widget-analysis .result-section{width: 100%; margin-top: 15px; margin-bottom: 15px; font-size: 14px; color: #66699c;}.jimu-widget-analysis .result-loading{width: 100%; height: 40px; margin-top: 15px; margin-bottom: 15px; background-image: url(images/loading.gif); background-repeat: no-repeat; background-position: center;}.jimu-widget-analysis .hidden{display: none;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton{margin-left: 0px;}.jimu-rtl .jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton{margin-right: 0px; margin-left: auto;}.jimu-widget-analysis .esriAnalysis .dijitButton.calcite {display: inline-block !important;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton.dijitButton\x3espan.dijitButtonNode,.jimu-widget-analysis .esriAnalysis .dijitButton.calcite \x3e span.dijitButtonNode{cursor:pointer; min-width: 70px; display:inline-block; padding:6px; font-size:15px; text-align:center; background:#485566; vertical-align:middle; color:#ffffff; -webkit-border-radius:5px; -moz-border-radius:5px; -o-border-radius:5px; -ms-border-radius:5px; border-radius: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton.dijitButtonHover\x3espan.dijitButtonNode,.jimu-widget-analysis .esriAnalysis .dijitButton.calcite.dijitButtonHover\x3espan.dijitButtonNode{background-color: #596d87; color: #ffffff;}.dijitDialog .esriAnalysis{overflow: hidden;}.dijitDialog .esriAnalysis .esriAnalysisSubmitButton{margin-left: 10px;}.jimu-rtl .dijitDialog .esriAnalysis .esriAnalysisSubmitButton{margin-left: auto; margin-right: 10px;}.dijitDialog .esriAnalysis .esriAnalysisCloseIcon{display: none !important;}.itemsGallery .galleryNode .galleryLabelContainer {height: 2.7em; text-align: left; line-height: 15px;}.jimu-widget-analysis .export-node {width: 16px; height: 16px; background-image: url(images/download.png); cursor: pointer; margin: 10px 10px 0 10px; display: inline-block;}.jimu-widget-analysis .export-node:hover {background-image: url(images/download_hover.png);}.esriAnalysis .dijitReset.dijitRight.dijitButtonNode.dijitArrowButton.dijitDownArrowButton.dijitArrowButtonContainer{width: 18px !important;}.esriAnalysis .esriAnalysisExpressionGrid .dijitButtonNode {height: auto;}",
"*now":function(p){p(['dojo/i18n!*preload*widgets/Analysis/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/dom-style dojo/dom-attr dojo/dom-class dojo/Deferred dojo/on dojo/Evented dojo/query dojo/promise/all dojo/dom-construct dojo/i18n!esri/nls/jsapi dojo/json dijit/_WidgetsInTemplateMixin esri/request esri/tasks/JobInfo esri/tasks/FeatureSet esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer esri/dijit/PopupTemplate esri/dijit/analysis/utils esri/geometry/Extent jimu/BaseWidget jimu/dijit/ViewStack jimu/dijit/Message jimu/utils jimu/portalUtils jimu/portalUrlUtils jimu/LayerInfos/LayerInfos jimu/exportUtils jimu/dijit/ExportChooser ./layerUtil ./toolValidate ./PrivilegeUtil ./toolSettings dojo/i18n!./setting/nls/strings dijit/form/Button jimu/dijit/LoadingShelter".split(" "),function(p,
e,h,l,d,a,t,y,g,r,s,u,q,m,w,B,f,v,z,D,F,E,c,n,k,A,x,M,H,C,I,N,J,G,K,O,P,L,Q){return p([A,B,r],{baseClass:"jimu-widget-analysis esriAnalysis",_hasContent:null,privilegeUtil:null,currentStack:0,toolCountInList:0,postMixInProperties:function(){this.inherited(arguments);e.mixin(this.nls,m.analysisTools);e.mixin(this.nls,window.jimuNls.common);this.nls.toolNotAvailable=Q.toolNotAvailable},postCreate:function(){this.inherited(arguments);this.privilegeUtil=P.getInstance();this.viewStack=new x({viewType:"dom",
views:[this.toolListPanel,this.toolPanel,this.messagePanel]});h.place(this.viewStack.domNode,this.widgetContent);0===this.config.analysisTools.length&&this._noPrivilegeHandler(this.nls.noToolTip);this._switchView(0)},_closeHelpDialog:function(){n._helpDialog&&"function"===typeof n._helpDialog.close&&n._helpDialog.close()},onClose:function(){this._closeHelpDialog();this._deactiveDrawTool();this._setDrawingLayersVisibility(!1);this._unbindAnalysisEvent()},onOpen:function(){this._setDrawingLayersVisibility(!0);
1===this.currentStack&&this._refreshAnalysisTool()},onDeActive:function(){this._deactiveDrawTool()},_refreshAnalysisTool:function(){this.shelter.show();K.getLayerObjects(this.map).then(e.hitch(this,function(a){O.isValid(a,this.currentToolSetting,this.privilegeUtil);this.shelter.hide();this._setIconAndLink(this.currentToolSetting);this._switchToAnalysisTool()}))},_checkValidation:function(){q.empty(this.toolsTbody);0!==this.config.analysisTools.length&&(this.shelter.show(),this.privilegeUtil.loadPrivileges(this._getPortalUrl()).then(e.hitch(this,
function(a){!a||!this.privilegeUtil.canPerformAnalysis()?this._noPrivilegeHandler(this.nls.privilegeError):(d.set(this.toolsSection,"display","block"),d.set(this.noQueryTipSection,"display","none"),this._initToolList().then(e.hitch(this,function(){this.shelter.hide()})))}),e.hitch(this,function(){this._noPrivilegeHandler(this.nls.privilegeError);this.shelter.hide()})))},_clearContent:function(){q.empty(this.toolsTbody);this.currentAnalysisDijit&&("function"===typeof this.currentAnalysisDijit.clear&&
this.currentAnalysisDijit.clear(),this.currentAnalysisDijit=null,q.empty(this.toolCtr));this.currentToolSetting=null},_noPrivilegeHandler:function(c){this.shelter.hide();d.set(this.toolsSection,"display","none");a.set(this.noQueryTipSection,"innerHTML",H.stripHTML(c));d.set(this.noQueryTipSection,"display","block")},_initToolList:function(){d.set(this.homeBtn,"display","");this.toolCountInList=0;var a=null;return K.getLayerObjects(this.map).then(e.hitch(this,function(c){l.forEach(this.config.analysisTools,
e.hitch(this,function(b,d){var f=L.findToolSetting(b.name);if(null!==f&&(f=e.mixin(f,this.config.analysisTools[d]),f.toolLabel||(f.toolLabel=this.nls[f.title]),this.privilegeUtil.hasPrivileges(f.privileges))){var g=O.isValid(c,f,this.privilegeUtil);this._addTool(f,d,g);this.toolCountInList+=1;a=f}}));0===this.toolCountInList?this._noPrivilegeHandler(this.nls.privilegeError):1===this.toolCountInList&&(d.set(this.homeBtn,"display","none"),this.currentToolSetting=a,this._setIconAndLink(a),this._switchToAnalysisTool())}),
e.hitch(this,function(){console.error("layerUtil: getLayerObjects error")}))},destroy:function(){this._clearContent();this.inherited(arguments)},_addTool:function(c,d,b){var f=q.create("tr",{"class":"tools-table-tr","data-toolname":c.name},this.toolsTbody);0===d%2?t.add(f,"even"):t.add(f,"odd");f.rowData=c;d=q.create("td",{"class":"icon-td"},f);q.create("div",{"class":"tool-name",innerHTML:H.stripHTML(c.toolLabel)},d);d=q.create("div",{"class":"icon-div"},d);q.create("img",{src:this.folderUrl+c.imgDisplay,
"class":"tool-icon"},d);d=q.create("td",{"class":"tooltip-td esriAnalysis"},f);if(c.showHelp){d=q.create("a",{href:"#",esriHelpTopic:"toolDescription"},d);q.create("img",{src:this.folderUrl+"images/helpIcon.png",title:c.toolLabel,"class":"tooltip-icon"},d);d=c.dijitID.lastIndexOf("/");d=c.dijitID.substring(d+1);var h=!I.isOnline(this._getPortalUrl());try{n.initHelpLinks(f,!0,{helpFileName:d,isSingleTenant:h})}catch(k){console.log(k)}}!0===b?(a.set(f,"title",""),this.own(g(f,"click",e.hitch(this,function(){this._setIconAndLink(c);
this.currentToolSetting=c;this._switchToAnalysisTool()})))):(a.set(f,"title",this.nls.toolNotAvailable),t.remove(f,"even"),t.remove(f,"odd"),t.add(f,"disabled"))},_setIconAndLink:function(c){a.set(this.smallIcon,"src",this.folderUrl+c.icon);a.set(this.toolTitle,"innerHTML",H.stripHTML(c.toolLabel));var d=c.dijitID.lastIndexOf("/"),d=c.dijitID.substring(d+1);this.helpLink&&(q.destroy(this.helpLink),this.helpLink=null);if(c.showHelp){this.helpLink=q.create("a",{href:"#",esriHelpTopic:"toolDescription"},
this.inputHeader);q.create("img",{height:16,width:16,"class":"help-icon jimu-float-trailing",src:this.folderUrl+"images/helpIcon.png"},this.helpLink);try{n.initHelpLinks(this.inputHeader,!0,{helpFileName:d})}catch(b){console.log(b)}}},_switchToAnalysisTool:function(){d.set(this.toolLoadErrorNode,"display","none");this.shelter.show();require([this.currentToolSetting.dijitID],e.hitch(this,function(c){this.currentAnalysisDijit&&("function"===typeof this.currentAnalysisDijit.clear&&this.currentAnalysisDijit.clear(),
this.currentAnalysisDijit=null,q.empty(this.toolCtr));var f=!I.isOnline(this._getPortalUrl()),b={map:this.map,showSelectFolder:!0,portalUrl:this._getPortalUrl(this.privilegeUtil.getUserPortal()),showCredits:this.currentToolSetting.showCredits,showHelp:this.currentToolSetting.showHelp,showChooseExtent:this.currentToolSetting.showChooseExtent,returnFeatureCollection:this.currentToolSetting.returnFeatureCollection,showReadyToUseLayers:this.currentToolSetting.showReadyToUseLayers,isSingleTenant:f,disableRunAnalysis:!0===
this.currentToolSetting.disableRunAnalysis};f&&(b.showReadyToUseLayers=!1);if("findNearest"===this.currentToolSetting.title||"summarizeNearby"===this.currentToolSetting.title||"enrichLayer"===this.currentToolSetting.title)b.enableTravelModes=this.privilegeUtil.hasPrivileges(["networkanalysis"]);"returnFeatureCollection"in this.currentToolSetting&&(b.showSelectFolder=!this.currentToolSetting.returnFeatureCollection);K.getLayerObjects(this.map).then(e.hitch(this,function(f){this.currentToolSetting.analysisLayer&&
(b.showSelectAnalysisLayer=!0,b[this.currentToolSetting.analysisLayer.name+"s"]=this._prepareLayers(f,this.currentToolSetting.analysisLayer.geomTypes));f=this._prepareLayerParams(f);e.mixin(b,f);try{if(-1!==this.currentToolSetting.dijitID.indexOf("DeriveNewLocations")||-1!==this.currentToolSetting.dijitID.indexOf("FindExistingLocations")||-1!==this.currentToolSetting.dijitID.indexOf("FindSimilarLocations"))b.primaryActionButttonClass="esriAnalysisSubmitButton";this.currentAnalysisDijit=new c(b,q.create("div",
{style:{width:"100%"}},this.toolCtr));this.currentAnalysisDijit._setTitleAttr(this.currentToolSetting.toolLabel);this._bindAnalysisEvents(this.currentAnalysisDijit);this.currentAnalysisDijit.startup();this.currentDijitID=this.currentToolSetting.dijitID;var h;if(1<this.toolCountInList&&(h=s(".esriAnalysis .esriAnalysisSubmitButton",this.toolPanel)[0],"undefined"!==typeof h)){t.add(h,"multiTool");var k=q.create("div",{"class":"toolpanel-button"}),l=q.create("div",{"class":"jimu-btn",innerHTML:this.nls.back},
k);q.place(k,h,"before");q.place(h,k);this.currentAnalysisDijit.own(g(l,"click",e.hitch(this,this._switchToPrevious)))}}catch(m){console.error(m.message||m),a.set(this.toolLoadErrorNode,"innerHTML",H.stripHTML(m.message||m)),d.set(this.toolLoadErrorNode,"display","")}this._switchView(1);this.shelter.hide()}))}),e.hitch(this,function(c){this._switchView(1);a.set(this.toolLoadErrorNode,"innerHTML",H.stripHTML(c));d.set(this.toolLoadErrorNode,"display","");this.shelter.hide()}))},_prepareLayerParams:function(a){var c=
{};if("optionalParams"in this.currentToolSetting||"requiredParam"in this.currentToolSetting){var b;"requiredParam"in this.currentToolSetting&&(b=this._prepareLayers(a,this.currentToolSetting.requiredParam.geomTypes),c[this.currentToolSetting.requiredParam.name]=this.currentToolSetting.requiredParam.isArray?b:0<b.length?b[0]:null);"optionalParams"in this.currentToolSetting&&l.forEach(this.currentToolSetting.optionalParams,function(d){b=this._prepareLayers(a,d.geomTypes);c[d.name]=d.isArray?b:0<b.length?
b[0]:null},this)}return c},_prepareLayers:function(a,c){var b,d=["point","polyline","polygon"],e=[];"*"!==c[0]&&(d=l.map(c,function(a){return H.getTypeByGeometryType(a)}));l.forEach(a,function(a){"esri.layers.FeatureLayer"===a.declaredClass&&(b=H.getTypeByGeometryType(a.geometryType),0<=d.indexOf(b)&&(a.url||0<a.graphics.length)&&e.push(a))},this);return e},_deactivateGenerator:function(a){var c=this.currentAnalysisDijit;return function(){l.forEach(a,function(a){c[a]&&c[a].set("checked",!1)})}},_deactiveDrawTool:function(){if(this.currentAnalysisDijit){var a=
{calculateDensity:this._deactivateGenerator(["_bndgPolyDrawBtn"]),createViewshed:this._deactivateGenerator(["_analysisPointDrawBtn"]),createWatershed:this._deactivateGenerator(["_analysisPointDrawBtn"]),extractData:e.hitch(this,function(){this.currentAnalysisDijit._drawExtentBtn&&this.currentAnalysisDijit._drawExtentBtn.set("checked",!1);this.currentAnalysisDijit._toolbar&&this.currentAnalysisDijit._toolbar.deactivate()}),findHotSpots:this._deactivateGenerator(["_boundingDrawBtn"]),findSimilarLocations:e.hitch(this,
function(){this.currentAnalysisDijit._selectBtn&&this.currentAnalysisDijit._selectBtn.set("checked",!1);this.currentAnalysisDijit.selectionLayer&&this.currentAnalysisDijit.selectionLayer.clearSelection()}),interpolatePoints:this._deactivateGenerator(["_bndgPolyDrawBtn","_predictPointDrawBtn"]),planRoutes:this._deactivateGenerator(["_startPointDrawBtn","_endPointDrawBtn"]),traceDownstream:this._deactivateGenerator(["_analysisPointDrawBtn","_bndgPolyDrawBtn"])};"function"===typeof a[this.currentToolSetting.title]&&
(a[this.currentToolSetting.title].apply(this),this.map.setInfoWindowOnClick(!0))}},_setDrawingLayersVisibility:function(a){this.currentAnalysisDijit&&"function"===typeof this.currentAnalysisDijit._getDrawLayerAttr&&l.forEach(this.currentAnalysisDijit._getDrawLayerAttr(),function(c){a?c.show():c.hide()})},_unbindAnalysisEvent:function(){this.startListener&&(this.startListener.remove(),this.startListener=null);this.submitListener&&(this.submitListener.remove(),this.submitListener=null);this.cancelListener&&
(this.cancelListener.remove(),this.cancelListener=null);this.failedListener&&(this.failedListener.remove(),this.failedListener=null);this.succeedListener&&(this.succeedListener.remove(),this.succeedListener=null);this.statusListener&&(this.statusListener.remove(),this.statusListener=null);this.resultListener&&(this.resultListener.remove(),this.resultListener=null);this.activeDrawListener&&(this.activeDrawListener.remove(),this.activeDrawListener=null);this.deactiveDrawListener&&(this.deactiveDrawListener.remove(),
this.deactiveDrawListener=null)},_bindAnalysisEvents:function(a){this._unbindAnalysisEvent();this.startListener=g(a,"start",e.hitch(this,this._onJobStart));this.submitListener=g(a,"job-submit",e.hitch(this,this._onJobSubmitted));this.cancelListener=g(a,"job-cancel",e.hitch(this,this._onJobCancelled));this.failedListener=g(a,"job-fail",e.hitch(this,this._onJobFailed));this.succeedListener=g(a,"job-success",e.hitch(this,this._onJobSucceed));this.statusListener=g(a,"job-status",e.hitch(this,this._onJobStatusChange));
this.resultListener=g(a,"job-result",e.hitch(this,this._onJobResultData));this.activeDrawListener=g(a,"drawtool-activate",e.hitch(this,function(){this.map.setInfoWindowOnClick(!1)}));this.deactiveDrawListener=g(a,"drawtool-deactivate",e.hitch(this,function(){this.map.setInfoWindowOnClick(!0)}))},_onJobStart:function(){this._clearMessageLogs();this.shelter.show();this._switchView(2);this.emit("start")},_onJobSubmitted:function(a){this.shelter.hide();this.outputProperties=null;a.OutputName&&(this.outputProperties=
w.parse(a.OutputName,!0));this._appendMessage(this.nls[this.currentToolSetting.title]+" "+this.nls.jobSubmitted);var c=q.create("div",{"class":"job-message waiting"},this.messageSection);q.create("img",{"class":"job-running-icon",src:this.folderUrl+"images/loading.gif"},c);this.emit("job-submit",a)},_onJobCancelled:function(a){a.jobStatus?this._appendMessage(this.nls.jobCancelled+": "+a.jobStatus,"cancelled"):this._appendMessage(this.nls.jobCancelled,"cancelled");this._onJobDone();d.set(this.buttonSection,
"display","");this.emit("job-cancel",a)},_onJobFailed:function(a){this.shelter.hide();"warning"===a.type?(this.currentAnalysisDijit.set("disableRunAnalysis",!1),this._switchView(1),new M({message:a.message})):(2!==this.currentStack&&(this._clearMessageLogs(),this._switchView(2)),this._appendMessage(this.nls.jobFailed+": "+(a.analysisReport||a.message),"failed"),this._onJobDone(),d.set(this.buttonSection,"display",""));this.emit("job-fail",a)},_onJobSucceed:function(c){this._appendMessage(this.nls.jobSuccess,
"success");this._onJobDone();0<=this.currentToolSetting.dijitID.indexOf("ExtractData")&&(d.set(this.resultSection,"display",""),a.set(this.outputtip,"innerHTML",H.stripHTML(this.nls.outputSaveInPortal)));d.set(this.buttonSection,"display","");d.set(this.resultLoading,"display","");this.emit("job-success",c)},_onJobDone:function(){s("img.job-executing",this.messagePanel).forEach(function(a){q.destroy(a)})},_onJobStatusChange:function(a){this.shelter.hide();a.jobId&&a.jobId!==this.currentToolJobId&&
(this.currentToolJobId=a.jobId);if(a.jobStatus===v.STATUS_EXECUTING)this._appendExecutingMessage();else switch(a.jobStatus){case v.STATUS_FAILED:case v.STATUS_CANCELLED:case v.STATUS_DELETED:case v.STATUS_TIMED_OUT:this.shelter.hide();"string"===typeof a.message&&this._appendMessage(a.message,"failed");this._onJobDone();d.set(this.buttonSection,"display","");break;case v.STATUS_SUCCEEDED:"string"===typeof a.message&&this._appendMessage(a.message,"success"),this._onJobDone(),d.set(this.buttonSection,
"display",""),d.set(this.resultLoading,"display","")}this.emit("job-status",a)},_onJobResultData:function(f){a.set(this.outputtip,"innerHTML",H.stripHTML(this.nls.outputtip));d.set(this.resultSection,"display","");d.set(this.buttonSection,"display","");var g=this._appendResultMessage(f);if(0>this.currentToolSetting.dijitID.indexOf("ExtractData")){var b;if(f.value.itemId)b=null,"layerInfo"in f.value&&(b=f.value.layerInfo.popupInfo),this._fetchResultByItemId(g,f.value.itemId,b).then(e.hitch(this,function(){d.set(this.resultLoading,
"display","none")}));else if("layerDefinition"in f.value){var h={title:g?g:"output",fieldInfos:[]};l.forEach(f.value.layerDefinition.fields,function(a){a.name!==f.value.layerDefinition.objectIdField&&h.fieldInfos.push({fieldName:a.name,visible:!0,label:a.alias,isEditable:!1})});b=new c(h);b=new E(f.value,{infoTemplate:b});b.title=g?g:"output";b.name=g?g:"output";this.map.addLayer(b);this.currentToolSetting.allowToExport&&this._createExportNode(b.title,new z(f.value.featureSet),J.TYPE_FEATURESET);
d.set(this.resultLoading,"display","none")}}this.emit("job-result",f)},_fetchResultByItemId:function(a,c,b){return C.getPortal(this._getPortalUrl(this.privilegeUtil.getUserPortal())).getItemById(c).then(e.hitch(this,function(d){var g=d.url;return f({url:g,content:{f:"json"},handleAs:"json"}).then(e.hitch(this,function(d){var f=[],h,m=d.tables||[],n=d.layers||[];m.reverse();n.reverse();l.forEach(m,function(b){var c=g+"/"+b.id;h=N.getInstance(this.map,this.map.itemInfo).then(e.hitch(this,function(d){d.addTable({url:c,
title:a+" - "+b.name,options:{outFields:["*"]}});this.currentToolSetting.allowToExport&&f.push(this._createExportNodeForUrl(b.name,c,J.TYPE_TABLE))}));f.push(h)},this);l.forEach(n,function(a){var d=g+"/"+a.id,k=null;1===n.length&&(k=b);h=this._buildFeatureLayer(a.name,d,k,c).then(e.hitch(this,function(a){this.map.addLayer(a)}));this.currentToolSetting.allowToExport&&f.push(this._createExportNodeForUrl(a.name,d,J.TYPE_FEATURESET));f.push(h)},this);d.initialExtent&&this.map.setExtent(new k(d.initialExtent));
return u(f)}))}))},_buildFeatureLayer:function(a,d,b,g){if(null!==b){var h=new y;b.title=a;b=new E(d,{mode:E.MODE_SNAPSHOT,infoTemplate:new c(b),outFields:["*"]});b._itemId=g;h.resolve(b);return h}return f({url:d,content:{f:"json"},handleAs:"json"}).then(e.hitch(this,function(b){var e={title:a,fieldInfos:[]};l.forEach(b.fields,function(a){a.name!==b.objectIdField&&e.fieldInfos.push({fieldName:a.name,visible:!0,label:a.alias,isEditable:!1})});var f=new E(d,{mode:E.MODE_SNAPSHOT,infoTemplate:new c(e),
outFields:["*"]});f._itemId=g;return f}),e.hitch(this,function(){var a=new E(d);a._itemId=g;return a}))},_clearMessageLogs:function(){q.empty(this.messageSection);q.empty(this.outputSection);d.set(this.resultSection,"display","none");d.set(this.buttonSection,"display","none");d.set(this.resultLoading,"display","none")},_appendMessage:function(a,c){q.create("div",{"class":"job-message "+(c?c:""),innerHTML:H.stripHTML(a)},this.messageSection)},_appendExecutingMessage:function(){s("div.waiting",this.messagePanel).forEach(function(a){q.destroy(a)});
if(0===s("div.job-executing",this.messagePanel).length){var a=q.create("div",{"class":"job-message job-executing"},this.messageSection);q.create("span",{innerHTML:H.stripHTML(this.nls.executing)},a);q.create("img",{"class":"job-running-icon job-executing",src:this.folderUrl+"images/loading.gif"},a);var c=!1;!0===this.currentToolSetting.cannotCancel?c=!0:0<=this.currentToolSetting.dijitID.indexOf("EnrichLayer")&&this.currentAnalysisDijit&&this.currentAnalysisDijit.enableTravelModes&&(c=!0);c||(a=q.create("img",
{"class":"job-cancel-icon job-executing",src:this.folderUrl+"images/cancel.png",title:this.nls.cancelJob},a),this.own(g(a,"click",e.hitch(this,this._cancelTask))))}},_getLayerNameSuffix:function(a,c){if(a===c)return 1;if(/_\d+$/.test(a)&&0===a.indexOf(c)){var b=a.split("_");return Number(b[b.length-1])+1}return 0},_appendResultMessage:function(c){if(c.paramName){var d=c.paramName,b=0,f=0,g;l.forEach(this.map.graphicsLayerIds,e.hitch(this,function(a){g=this.map.getLayer(a);f=this._getLayerNameSuffix(g.title,
d);b<f&&(b=f)}));l.forEach(this.map.layerIds,e.hitch(this,function(a){a=this.map.getLayer(a);f=this._getLayerNameSuffix(a.title,d);b<f&&(b=f)}));0<b&&(d=d+"_"+b);var h=q.create("div",{"class":"output-item"},this.outputSection);if(c.value&&c.value.itemId){var k=I.getItemDetailsPageUrl(this._getPortalUrl(this.privilegeUtil.getUserPortal()),c.value.itemId);"object"===typeof this.outputProperties&&c.value.itemId===this.outputProperties.itemProperties.itemId&&(d=this.outputProperties.serviceProperties.name);
q.create("a",{href:k,target:"_blank",innerHTML:H.stripHTML(d)},h)}else a.set(h,"innerHTML",d);return d}return null},_createExportNodeForUrl:function(a,c,b){var d=new D;d.returnGeometry=b===J.TYPE_FEATURESET;d.outSpatialReference=this.map.spatialReference;d.outFields=["*"];d.where="1\x3d1";return(new F(c)).execute(d).then(e.hitch(this,function(c){var d=q.create("div",{},this.outputSection);q.create("div",{"class":"output-item",innerHTML:a},d);if(b===J.TYPE_FEATURESET)this._createExportNode(a,c,b,d);
else if(b===J.TYPE_TABLE){var e=l.map(c.features,function(a){return a.attributes}),f=[];if(c.fields)f=c.fields;else if(c.features&&0<c.features.length)for(var g in c.features[0].attributes)f.push({name:g});this._createExportNode(a,{fields:f,datas:e},b,d)}}),function(a){console.error(a.message?a.message:a)})},_createExportNode:function(a,c,b,d){d||(d=this.outputSection);a=J.createDataSource({type:b,data:c,filename:a});var f=new G({dataSource:a});f.hide();h.place(f.domNode,this.domNode);d=q.create("div",
{"class":"export-node"},d);this.own(g(d,"click",e.hitch(this,function(a){a.preventDefault();a.stopPropagation();f.show(a.clientX,a.clientY)})))},_getPortalUrl:function(a){return a?I.getStandardPortalUrl(a):I.getStandardPortalUrl(this.appConfig.portalUrl)},_cancelTask:function(){this.currentToolJobId&&this.currentAnalysisDijit&&this.currentAnalysisDijit.cancel({jobId:this.currentToolJobId})},_switchToPrevious:function(){this._deactiveDrawTool();2===this.currentStack?this._switchToAnalysisTool():this._switchView(0)},
_switchToHome:function(){this._deactiveDrawTool();1<this.toolCountInList?this._switchView(0):this._switchToAnalysisTool()},_switchView:function(a){this._closeHelpDialog();0===a&&this._checkValidation();this.currentStack=a;this.viewStack.switchView(a)}})});