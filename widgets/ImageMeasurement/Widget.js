// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/ImageServiceMeasure":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n!../nls/jsapi dojo/text!./templates/ImageServiceMeasure.html dojo/has ../kernel dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../toolbars/ImageServiceMeasureTool dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/MenuSeparator dijit/PopupMenuItem dijit/RadioMenuItem dijit/CheckedMenuItem ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/Point dojo/_base/Color dojo/dom-class dojo/_base/array ../tasks/ImageServiceMeasureParameters ../units dojo/dom-construct dijit/form/ToggleButton dojo/html".split(" "),
function(e,f,g,l,r,p,h,d,A,x,w,v,B,s,k,z,b,t,C,F,G,H,D,m,n,u,q,y,I,E){return e([h,d,A],{declaredClass:"esri.dijit.ImageServiceMeasure",templateString:l,widgetsInTemplate:!0,layer:null,map:null,layout:"dropDown",displayOperations:null,markerSymbol:null,lineSymbol:null,fillSymbol:null,displayMeasureResultInPopup:null,angularUnit:null,linearUnit:null,areaUnit:null,_supportedMeasureOperations:[],_supportedUnits:{},_currentGraphic:null,_defaultUnits:{angularUnit:"DECIMAL_DEGREES",linearUnit:"METERS",areaUnit:"SQUARE_METERS"},
_desiredDropDownOrder:"OPERATION_POINT OPERATION_DISTANCE_ANGLE OPERATION_AREA_PERIMETER OPERATION_CENTROID OPERATION_BASE_TOP OPERATION_TOP_TOP_SHADOW OPERATION_BASE_TOP_SHADOW".split(" "),_map3DOperations:{OPERATION_POINT:"OPERATION_POINT_3D",OPERATION_DISTANCE_ANGLE:"OPERATION_DISTANCE_ANGLE_3D",OPERATION_AREA_PERIMETER:"OPERATION_AREA_PERIMETER_3D",OPERATION_CENTROID:"OPERATION_CENTROID_3D",OPERATION_BASE_TOP:"OPERATION_BASE_TOP",OPERATION_TOP_TOP_SHADOW:"OPERATION_TOP_TOP_SHADOW",OPERATION_BASE_TOP_SHADOW:"OPERATION_BASE_TOP_SHADOW"},
_menu:null,_dropDownButton:null,_currentOperation:null,_activeMeasureOpMenuItem:null,_has3DOperations:!1,_enabled3DCheckbox:!1,_dropDownMenuItemMap:{},_toggleButtonMenuItemMap:{},_decimalDegreesConstantValue:"esriDUDecimalDegrees",_decimalDegreesConstantKeyword:"DECIMAL_DEGREES",constructor:function(a){e.safeMixin(this,a);this._setDefaultSymbols();this._i18n=g},startup:function(){this.inherited(arguments)},postCreate:function(){this.map&&this.layer&&(this.measureToolbar=new x({map:this.map,layer:this.layer}),
this.measureToolbar.on("draw-end",f.hitch(this,this._addGraphic)),this.measureToolbar.on("draw-start",f.hitch(this,this._onDrawStart)),this.measureToolbar.on("measure-end",f.hitch(this,this._addInfoWindow)),this.measureToolbar.on("unit-change",f.hitch(this,this._onUnitChange)),this._supportedMeasureOperations=this._getSupportedMeasureOperations(),this._has3DOperations=this._check3DSupported(),this._reorderMeasureOperations(),this._supportedUnits=this._getSupportedUnits(),this._setDefaultUnits());
this._checkValidLayoutValue();0<this._supportedMeasureOperations.length?"dropDown"===this.layout?this._populateMeasureDropdown():"toolbar"===this.layout&&this._populateMeasureButtons():E.set(this.esriImageServiceMeasure,this._i18n.widgets.imageServiceMeasure.mensurationCapabilitiesAbsentText)},_checkValidLayoutValue:function(){"dropdown"===this.layout.toLowerCase()?this.layout="dropDown":"toolbar"===this.layout.toLowerCase()?this.layout="toolbar":(this.layout="dropDown",console.log("Invalid value for layout"))},
_getUnitKeyword:function(a){var c=null,b;if(a===this._decimalDegreesConstantValue)c=this._decimalDegreesConstantKeyword;else for(b in q)q.hasOwnProperty(b)&&q[b]===a&&(c=b);return c||null},_setUnitKeyword:function(a,c){var b;this[a]?(b=this._getUnitKeyword(this[a]),b||(b=this._defaultUnits[a],console.log("Incorrect "+c+" supplied. "+c+" set to default."))):b=this._defaultUnits[a];return b},_setDefaultUnits:function(){this.linearUnit=this._setUnitKeyword("linearUnit","Linear Unit");this.areaUnit=this._setUnitKeyword("areaUnit",
"Area Unit");this.angularUnit=this._setUnitKeyword("angularUnit","Angular Unit");this.measureToolbar.setLinearUnit(q[this.linearUnit]);this.measureToolbar.setAreaUnit(q[this.areaUnit]);this.measureToolbar.setAngularUnit(q[this.angularUnit])},_getSupportedMeasureOperations:function(){var a=[],c=this.displayOperations||this.measureToolbar.getSupportedMeasureOperations(),b=this.measureToolbar.getSupportedMeasureOperations(),d;n.forEach(c,function(c){for(d in u)u.hasOwnProperty(d)&&u[d]===c&&(-1<n.indexOf(b,
c)?a.push(d):console.log(c+" is not supported by the service."))},this);return a},_getSupportedUnits:function(){var a={},c=[],b=[],d=this.measureToolbar.getSupportedUnits(),t;for(t in d)d.hasOwnProperty(t)&&(b=d[t],c=[],n.forEach(b,function(a){c.push(this._getUnitString(a))},this),a[t]=c);return a},_check3DSupported:function(){return this._isSupportedMeasureOperation("OPERATION_POINT_3D")||this._isSupportedMeasureOperation("OPERATION_DISTANCE_ANGLE_3D")||this._isSupportedMeasureOperation("OPERATION_AREA_PERIMETER_3D")||
this._isSupportedMeasureOperation("OPERATION_CENTROID_3D")},_isSupportedMeasureOperation:function(a){return-1<this._supportedMeasureOperations.indexOf(a)},_reorderMeasureOperations:function(){var a=[];n.forEach(this._desiredDropDownOrder,function(c){-1<this._supportedMeasureOperations.indexOf(c)&&a.push(c)},this);this._supportedMeasureOperations=a},_setDefaultSymbols:function(){this.markerSymbol||(this.markerSymbol=new t,this.markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z"),
this.markerSymbol.setColor(new D("#00FFFF")));this.lineSymbol||(this.lineSymbol=new C(C.STYLE_SOLID,new D([255,0,0]),1.5));this.fillSymbol||(this.fillSymbol=new F(F.STYLE_SOLID,new C(C.STYLE_DASHDOT,new D([255,0,0]),2),new D([255,255,0,0.25])))},_populateMeasureDropdown:function(){var a,c;this._menu=new v;n.forEach(this._supportedMeasureOperations,function(c){a=new B({label:this._i18n.widgets.imageServiceMeasure.operationLabel[c],iconClass:u[c]});a.on("click",f.hitch(this,this._onDropDownMenuItemClick,
c,a));this._menu.addChild(a);this._dropDownMenuItemMap[c]=a},this);c=new s;this._menu.addChild(c);this._has3DOperations&&(c=new b({label:this._i18n.widgets.imageServiceMeasure.measure3DLabel,checked:!1}),c.on("change",f.hitch(this,this._on3DCheckBoxChange)),this._menu.addChild(c),c=new s,this._menu.addChild(c));this._addUnitsMenu();this._dropDownButton=new w({dropDown:this._menu,"class":"esriImageServiceMeasureDropdownContainer"},this.measureDropDownContainer);this._dropDownButton.startup();this._currentOperation=
this._defaultOperation=this._supportedMeasureOperations[0];this._toggleButton=new w({label:this._i18n.widgets.imageServiceMeasure.operationLabel[this._defaultOperation],iconClass:u[this._defaultOperation],"class":"esriImageServiceMeasureToggleButton",dropDown:new v({"class":"esriHiddenDropDownMenu"})},this.toggleButtonDiv);this._toggleButton.startup();this._toggleButton.on("click",f.hitch(this,this._toggle))},_populateMeasureButtons:function(){var a,c,d;m.add(this.esriImageServiceMeasure,"esriImageServiceMeasureToolbarLayout");
m.add(this.measureButtonContainer,"esriImageServiceMeasureButtonContainer");this._menu=new v;n.forEach(this._supportedMeasureOperations,function(c){d=y.create("div",{innerHTML:this._i18n.widgets.imageServiceMeasure.operationLabel[c]},this.measureButtonContainer);a=new I({showLabel:!1,checked:!1,label:this._i18n.widgets.imageServiceMeasure.operationLabel[c],iconClass:u[c],baseClass:"esriMeasureButton"},d);a.on("click",f.hitch(this,this._onButtonMenuItemClick,c));this._toggleButtonMenuItemMap[c]=a},
this);this._has3DOperations&&(c=new b({label:this._i18n.widgets.imageServiceMeasure.measure3DLabel,checked:!1}),c.on("change",f.hitch(this,this._on3DCheckBoxToolbarLayoutChange)),this._menu.addChild(c),c=new s,this._menu.addChild(c));this._addUnitsMenu();c=y.create("span",{innerHTML:"|"},this.measureButtonContainer);d=y.create("div",null,this.measureButtonContainer);this._dropDownButton=new w({dropDown:this._menu,label:this._i18n.widgets.imageServiceMeasure.settings,showLabel:!1,iconClass:"esriMensurationSettingsIcon",
"class":"esriMeasureSettingsButton"},d);this._dropDownButton.startup();if("false"===this.displayMeasureResultInPopup||!1===this.displayMeasureResultInPopup||!this.displayMeasureResultInPopup)this.measureResultContainer=y.create("div",{"class":"measureResultContainer"},this.esriImageServiceMeasure),this.esriMeasurementResultLabel=y.create("div",{innerHTML:this._i18n.widgets.imageServiceMeasure.infoWindowTitle,"class":"esriMeasurementResultLabel"},this.measureResultContainer),this.measureResultStringDiv=
y.create("div",{"class":"esriMeasurementResultString"},this.measureResultContainer)},_angularUnitsReqd:function(){if(n.some(this._supportedMeasureOperations,function(a){if("OPERATION_DISTANCE_ANGLE_3D"===a||"OPERATION_DISTANCE_ANGLE"===a)return!0}))return!0},_linearUnitsReqd:function(){if(n.some(this._supportedMeasureOperations,function(a){if(0>a.indexOf("OPERATION_POINT")&&0>a.indexOf("OPERATION_CENTROID"))return!0}))return!0},_areaUnitsReqd:function(){if(n.some(this._supportedMeasureOperations,
function(a){if("OPERATION_AREA_PERIMETER_3D"===a||"OPERATION_AREA_PERIMETER"===a)return!0}))return!0},_addUnitsMenu:function(){var a,c,b;this._angularUnitsReqd()&&(this.angularUnitMenu=new v,n.forEach(this._supportedUnits.angularUnits,function(a){b=this._isCurrentAngularUnit(a);c=new z({group:"angularUnit",checked:b,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":b?"esriSelectedOption":""});b&&(this._currentAngularUnitMenuItem=c);c.on("click",f.hitch(this,this._onAngularUnitClick,
a,c));this.angularUnitMenu.addChild(c)},this),a=new k({label:this._i18n.widgets.imageServiceMeasure.angularUnits,popup:this.angularUnitMenu}),this._menu.addChild(a));this._linearUnitsReqd()&&(this.linearUnitMenu=new v,n.forEach(this._supportedUnits.linearUnits,function(a){b=this._isCurrentLinearUnit(a);c=new z({group:"linearUnit",checked:b,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":b?"esriSelectedOption":""});b&&(this._currentLinearUnitMenuItem=c);c.on("click",f.hitch(this,
this._onLinearUnitClick,a,c));this.linearUnitMenu.addChild(c)},this),a=new k({label:this._i18n.widgets.imageServiceMeasure.linearUnits,popup:this.linearUnitMenu}),this._menu.addChild(a));this._areaUnitsReqd()&&(this.areaUnitMenu=new v,n.forEach(this._supportedUnits.areaUnits,function(a){b=this._isCurrentAreaUnit(a);c=new z({group:"areaUnit",checked:b,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":b?"esriSelectedOption":""});b&&(this._currentAreaUnitMenuItem=c);c.on("click",f.hitch(this,
this._onAreaUnitClick,a,c));this.areaUnitMenu.addChild(c)},this),a=new k({label:this._i18n.widgets.imageServiceMeasure.areaUnits,popup:this.areaUnitMenu}),this._menu.addChild(a))},_on3DCheckBoxChange:function(a){var c=this._currentOperation.replace("_3D","");this._enabled3DCheckbox=a;this._dropDownButton.openDropDown();this._activeMeasureOpMenuItem&&(this._activeMeasureOpMenuItem=null,this._onDropDownMenuItemClick(c,this._dropDownMenuItemMap[c]))},_on3DCheckBoxToolbarLayoutChange:function(a){this._enabled3DCheckbox=
a;this._dropDownButton.openDropDown();this._enabled3DCheckbox||(this._currentOperation=this._currentOperation.replace("_3D",""));this._currentOperation&&this._onButtonMenuItemClick(this._currentOperation)},_onDropDownMenuItemClick:function(a,c){var b=c.domNode;this._enabled3DCheckbox&&(a=this._map3DOperations[a]);this._disableMapNavigation();this._removeDraws();this._activeMeasureOpMenuItem?(m.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),m.add(b,"esriSelectedOption"),this._activeMeasureOpMenuItem=
c,this._currentOperation=a,this._toggleButton.set({label:this._i18n.widgets.imageServiceMeasure.operationLabel[a],iconClass:u[a.replace("_3D","")]})):(this._activeMeasureOpMenuItem=c,m.add(b,"esriSelectedOption"),this._currentOperation=a,this._toggleButton.set({label:this._i18n.widgets.imageServiceMeasure.operationLabel[a],iconClass:u[a.replace("_3D","")]}),m.add(this._toggleButton._buttonNode,"esriCheckedMeasureButton"));this.measureToolbar.activate(u[a]);this.measureToolbar.showDrawTooltip()},_uncheckOtherButtons:function(a){for(var c in this._toggleButtonMenuItemMap)this._toggleButtonMenuItemMap.hasOwnProperty(c)&&
c!==a&&(0<=n.indexOf(this._supportedMeasureOperations,c)?this._toggleButtonMenuItemMap[c].set("checked",!1):delete this._toggleButtonMenuItemMap[c])},_onButtonMenuItemClick:function(a){this._removeDraws();this._enabled3DCheckbox&&(a=this._map3DOperations[a]);this._uncheckOtherButtons(a.replace("_3D",""));this._currentOperation=a;this._toggleButtonMenuItemMap[a.replace("_3D","")].checked?(this._disableMapNavigation(),this.measureToolbar.activate(u[a]),this.measureToolbar.showDrawTooltip()):(this.measureToolbar.deactivate(),
this._enableMapNavigation());this.measureResultStringDiv&&E.set(this.measureResultStringDiv,"")},_isCurrentAngularUnit:function(a){return a===this.angularUnit?!0:!1},_isCurrentLinearUnit:function(a){return a===this.linearUnit?!0:!1},_isCurrentAreaUnit:function(a){return a===this.areaUnit?!0:!1},_onLinearUnitClick:function(a,c){m.remove(this._currentLinearUnitMenuItem.domNode,"esriSelectedOption");m.add(c.domNode,"esriSelectedOption");this._currentLinearUnitMenuItem=c;this.linearUnit=a;this.measureToolbar.setLinearUnit(q[a]);
this._dropDownButton.openDropDown()},_onAngularUnitClick:function(a,c){m.remove(this._currentAngularUnitMenuItem.domNode,"esriSelectedOption");m.add(c.domNode,"esriSelectedOption");this._currentAngularUnitMenuItem=c;this.angularUnit=a;this.measureToolbar.setAngularUnit(q[a]);this._dropDownButton.openDropDown()},_onAreaUnitClick:function(a,c){m.remove(this._currentAreaUnitMenuItem.domNode,"esriSelectedOption");m.add(c.domNode,"esriSelectedOption");this._currentAreaUnitMenuItem=c;this.areaUnit=a;this.measureToolbar.setAreaUnit(q[a]);
this._dropDownButton.openDropDown()},_onDrawStart:function(){this._removeDraws()},_addGraphic:function(a){var c=a.geometry;this.measureToolbar.hideDrawTooltip();a="point"===c.type?this.markerSymbol:"line"===c.type||"polyline"===c.type?this.lineSymbol:this.fillSymbol;this._removeDraws();this._currentGraphic=a=new G(c,a);this.map.graphics.add(a)},_addInfoWindow:function(a){a=this._measureResultString(a.measureResult,a.error);"dropDown"===this.layout||"toolbar"===this.layout&&("true"===this.displayMeasureResultInPopup||
!0===this.displayMeasureResultInPopup)?this._displayInfoWindowMeasureResult(a):"toolbar"===this.layout&&this._displayToolbarMeasureResult(a)},_measureResultString:function(a,c){var b="",d,t,f,h,e;if(a)for(e in a)a.hasOwnProperty(e)&&(a[e]&&"name"!==e&&"sensorName"!==e)&&(h="point"===e&&0<=this._currentOperation.toLowerCase().indexOf("centroid")?this._i18n.widgets.imageServiceMeasure.measureDialog.Centroid:this._i18n.widgets.imageServiceMeasure.measureDialog[e.charAt(0).toUpperCase()+e.slice(1)],"point"!=
e?(d=this._i18n.widgets.imageServiceMeasure.unitLabel[this._getUnitString(a[e].unit)],f=Math.abs(a[e].uncertainty).toFixed(2),t=this._getDisplayValue(a[e]),b+="\x3cstrong\x3e"+h+"\x3c/strong\x3e: "+t+" (\x26plusmn"+f+") "+d+"\x3cbr/\x3e"):(d=a[e].value.x.toFixed(2),t=a[e].value.y.toFixed(2),b+="\x3cstrong\x3e"+h+"\x3c/strong\x3e\x3cbr/\x3e"+this._i18n.widgets.imageServiceMeasure.measureDialog.X+" : "+d+"\x3cbr/\x3e"+this._i18n.widgets.imageServiceMeasure.measureDialog.Y+" : "+t+"\x3cbr/\x3e"));else b=
this._i18n.widgets.imageServiceMeasure.measurementErrorGeneric;return b},_getDisplayValue:function(a){return this.layer.currentVersion&&10.3<=this.layer.currentVersion?0>a.uncertainty?a.value.toFixed(2):Number(a.displayValue).toString():a.value.toFixed(2)},_getUnitString:function(a){var c,b;for(c in q)q.hasOwnProperty(c)&&(q[c]===a?b=c:a===this._decimalDegreesConstantValue&&(b=this._decimalDegreesConstantKeyword));return b},_displayInfoWindowMeasureResult:function(a){var c=this._currentGraphic.geometry,
b;this._currentGraphic&&("point"===c.type?this._currentInfowindow=c:"polyline"===c.type?(b=(c.paths[0][0][0]+c.paths[0][1][0])/2,c=(c.paths[0][0][1]+c.paths[0][1][1])/2,this._currentInfowindow=new H(b,c,this.map.spatialReference)):"polygon"===c.type&&(this._currentInfowindow=c.getCentroid()),this.map.infoWindow.setTitle(this._i18n.widgets.imageServiceMeasure.infoWindowTitle),this.map.infoWindow.setContent(a),this.map.infoWindow.on("hide",f.hitch(this,this._removeAssociatedGeometry)),this.map.infoWindow.show(this._currentInfowindow))},
_displayToolbarMeasureResult:function(a){E.set(this.measureResultStringDiv,a)},_removeAssociatedGeometry:function(){this._currentGraphic&&(this.map.graphics.remove(this._currentGraphic),this._currentGraphic=null)},_removeDraws:function(){this._removeAssociatedGeometry();this._currentInfowindow&&(this.map.infoWindow.hide(this._currentInfowindow),this._currentInfowindow=null)},_onUnitChange:function(a){this._addInfoWindow(a)},_toggle:function(){this._activeMeasureOpMenuItem?(this._removeDraws(),m.remove(this._activeMeasureOpMenuItem.domNode,
"esriSelectedOption"),this._activeMeasureOpMenuItem=null,this.measureToolbar.deactivate(),m.remove(this._toggleButton._buttonNode,"esriCheckedMeasureButton"),this._enableMapNavigation()):(this._menuItem=this._dropDownMenuItemMap[this._currentOperation.replace("_3D","")],this._onDropDownMenuItemClick(this._currentOperation.replace("_3D",""),this._menuItem))},deactivate:function(){this._removeDraws();this._activeMeasureOpMenuItem&&(m.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),
this._activeMeasureOpMenuItem=null);this._toggleButton&&m.remove(this._toggleButton._buttonNode,"esriCheckedMeasureButton");this.measureResultStringDiv&&E.set(this.measureResultStringDiv,"");"toolbar"===this.layout&&this._currentOperation&&this._toggleButtonMenuItemMap[this._currentOperation.replace("_3D","")].set("checked",!1);this.measureToolbar&&this.measureToolbar.deactivate();this._enableMapNavigation()},_disableMapNavigation:function(){this.map.disableMapNavigation();this.map.setInfoWindowOnClick(!1)},
_enableMapNavigation:function(){this.map.enableMapNavigation();this.map.setInfoWindowOnClick(!0)},destroy:function(){this.inherited(arguments)}})})},"esri/toolbars/ImageServiceMeasureTool":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has ../kernel ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ./draw ../tasks/ImageServiceMeasureParameters ../tasks/ImageServiceMeasureTask ../geometry/Point dojo/_base/array ../units".split(" "),
function(e,f,g,l,r,p,h,d,A,x,w,v,B,s,k){var z=e("CustomDraw",[x],{returnCurrentPoint:function(){return this._points},hideTooltip:function(){this._options.showTooltips=!1},showTooltip:function(){this._options.showTooltips=!0}});return e(p,{declaredClass:"esri.toolbars.imageServiceMeasure",_eventMap:{"draw-end":["geometry"],"draw-start":[],"measure-end":["measureResult","error","geometry"],"unit-change":["measureResult","error","geometry"]},_mensurationCapabilitiesMap:{Basic:["OPERATION_POINT","OPERATION_DISTANCE_ANGLE",
"OPERATION_AREA_PERIMETER","OPERATION_CENTROID"],"3D":["OPERATION_POINT_3D","OPERATION_DISTANCE_ANGLE_3D","OPERATION_AREA_PERIMETER_3D","OPERATION_CENTROID_3D"],"Base-Top Height":["OPERATION_BASE_TOP"],"Top-Top Shadow Height":["OPERATION_TOP_TOP_SHADOW"],"Base-Top Shadow Height":["OPERATION_BASE_TOP_SHADOW"]},_supportedMeasureOperations:[],_operationsMap:{OPERATION_POINT:{geometryType:"POINT"},OPERATION_DISTANCE_ANGLE:{geometryType:"LINE"},OPERATION_AREA_PERIMETER:{geometryType:"POLYGON"},OPERATION_BASE_TOP:{geometryType:"LINE"},
OPERATION_BASE_TOP_SHADOW:{geometryType:"LINE"},OPERATION_TOP_TOP_SHADOW:{geometryType:"LINE"},OPERATION_CENTROID:{geometryType:"POLYGON"},OPERATION_POINT_3D:{geometryType:"POINT"},OPERATION_DISTANCE_ANGLE_3D:{geometryType:"LINE"},OPERATION_AREA_PERIMETER_3D:{geometryType:"POLYGON"},OPERATION_CENTROID_3D:{geometryType:"POLYGON"}},_supportedUnits:{linearUnits:"INCHES FEET YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS DECIMETERS METERS KILOMETERS".split(" "),angularUnits:["RADIANS","DECIMAL_DEGREES"],
areaUnits:"SQUARE_INCHES SQUARE_FEET SQUARE_YARDS ACRES SQUARE_MILES SQUARE_MILLIMETERS SQUARE_CENTIMETERS SQUARE_DECIMETERS SQUARE_METERS ARES HECTARES SQUARE_KILOMETERS".split(" ")},markerSymbol:null,lineSymbol:null,fillSymbol:null,_drawToolbar:null,_currentGeometry:null,_currentOperation:null,linearUnit:null,angularUnit:null,areaUnit:null,_decimalDegreesConstantValue:"esriDUDecimalDegrees",_decimalDegreesConstantKeyword:"DECIMAL_DEGREES",constructor:function(b){e.safeMixin(this,b);this._checkMensurationSupport();
this._setDefaultSymbols()},_checkMensurationSupport:function(){this.layer.mensurationCapabilities?this._setSupportedMeasureOperations():console.log("Mensuration Capabilities not supported.")},_setDefaultSymbols:function(){this.markerSymbol||(this.markerSymbol=new h,this.markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z"),
this.markerSymbol.setColor(new g("#00FFFF")));this.lineSymbol||(this.lineSymbol=new d(d.STYLE_SOLID,new g([255,0,0]),1.5));this.fillSymbol||(this.fillSymbol=new A(A.STYLE_SOLID,new d(d.STYLE_DASHDOT,new g([255,0,0]),2),new g([255,255,0,0.25])))},_setSupportedMeasureOperations:function(){var b;this._supportedMeasureOperations=[];this.mensurationCapabilities=this.layer.mensurationCapabilities.split(",");s.forEach(this.mensurationCapabilities,function(d){b=this._mensurationCapabilitiesMap[d];s.forEach(b,
function(b){this._supportedMeasureOperations.push(b)},this)},this)},getSupportedMeasureOperations:function(){var b=[];s.forEach(this._supportedMeasureOperations,function(d){b.push(w[d])},this);return b},getSupportedUnits:function(){var b={},d=[],e=[],f;for(f in this._supportedUnits)this._supportedUnits.hasOwnProperty(f)&&(d=this._supportedUnits[f],e=[],s.forEach(d,function(b){b===this._decimalDegreesConstantKeyword?e.push(this._decimalDegreesConstantValue):e.push(k[b])},this),b[f]=e);return b},setLinearUnit:function(b){for(var d in k)k.hasOwnProperty(d)&&
k[d]===b&&(this.linearUnit=d);this._currentGeometry&&this._getUnitChangeResults(this._currentGeometry)},setAngularUnit:function(b){for(var d in k)k.hasOwnProperty(d)&&(k[d]===b?this.angularUnit=d:b===this._decimalDegreesConstantValue&&(this.angularUnit=this._decimalDegreesConstantKeyword));this._currentGeometry&&this._getUnitChangeResults(this._currentGeometry)},setAreaUnit:function(b){for(var d in k)k.hasOwnProperty(d)&&k[d]===b&&(this.areaUnit=d);this._currentGeometry&&this._getUnitChangeResults(this._currentGeometry)},
setMarkerSymbol:function(b){this.markerSymbol=b},setLineSymbol:function(b){this.lineSymbol=b},setFillSymbol:function(b){this.fillSymbol=b},activate:function(b){s.forEach(this._supportedMeasureOperations,function(d){w[d]===b&&(this._currentOperation=d)},this);this.map.setMapCursor("crosshair");this._mapClickHandle=this.map.on("click",f.hitch(this,this._onMapClick));this._mapMouseDownHandle=this.map.on("mouse-down",f.hitch(this,this._onMapMouseDown));this._drawToolbar||(this._drawToolbar=new z(this.map,
{fillSymbol:this.fillSymbol,markerSymbol:this.markerSymbol,lineSymbol:this.lineSymbol}),this._drawToolbar.on("draw-end",f.hitch(this,this._setGeometry)));this._drawToolbar.activate(x[this._operationsMap[this._currentOperation].geometryType])},_onMapClick:function(){if(0===this._drawToolbar.returnCurrentPoint().length)this.onDrawStart()},_onMapMouseDown:function(){if(0===this._drawToolbar.returnCurrentPoint().length)this.onDrawStart()},deactivate:function(){this._drawToolbar&&this._drawToolbar.deactivate();
this.map.setMapCursor("default");this._currentOperation=this._currentGeometry=null;this._mapClickHandle&&(this._mapClickHandle.remove(),this._mapClickHandle=null);this._mapMouseDownHandle&&(this._mapMouseDownHandle.remove(),this._mapMouseDownHandle=null)},hideDrawTooltip:function(){this._drawToolbar.deactivate();this._drawToolbar.hideTooltip();this._drawToolbar.activate(x[this._operationsMap[this._currentOperation].geometryType])},showDrawTooltip:function(){this._drawToolbar.deactivate();this._drawToolbar.showTooltip();
this._drawToolbar.activate(x[this._operationsMap[this._currentOperation].geometryType])},_setGeometry:function(b){b=b.geometry;this.onDrawEnd(b);this._getMensurationResults(b);this._currentGeometry=b},_getImageServiceMeasureParameters:function(b){var d=new w;d.operation=w[this._currentOperation];d.mosaicRule=this.layer.mosaicRule;d.linearUnit=k[this.linearUnit];d.angularUnit=this.angularUnit===this._decimalDegreesConstantKeyword?this._decimalDegreesConstantValue:k[this.angularUnit];d.areaUnit=k[this.areaUnit];
"line"===b.type||"polyline"===b.type?(d.fromGeometry=new B(b.paths[0][0][0],b.paths[0][0][1],this.map.spatialReference),d.toGeometry=new B(b.paths[0][1][0],b.paths[0][1][1],this.map.spatialReference)):d.fromGeometry=b;return d},_getMensurationResults:function(b){b=this._getImageServiceMeasureParameters(b);(new v(this.layer.url)).execute(b,f.hitch(this,this._measureTaskSuccess),f.hitch(this,this._measureTaskError))},_measureTaskSuccess:function(b){this.onMeasureEnd(b,null,this._currentGeometry)},_measureTaskError:function(b){this.onMeasureEnd(null,
b,this._currentGeometry)},_getUnitChangeResults:function(b){b=this._getImageServiceMeasureParameters(b);(new v(this.layer.url)).execute(b,f.hitch(this,this._unitChangeSuccess),f.hitch(this,this._unitChangeError))},_unitChangeSuccess:function(b){this.onUnitChange(b,null,this._currentGeometry)},_unitChangeError:function(b){this.onUnitChange(null,b,this._currentGeometry)},onDrawStart:function(){},onDrawEnd:function(){},onMeasureEnd:function(){},onUnitChange:function(){}})})},"esri/tasks/ImageServiceMeasureParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(e,f,g,l,r,p){e=e(null,{declaredClass:"esri.tasks.ImageServiceMeasureParameters",fromGeometry:null,toGeometry:null,operation:null,pixelSize:null,mosaicRule:!1,linearUnit:null,angularUnit:null,areaUnit:null,toJson:function(e){var d=e&&e.fromGeometry||this.fromGeometry;e={fromGeometry:d,toGeometry:e&&e.toGeometry||this.toGeometry,measureOperation:this.operation,mosaicRule:this.mosaicRule?g.toJson(this.mosaicRule.toJson()):null,linearUnit:this.linearUnit,angularUnit:this.angularUnit,areaUnit:this.areaUnit};
d&&(e.geometryType=p.getJsonType(d));this.pixelSize&&(e.pixelSize=this.pixelSize?g.toJson(this.pixelSize.toJson()):null);return e}});f.mixin(e,{OPERATION_POINT:"esriMensurationPoint",OPERATION_DISTANCE_ANGLE:"esriMensurationDistanceAndAngle",OPERATION_AREA_PERIMETER:"esriMensurationAreaAndPerimeter",OPERATION_BASE_TOP:"esriMensurationHeightFromBaseAndTop",OPERATION_BASE_TOP_SHADOW:"esriMensurationHeightFromBaseAndTopShadow",OPERATION_TOP_TOP_SHADOW:"esriMensurationHeightFromTopAndTopShadow",OPERATION_CENTROID:"esriMensurationCentroid",
OPERATION_POINT_3D:"esriMensurationPoint3D",OPERATION_DISTANCE_ANGLE_3D:"esriMensurationDistanceAndAngle3D",OPERATION_AREA_PERIMETER_3D:"esriMensurationAreaAndPerimeter3D",OPERATION_CENTROID_3D:"esriMensurationCentroid3D"});return e})},"esri/tasks/ImageServiceMeasureTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task".split(" "),function(e,f,g,l,r,p,h){e=e(h,{declaredClass:"esri.tasks.ImageServiceMeasureTask",constructor:function(d){this._url.path+=
"/measure";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["fromGeometry","toGeometry"]}],e:2}],_handler:function(d,e,f,h,l){try{this._successHandler([d],"onComplete",f,l)}catch(r){this._errorHandler(r,h,l)}},execute:function(d,e,h,l){var g=l.assembly;d=this._encode(f.mixin({},this._url.query,{f:"json"},d.toJson(g&&g[0])));var p=this._handler,s=this._errorHandler;return r({url:this._url.path,content:d,callbackParamName:"callback",load:function(d,f){p(d,f,e,h,l.dfd)},
error:function(d){s(d,h,l.dfd)}})},onComplete:function(){}});p._createWrappers(e);return e})},"dijit/PopupMenuItem":function(){define("dojo/_base/declare dojo/dom-style dojo/_base/lang dojo/query ./popup ./registry ./MenuItem ./hccss".split(" "),function(e,f,g,l,r,p,h){return e("dijit.PopupMenuItem",h,{baseClass:"dijitMenuItem dijitPopupMenuItem",_fillContent:function(){if(this.srcNodeRef){var d=l("*",this.srcNodeRef);this.inherited(arguments,[d[0]]);this.dropDownContainer=this.srcNodeRef}},_openPopup:function(d,
e){var f=this.popup;r.open(g.delegate(d,{popup:this.popup,around:this.domNode}));e&&f.focus&&f.focus()},_closePopup:function(){r.close(this.popup);this.popup.parentMenu=null},startup:function(){if(!this._started){this.inherited(arguments);if(!this.popup){var d=l("[widgetId]",this.dropDownContainer)[0];this.popup=p.byNode(d)}this.ownerDocumentBody.appendChild(this.popup.domNode);this.popup.domNode.setAttribute("aria-labelledby",this.containerNode.id);this.popup.startup();this.popup.domNode.style.display=
"none";this.arrowWrapper&&f.set(this.arrowWrapper,"visibility","");this.focusNode.setAttribute("aria-haspopup","true")}},destroyDescendants:function(d){this.popup&&(this.popup._destroyed||this.popup.destroyRecursive(d),delete this.popup);this.inherited(arguments)}})})},"dijit/RadioMenuItem":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/query!css2 ./CheckedMenuItem ./registry".split(" "),function(e,f,g,l,r,p){return f("dijit.RadioButtonMenuItem",r,{baseClass:"dijitMenuItem dijitRadioMenuItem",
role:"menuitemradio",checkedChar:"*",group:"",_setGroupAttr:"domNode",_setCheckedAttr:function(f){this.inherited(arguments);this._created&&f&&this.group&&e.forEach(this._getRelatedWidgets(),function(d){d!=this&&d.checked&&d.set("checked",!1)},this)},_onClick:function(e){!this.disabled&&!this.checked&&(this.set("checked",!0),this.onChange(!0));this.onClick(e)},_getRelatedWidgets:function(){var e=[];l("[group\x3d"+this.group+"][role\x3d"+this.role+"]").forEach(function(d){(d=p.getEnclosingWidget(d))&&
e.push(d)});return e}})})},"widgets/ImageMeasurement/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:esri/dijit/templates/ImageServiceMeasure.html":'\x3cdiv data-dojo-attach-point\x3d"esriImageServiceMeasure" class\x3d"esriImageServiceMeasure"\x3e\r\n  \x3cdiv class\x3d"esriImageServiceMeasureToggleButton" data-dojo-attach-point\x3d"toggleButtonDiv"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriImageServiceMeasureDropdownContainer" data-dojo-attach-point\x3d"measureDropDownContainer"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"measureButtonContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/ImageMeasurement/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"measureWidgetDiv"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n\r\n\r\n',"url:widgets/ImageMeasurement/css/style.css":".esriImageServiceMeasureToolbarLayout {border: none; box-shadow: none; border-radius: none;}","*now":function(e){e(['dojo/i18n!*preload*widgets/ImageMeasurement/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/dijit/ImageServiceMeasure"],function(e,f,g){return e([f],{baseClass:"jimu-widget-ImageMeasurement",name:"ImageMeasurement",imageServiceMeasureWidget:null,startup:function(){this.inherited(arguments);var e=this.config.ImageMeasurement,f=this._getLayerId(this.config.ImageMeasurement.layerTitle);this.imageServiceMeasureWidget=new g({map:this.map,layer:this.map.getLayer(f),displayMeasureResultInPopup:e.displayMeasureResultInPopup,layout:"toolbar",linearUnit:e.linearUnit,
angularUnit:e.angularUnit,areaUnit:e.areaUnit,displayOperations:e.displayOperations},this.measureWidgetDiv);this.imageServiceMeasureWidget.startup()},onClose:function(){this.imageServiceMeasureWidget.deactivate()},_getLayerId:function(e){var f=this.map.itemInfo.itemData.operationalLayers,g,h;for(g in f)f.hasOwnProperty(g)&&f[g].title===e&&(h=f[g].id);return h}})});