// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(l,k,s,r,e,p,b,m,u,v,n){return l(v,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},
constructor:function(a){this._geocodeHandler=k.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=k.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=k.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(a){this.outSpatialReference=a},_geocodeHandler:function(a,q,g,c,A){try{var b=a.candidates,h;q=[];var d,t=b.length,f=a.spatialReference,w;for(d=0;d<t;d++){h=b[d];if(w=h.location)w.spatialReference=
f;q[d]=new n(h)}this._successHandler([q],"onAddressToLocationsComplete",g,A)}catch(m){this._errorHandler(m,c,A)}},_geocodeAddressesHandler:function(a,q,g,c,b){try{var m=a.locations;q=[];var h,d=m.length,t=a.spatialReference,f;for(h=0;h<d;h++){if(f=m[h].location)f.spatialReference=t;q[h]=new n(m[h])}this._successHandler([q],"onAddressesToLocationsComplete",g,b)}catch(w){this._errorHandler(w,c,b)}},addressToLocations:function(a,q,g,c,b){var n,h,d,t,f,w,F;a.address&&(c=g,g=q,q=a.outFields,b=a.searchExtent,
F=a.countryCode,n=a.magicKey,h=a.distance,w=a.categories,a.location&&this.normalization&&(d=a.location.normalize()),t=a.maxLocations,f=a.forStorage,a=a.address);b&&(b=b.shiftCentralMeridian());var x=this.outSpatialReference;a=this._encode(k.mixin({},this._url.query,a,{f:"json",outSR:x&&e.toJson(x.toJson()),outFields:q&&q.join(",")||null,searchExtent:b&&e.toJson(b.toJson()),category:w&&w.join(",")||null,countryCode:F||null,magicKey:n||null,distance:h||null,location:d||null,maxLocations:t||null,forStorage:f||
null}));var y=this._geocodeHandler,l=this._errorHandler,p=new r(u._dfdCanceller);p._pendingDfd=m({url:this._url.path+"/findAddressCandidates",content:a,callbackParamName:"callback",load:function(a,d){y(a,d,g,c,p)},error:function(a){l(a,c,p)}});return p},suggestLocations:function(a){var q;q=new r(u._dfdCanceller);a.hasOwnProperty("location")&&this.normalization&&(a.location=a.location.normalize());a.searchExtent&&(a.searchExtent=a.searchExtent.shiftCentralMeridian());a=this._encode(k.mixin({},this._url.query,
{f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:a.searchExtent&&e.toJson(a.searchExtent.toJson()),category:a.categories&&a.categories.join(",")||null,countryCode:a.countryCode||null,location:a.location||null,distance:a.distance||null},{f:"json"}));a=m({url:this._url.path+"/suggest",content:a,callbackParamName:"callback"});q._pendingDfd=a;a.then(k.hitch(this,function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);q.resolve(a)}),k.hitch(this,function(a){this._errorHandler(a);
q.reject(a)}));return q},addressesToLocations:function(a,q,g){var c=this.outSpatialReference,b=[],n=a.categories,h=a.countryCode;s.forEach(a.addresses,function(a,d){b.push({attributes:a})});a=this._encode(k.mixin({},this._url.query,{category:n&&n.join(",")||null,sourceCountry:h||null},{addresses:e.toJson({records:b})},{f:"json",outSR:c&&e.toJson(c.toJson())}));var d=this._geocodeAddressesHandler,t=this._errorHandler,f=new r(u._dfdCanceller);f._pendingDfd=m({url:this._url.path+"/geocodeAddresses",
content:a,callbackParamName:"callback",load:function(a,c){d(a,c,q,g,f)},error:function(a){t(a,g,f)}});return f},_reverseGeocodeHandler:function(a,q,g,c,b){try{var m=new n({address:a.address,location:a.location,score:100});this._successHandler([m],"onLocationToAddressComplete",g,b)}catch(h){this._errorHandler(h,c,b)}},locationToAddress:function(a,q,g,c){a&&this.normalization&&(a=a.normalize());var b=this.outSpatialReference;a=this._encode(k.mixin({},this._url.query,{outSR:b&&e.toJson(b.toJson()),location:a&&
e.toJson(a.toJson()),distance:q,f:"json"}));var n=this._reverseGeocodeHandler,h=this._errorHandler,d=new r(u._dfdCanceller);d._pendingDfd=m({url:this._url.path+"/reverseGeocode",content:a,callbackParamName:"callback",load:function(a,f){n(a,f,g,c,d)},error:function(a){h(a,c,d)}});return d},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}})})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(l,k,s,r,e){return l(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(p){k.mixin(this,p);this.location=new e(this.location)}})})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(l,k,s,r,e,p,b,m){return l(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,
outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var e={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},k=this.distances,n=this.outSpatialReference,a=this.bufferSpatialReference,q=s.map(this.geometries,function(a){a="extent"===a.type?b.fromExtent(a):a;return a.toJson()},this),g=this.geometries;if(g&&0<g.length){var c="extent"===g[0].type?"esriGeometryPolygon":m.getJsonType(g[0]);e.geometries=r.toJson({geometryType:c,
geometries:q});e.inSR=g[0].spatialReference.wkid?g[0].spatialReference.wkid:r.toJson(g[0].spatialReference.toJson())}k&&(e.distances=k.join(","));n&&(e.outSR=n.wkid?n.wkid:r.toJson(n.toJson()));a&&(e.bufferSR=a.wkid?a.wkid:r.toJson(a.toJson()));return e}})})},"widgets/IncidentAnalysis/js/SummaryInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/CSVUtils jimu/utils esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query".split(" "),
function(l,k,s,r,e,p,b,m,u,v,n,a,q,g,c,A,C,h,d,t,f,w,F,x,y,J,B){return l("SummaryInfo",null,{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],constructor:function(a,d,f){this.tab=a;this.container=d;this.parent=f;this.config=f.config;this.buffer=this.incident=this.summaryLayer=null},updateForIncident:function(a,d){this.container.innerHTML="";p.add(this.container,"loading");this.incident=a;this.buffer=d;this.summaryIds=[];this.summaryFeatures=[];if(this.summaryLayer)this._queryFeatures(d.geometry);
else{var f=new w(this.tab.tabLayers[0].url);v(f,"load",s.hitch(this,function(){f.capabilities&&-1<f.capabilities.indexOf("Query")?(this.summaryLayer=f,this.summaryFields=this._getFields(this.summaryLayer),this._queryFeatures(d.geometry)):this._processError()}));v(this.parent.opLayers,"layerInfosFilterChanged",s.hitch(this,this._layerFilterChanged))}},_layerFilterChanged:function(a){if(!(null===this.summaryLayer||null===this.incident||null===this.buffer)){var d=this.tab.tabLayers[0].id;k.forEach(a,
s.hitch(this,function(a){d===a.id&&this.updateForIncident(this.incident,this.buffer)}))}},_queryFeatures:function(a){var d=this.tab.tabLayers[0].id,f="";this.parent.opLayers.traversal(function(a){if(d===a.id&&a.getFilter())return f=a.getFilter(),!0});var c=new B;c.geometry=a;c.where=f;this.summaryLayer.queryIds(c,s.hitch(this,function(a){a?(this.summaryIds=a,0<this.summaryIds.length?this._queryFeaturesByIds():this._processResults()):this._processResults()}))},_queryFeaturesByIds:function(){var a=
this.summaryLayer.maxRecordCount||1E3,d=this.summaryIds.slice(0,a);this.summaryIds.splice(0,a);var a=new B,f=!1;k.some(this.summaryFields,function(a){if("area"===a.type||"length"===a.type)return f=!0});a.returnGeometry=f;var c=[];k.forEach(this.summaryFields,function(a){c.push(a.field)});a.outFields=c;a.objectIds=d;this.summaryLayer.queryFeatures(a,s.hitch(this,function(a){this.summaryFeatures=this.summaryFeatures.concat(a.features);this._processResults();0<this.summaryIds.length?(e.byId("IMT_download")&&
p.replace(e.byId("IMT_download"),"processing","download"),setTimeout(s.hitch(this,this._queryFeaturesByIds),900)):e.byId("IMT_download")&&p.replace(e.byId("IMT_download"),"download","processing")}))},_prepResults:function(){for(var a=0;a<this.summaryFields.length;a++){var d=this.summaryFields[a],f=d.field,c=d.value;switch(d.type){case "count":c=this.summaryFeatures.length;break;case "area":c=this._getArea();break;case "length":c=this._getLength();break;case "sum":c=this._getSum(f);break;case "avg":c=
this._getSum(f)/this.summaryFeatures.length;break;case "min":c=this._getMin(f);break;case "max":c=this._getMax(f)}d.value=c}},_sortResults:function(a){return function(d,f){return d.attributes[a]<f.attributes[a]?-1:d.attributes[a]>f.attributes[a]?1:0}},_getSum:function(a){var d=0;k.forEach(this.summaryFeatures,function(f){d+=f.attributes[a]});return d},_getMin:function(a){this.summaryFeatures.sort(this._sortResults(a));return this.summaryFeatures[0].attributes[a]},_getMax:function(a){this.summaryFeatures.sort(this._sortResults(a));
this.summaryFeatures.reverse();return this.summaryFeatures[0].attributes[a]},_getArea:function(){var a=0,d=s.clone(this.config.distanceSettings);d.miles=109413;d.kilometers=109414;d.feet=109405;d.meters=109404;d.yards=109442;d.nauticalMiles=109409;var f=d[this.config.distanceUnits];k.forEach(this.summaryFeatures,function(d){a+=C.geodesicArea(d.geometry,f)});return a},_getLength:function(){var a=0,d=this.config.distanceSettings[this.config.distanceUnits];k.forEach(this.summaryFeatures,function(f){a+=
C.geodesicLength(f.geometry,d)});return a},_processError:function(){this.container.innerHTML="";p.remove(this.container,"loading");this.container.innerHTML=this.parent.nls.noFeaturesFound},_processResults:function(){this._prepResults();this.container.innerHTML="";p.remove(this.container,"loading");var a=this.summaryFields,d=0,f=b.create("div",{id:"tpc",style:"width:"+220*(a.length+1)+"px;"},this.container);p.add(f,"IMT_tabPanelContent");var h=b.create("div",{},f);p.add(h,"IMTcol");h=b.create("div",
{id:"IMT_download",innerHTML:this.parent.nls.downloadCSV},h);p.add(h,["btnExport","download"]);v(h,"click",s.hitch(this,this._exportToCSV));for(h=0;h<a.length;h++){var d=a[h],t=c.sanitizeHTML(d.alias?d.alias:"")+"\x3cbr/\x3e",d=d.alias===this.parent.nls.area||d.alias===this.parent.nls.length?d.value:Math.round(d.value);isNaN(d)&&(d=0);t+="\x3cdiv class\x3d'colSummary'\x3e"+u.format(d)+"\x3c/div\x3e\x3cbr/\x3e";t=b.create("div",{id:"Demographics_"+h,innerHTML:t},f);p.add(t,"IMTcol")}},_exportToCSV:function(){if(0===
this.summaryFeatures.length)return!1;console.log(this.tab);var a=this.tab.layers,d=[],f=[];k.forEach(this.summaryFeatures,function(a){d.push(a.attributes)});for(var c in d[0])f.push(c);g.exportCSV(a,d,f)},_getFields:function(a){var d=[];if(this.tab.advConfig&&this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)return k.forEach(this.tab.advConfig.fields,s.hitch(this,function(a){var f="";"count"!==a.type&&("area"!==a.type&&"length"!==a.type)&&(f=" (\x3cspan style\x3d'font-size:7pt;'\x3e"+
this.parent.nls[a.type]+"\x3c/span\x3e)");d.push({field:a.expression,alias:a.label+f,type:a.type,value:0})})),d;var f;f=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var c=0;c<f.length;c++){var h=f[c],t=h.fieldName||h.name,q=this._getFieldType(a.fields,t),b=null;if(t!==a.objectIdField&&("esriFieldTypeDouble"===q||"esriFieldTypeInteger"===q||"esriFieldTypeSmallInteger"===q))"undefined"!==typeof h.visible?h.visible&&(b={field:h.fieldName,alias:h.label,type:"sum",value:0}):b={field:h.name,
alias:h.alias,type:"sum",value:0},b&&d.push(b)}return d},_getFieldType:function(a,d){var f;k.some(a,function(a){if(a.name===d)return f=a.type,!0});return f}})})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),function(l,k,s,r,e,p,b,m,u,v){function n(a){var q=k.clone(a.attributes);if((a=a.geometry)&&"point"===a.type)"x"in q?q._x=a.x:q.x=a.x,"y"in q?q._y=a.y:q.y=
a.y;return q}l.exportCSV=function(a,q,b){return l._createCSVStr(q,b).then(function(c){return l._download(a+".csv",c)})};l.exportCSVFromFeatureLayer=function(a,b,g){g=g||{};return l._getExportData(b,{datas:g.datas,fromClient:g.fromClient,withGeometry:g.withGeometry,outFields:g.outFields,filterExpression:g.filterExpression}).then(function(c){return l._formattedData(b,c,{formatNumber:g.formatNumber,formatDate:g.formatDate,formatCodedValue:g.formatCodedValue,popupInfo:g.popupInfo}).then(function(c){return l.exportCSV(a,
c.datas,c.columns)})})};l.exportCSVByAttributes=function(a,b,g,c){c=k.mixin({},c);c.datas=g;return l.exportCSVFromFeatureLayer(a,b,c)};l.exportCSVByGraphics=function(a,b,g,c){g=s.map(g,function(a){return a.attributes});return l.exportCSVByAttributes(a,b,g,c)};l._createCSVStr=function(a,b){var g=new p,c="",m=0,e=0,h="",d="";try{s.forEach(b,function(a){c=c+h+a;h=","});for(var c=c+"\r\n",m=a.length,e=b.length,t=0;t<m;t++){for(var h="",f=0;f<e;f++)d=a[t][b[f]],!d&&"number"!==typeof d&&(d=""),d&&/[",\r\n]/g.test(d)&&
(d='"'+d.replace(/(")/g,'""')+'"'),c=c+h+d,h=",";c+="\r\n"}g.resolve(c)}catch(w){console.error(w),g.resolve("")}return g};l._isIE11=function(){return 11===b.has("ie")};l._isEdge=function(){return b.has("edge")};l._getDownloadUrl=function(a){return window.Blob&&window.URL&&window.URL.createObjectURL?(a=new Blob(["\ufeff"+a],{type:"text/csv"}),URL.createObjectURL(a)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(a)};l._download=function(a,b){var g=new p;try{if(e("ie")&&10>e("ie")){var c=
window.top.open("about:blank","_blank");c.document.write("sep\x3d,\r\n"+b);c.document.close();c.document.execCommand("SaveAs",!0,a);c.close()}else if(10===e("ie")||l._isIE11()||l._isEdge()){var m=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(m,a)}else{var n=r.create("a",{href:l._getDownloadUrl(b),target:"_blank",download:a},document.body);if(e("safari")){var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0);n.dispatchEvent(h)}else n.click();r.destroy(n)}g.resolve()}catch(d){g.reject(d)}return g};
l._getExportData=function(a,b){var g=new p,c=null,m=b.datas,e=b.withGeometry,c=b.outFields;if(!c||!c.length)c=a.fields;c=k.clone(c);if(e&&!(m&&0<m.length)){var h="",h=-1!==c.indexOf("x")?"_x":"x";c.push({name:h,alias:h,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});h=-1!==c.indexOf("y")?"_y":"y";c.push({name:h,alias:h,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}m&&0<m.length?g.resolve({data:m||[],outFields:c}):b.fromClient?(m=s.map(a.graphics,
function(a){return e?n(a):k.clone(a)}),g.resolve({data:m||[],outFields:c})):l._getExportDataFromServer(a,c,b).then(function(a){g.resolve({data:a||[],outFields:c})});return g};l._getExportDataFromServer=function(a,b,g){var c=new p;if("esri.layers.FeatureLayer"!==a.declaredClass)return c.resolve([]),c;var m=new u(a.url),e=new v;e.where=g.filterExpression||a.getDefinitionExpression&&a.getDefinitionExpression()||"1\x3d1";0<b.length?(a=s.map(b,function(a){return a.name}),e.outFields=a):e.outFields=["*"];
e.returnGeometry=g.withGeometry;m.execute(e,function(a){a=s.map(a.features,function(a){return n(a)});c.resolve(a)},function(a){console.error(a);c.resolve([])});return c};l._formattedData=function(a,b,g){var c=new p,m=[],e=b.data;b=b.outFields;for(var h=0,d=e.length;h<d;h++){for(var t={},f=0;f<b.length;f++){var w=b[f];t[w.alias||w.name]=l._getExportValue(e[h][w.name],w,a.objectIdField,a.typeIdField,e[h][a.typeIdField],a.types,g)}m.push(t)}a=s.map(b,function(a){return a.alias||a.name});c.resolve({datas:m,
columns:a});return c};l._getExportValue=function(a,e,g,c,n,k,h){function d(a){if(t&&m.isDefined(t.fieldInfos))for(var d=0,f=t.fieldInfos.length;d<f;d++){var c=t.fieldInfos[d];if(c.fieldName===a)return c.format}return null}var t=h.popupInfo,f=!!e.domain&&h.formatCodedValue;h="esriFieldTypeDate"===e.type&&h.formatDate;var w=g&&e.name===g;c=c&&e.name===c;return h?b.fieldFormatter.getFormattedDate(a,d(e.name)):c?b.fieldFormatter.getTypeName(a,k):f?b.fieldFormatter.getCodedValue(e.domain,a):!f&&!h&&!w&&
!c?(f=null,g&&k&&0<k.length&&(g=(g=s.filter(k,function(a){return a.id===n}))&&g[0])&&(g.domains&&g.domains[e.name]&&g.domains[e.name].codedValues)&&(f=b.fieldFormatter.getCodedValue(g.domains[e.name],a)),null!==f?f:a):a}})},"widgets/IncidentAnalysis/js/WeatherInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct esri/geometry/webMercatorUtils esri/request".split(" "),function(l,k,s,r,e,p){return l("WeatherInfo",null,{constructor:function(b,e,k){this.tab=b;this.container=
e;this.parent=k;this.weatherURL=b.url;this.weatherDict={119:["Cloudy","cloudy5.png","cloudy5.png"],377:["Moderate or heavy showers of ice pellets","hail.png","hail.png"],374:["Light showers of ice pellets","hail.png","hail.png"],350:["Ice pellets","hail.png","hail.png"],353:["Light rain shower","light_rain.png","light_rain.png"],302:["Moderate rain","light_rain.png","light_rain.png"],296:["Light rain","light_rain.png","light_rain.png"],293:["Patchy light rain","light_rain.png","light_rain.png"],266:["Light drizzle",
"light_rain.png","light_rain.png"],263:["Patchy light drizzle","light_rain.png","light_rain.png"],122:["Overcast","overcast.png","overcast.png"],359:["Torrential rain shower","shower3.png","shower3.png"],308:["Heavy rain","shower3.png","shower3.png"],365:["Moderate or heavy sleet showers","sleet.png","sleet.png"],362:["Light sleet showers","sleet.png","sleet.png"],320:["Moderate or heavy sleet","sleet.png","sleet.png"],317:["Light sleet","sleet.png","sleet.png"],314:["Moderate or Heavy freezing rain",
"sleet.png","sleet.png"],311:["Light freezing rain","sleet.png","sleet.png"],284:["Heavy freezing drizzle","sleet.png","sleet.png"],281:["Freezing drizzle","sleet.png","sleet.png"],185:["Patchy freezing drizzle nearby","sleet.png","sleet.png"],182:["Patchy sleet nearby","sleet.png","sleet.png"],395:["Moderate or heavy snow in area with thunder","snow4.png","snow4.png"],335:["Patchy heavy snow","snow4.png","snow4.png"],230:["Blizzard","snow4.png","snow4.png"],227:["Blowing snow","snow4.png","snow4.png"],
371:["Moderate or heavy snow showers","snow5.png","snow5.png"],338:["Heavy snow","snow5.png","snow5.png"],389:["Moderate or heavy rain in area with thunder","tstorm3.png","tstorm3.png"],392:["Patchy light snow in area with thunder","snow2.png","snow2_night.png"],386:["Patchy light rain in area with thunder","tstorm1.png","tstorm1_night.png"],368:["Light snow showers","snow2.png","snow2_night.png"],356:["Moderate or heavy rain shower","shower2.png","shower2_night.png"],332:["Moderate snow","snow3.png",
"snow3_night.png"],329:["Patchy moderate snow","snow2.png","snow2_night.png"],326:["Light snow","snow1.png","snow1_night.png"],323:["Patchy light snow","snow1.png","snow1_night.png"],305:["Heavy rain at times","shower2.png","shower2_night.png"],299:["Moderate rain at times","shower2.png","shower2_night.png"],260:["Freezing fog","fog.png","fog_night.png"],248:["Fog","fog.png","fog_night.png"],200:["Thundery outbreaks in nearby","tstorm1.png","tstorm1_night.png"],179:["Patchy snow nearby","snow1.png",
"snow1_night.png"],176:["Patchy rain nearby","shower1.png","shower1_night.png"],143:["Mist","mist.png","mist_night.png"],116:["Partly Cloudy","cloudy3.png","cloudy3_night.png"],113:["Clear/Sunny","sunny.png","sunny_night.png"]}},updateForIncident:function(b){this.container.innerHTML="";s.add(this.container,"loading");var m=b=b.geometry;"point"!==b.type&&(m=b.getExtent().getCenter());b=e.webMercatorToGeographic(m);p({url:this.weatherURL+"\x26callbackNode\x3d"+this.parent.domNode.id+"\x26q\x3d"+(b.y+
","+b.x),callbackParamName:"callback"},{useProxy:!1}).then(k.hitch(this,function(b){return this._resultsHandler(b)}),k.hitch(this,function(b){b=this._errorHandler(b);console.log(b)}))},_resultsHandler:function(b){b=b.data;console.log(b);var e=b.current_condition;b=b.weather;var k=1;this.container.innerHTML="";s.remove(this.container,"loading");var p=r.create("div",{id:"tpc",style:"width:"+165*(b.length+3)+"px;"},this.container);s.add(p,"IMT_tabPanelContent");var n,a;if(0<e.length){e=e[0];n=e.localObsDateTime.split(" ");
a=n[2];n=n[1].split(":");n=parseInt(n[0],10);if("AM"===a){if(6>n||12===n)k=2}else 6<n&&12>n&&(k=2);a=e.temp_F;n=e.weatherCode;n=this.weatherDict[parseInt(n,10)];n=this.parent.nls.now+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+n[k]+"' /\x3e\x3cbr/\x3e"+a+"\x26deg;";a=r.create("div",{innerHTML:n},p);s.add(a,"IMTcolSmall");n=this.parent.nls.wind+"\x3cbr/\x3e\x3cspan style\x3d'font-size: 30px; line-height:47px'\x3e"+e.winddir16Point+"\x3c/span\x3e\x3cbr/\x3e"+
e.windspeedMiles+" MPH";e=r.create("div",{innerHTML:n},p);s.add(e,"IMTcolSmall")}for(a=0;a<b.length;a++){var e=b[a],q=this._getDay(e.date),g=e.tempMaxF||e.maxtempF,c=e.tempMinF||e.mintempF;n=e.weatherCode||e.hourly[0].weatherCode;n=this.weatherDict[parseInt(n,10)];n=q+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+n[k]+"' /\x3e\x3cbr/\x3e"+g+"\x26deg; | "+c+"\x26deg;";e=r.create("div",{innerHTML:n},p);s.add(e,"IMTcolSmall")}b=r.create("div",{innerHTML:'\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d"font-size:11px;color:#6e6e6e"\x3ePowered by\x3cbr/\x3e\x3ca style\x3d"color:#6e6e6e;text-decoration:none" href\x3d"http://www.worldweatheronline.com/" title\x3d"Free Weather API" target\x3d"_blank"\x3eWorld Weather Online\x3c/a\x3e\x3c/span\x3e'},
p);s.add(b,"IMTcolSmall");s.add(b,"IMTcolLast")},_getDay:function(b){b=b.split("-");b="SUN MON TUE WED THU FRI SAT".split(" ")[(new Date(b[0],b[1]-1,b[2])).getDay()];return this.parent.nls[b]},_errorHandler:function(b){console.log(b.message);b=r.create("div",{innerHTML:b.message},this.container);s.add(b,"IMTcolSmall")}})})},"widgets/IncidentAnalysis/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/dom-class dojo/dom-construct dojo/dom-style dojo/on esri/geometry/geometryEngine esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query".split(" "),
function(l,k,s,r,e,p,b,m,u,v,n,a,q,g,c,A,C){return l("ClosestInfo",null,{constructor:function(a,d,b){this.tab=a;this.container=d;this.parent=b;this.graphicsLayer=this.distance=this.incident=this.featureLayer=null;this.map=b.map;this.specialFields={}},updateForIncident:function(b,d,c){if(this.featureLayer)this.processIncident(b,d,c);else if(0<this.tab.tabLayers.length){var f=new a(this.tab.tabLayers[0].url);m(f,"load",k.hitch(this,function(){f.capabilities&&-1<f.capabilities.indexOf("Query")?(this.featureLayer=
f,this.processIncident(b,d,c)):this._processError()}));m(this.parent.opLayers,"layerInfosFilterChanged",k.hitch(this,this._layerFilterChanged))}},_layerFilterChanged:function(a){if(!(null===this.featureLayer||null===this.incident||null===this.distance||null===this.graphicsLayer)){var d=this.tab.tabLayers[0].id;r.forEach(a,k.hitch(this,function(a){d===a.id&&this.processIncident(this.incident,this.distance,this.graphicsLayer)}))}},processIncident:function(a,d,b){this.container.innerHTML="";e.add(this.container,
"loading");var f=[];this.incident=a;this.distance=d;d=u.buffer(a.geometry,d,this.parent.config.distanceSettings[this.parent.config.distanceUnits]);this.graphicsLayer=b;this.graphicsLayer.clear();var c=this.tab.tabLayers[0].id,g="";this.parent.opLayers.traversal(function(a){if(c===a.id&&a.getFilter())return g=a.getFilter(),!0});b=new C;b.returnGeometry=!0;b.geometry=d;b.where=g;b.outFields=this._getFields(this.featureLayer);b.outSpatialReference=this.parent.map.spatialReference;this.featureLayer.queryFeatures(b,
k.hitch(this,function(d){var b=this._getFields(this.featureLayer);d=d.features;if(0<d.length){for(var c=0;c<d.length;c++){for(var e=d[c],t={DISTANCE:this._getDistance(a.geometry,e.geometry)},g=0;g<b.length;g++)t[b[g]]=e.attributes[b[g]];e.attributes=t}d.sort(this._compareDistance);f.push(d[0]);this._processResults(f)}}),k.hitch(this,this._processError))},_processError:function(){this.container.innerHTML="";e.remove(this.container,"loading");this.container.innerHTML=this.parent.nls.noFeaturesFound},
_processResults:function(a){this.container.innerHTML="";e.remove(this.container,"loading");0===a.length&&(this.container.innerHTML=this.parent.nls.noFeaturesFound);var d=p.create("div",{id:"tpc",style:"width:"+220*a.length+"px;"},this.container);e.add(d,"IMT_tabPanelContent");for(var t=this.parent.nls[this.parent.config.distanceUnits],f=0;f<a.length;f++){var w=f+1,l=a[f],x=l.geometry,y=x;"point"!==x.type&&(y=x.getExtent().getCenter());var l=l.attributes,r=t+": "+Math.round(100*l.DISTANCE)/100,x="",
B=0,z;for(z in l)"DISTANCE"!==z&&3>B&&(x+=this._getFieldValue(z,l[z])+"\x3cbr/\x3e",B+=1);B=p.create("div",{id:"Feature_"+w},d);e.add(B,"IMTcolRec");var u=p.create("div",{},B);e.add(u,"IMTcolRecBar");var v=p.create("div",{innerHTML:w},u);e.add(v,"IMTcolRecNum");b.set(v,"backgroundColor",this.parent.config.color);m(v,"click",k.hitch(this,this._zoomToLocation,y));r=p.create("div",{innerHTML:r},u);e.add(r,"IMTcolDistance");this.parent.config.enableRouting&&(r=p.create("div",{},u),e.add(r,"IMTcolDir"),
m(r,"click",k.hitch(this,this._routeToIncident,y)));x=p.create("div",{innerHTML:x},B);e.add(x,"IMTcolInfo");x=new g(g.STYLE_SOLID,new s.fromString(this.parent.config.color),1);x=new q(q.STYLE_CIRCLE,24,x,new s.fromString(this.parent.config.color));B=new c;B.family="Arial";B.size="12px";w=new A(w,B,"#ffffff");w.setOffset(0,-4);this.graphicsLayer.add(new n(y,x,l));this.graphicsLayer.add(new n(y,w,l))}},_getFields:function(a){var d=[];if(this.tab.advConfig&&this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)r.forEach(this.tab.advConfig.fields,
function(a){d.push(a.expression)});else{var b;b=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var f=0;f<b.length;f++){var c=b[f];"undefined"!==typeof c.visible?c.visible&&d.push(c.fieldName):d.push(c.name)}}var e={};r.forEach(a.fields,function(a){if("esriFieldTypeDate"===a.type||a.domain)e[a.name]=a});this.specialFields=e;return d},_getFieldValue:function(a,d){var b=d;if(this.specialFields[a]){var f=this.specialFields[a];"esriFieldTypeDate"===f.type?b=(new Date(d)).toLocaleString():r.some(f.domain.codedValues,
function(a){if(a.code===d)return b=a.name,!0})}return b},_getDistance:function(a,d){var b=0;4326===a.spatialReference.wkid&&(a=v.geographicToWebMercator(a));4326===d.spatialReference.wkid&&(d=v.geographicToWebMercator(d));var f=this.parent.config.distanceUnits,b=u.distance(a,d,9001);switch(f){case "miles":b*=6.21371E-4;break;case "kilometers":b*=0.0010;break;case "feet":b*=3.28084;break;case "yards":b*=1.09361;break;case "nauticalMiles":b*=5.39957E-4}return b},_compareDistance:function(a,d){return a.attributes.DISTANCE<
d.attributes.DISTANCE?-1:a.attributes.DISTANCE>d.attributes.DISTANCE?1:0},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/IncidentAnalysis/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/dom-class dojo/dom-construct dojo/dom-style dojo/on esri/geometry/geometryEngine esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query jimu/CSVUtils".split(" "),
function(l,k,s,r,e,p,b,m,u,v,n,a,q,g,c,A,C,h){return l("ProximityInfo",null,{constructor:function(a,b,f){this.tab=a;this.container=b;this.parent=f;this.graphicsLayer=this.buffer=this.incident=this.featureLayer=null;this.specialFields={}},updateForIncident:function(d,b,f){if(this.featureLayer)this.processIncident(d,b,f);else if(0<this.tab.tabLayers.length){var c=new a(this.tab.tabLayers[0].url);m(c,"load",k.hitch(this,function(){c.capabilities&&-1<c.capabilities.indexOf("Query")?(this.featureLayer=
c,this.processIncident(d,b,f)):this._processError()}));m(this.parent.opLayers,"layerInfosFilterChanged",k.hitch(this,this._layerFilterChanged))}},_layerFilterChanged:function(a){if(!(null===this.featureLayer||null===this.incident||null===this.buffer||null===this.graphicsLayer)){var b=this.tab.tabLayers[0].id;r.forEach(a,k.hitch(this,function(a){b===a.id&&this.processIncident(this.incident,this.buffer,this.graphicsLayer)}))}},processIncident:function(a,b,c){this.container.innerHTML="";e.add(this.container,
"loading");var g=[];this.incident=a;this.buffer=b;this.graphicsLayer=c;this.graphicsLayer.clear();var h=this.tab.tabLayers[0].id,n="";this.parent.opLayers.traversal(function(a){if(h===a.id&&a.getFilter())return n=a.getFilter(),!0});c=new C;c.returnGeometry=!0;c.geometry=b.geometry;c.where=n;c.outFields=this._getFields(this.featureLayer);c.outSpatialReference=this.parent.map.spatialReference;this.featureLayer.queryFeatures(c,k.hitch(this,function(b){var c=this._getFields(this.featureLayer);b=b.features;
if(0<b.length){for(var f=0;f<b.length;f++){for(var e=b[f],h={DISTANCE:this._getDistance(a.geometry,e.geometry)},n=0;n<c.length;n++)h[c[n]]=e.attributes[c[n]];e.attributes=h;g.push(e)}this._processResults(g)}}),k.hitch(this,this._processError))},_processError:function(){this.container.innerHTML="";e.remove(this.container,"loading");this.container.innerHTML=this.parent.nls.noFeaturesFound},_processResults:function(a){this.container.innerHTML="";e.remove(this.container,"loading");this.graphicsLayer.clear();
if(0===a.length)this.container.innerHTML=this.parent.nls.noFeaturesFound;else{a.sort(this._compareDistance);var h=p.create("div",{id:"tpc",style:"width:"+220*(a.length+1)+"px;"},this.container);e.add(h,"IMT_tabPanelContent");var f=p.create("div",{},h);e.add(f,"IMTcol");f=p.create("div",{innerHTML:this.parent.nls.downloadCSV},f);e.add(f,"btnExport");m(f,"click",k.hitch(this,this._exportToCSV,a));for(var f=this.parent.nls[this.parent.config.distanceUnits],l=0;l<a.length;l++){var r=l+1,x=a[l],y=x.geometry,
u=y;"point"!==y.type&&(u=y.getExtent().getCenter());var x=x.attributes,v=f+": "+Math.round(100*x.DISTANCE)/100,y="",z=0,D;for(D in x)"DISTANCE"!==D&&3>z&&(y+=this._getFieldValue(D,x[D])+"\x3cbr/\x3e",z+=1);z=p.create("div",{id:"Feature_"+r},h);e.add(z,"IMTcolRec");var E=p.create("div",{},z);e.add(E,"IMTcolRecBar");var C=p.create("div",{innerHTML:r},E);e.add(C,"IMTcolRecNum");b.set(C,"backgroundColor",this.parent.config.color);m(C,"click",k.hitch(this,this._zoomToLocation,u));v=p.create("div",{innerHTML:v},
E);e.add(v,"IMTcolDistance");this.parent.config.enableRouting&&(v=p.create("div",{},E),e.add(v,"IMTcolDir"),m(v,"click",k.hitch(this,this._routeToIncident,u)));y=p.create("div",{innerHTML:y},z);e.add(y,"IMTcolInfo");y=new g(g.STYLE_SOLID,new s.fromString(this.parent.config.color),1);y=new q(q.STYLE_CIRCLE,24,y,new s.fromString(this.parent.config.color));z=new c;z.family="Arial";z.size="12px";r=new A(r,z,"#ffffff");r.setOffset(0,-4);this.graphicsLayer.add(new n(u,y,x));this.graphicsLayer.add(new n(u,
r,x))}}},_exportToCSV:function(a){if(0===a.length)return!1;var b=this.tab.layers,c=[],e=[];r.forEach(a,function(a){c.push(a.attributes)});for(var g in c[0])e.push(g);h.exportCSV(b,c,e)},_getFields:function(a){var b=[];if(this.tab.advConfig&&this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)r.forEach(this.tab.advConfig.fields,function(a){b.push(a.expression)});else{var c;c=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var e=0;e<c.length;e++){var g=c[e];"undefined"!==typeof g.visible?
g.visible&&b.push(g.fieldName):b.push(g.name)}}var h={};r.forEach(a.fields,function(a){if("esriFieldTypeDate"===a.type||a.domain)h[a.name]=a});this.specialFields=h;return b},_getFieldValue:function(a,b){var c=b;if(this.specialFields[a]){var e=this.specialFields[a];"esriFieldTypeDate"===e.type?c=(new Date(b)).toLocaleString():r.some(e.domain.codedValues,function(a){if(a.code===b)return c=a.name,!0})}return c},_getDistance:function(a,b){var c=0;4326===a.spatialReference.wkid&&(a=v.geographicToWebMercator(a));
4326===b.spatialReference.wkid&&(b=v.geographicToWebMercator(b));var e=this.parent.config.distanceUnits,c=u.distance(a,b,9001);switch(e){case "miles":c*=6.21371E-4;break;case "kilometers":c*=0.0010;break;case "feet":c*=3.28084;break;case "yards":c*=1.09361;break;case "nauticalMiles":c*=5.39957E-4}return c},_compareDistance:function(a,b){return a.attributes.DISTANCE<b.attributes.DISTANCE?-1:a.attributes.DISTANCE>b.attributes.DISTANCE?1:0},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},
_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/IncidentAnalysis/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/IncidentAnalysis/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv id\x3d"tabPanel0" class\x3d"IMT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"IMT_tabPanelContent" style\x3d"width: 660px"\x3e\r\n          \x3cdiv id\x3d"incidentsLocate" class\x3d"IMTcol"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.locate_incident}\r\n            \x3c/div\x3e\r\n            \x3cbr/\x3e\r\n            \x3cdiv class\x3d"colBar"\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn0"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn1"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn2"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32 btnClear" data-dojo-attach-event\x3d"onclick:_clear"\x3e \x3cimg id\x3d"btn3"\x3e \x3c/img\x3e \x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv id\x3d"incidentsDistance" class\x3d"IMTcol"\x3e\r\n            \x3cdiv class\x3d"label" data-dojo-attach-point\x3d"buffer_lbl"\x3e\x3c/div\x3e\r\n            \x3cbr/\x3e\r\n            \x3cdiv class\x3d"colBar"\x3e\r\n              \x3cdiv id\x3d"horizontalSliderDiv" data-dojo-attach-point\x3d"horizontalSliderDiv"\x3e\x3c/div\x3e\r\n              \x3cdiv style\x3d"text-align:center; margin-top: -4px;"\x3e\r\n                \x3cinput data-dojo-type\x3d"dijit/form/TextBox" style\x3d"width:60px;align:left;" data-dojo-attach-point\x3d"sliderValue" name\x3d"sliderValue" value\x3d"15" /\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"IMTcol" style\x3d"visibility:hidden"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv class\x3d"label" style\x3d"width:100%;" data-dojo-attach-point\x3d"div_reversed_address"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv id\x3d"panelMessage" data-dojo-attach-point\x3d"messageNode"\x3e\r\n      \x3cspan id\x3d"msgText" data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv id\x3d"panelFooter" data-dojo-attach-point\x3d"footerNode" class\x3d"jimu-main-background"\x3e\r\n      \x3cdiv id\x3d"panelFooterContent" data-dojo-attach-point\x3d"footerContentNode"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv id\x3d"IMT_tabs" data-dojo-attach-point\x3d"tabsNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/IncidentAnalysis/css/style.css":".jimu-widget-IMT {color: #ffffff !important; background-color: #4c4c4c; left: 0px !important; right: 0px !important; bottom: 0px; height: 140px !important; display: block; z-index: 100 !important;}.jimu-widget-IMT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-IMT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-IMT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-IMT .panelBottom {position: absolute; width: 100%; height: 140px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-IMT #panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-IMT #panelFooter {position: absolute; bottom: 0px; left: 0px; right: 0px; height: 40px; line-height: 40px; overflow: hidden; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-IMT #panelFooterContent {position: absolute; left: 0px; right: 24px; height: 90px; overflow-x: auto; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-IMT #panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-IMT #panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 40px; line-height: 40px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 18px;}.jimu-rtl .jimu-widget-IMT #panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-IMT .panelContainer {position: absolute; width: 100%; height: 100px; overflow: hidden; display: block;}.jimu-widget-IMT .IMT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 90px; display: none; overflow-x: auto !important; overflow-y: hidden !important;}.jimu-widget-IMT .IMT_tabPanelContent {position: absolute; top: 0px; width: auto; height: 80px; white-space: nowrap; display: block; overflow-x: visible; overflow-y: hidden;}.jimu-widget-IMT #IMT_tabs {position: absolute; white-space: nowrap; height: 40px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-IMT .IMTTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 40px; float: left; line-height: 40px; font-size: 13px; padding: 0 35px 0 10px; background-image: url('images/tab.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .IMTTab {float: right;}.jimu-widget-IMT .active {color: #ffffff; background-color: #353535; background-color: rgba(0, 0, 0, 0.3); background-image: url('images/tabon.png'); background-position: right center; background-repeat: no-repeat;}.jimu-widget-IMT .IMTcol {float: left; height: 80px; width: 220px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcol {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none;}.jimu-widget-IMT .IMTcolSmall {float: left; height: 80px; width: 165px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcolSmall {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none;}.jimu-widget-IMT .IMTcolLast {border-left: none; border-right: none;}.jimu-widget-IMT .IMTcol .label,.jimu-widget-IMT .IMTcolSmall .label {font-size: 13px; padding: 2px 0; overflow: hidden; text-overflow: ellipsis; width: 100%;}.jimu-widget-IMT .IMTcol .colBar {position: relative; height: 32px; display: block;}.jimu-widget-IMT .btn32 {float: left; width: 32px; height: 32px; padding: 0; color: #ffffff; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-radius: 2px; display: block; margin-right: 8px; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .btn32 {float: right;}.jimu-widget-IMT .btn32:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .btn32 img {padding: 8px;}.jimu-widget-IMT .btnClear {background-color: #bb0000; margin-left: 16px;}.jimu-rtl .jimu-widget-IMT .btnClear {margin-right: 16px; margin-left: 0;}.jimu-widget-IMT .btnClear:hover {background-color: #ff0000;}.jimu-widget-IMT .dijitTextBox,.jimu-widget-IMT .dijitTextBoxHover,.jimu-widget-IMT .dijitTextBoxFocused,.jimu-widget-IMT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-IMT .dijitTextBoxFocused,.jimu-widget-IMT .dijitInputInner,.jimu-widget-IMT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-IMT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-IMT .btnExport {background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-radius: 2px; padding: 10px 44px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer;}.jimu-widget-IMT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-IMT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-IMT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-IMT .colSummary {height: 36px; line-height: 36px; font-size: 28px; padding-top: 25px;}.jimu-widget-IMT .IMTcolRec {float: left; height: 80px; width: 220px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-align: left; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcolRec {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none; text-align: right;}.jimu-widget-IMT .IMTcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-IMT .IMTcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #4c4c4c; color: #ffffff; line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-IMT .IMTcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .IMTcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-IMT .IMTcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-IMT .IMTcolInfo {position: relative; margin-top: 10px; height: 64px; width: 100%; display: block; overflow: hidden; text-overflow: ellipsis;}.claro .dijitSlider {background: transparent; border: 0 none; -webkit-border-radius: 3px; border-radius: 3px; padding: 0;}.claro .dijitSliderBar {border-style: solid; outline: 1px;}.claro .dijitRuleLabelsContainer {color: #2b2e34;}.claro .dijitSliderDisabled {opacity: 0.65; -ms-filter: \"progid:DXImageTransform.Microsoft.Alpha(Opacity\x3d65)\"; filter: alpha(opacity\x3d65);}.claro .dijitRuleLabelsContainerH {padding: 8px 0 !important; color: #6e6e6e !important;}.claro .dijitSliderBarH,.claro .dijitSliderBumperH {height: 4px;}.claro .dijitSlider .dijitSliderLeftBumper {-webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px; border-width: 1px 0 1px 1px; margin-left: 4px;}.claro .dijitSlider .dijitSliderRightBumper {-webkit-border-radius: 0 2px 2px 0; border-radius: 0 2px 2px 0; border-width: 1px 1px 1px 0; margin-left: -2px; margin-right: 4px;}.claro .dijitSlider .dijitSliderProgressBarH {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSlider .dijitSliderLeftBumper {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none; -webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px;}.claro .dijitSlider .dijitSliderRemainingBarH,.claro .dijitSlider .dijitSliderRightBumper {border-color: #878787; background-color: #878787; -webkit-border-radius: 2px; border-radius: 2px;}.claro .dijitSliderHover .dijitSliderProgressBarH,.claro .dijitSliderHover .dijitSliderLeftBumper {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSliderFocused .dijitSliderProgressBarH,.claro .dijitSliderFocused .dijitSliderLeftBumper {border-color: #ebebeb;}.claro .dijitSliderFocused .dijitSliderRemainingBarH,.claro .dijitSliderFocused .dijitSliderRightBumper {border-color: #878787; background-color: #878787; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSliderImageHandle {background: #ffffff; -webkit-border-radius: 50%; border-radius: 50%; border: 0 none; width: 16px; height: 16px; margin-top: -2px; position: absolute;}.claro .dijitSliderImageHandle:after {content: \"\"; display: block; background: #6e6e6e; -webkit-border-radius: 50%; border-radius: 50%; height: 8px; width: 8px; left: 4px; top: 4px; position: absolute;}.claro .dijitSliderDisabled.dijitSliderFocused .dijitSliderImageHandle:after {display: none; outline: none;}.claro .dijitSliderDecrementIconH,.claro .dijitSliderIncrementIconH {padding: 0; height: 20px; width: 20px; background-color: transparent; border: 0 none;}.IMT_tabPanel::-webkit-scrollbar {width: 6px; height: 6px; background-color: rgba(0, 0, 0, 0.1);}.IMT_tabPanel::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0.4);}.IMT_tabPanel {scrollbar-base-color: #4c4c4c; scrollbar-3dlight-color: #4c4c4c; scrollbar-highlight-color: #4c4c4c; scrollbar-track-color: #444444; scrollbar-arrow-color: #2e2e2e; scrollbar-shadow-color: #4c4c4c; scrollbar-dark-shadow-color: #4c4c4c; scrollbar-face-color: #2e2e2e;}",
"*now":function(l){l(['dojo/i18n!*preload*widgets/IncidentAnalysis/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/LayerInfos/LayerInfos dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/webMercatorUtils esri/graphic esri/layers/GraphicsLayer esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/BufferParameters esri/toolbars/draw ./js/SummaryInfo ./js/WeatherInfo ./js/ClosestInfo ./js/ProximityInfo dojo/keys dojo/domReady!".split(" "),function(l,
k,s,r,e,p,b,m,u,v,n,a,q,g,c,A,C,h,d,t,f,w,F,x,y,J,B,z,D,E,L,G,H,K,N,M,T,I,O,P,Q,R,S){return l([s,k],{baseClass:"jimu-widget-IMT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,tabLayersVisibility:{},toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incident:null,buffer:null,locator:null,stops:[],Incident_Local_Storage_Key:"IMT_Incident",SLIDER_MAX_VALUE:1E4,postCreate:function(){this.inherited(arguments)},
startup:function(){this.inherited(arguments);this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this.SLIDER_MAX_VALUE=this.config.bufferRange.maximum;this.opLayers=this.map.itemInfo.itemData.operationalLayers;this._mapLoaded();this._restoreIncidents()},onOpen:function(){this.inherited(arguments);this._getTabLayersVisibility();this._clickTab(0)},onClose:function(){this._clear();this._toggleTabLayersOld();this._setTabLayersVisibility();this.inherited(arguments)},
onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear();this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&this.map.removeLayer(this.lyrClosest);this.lyrProximity&&this.map.addLayer(this.lyrProximity);this.inherited(arguments)},onAppConfigChanged:function(a,b,c){switch(b){case "styleChange":this._updateUI(c);break;case "widgetPoolChange":this._verifyRouting()}},_updateUI:function(a){this._getStyleColor(a)},
_getStyleColor:function(a){var b=this.appConfig.theme.name,d=this.appConfig.theme.styles[0];a&&(d=a);C.get({url:"./themes/"+b+"/manifest.json",handleAs:"json",load:c.hitch(this,function(a){a=a.styles;for(var b=0;b<a.length;b++){var c=a[b];c.name===d&&(n.set(this.footerNode,"background-color",c.styleColor),this.config.color=c.styleColor,this._setupSymbols(),this._bufferIncident())}})})},setPosition:function(a,b){if("BoxTheme"===this.appConfig.theme.name||"DartTheme"===this.appConfig.theme.name||"LaunchpadTheme"===
this.appConfig.theme.name)this.inherited(arguments);else{this.position={left:"0px",right:"0px",bottom:"0px",height:"140px"};var c=e.getPositionStyle(this.position);c.position="absolute";b=this.map.id;m.place(this.domNode,b);m.setStyle(this.domNode,c);this.started&&this.resize();"TabTheme"===this.appConfig.theme.name&&(c=this.widgetManager.getControllerWidgets()[0],this.widgetManager.minimizeWidget(c.id))}},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&
this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(a){this.onReceiveData("","",{eventType:"IncidentLocation",dataValue:a})},_initLayers:function(){this.locator=new M(this.config.geocodeService.url);this.own(v(this.locator,"location-to-address-complete",c.hitch(this,this._showIncidentAddress)));this.own(v(this.locator,"error",c.hitch(this,this._onAddressError)));this.lyrBuffer=new E;this.map.addLayer(this.lyrBuffer);this.lyrIncidents=new E;this.map.addLayer(this.lyrIncidents);this.lyrClosest=
new E;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new E;this.lyrProximity.setVisibility(!1);this.map.addLayer(this.lyrProximity)},_mapLoaded:function(){h("[data-reference]").style("z-index",0);this.map.itemId&&p.getInstance(this.map,this.map.itemInfo).then(c.hitch(this,function(a){this.opLayers=a;this._processOperationalLayers()}));this._clickTab(0)},_processOperationalLayers:function(){for(var a=0;a<this.config.tabs.length;a++){var b=this.config.tabs[a];
b.layers&&""!==b.layers&&(b.tabLayers=this._getTabLayers(b.layers))}},_createUI:function(){var b=this.config.distanceUnits,d=e.sanitizeHTML(this.config.bufferLabel?this.config.bufferLabel:""),d=d+(" ("+this.nls[b]+")");this.buffer_lbl.innerHTML=d;this.buffer_lbl.title=d;b=u.byId("horizontalSliderDiv");d=document.createElement("div");b.appendChild(d);d=document.createElement("div");b.appendChild(d);var d=new f({container:"bottomDecoration",minimum:this.config.bufferRange.minimum,maximum:this.config.bufferRange.maximum,
labels:[this.config.bufferRange.minimum,this.config.bufferRange.maximum],style:"height:2em;font-size:75%;color:#fff"},d),h=Math.abs(Math.round(this.config.bufferRange.maximum-this.config.bufferRange.minimum))+1,k=this.config.bufferRange.minimum+10;k>this.config.bufferRange.maximum&&(k=this.config.bufferRange.minimum);this.horizontalSlider=new t({value:k,minimum:this.config.bufferRange.minimum,maximum:this.config.bufferRange.maximum,discreteValues:h,intermediateChanges:!1,showButtons:!1,style:"width:180px;"},
b);this.own(v(this.horizontalSlider,"change",c.hitch(this,this._sliderChange)));this.horizontalSlider.startup();d.startup();this.sliderValue.set("value",k);this.config.tabs.splice(0,0,{type:"incidents",label:this.nls.incident,color:this.config.color});b=this.panelContainer;d=u.byId("IMT_tabs");for(k=h=0;k<this.config.tabs.length;k++){var l=this.config.tabs[k],m=l.label;"weather"===l.type&&(m=this.nls.weather);if(!m||""===m)m=l.layers;m=q.create("div",{id:"tab"+k,innerHTML:e.sanitizeHTML(m?m:"")},
d);a.add(m,"IMTTab");h+=g.position(m).w;v(m,"click",c.hitch(this,this._clickTab,k));0<k&&(m=q.create("div",{id:"tabPanel"+k,innerHTML:this.nls.defaultTabMsg},b),a.add(m,"IMT_tabPanel"),"summary"===l.type&&(l.summaryInfo=new O(l,m,this)),"weather"===l.type&&(l.weatherInfo=new P(l,m,this)),"closest"===l.type&&(l.closestInfo=new Q(l,m,this)),"proximity"===l.type&&(l.proximityInfo=new R(l,m,this)))}n.set(d,"width",h+10+"px")},_loadUI:function(){for(var a=0;4>a;a++){var b=u.byId("btn"+a);m.setAttr(b,"src",
this.folderUrl+"images/btn"+a+".png");this.own(v(b,"click",c.hitch(this,this._clickIncidentsButton,a)))}this.toolbar=new I(this.map,{tooltipOffset:20,drawTime:90});this.toolbar.on("draw-end",c.hitch(this,this._drawIncident));this.own(v(this.horizontalSlider,"change",c.hitch(this,this._sliderChange)));this.own(v(this.sliderValue,"keyup",c.hitch(this,function(a){a.keyCode===S.ENTER?this._updateSliderValue():(a=this.sliderValue.get("value"),isNaN(a)?this.sliderValue.set("value",this.horizontalSlider.value):
(a<this.config.bufferRange.minimum&&this.sliderValue.set("value",this.config.bufferRange.minimum),a>this.SLIDER_MAX_VALUE&&this.sliderValue.set("value",this.SLIDER_MAX_VALUE)))})))},_locateBuffer:function(a){if(null!==a&&(a="extent"===a.type?a:a.geometry.getExtent(),null!==a)){a=a.expand(1.5);var b=80/this.map.height,c=a.getHeight();a.update(a.xmin,a.ymin-c*b,a.xmax,a.ymax-c*b,this.map.spatialReference);this.map.setExtent(a,!0)}},_clickIncidentsButton:function(b){var c;if(3>b){for(var d=0;3>d;d++)c=
u.byId("btn"+d),a.remove(c,"btnOn");-1<b&&b!==this.tool?(c=u.byId("btn"+b),a.add(c,"btnOn"),this.tool=b):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;case 0:this._clear();this.toolbar.activate(I.POINT);this.disableWebMapPopup();break;case 1:this._clear();this.toolbar.activate(I.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(),this.toolbar.activate(I.POLYGON),this.disableWebMapPopup()}}else this._clear()},_clear:function(){this.map.graphics.clear();
this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.buffer=this.incident=null;this.div_reversed_address.innerHTML="";m.setStyle(this.div_reverse_geocoding,"visibility","hidden");for(var a=1;a<this.config.tabs.length;a++)u.byId("tabPanel"+a)&&(u.byId("tabPanel"+a).innerHTML=this.nls.defaultTabMsg)},_sliderChange:function(){this.sliderValue.set("value",this.horizontalSlider.value);this._bufferIncident()},_sliderTextChange:function(){0>this.sliderValue.value||
this.sliderValue.value>this.SLIDER_MAX_VALUE?this.sliderValue.set("value",this.horizontalSlider.value):this.horizontalSlider.set("value",this.sliderValue.value)},_updateSliderValue:function(){0>this.sliderValue.displayedValue||this.sliderValue.displayedValue>this.SLIDER_MAX_VALUE?this.sliderValue.set("value",this.horizontalSlider.value):this.horizontalSlider.set("value",this.sliderValue.displayedValue)},_clickTab:function(a){this._toggleTabs(a);this._toggleTabLayers(a);this.curTab=a;this._clickIncidentsButton(-1)},
_toggleTabs:function(b){for(var c=0;c<this.config.tabs.length;c++)c===b?(a.add("tab"+c,"active"),n.set("tabPanel"+c,"display","block")):(a.remove("tab"+c,"active"),n.set("tabPanel"+c,"display","none"));this._scrollToTab(b)},_getTabLayersVisibility:function(){this.config.disableLayerManagement||A.forEach(this.config.tabs,c.hitch(this,function(a){A.forEach(a.tabLayers,c.hitch(this,function(a){"undefined"!==typeof a.visible&&(this.tabLayersVisibility[a.id]=a.visible,a.setVisibility(!1))}))}))},_setTabLayersVisibility:function(){this.config.disableLayerManagement||
A.forEach(this.config.tabs,c.hitch(this,function(a){A.forEach(a.tabLayers,c.hitch(this,function(a){a.id in this.tabLayersVisibility&&a.setVisibility(this.tabLayersVisibility[a.id])}))}))},_toggleTabLayers:function(a){this._toggleTabLayersOld();this._toggleTabLayersNew(a)},_toggleTabLayersOld:function(){var a=this.config.tabs[this.curTab];a&&(this.lyrClosest.setVisibility(!1),this.lyrProximity.setVisibility(!1),this.config.disableLayerManagement||a.tabLayers&&A.forEach(a.tabLayers,function(a){"undefined"!==
typeof a.visible&&a.setVisibility(!1)}))},_toggleTabLayersNew:function(a){a=this.config.tabs[a];switch(a.type){case "summary":this.incident&&!0===a.updateFlag&&(a.summaryInfo.updateForIncident(this.incident,this.buffer),a.updateFlag=!1);break;case "weather":this.incident&&!0===a.updateFlag&&(a.weatherInfo.updateForIncident(this.incident),a.updateFlag=!1);break;case "closest":this.lyrClosest.setVisibility(!0);this.incident&&(a.closestInfo.updateForIncident(this.incident,this.config.maxDistance,this.lyrClosest),
a.updateFlag=!1);break;case "proximity":this.lyrProximity.setVisibility(!0),this.incident&&(a.proximityInfo.updateForIncident(this.incident,this.buffer,this.lyrProximity),a.updateFlag=!1)}a.updateFlag=!1;this.config.disableLayerManagement||a.tabLayers&&A.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)})},_drawIncident:function(a){var b=a.geometry.type,c=this.symPoint;"polyline"===b&&(c=this.symLine);"polygon"===b&&(c=this.symPoly);this.incident=new D(a.geometry,
c);this.lyrIncidents.add(this.incident);this.toolbar.deactivate();this._clickIncidentsButton(-1);this._bufferIncident();"point"===b&&this._getIncidentAddress(a.geometry);this.div_reversed_address.innerHTML="";m.setStyle(this.div_reverse_geocoding,"visibility","hidden")},_getIncidentAddress:function(a){this.map.graphics.clear();this.locator.locationToAddress(z.webMercatorToGeographic(a),100)},_showIncidentAddress:function(a){if(a.address.address){var b=a.address.address.Address,c=z.geographicToWebMercator(a.address.location),
d=new L;d.family="Arial";d.size="18px";d=new N(b,d,"#000000");d.setOffset(20,-4);d.horizontalAlignment="left";this.map.graphics.add(new D(c,d,{}));b+="\x3c/br\x3e";a.address.address.City&&(b+=a.address.address.City+", ");a.address.address.Region&&(b+=a.address.address.Region);a.address.address.Postal&&(b+=" "+a.address.address.Postal);this.div_reversed_address.innerHTML=b;m.setStyle(this.div_reverse_geocoding,"visibility","visible")}},_onAddressError:function(){this.div_reversed_address.innerHTML=
this.nls.reverse_geocoded_error;m.setStyle(this.div_reverse_geocoding,"visibility","visible")},_bufferIncident:function(){if(null!==this.incident){for(var a=0;a<this.config.tabs.length;a++)this.config.tabs[a].updateFlag=!0;a=this.incident;this.buffer=null;this.lyrBuffer.clear();var b=this.horizontalSlider.value,c=this.config.distanceSettings[this.config.distanceUnits];if(0<b){var d=a.geometry.spatialReference.wkid,a=4326===d||3857===d||102100===d?F.geodesicBuffer(a.geometry,b,c):F.buffer(a.geometry,
b,c);this._locateBuffer(a.getExtent());this.buffer=new D(a,this.symBuffer);this.lyrBuffer.add(this.buffer);this._performAnalysis()}else"polygon"===a.geometry.type&&(this._locateBuffer(a.geometry.getExtent()),this.buffer=new D(a.geometry,this.symPoly),this.lyrBuffer.add(this.buffer),this._performAnalysis())}},_performAnalysis:function(){this._toggleTabLayersNew(this.curTab)},_verifyRouting:function(){if(this.config.enableRouting){this.config.enableRouting=!1;var a=this.appConfig.getConfigElementsByName("Directions");
A.forEach(a,c.hitch(this,function(a){"Directions"===a.name&&(this.dirConfig=a,this.config.enableRouting=!0)}))}},zoomToLocation:function(a){this.map.centerAndZoom(a,this.config.defaultZoomLevel)},routeToIncident:function(a){var b=this.incident.geometry,d=b;"point"!==b.type&&(d=b.getExtent().getCenter());this.stops=[a,d];this.widgetManager.triggerWidgetOpen(this.dirConfig.id).then(c.hitch(this,function(a){a.addStop(this.stops[0]);a.addStop(this.stops[1])}))},_getTabLayers:function(a){var b=[];A.forEach(this.opLayers._layerInfos,
c.hitch(this,function(c){var d=c.originOperLayer.layerType;"ArcGISMapServiceLayer"===d&&0<c.newSubLayers.length?this._recurseOpLayers(c.newSubLayers,b,a):-1<a.indexOf(c.title)&&("ArcGISFeatureLayer"===d&&c.originOperLayer.featureCollection?b.push(c.originOperLayer):b.push(c.layerObject))}));return b},_recurseOpLayers:function(a,b,d){A.forEach(a,c.hitch(this,function(a){var c=a.originOperLayer.layerType;"ArcGISMapServiceLayer"===c&&0<a.newSubLayers.length?this._recurseOpLayers(a.newSubLayers,b,d):
-1<d.indexOf(a.title)&&("ArcGISFeatureLayer"===c&&a.originOperLayer.featureCollection?b.push(a.originOperLayer):b.push(a.layerObject))}))},_setupSymbols:function(){var a=b.fromString(this.config.color),c=a.toRgb();c.push(0.2);var d=b.fromString("#000000"),a=b.blendColors(a,d,0.2).toRgb(),d=new G(G.STYLE_SOLID,new b([255,255,255,0.25]),1);this.symPoint=new K(K.STYLE_CIRCLE,20,d,new b([a[0],a[1],a[2],0.7]));this.symLine=new G(G.STYLE_SOLID,new b([a[0],a[1],a[2],0.7]),3);this.symPoly=new H(H.STYLE_SOLID,
this.symLine,new b([a[0],a[1],a[2],0.3]));this.symBuffer=new H(H.STYLE_SOLID,d,new b(c))},onReceiveData:function(a,b,c){null!==c&&c.eventType&&("IncidentLocation"===c.eventType?c.dataValue&&null!==c.dataValue&&(this._clear(),this._clickTab(0),a=c.dataValue,a.attributes[this.shapeFlagFieldName]?(this.incident=a,this._bufferIncident()):this._drawIncident(a)):"WebMapChanged"===c.eventType&&this._storeIncidents())},_storeIncidents:function(){if(null!==this.incident){var a={location:d.stringify(this.incident.geometry),
hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.horizontalSlider.value,unit:this.config.distanceUnits},a=d.stringify(a);window.localStorage.setItem(this.Incident_Local_Storage_Key,a);console.log("Inclident saved to storage")}this.publishData({eventType:"WebMapChangedACK"});console.log("eventType WebMapChangedACK fired")},_restoreIncidents:function(){var a=window.localStorage.getItem(this.Incident_Local_Storage_Key);if(null!==a&&"null"!==a){window.localStorage.setItem(this.Incident_Local_Storage_Key,
null);var a=d.parse(a,!0),b=a.buffer_dist;this.sliderValue.set("value",b);this.horizontalSlider.set("value",b);var b=d.parse(a.location),c=a.hasBuffer;if(b){var a={},e=null;"extent"===b.type?e=new w(b):"multipoint"===b.type?e=new J(b):"point"===b.type?e=new y(b):"polygon"===b.type?e=new x(b):"polyline"===b.type&&(e=new B(b));a.geometry=e;this._drawIncident(a,c)}}},_scrollToTab:function(a){var b=g.position(this.footerContentNode).w;g.position(this.tabsNode).w>b&&(a=g.getMarginBox("tab"+a),this.footerContentNode.scrollLeft=
a.l-(b-a.w)/2)},_close:function(){this.widgetManager.closeWidget(this.id)}})});