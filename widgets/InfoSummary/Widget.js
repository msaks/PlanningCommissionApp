// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(y,s,p,g,a,b,d,x){function l(a,b){this.start=a;this.end=b}function k(a,b,e){this.start=a;this.end=b;this.units=e}function c(a,b){this.start=a;this.end=b;this.temp=new g}function n(a){this.values=a;this.length=a.length}function B(a,b){this.values=a;this.def=b?b:{}}function C(a,b){this.stack=a;this.original=b}function F(a,
b,e,d){if(a.values)return new n(a.values);var w,z;z=a.start?s.normalizeColor(a.start):w=b?e?b[e]:b:d;a.end?a=s.normalizeColor(a.end):(w||(w=b?e?b[e]:b:d),a=w);return new c(z,a)}var r=s.fx={};l.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};k.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};c.prototype.getValue=function(a){return g.blendColors(this.start,this.end,a,this.temp)};n.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*
this.length),this.length-1)]};B.prototype.getValue=function(a){var b=y.clone(this.def),e;for(e in this.values)b[e]=this.values[e].getValue(a);return b};C.prototype.getValue=function(b){var d=[];a.forEach(this.stack,function(e){if(e instanceof p.Matrix2D)d.push(e);else if("original"==e.name&&this.original)d.push(this.original);else if("matrix"==e.name){if(e.start instanceof p.Matrix2D&&e.end instanceof p.Matrix2D){var c=new p.Matrix2D,w;for(w in e.start)c[w]=(e.end[w]-e.start[w])*b+e.start[w];d.push(c)}}else e.name in
p&&(c=p[e.name],"function"!=typeof c?d.push(c):(w=a.map(e.start,function(a,d){return(e.end[d]-a)*b+a}),c=c.apply(p,w),c instanceof p.Matrix2D&&d.push(c)))},this);return d};var v=new g(0,0,0,0);r.animateStroke=function(a){a.easing||(a.easing=b._defaultEasing);var c=new b.Animation(a),e=a.shape,k;d.connect(c,"beforeBegin",c,function(){k=e.getStroke();var b=a.color,d={},c;b&&(d.color=F(b,k,"color",v));if((b=a.style)&&b.values)d.style=new n(b.values);if(b=a.width){var g=b;g.values?c=new n(g.values):(b=
g.start?g.start:c=k?k.width:1,g.end?c=g.end:"number"!=typeof c&&(c=k?k.width:1),c=new l(b,c));d.width=c}if((b=a.cap)&&b.values)d.cap=new n(b.values);if(b=a.join)b.values?d.join=new n(b.values):(c=b.start?b.start:k&&k.join||0,b=b.end?b.end:k&&k.join||0,"number"==typeof c&&"number"==typeof b&&(d.join=new l(c,b)));this.curve=new B(d,k)});d.connect(c,"onAnimate",e,"setStroke");return c};r.animateFill=function(a){a.easing||(a.easing=b._defaultEasing);var c=new b.Animation(a),e=a.shape,k;d.connect(c,"beforeBegin",
c,function(){k=e.getFill();var b=a.color;b&&(this.curve=F(b,k,"",v))});d.connect(c,"onAnimate",e,"setFill");return c};r.animateFont=function(a){a.easing||(a.easing=b._defaultEasing);var c=new b.Animation(a),e=a.shape,l;d.connect(c,"beforeBegin",c,function(){l=e.getFont();var b=a.style,c={},d,g;b&&b.values&&(c.style=new n(b.values));if((b=a.variant)&&b.values)c.variant=new n(b.values);if((b=a.weight)&&b.values)c.weight=new n(b.values);if((b=a.family)&&b.values)c.family=new n(b.values);if((b=a.size)&&
b.units)d=parseFloat(b.start?b.start:e.font&&e.font.size||"0"),g=parseFloat(b.end?b.end:e.font&&e.font.size||"0"),c.size=new k(d,g,b.units);this.curve=new B(c,l)});d.connect(c,"onAnimate",e,"setFont");return c};r.animateTransform=function(c){c.easing||(c.easing=b._defaultEasing);var k=new b.Animation(c),e=c.shape,l;d.connect(k,"beforeBegin",k,function(){l=e.getTransform();this.curve=new C(c.transform,l)});d.connect(k,"onAnimate",e,"setTransform");if("svg"===s.renderer&&(9<=x("ie")||x("ff")))var n=
[d.connect(k,"onBegin",k,function(){for(var a=e.getParent();a&&a.getParent;)a=a.getParent();a&&(e.__svgContainer=a.rawNode.parentNode,e.__svgRoot=a.rawNode,e.__svgRoot&&e.__svgRoot.getAttribute&&(e.__svgWidth=parseInt(e.__svgRoot.getAttribute("width"),10),isNaN(e.__svgWidth)&&delete e.__svgWidth))}),d.connect(k,"onAnimate",k,function(){try{if(e.__svgContainer){var a=e.__svgContainer.style.visibility;e.__svgContainer.style.visibility="visible";e.__svgContainer.style.visibility=a;var b=e.__svgWidth;
if(!isNaN(b))try{e.__svgRoot.setAttribute("width",b-5E-6),e.__svgRoot.setAttribute("width",b)}catch(c){}}}catch(m){}}),d.connect(k,"onEnd",k,function(){a.forEach(n,d.disconnect);if(e.__svgContainer){var b=e.__svgContainer;if(null==b.getAttribute("__gotVis")){b.setAttribute("__gotVis",!0);var c=e.__svgContainer.style.visibility,k=e.__svgRoot,m=e.__svgWidth;b.style.visibility="visible";setTimeout(function(){try{b.style.visibility=c;b.removeAttribute("__gotVis");b=null;try{isNaN(m)||(k.setAttribute("width",
m-5E-6),k.setAttribute("width",m))}catch(a){}}catch(d){}},100)}}delete e.__svgContainer;delete e.__svgRoot;delete e.__svgWidth})];return k};return r})},"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/Color dojo/DeferredList dojo/dom-class dojox/gfx/fx dojo/on dojo/Evented esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/renderers/SimpleRenderer esri/request esri/tasks/query esri/tasks/QueryTask esri/symbols/jsonUtils esri/layers/FeatureLayer".split(" "),
function(y,s,p,g,a,b,d,x,l,k,c,n,B,C,F,r,v,K,L,e,G,w,z,D,J){return y("ClusterLayer",[c,k],{constructor:function(m){this.clusterGraphics=null;this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this._showSingles=!0;this.updateFeatures=[];if(this._parentLayer=m.parentLayer)this.objectIdField=this._parentLayer.objectIdField,this.fields=this._parentLayer.fields;this.name=m.name;this._map=m.map;this.color=a.fromString(m.color||"#ff0000");this._styleColor=m._styleColor;this.symbolData=m.lyrInfo.symbolData;
this.countColor=this.symbolData._highLightColor;this.itemId=m.lyrInfo.itemId;this.refresh=m.lyrInfo.refresh;this.displayFeatureCount=this.symbolData.displayFeatureCount;this.node=m.node;this.countEnabled=m.countEnabled;this.legendNode=m.legendNode;this.id=m.id;this.infoTemplate=m.infoTemplate;this.url=m.lyrInfo.url;this._testRenderer=m.lyrInfo.renderer;(this.originOperLayer=m.originOperLayer)&&this._getInfoTemplate(this.originOperLayer);this.lyrInfo=m.lyrInfo;this.lyrType=m.lyrType;this.filter=m.filter;
this._setupSymbols();this._setFieldNames();this.countFeatures(this._parentLayer);0<this._parentLayer.refreshInterval&&setInterval(g.hitch(this,this._updateEnd),6E4*this._parentLayer.refreshInterval)},countFeatures:function(m){var a=new w;a.geometry=this._map.extent;m.queryCount?m.queryCount(a,g.hitch(this,function(a){if(0<a)this.nodeCount=a,this._initFeatures(this._parentLayer);else{this.nodeCount=0;var b=new J(m.url);l(b,"load",g.hitch(this,function(){this.countFeatures(b)}))}})):this._initFeatures(this._parentLayer)},
_initFeatures:function(m){this._features=[];var a=!0,b=new w;-1<["CSV","Feature Collection","GeoRSS","KML"].indexOf(this.lyrType)||null===this.url?(this._getSourceFeatures(m.graphics),this.clusterFeatures()):"undefined"!==typeof this.url?this.loadData(this.url):(b.where=this.filter?this.filter:"1\x3d1",b.outFields=this._fieldNames,b.returnGeometry=!0,m.queryFeatures?m.queryFeatures(b).then(g.hitch(this,function(m){m.features&&(this._getSourceFeatures(m.features),this.clusterFeatures())})):a="error");
"error"!==a&&(this.extentChangeSignal||(this.extentChangeSignal=this._map.on("extent-change",g.hitch(this,this.handleMapExtentChange))),this.clickSignal||(this.clickSignal=this.on("click",g.hitch(this,this.handleClick))))},_getSourceFeatures:function(m){this._features=[];for(var a=0;a<m.length;a++){var b=m[a];b.geometry&&this._features.push(b)}},_getInfoTemplate:function(m){m=m.parentLayerInfo?m.parentLayerInfo:m;if(m.controlPopupInfo&&(m=m.controlPopupInfo.infoTemplates)){if(this.url){var a=this.url.split("/").pop();
a&&(m.indexOf?-1<m.indexOf(a)&&(this.infoTemplate=m[a].infoTemplate):m.hasOwnProperty(a)&&(this.infoTemplate=m[a].infoTemplate))}this.setInfoTemplate(this.infoTemplate)}},_setFieldNames:function(){this._fieldNames=[];if(this.infoTemplate&&"undefined"!==typeof this.infoTemplate.info){var a=this.infoTemplate.info.fieldInfos;if(a)for(var b=0;b<a.length;b++)a[b].visible&&this._fieldNames.push(a[b].fieldName)}if(this.symbolData.featureDisplayOptions&&0<this.symbolData.featureDisplayOptions.fields.length)for(a=
0;a<this.symbolData.featureDisplayOptions.fields.length;a++)b=this.symbolData.featureDisplayOptions.fields[a],-1===this._fieldNames.indexOf(b.name)&&this._fieldNames.push(b.name);1>this._fieldNames.length&&(this._fieldNames=["*"])},setLayerInfo:function(a){this.lyrInfo=a},clearSingles:function(a){s.forEach(a||this._singles,function(a){this.remove(a)},this);this._singles.length=0},_getSingleGraphic:function(a){a=new n(new C(a.geometry.x,a.geometry.y,this._map.spatialReference),null,a.attributes);a.setSymbol(this._singleSym);
return a},_addSingles:function(a){s.forEach(a,function(a){a=this._getSingleGraphic(a);this._singles.push(a);this._showSingles&&this.add(a)},this);this._map.infoWindow.setFeatures(this._singles)},initalCount:function(a){var b=new w;b.returnGeometry=!1;b.geometry=this._map.extent;b.where=this.filter?this.filter:"1\x3d1";(new z(a)).executeForIds(b).then(g.hitch(this,function(a){this.node&&(d.contains(this.node,"searching")&&d.remove(this.node,"searching"),this.node.innerHTML=a?a.length.toLocaleString():
0)}))},loadData:function(a){if(0<a.length){this.initalCount(a);var c=new w;c.where="1\x3d1";this.filter&&(c.where=this.filter);c.returnGeometry=!1;this.queryPending=!0;(new z(a)).executeForIds(c).then(g.hitch(this,function(c){if(c){this.queryIDs=c;c=[];var d,k;d=0;for(k=this.queryIDs.length;d<k;d+=1E3){var e=this.queryIDs.slice(d,d+1E3);c.push(G({url:a+"/query",content:{f:"json",outFields:this._fieldNames.join(),objectids:e.join(),returnGeometry:"true",outSR:this._map.spatialReference.wkid}}))}this._features=
[];this.cancelRequest?console.log("Cancelled ClusterLayer 1"):(new b(c)).then(g.hitch(this,function(a){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");else if(a){for(var b=this._map.spatialReference,m=[],c=0;c<a.length;c++)if(a[c][1].features)for(var d=0;d<a[c][1].features.length;d++){var q=a[c][1].features[d];if("undefined"!==typeof q.geometry){var t=new C(q.geometry.x,q.geometry.y,b),t=new n(t);t.setAttributes(q.attributes);this.infoTemplate&&t.setInfoTemplate(this.infoTemplate);
m.push(t)}}a=!0;1E4>m&&(a=JSON.stringify(this._features)!==JSON.stringify(m));a&&(this._features=m,this.clusterFeatures(),this.emit("update-end",{bubbles:!0,cancelable:!0}))}}))}}))}},handleClick:function(a){var b=[];if(a.graphic&&(b=a.graphic,b.attributes)){var c=b.attributes;c.Data&&1<c.Data.length?(this.clearSingles(this._singles),b=c.Data,a.stopPropagation(),this._addSingles(b)):this._map.infoWindow.setFeatures([b])}this.infoTemplate&&this._map.infoWindow.show(a.mapPoint);p.stop(a)},handleMapExtentChange:function(a){if(a.levelChange)this.clusterFeatures();
else if(a.delta){var b=a.delta;a=Math.abs(b.x);b=Math.abs(b.y);(50<a||50<b)&&this.clusterFeatures()}},refreshFeatures:function(a){if(this.itemId){a=a.featureSet.features;var b=!0;1E4>a.length&&(b=JSON.stringify(this.updateFeatures)!==JSON.stringify(a));if(b){this._features=[];this._parentLayer.clear();var b=this._parentLayer.spatialReference,c;this._parentLayer.renderer?c=this._parentLayer.renderer:this._testRenderer&&(c=this._testRenderer);for(var d=0;d<a.length;d++){var k=a[d];if(k.geometry){var e=
new n(this.getGraphicOptions(k,b,c));e.setAttributes(k.attributes);this.infoTemplate&&e.setInfoTemplate(this.infoTemplate);e.setSymbol(c.getSymbol(e));this._parentLayer.add(e);this._features.push(e)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=a}else this.url&&this.loadData(this.url)},getGraphicOptions:function(a,b,c){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:b.wkid}}}:"undefined"!==typeof a.geometry.paths?
{geometry:{paths:a.geometry.paths,spatialReference:{wkid:b.wkid}}}:{geometry:new C(a.geometry.x,a.geometry.y,a.geometry.spatialReference),symbol:c.symbol}},flashFeatures:function(){this.flashGraphics(this.graphics)},flashSingle:function(b){if("undefined"===typeof b.symbol){var c=new v(v.STYLE_NULL,new a(0,0,0,0),0),d=this.color.toRgb();b.setSymbol(new r(r.STYLE_CIRCLE,9,c,new a([d[0],d[1],d[2],0.5])))}this.flashGraphics([b])},flashGraphics:function(a){for(var b=0;b<a.length;b++)this._flashFeature(a[b])},
_flashFeature:function(b){var c;if(b.geometry){c=a.fromHex(this._styleColor);var d=g.clone(c);d.a=0.4;c=new r(r.STYLE_CIRCLE,b.symbol.size,new v(v.STYLE_SOLID,c,1),d)}b=new n(b.geometry,c);this._map.graphics.add(b);if(c=b.getDojoShape())x.animateStroke({shape:c,duration:700,color:{start:c.strokeStyle.color,end:c.strokeStyle.color},width:{start:18,end:0}}).play(),setTimeout(this._clearFeature,850,b)},_clearFeature:function(a){a.getLayer().remove(a)},setColor:function(a){this.color=a},setStyleColor:function(a){this._styleColor=
a},cancelPendingRequests:function(){console.log("Cancel Query...");this.queryPending&&(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},clusterFeatures:function(){this.clear();this._map.infoWindow.isShowing&&this._map.infoWindow.hide();var a=this._features,b=0;if("undefined"!==typeof a){if(0<a.length){var c=
this.clusterSize;this.clusterGraphics=[];for(var d=this._map.spatialReference,k=this._map.extent,e=new C(k.xmin,k.ymax,d),l=Math.ceil(this._map.height/c),g=Math.ceil(this._map.width/c),x=k.getWidth()/this._map.width*c,c=k.getHeight()/this._map.height*c,k=0;k<l;k++)for(var r=0;r<g;r++){var p=e.x+x*r,q=e.y-c*k,q=new B(p,q-c,p+x,q,d),p=[],t;for(t in a){var h=a[t];q.contains(h.geometry)&&(b+=1,p.push(h))}0<p.length&&(q=this.getClusterCenter(p),this.clusterGraphics.push({center:q,graphics:p}))}for(var f in this.clusterGraphics){a=
this.clusterGraphics[f];d=a.graphics.length;e=a.graphics;x=d.toString();g=l=19*x.length;l+=5;t=new L;t.family="Arial";t.size="16px";x=new K(x,t,this.countColor);x.setOffset(0,-4);var u;this.symbolData&&this.symbolData.symbol?this.symbolData.symbol.size?u=this.symbolData.symbol.size:this.symbolData.symbol.width&&(u=this.symbolData.symbol.width,t=this.symbolData.symbol.height,u=u>=t?u:t):this.icon.width?(l=this.icon.width>=l?this.icon.width+5:l,l=this.icon.height>=l?this.icon.height+5:l,g=this.icon.width>=
g?this.icon.width+1:g,g=this.icon.height>=g?this.icon.height+1:g):this.icon.size&&(u=this.icon.size);u&&(l=u>=l?u+5:l,g=u>=g?u+1:g);g>=l&&(l+=0===g-l?4:g-l+5);this._setSymbols(l+15,l);e={Count:d,Data:e};1<d?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new n(a.center,this.csym,e)),this.displayFeatureCount?this.add(new n(a.center,x,e)):this.add(new n(a.center,this.csym3,e))):(this.add(new n(a.center,this.csym,e)),this.displayFeatureCount?this.add(new n(a.center,
x,e)):this.add(new n(a.center,this.psym,e))):(this.add(new n(a.center,this.csym,e)),this.displayFeatureCount?this.add(new n(a.center,x,e)):this.add(new n(a.center,this.psym,e))):(a=a.graphics[0].geometry,this.renderer&&(this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new n(a,null,e.Data[0].attributes),d=this.renderer.getSymbol(a),a.setInfoTemplate(this.infoTemplate),a.setSymbol(d),this.add(a)):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?
(a=new n(a,null,e.Data[0].attributes),a.setInfoTemplate(this.infoTemplate),a.setSymbol(D.fromJson(this.renderer.symbol)),this.add(a)):"EsriSymbol"===this.symbolData.symbolType?this.add(new n(a,D.fromJson(this.symbolData.symbol),e)):"LayerSymbol"!==this.symbolData.symbolType?this.add(new n(a,this.psym,e)):(a=this.renderer.symbol?new n(a,this.renderer.symbol,e):new n(a,this.psym,e),a.setInfoTemplate(this.infoTemplate),this.add(a))))}}this._updateNode(b)}},_updateNode:function(a){this.node&&(this.node.innerHTML=
a?a.toLocaleString():0)},_updatePanelTime:function(a){this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e";var b="";""!==this.config.mainPanelText&&(b=this.config.mainPanelText+" ");this.pageTitle.innerHTML=b+(new Date(a)).toLocaleDateString(navigator.language,{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},_setSymbols:function(b,c){var d=this.color.toRgb(),e,k,l;if("undefined"!==typeof this.symbolData){var n;"custom"===this.backgroundClusterSymbol?n=d:(e=
D.fromJson(this.backgroundClusterSymbol),0===e.outline.color.a||0===e.outline.width?(k=v.STYLE_NULL,l=0):(k=v.STYLE_SOLID,l=e.outline.width));e?(d=v(k,e.outline.color,l),n=e.color.toRgb(),this.csym=new r(r.STYLE_CIRCLE,b,d,new a([n[0],n[1],n[2],0.75]))):this.csym=new r(r.STYLE_CIRCLE,b,null,new a([n[0],n[1],n[2],0.75]));d=this.symbolData.s;(d=-1<d.indexOf("${appPath}")?this.symbolData.s.replace("${appPath}",window.location.origin+window.location.pathname):this.symbolData.s?this.symbolData.s:this.icon.imageData)&&
"CustomIcon"===this.symbolData.iconType?this.psym=new F(d,b-6,b-6):d&&"LayerIcon"===this.symbolData.iconType?this.psym=D.fromJson(this.symbolData.symbol):(d=v(this.icon.outline.style,this.icon.outline.color,this.icon.outline.width),this.psym=new r(this.icon.style,this.icon.size,d,this.icon.color));this.csym2=g.clone(this.psym);this.csym3=g.clone(this.csym2);"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else e=new v(v.STYLE_NULL,
new a(0,0,0,0),0),this.csym=new r(r.STYLE_CIRCLE,b,e,new a([d[0],d[1],d[2],0.5])),this.psym=new F(this.icon.url,b-10,b-10),this.psym2=new F(this.icon.url,c-7,c-7),e=new v(v.STYLE_NULL,new a(0,0,0,0),0),this.csym2=new r(r.STYLE_CIRCLE,c,e,new a([d[0],d[1],d[2],0.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.countColor=this.symbolData._highLightColor;this.backgroundClusterSymbol=this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?
this._parentLayer.renderer?this.renderer=this._parentLayer.renderer:this.symbolData.renderer&&(this.renderer=this._testRenderer):this.renderer=new e(D.fromJson(this.symbolData.symbol));var b=this.color.toRgb(),c=new v(v.STYLE_NULL,new a(0,0,0,0),0);this._singleSym=new r(r.STYLE_CIRCLE,9,c,new a([b[0],b[1],b[2],0.5]))}},getLayer:function(){return this},getClusterCenter:function(a){var b=0,c=0,d=a.length;s.forEach(a,function(a){b+=a.geometry.x;c+=a.geometry.y},this);return new C(b/d,c/d,a[0].geometry.spatialReference)},
destroy:function(){this._clear();this.removeEventListeners()},_clear:function(){this.clear();this._features=[]},_updateEnd:function(){this.loadData(this.url)}})})},"widgets/InfoSummary/js/ThemeColorManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/xhr dojo/dom-style dojo/_base/array dojo/_base/Color".split(" "),function(y,s,p,g,a,b){return y(null,{_theme:null,_styleName:"",_styleColor:null,_options:null,constructor:function(a){this._theme=a.theme;this._styleName=a.stylename;
this.getStyleColor(this._styleName);this._options=a},setStyle:function(a){this._styleName=a;this.getStyleColor(this._styleName)},getStyleColor:function(d){var g=d?d:this._theme.styles[0];p.get({url:"././themes/"+this._theme.name+"/manifest.json",handleAs:"json",load:s.hitch(this,function(d){d=d.styles;for(var k=0;k<d.length;k++)if(d[k].name===g){var c;a.forEach(document.styleSheets,function(b){(b=b.rules?b.rules:b.cssRules)&&a.forEach(b,function(a){".jimu-main-background"===a.selectorText&&(c=a.style.getPropertyValue("background-color"))})});
this._styleColor=b.fromRgb(c).toHex();break}})})},updateUI:function(b){b&&a.forEach(this._options.updateNodes,function(a){g.set(a.node,a.styleProp,b)})}})})},"widgets/InfoSummary/js/LayerVisibilityManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","jimu/LayerInfos/LayerInfos"],function(y,s,p,g){return y(null,{_layerList:{},_map:null,_initalLayerVisibility:{},_opLayers:null,_parent:null,constructor:function(a){this._map=a.map;this._layerList=a.configLayerList;this._parent=
a.parent;this.setOpLayers(this._map);this.storeInitalVisibility();this.setInitalVisibility()},setOpLayers:function(a){a.itemId&&g.getInstance(a,a.itemInfo).then(s.hitch(this,function(a){this._opLayers=a}))},setInitalVisibility:function(){for(var a in this._layerList){var b=this._layerList[a];"ClusterLayer"===b.type&&(b.layerObject.setVisibility&&b.layerObject.setVisibility(!0),b.layerObject.visible=!0,b.layerObject._parentLayer&&(b.layerObject._parentLayer.setVisibility&&b.layerObject._parentLayer.setVisibility(!1),
b.layerObject._parentLayer.hasOwnProperty("visibility")&&(b.layerObject._parentLayer.visibility=!1)));var d;b.layerObject&&b.layerObject.layerInfos?d=b.layerObject:b.li&&"undefined"!==typeof b.li.parentLayerID&&(d=this._map.getLayer(b.li.parentLayerID));if(d&&d.visibleLayers){var g=s.clone(d.visibleLayers);d.layerInfos&&(0<d.layerInfos.length&&b.li&&("undefined"!==typeof b.li.subLayerId&&-1===g.indexOf(b.li.subLayerId)?"ClusterLayer"!==b.type&&g.push(b.li.subLayerId):-1<g.indexOf(b.li.subLayerId)&&
"ClusterLayer"===b.type&&g.splice(g.indexOf(b.li.subLayerId),1)),g&&d.setVisibleLayers(g),d.setVisibility&&d.setVisibility(!0),d.hasOwnProperty("visible")&&(d.visible=!0))}}},storeInitalVisibility:function(){this._initalLayerVisibility={};p.forEach(this._opLayers._operLayers,s.hitch(this,function(a){if("ArcGISFeatureLayer"===a.layerType||"ArcGISMapServiceLayer"===a.layerType||"undefined"===typeof a.layerType)if(a.layerObject&&this.shouldCheck(a))this._initalLayerVisibility[a.id]={type:a.layerType,
layerObject:a.layerObject,visible:a.layerObject.visible,visibleSubLayers:s.clone(a.layerObject.visibleLayers)};else if(a.featureCollection)for(var b=0;b<a.featureCollection.layers.length;b++){var d=a.featureCollection.layers[b];this.shouldCheck(d)&&(this._initalLayerVisibility[d.id]={type:d.layerType,layerObject:d.layerObject,visible:"undefined"!==typeof d.layerObject.visible?d.layerObject.visible:d.visibility,pl:a})}else a.layers&&(this._initalLayerVisibility[a.id]={type:a.layerType,layerObject:a.layerObject,
visible:a.layerObject.visible,visibleSubLayers:s.clone(a.layerObject.visibleLayers)})}))},shouldCheck:function(a){return this._layerList?!(a.id in this._layerList):!0},setLayerVisibility:function(a,b){var d=[];if(a)for(var g in a){var l=a[g];if(-1===d.indexOf(l.id))if(l.visibleSubLayers)l.layerObject.setVisibleLayers(l.visibleSubLayers);else if("undefined"===typeof l.pl)l.id&&-1===l.id.indexOf("_CL")?l.layerObject.setVisibility(!1):l.layerObject.setVisibility(b?!1:l.visible);else{var k=s.clone(l.layerObject.visibleLayers);
if(l.layerObject.layerInfos){if(0<l.layerObject.layerInfos.length)for(var c in a){var n=a[c];n.li&&n.li.subLayerId&&-1===k.indexOf(n.li.subLayerId)&&-1===l.id.indexOf("_CL")&&k.push(n.li.subLayerId)}b?(k=this._initalLayerVisibility[l.layerObject.id],k.visibleSubLayers&&(l.layerObject.setVisibleLayers(k.visibleSubLayers),l.layerObject.setVisibility&&l.layerObject.setVisibility(!0))):(k&&l.layerObject.setVisibleLayers(k),l.layerObject.setVisibility&&l.layerObject.setVisibility(!0))}else if(k=l.layerObject,
l.id&&-1===l.id.indexOf("_CL")||k.id&&-1===k.id.indexOf("_CL"))l.layerObject.setVisibility&&l.layerObject.setVisibility(b?!1:l.visible),l.pl.hasOwnProperty("visibility")&&(l.pl.visibility=b?!1:l.visible)}}},resetLayerVisibility:function(){this.setLayerVisibility(this._initalLayerVisibility,!1);this._initalLayerVisibility={};var a={},b;for(b in this._layerList)"ClusterLayer"===this._layerList[b].type&&(a[b]=this._layerList[b],this._layerList[b].pl&&(this._layerList[b].pl.setVisibility&&this._layerList[b].pl.setVisibility(!1),
this._layerList[b].pl.hasOwnProperty("visibility")&&(this._layerList[b].pl.visibility=!1)),this._layerList[b].layerObject._parentLayer&&(this._layerList[b].layerObject._parentLayer.setVisibility&&this._layerList[b].layerObject._parentLayer.setVisibility(!1),this._layerList[b].layerObject._parentLayer.hasOwnProperty("visibility")&&(this._layerList[b].layerObject._parentLayer.visibility=!1)));0<Object.keys(a).length&&this.setLayerVisibility(a,!1);this._layerList={}}})})},"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader roundedTop jimu-main-background" data-dojo-attach-point\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageLabel" data-dojo-attach-point\x3d"pageLabel"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"lastUpdated" data-dojo-attach-point\x3d"lastUpdated"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv class\x3d"resultsContent noselect" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary{width: 360px; height: 100%;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{overflow: hidden; display: none;}.jimu-widget-InfoSummary .legendOn{display: block; width: 100%; visibility: visible; height: auto; overflow: hidden;}.jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; margin: 10px 10px 10px 10px;}.jimu-widget-InfoSummary .groupField{padding: 0px 10px 5px 15px; text-align: left; display: table-cell; font-size: 14px; width: 100%;}.jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp{background-image: url(../images/nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown{background-image: url(../images/nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle{width: 100%; height: 30px; display: table;}.jimu-widget-InfoSummary .groupItemImage{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor:pointer; vertical-align:middle; -webkit-border-radius:10px; -moz-border-radius:10px; -o-border-radius:10px; -ms-border-radius:10px; border-radius: 10px; border: 2px solid #dcdcdc;}.jimu-widget-InfoSummary .groupItemImageUp{background-image: url(../images/default_nav_up.png); background-color: white;}.jimu-widget-InfoSummary .groupItemImageDown{background-image: url(../images/default_nav_down.png); background-color: white;}.jimu-widget-InfoSummary .groupOff{display: none;}.jimu-widget-InfoSummary .groupOn{height: auto; display: block;}.jimu-widget-InfoSummary .featureItem:hover{background-color: lightgray;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display: block; width: 35px; visibility: visible; height: 35px; float: left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter: alpha(opacity\x3d30); z-index: 3;}.jimu-widget-InfoSummary .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-InfoSummary .roundedTop {-moz-border-radius: 5px 5px 0 0; -webkit-border-radius: 5px 5px 0 0; border-radius: 5px 5px 0 0;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 360px; height: 100%;}.jimu-widget-InfoSummary .page {position: relative; width: 360px; margin-left: 0; height: 100%; display: block; background-color: rgba(0,0,0,0.1);}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 10px; right: 10px; top: 5px; bottom: 5px; overflow: hidden; display: block; background-color: rgba(255,255,255,1);}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 280px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleWidth {width: 100%;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 40px; width: auto; height: auto; bottom: 25px; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageClose {position: absolute; right: 10px; top: 10px; background: url(../images/x.png) no-repeat; cursor: pointer; width: 12px; height: 12px; display: block;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 280px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; overflow-x: hidden; overflow-y: hidden;}.jimu-widget-InfoSummary .expandArrow {width: 100%; height: 20px;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor:pointer;}.jimu-widget-InfoSummary .rec:hover .expandUp {background-image: url(../images/nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .rec:hover .expandDown {background-image: url(../images/nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.3; filter: alpha(opacity\x3d30); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width: 43px; height: 43px; align-content: center; vertical-align: super; z-index: 1;}.jimu-widget-InfoSummary .active {opacity:0.8; filter:alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-family: Steelfish; font-weight: 300; color: #000000; display: table-cell; width: auto; height: 100%; padding-right: 10px;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-family: Steelfish; font-weight: 300; color: #000000; margin-left: 5px; display: table-cell; width: auto;}.jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-family: sans-serif; font-weight: 500; text-align: center; vertical-align: middle; color: #000000; padding-left: 65px; text-overflow: ellipsis; width: 100%; padding-right: 10px; max-width: 100px; overflow: hidden; word-wrap: break-word;}.jimu-rtl .jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-family: sans-serif; font-weight: 500; text-align: center; vertical-align: middle; color: #000000; padding-right: 65px; text-overflow: ellipsis; width: 100%; padding-left: 10px; max-width: 200px; overflow: hidden; word-wrap: break-word;}.jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-family: sans-serif; font-weight: 500; text-align: center; vertical-align: middle; color: #000000; padding-left: 65px; margin-right: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-rtl .jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-family: sans-serif; font-weight: 500; text-align: center; vertical-align: middle; color: #000000; padding-right: 65px; margin-left: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-widget-InfoSummary .recNum {height: 100%; color: #000000; text-align: center; font-size: 28px; font-family: Steelfish; margin-right: 10px; float: right; display: table-cell; width: auto; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNum {height: 100%; color: #000000; text-align: center; font-size: 28px; font-family: Steelfish; margin-left: 10px; float: left; display: table-cell; width: auto; padding-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {background-size: contain; width: 310px; height: 205px; background-repeat: no-repeat; background-position: 50% 50%;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}.jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 35px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageBodyNoIconRefresh {position: absolute; top: 55px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}.jimu-widget-InfoSummary .pageHeaderNoIconRefresh {position: relative; width: 100%; height: 55px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageLabel {padding-top: 10px; color: whitesmoke; font-size: 16px; text-align: center;}.jimu-widget-InfoSummary .solidBorder {border-bottom: 1px solid #dcdcdc;}.jimu-widget-InfoSummary .imageDataGFX {width: 15px; height: 15px; display: block; float: left; padding-left: 10px;}.jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; right: 0px;}.jimu-rtl .jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; left: 0px;}.jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; bottom: 0px; right: 0px;}.jimu-widget-InfoSummary .expand{width: 50px; height: 11px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: white;}.jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; float: right; margin-right: 5px;}.jimu-widget-InfoSummary .expandUp{background-image: url(../images/default_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius:6px; -moz-border-top-radius:6px; -o-border-top-radius:6px; -ms-border-top-radius:6px; border-top-left-radius: 6px; border-top-right-radius: 6px;}.jimu-widget-InfoSummary .expandUp:hover{background-image: url(../images/nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .expandDown{background-image: url(../images/default_nav_down.png); bottom: -11px; background-position-y: -2px; border-bottom: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-bottom-radius:6px; -moz-border-bottom-radius:6px; -o-border-bottom-radius:6px; -ms-border-bottom-radius:6px; border-bottom-left-radius: 6px; border-bottom-right-radius: 6px;}.jimu-widget-InfoSummary .expandDown:hover{background-image: url(../images/nav_down.png); background-color: gray;}.noselect {-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}@media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent {} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; font-family: Steelfish; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}}@media only screen and (max-width: 470px) {.jimu-widget-InfoSummary{width: 100% !important; height: 50%;} .jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; bottom: 0px; width: 100%;} .jimu-widget-InfoSummary .page {position: relative; width: 100%; height: 100%; display: block; background-color: rgba(0,0,0,0.15);} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; font-family: Steelfish; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px; opacity:0.3; filter:alpha(opacity\x3d30);} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}} ",
"*now":function(y){y(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/promise/all dojo/_base/array dojo/query dojox/gfx/fx dojox/gfx dojo/_base/xhr dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/renderers/SimpleRenderer esri/renderers/jsonUtils ./js/ClusterLayer ./js/ThemeColorManager ./js/LayerVisibilityManager esri/layers/LayerDrawingOptions".split(" "),function(y,
s,p,g,a,b,d,x,l,k,c,n,B,C,F,r,v,K,L,e,G,w,z,D,J,m,M,V,N,O,R,S,T,P,U,Q){return l([y,L],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayers:null,opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,layerVisibilityManager:null,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],queryLookupList:[],legendNodes:[],currentQueryList:[],symbols:[],postCreate:function(){this.inherited(arguments);this.configLayerInfos=this.config.layerInfos;this.queryLookupList=[];
this.layerList={};this.initialLoad=!0;this._initWidget()},startup:function(){this.inherited(arguments);this.mapExtentChangedHandler=this.map.on("extent-change",k.hitch(this,this._mapExtentChange));this._mapExtentChange()},onOpen:function(){this.widgetChange=!1;this._updatePanelHeader();this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&this._updateStyleColor(this.appConfig.theme.styles[0]);"undefined"===typeof this.mapExtentChangedHandler&&(this.mapExtentChangedHandler=this.map.on("extent-change",
k.hitch(this,this._mapExtentChange)),this._mapExtentChange());this.layerVisibilityManager=new U({map:this.map,configLayerList:this.layerList,parent:this});this.config.refreshEnabled&&this.enableRefresh();this.map.infoWindow.highlight=!0;for(var q in this.layerList){var t=this.layerList[q],b=t.li,t=t.layerObject;if(b&&b.orgRenderer){if(t.setRenderer)t.setRenderer(b.newRenderer);else if(t.setLayerDrawingOptions){var f=[],u=new Q;u.renderer=b.newRenderer;f[b.subLayerId]=u;t.setLayerDrawingOptions(f)}else console.log("Error setting the new renderer...will use the default rendering of the layer");
t.refresh()}t&&"undefined"!==typeof t.visible&&(t.visible?a.contains("recIcon_"+q,"active")||a.add("recIcon_"+q,"active"):a.contains("recIcon_"+q,"active")&&a.remove("recIcon_"+q,"active"))}},enableRefresh:function(){var q=null,a=!1,b;for(b in this.layerList){q=this.layerList[b];if("ClusterLayer"!==q.type)!a&&q.li&&q.li.itemId&&(N.getItem(q.li.itemId).then(k.hitch(this,this._updateItem)),a=!0),q=q.layerObject;else for(var f=0;f<this.opLayers.length;f++){var u=this.opLayers[f];if(u.layerObject){q=
u.layerObject;break}}q&&(q.refreshInterval=this.config.refreshInterval)}q=6E4*this.config.refreshInterval;0===this.refreshInterval&&0===this.refreshIntervalValue?(this.refreshIntervalValue=q,this.refreshInterval=setInterval(k.hitch(this,this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==q&&(this.refreshIntervalValue=q,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(k.hitch(this,this.refreshLayers),
this.refreshIntervalValue))},_updatePanelTime:function(q){this.lastUpdated.innerHTML="\x3cdiv\x3e\x3c/div\x3e";this.lastUpdated.innerHTML=(new Date(q)).toLocaleDateString(navigator.language,{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},refreshLayers:function(){for(var q in this.layerList){var a=this.layerList[q],b;a.li&&a.li.itemId?b=a.li.itemId:a.layerObject.itemId&&(b=a.layerObject.itemId);b&&-1===this.currentQueryList.indexOf(b)&&(this.currentQueryList.push(b),
N.getItem(b).then(k.hitch(this,this._updateItem)))}},_updateItem:function(q){var a=!0;this.lastModifiedTime&&(a=this.lastModifiedTime<q.item.modified);if(a){this._updatePanelTime(q.item.modified);console.log(q);for(var a=q.itemData,b=0;b<a.layers.length;b++)this._updateLayerItem(a.layers[b],q.item.modified)}this.currentQueryList.splice(this.currentQueryList.indexOf(q.item.id),1);this.lastModifiedTime=q.item.modified},_updateLayerItem:function(a){var b,h,f;for(f in this.layerList)if(this.layerList[f].pl&&
this.layerList[f].pl.layerDefinition){if(this.layerList[f].pl.layerDefinition.name===a.layerDefinition.name){b=this.layerList[f];h=b.pl;break}}else this.layerList[f].layerObject._parentLayer&&this.layerList[f].layerObject._parentLayer.name===a.layerDefinition.name&&(this.layerList[f].layerObject.refreshFeatures(a),this.layerList[f].layerObject&&this._loadList(this.layerList[f],!0));if(a&&h){a=a.featureSet.features;f=h.featureSet.features;var u=!0;1E4>a.length&&(u=JSON.stringify(f)!==JSON.stringify(a));
if(u){h.layerObject.clear();f=b.layerObject.spatialReference;for(u=0;u<a.length;u++){var c=a[u];if(c.geometry){var d=this.getGraphicOptions(c,f,b.layerObject.renderer),k=new e(d);k.setSymbol(d.symbol);k.setAttributes(c.attributes);this._infoTemplate&&k.setInfoTemplate(this._infoTemplate);h.layerObject.add(k)}else console.log("Null geometry skipped")}b.layerObject.refresh();h.layerObject.refresh();h.featureSet.features=a;this.countFeatures(b.layerObject,b.node);b.layerObject&&this._loadList(b,!0)}}},
getGraphicOptions:function(a,b,h){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:b.wkid}}}:"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:b.wkid}}}:{geometry:new G(a.geometry.x,a.geometry.y,a.geometry.spatialReference),symbol:h.symbol}},_initWidget:function(){this.map.itemId&&s.getInstance(this.map,this.map.itemInfo).then(k.hitch(this,function(a){2.1<=parseFloat(this.appConfig.wabVersion)?this.supportsFilter=
!0:this.supportsFilter=!1;this.opLayers=a._operLayers;this.opLayerInfos=a._layerInfos;this._createPanelUI(this.configLayerInfos,a);this.supportsFilter&&this._addFilterChanged(a)}))},_addFilterChanged:function(a){a.on("filterChanged",k.hitch(this,function(a){C.forEach(a,k.hitch(this,function(a){var q=a.id,b=a.id+this.UNIQUE_APPEND_VAL_CL;this.layerList.hasOwnProperty(q)?this.layerList[q].filter=a.getFilter():this.layerList.hasOwnProperty(b)&&(this.layerList[b].filter=a.getFilter())}))}))},_updatePanelHeader:function(){this.pageLabel.innerHTML=
p.stripHTML(this.label);x.set(this.pageLabel,"display","block");var a;a=this.map.width;this.config.displayPanelIcon&&750<a?(this.pageHeader&&(c.removeClass(this.pageHeader,"pageHeaderNoIcon"),c.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),c.addClass(this.pageHeader,"pageHeader")),this.pageBody&&(c.removeClass(this.pageBody,"pageBodyNoIcon"),c.removeClass(this.pageBody,"pageBodyNoIconRefresh"),c.addClass(this.pageBody,"pageBody")),this.pageTitle&&c.addClass(this.pageTitle,"pageTitleWidth"),
a=this.config.mainPanelText,"undefined"===typeof a&&(a=""),this.pageTitle.innerHTML=a,this.panelMainIcon.innerHTML=this.config.mainPanelIcon):!this.config.displayPanelIcon&&!this.config.refreshEnabled?(this.pageHeader&&(c.removeClass(this.pageHeader,"pageHeader"),c.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),c.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(c.removeClass(this.pageBody,"pageBody"),c.removeClass(this.pageBody,"pageBodyNoIconRefresh"),c.addClass(this.pageBody,
"pageBodyNoIcon")),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):!this.config.displayPanelIcon&&this.config.refreshEnabled?(this.pageHeader&&(c.removeClass(this.pageHeader,"pageHeader"),c.removeClass(this.pageHeader,"pageHeaderNoIcon"),c.addClass(this.pageHeader,"pageHeaderNoIconRefresh")),this.pageBody&&(c.removeClass(this.pageBody,"pageBody"),c.removeClass(this.pageBody,"pageBodyNoIcon"),c.addClass(this.pageBody,"pageBodyNoIconRefresh")),
this.pageTitle&&c.removeClass(this.pageTitle,"pageTitleWidth"),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):this.config.displayPanelIcon&&(750>=a&&this.config.refreshEnabled)&&(this.pageHeader&&(c.removeClass(this.pageHeader,"pageHeaderNoIcon"),c.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),c.removeClass(this.pageHeader,"pageHeader"),c.addClass(this.pageHeader,"pageHeaderRefresh")),this.pageBody&&(c.removeClass(this.pageBody,
"pageBodyNoIcon"),c.removeClass(this.pageBody,"pageBodyNoIconRefresh"),c.removeClass(this.pageBody,"pageBody"),c.addClass(this.pageBody,"pageBodyRefresh")),this.pageTitle&&c.addClass(this.pageTitle,"pageTitleWidth"),a=this.config.mainPanelText,"undefined"===typeof a&&(a=""),this.pageTitle.innerHTML=a)},_createPanelUI:function(a,t){this.numClusterLayers=0;this._updatePanelHeader();this._updateUI(null);this._clearChildNodes(this.pageMain);this.updateEnd=[];for(var h=0;h<a.length;h++){var f=a[h];"ThemeCluster"===
f.symbolData.clusterType&&this.updateThemeClusterSymbol(f,h);var u=t.getLayerInfoById(f.id);this._createLayerListItem(f,u)}b.create("div",{"class":"expandArrow"},this.pageMain);for(var c in this.layerList)h=this.layerList[c],"ClusterLayer"!==h.type&&this.updateEnd.push(this.own(d(h.layerObject,"update-end",k.hitch(this,this.onUpdateEnd))));this.addMapLayers();this.legendNodes.push({node:this.pageHeader,styleProp:"background-color"});this.themeColorManager=new P({updateNodes:this.legendNodes,layerList:this.layerList,
theme:this.appConfig.theme,stylename:this.styleName})},updateThemeClusterSymbol:function(a,b){var h=a.symbolData;this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&"undefined"===typeof this._styleColor&&this._updateStyleColor(this.appConfig.theme.styles[0]);if(this._styleColor){var f=n.fromHex(this._styleColor),u=b+1,c=0<u?30*u:30,d=0===u%2,e=f.g,k=f.b,f=f.r-c;d&&(255<f?f-=255:0>f&&(f+=255));k-=c;0===u%3&&d&&(255<k?k-=255:0>k&&(k+=255));c=e-c;0===u%5&&d&&(255<c?c-=255:0>c&&(c+=255));h.clusterType=
"CustomCluster";h.clusterSymbol={color:[f,c,k,1],outline:{color:[0,0,0,0],width:0,type:"esriSLS",style:"esriSLSNull"},type:"esriSFS",style:"esriSFSSolid"}}},_createLayerListItem:function(a,b){for(var h=["ArcGISFeatureLayer","KML","ArcGISStreamLayer","CSV","GeoRSS"],f=0;f<this.opLayers.length;f++){var c=this.opLayers[f];if(c.id===a.id||c.id===a.parentLayerID)if("ArcGISMapServiceLayer"===c.layerType){if(c=this._getSubLayerByURL(a.id),"undefined"!==typeof c){this.updateLayerList(c,a,"Feature Layer",
b);break}}else if(-1<h.indexOf(c.layerType)||"undefined"===typeof c.layerType)if(c.layerObject&&c.id===a.id){this.updateLayerList(c,a,"Feature Layer",b);break}else if(c.featureCollection)for(var d=0;d<c.featureCollection.layers.length;d++){var e=c.featureCollection.layers[d];if(e.id===a.id||c.id===a.id){this.updateLayerList(e,a,"Feature Collection",b);break}}else if(c.layerObject&&c.id===a.parentLayerID){var k,l;"GeoRSS"===c.type?(l="GeoRSS",k=c.layerObject.getFeatureLayers()):"KML"===c.type&&(l=
"KML",k=c.layerObject.getLayers());if(k)for(c=0;c<k.length;c++)if(d=k[c],d.id===a.id){this.updateLayerList(d,a,l,b);break}}}},removeOldClusterLayers:function(a){var b=[],h;for(h in this.layerList){var f=!1,c=0;b:for(;c<a.length;c++)if(a[c].id+this.UNIQUE_APPEND_VAL_CL===h){b.push(h);f=!0;break b}f&&-1<this.map.graphicsLayerIds.indexOf(h)&&this.map.removeLayer(this.layerList[h].layerObject)}if(0<b.length)for(var d in b)this.layerList.hasOwnProperty(b[d])&&(this.layerList[b[d]].layerObject.destroy(),
delete this.layerList[b[d]])},addMapLayers:function(){for(var a=Object.keys(this.layerList).reverse(),b=0;b<a.length;b++){var h=this.layerList[a[b]];h.type&&"ClusterLayer"===h.type&&this.map.addLayer(h.layerObject)}},_getSubLayerByURL:function(a){for(var b=null,h=0;h<this.opLayerInfos.length;h++){var f=this.opLayerInfos[h];if(0<f.newSubLayers.length&&(b=this._recurseOpLayers(f.newSubLayers,a)))break}return b},_recurseOpLayers:function(a,b){for(var h=0;h<a.length;h++){var f=a[h];if(0<f.newSubLayers.length)this._recurseOpLayers(f.newSubLayers,
b);else if(f.id===b)return f}},updateLayerList:function(a,b,h,f){var c=null,e=null,l=null,g=null,g=b.layerObject?b.layerObject:a,m=this._getInfoTemplate(g&&g.originOperLayer?g.originOperLayer:a);"ArcGISFeatureLayer"===a.layerType?b.symbolData.clusteringEnabled?(c=this._getClusterLayer(b,a,f,h),this.layerList[c.id]={type:"ClusterLayer",layerObject:c,visible:!0,id:c.id,li:b,filter:this.supportsFilter&&f?f.getFilter():"1\x3d1",infoTemplate:m},this.own(d(c,"update-end",k.hitch(this,function(){this._loadList(this.layerList[c.id],
!0)}))),this.numClusterLayers+=1):(a.parentLayerInfo&&a.parentLayerInfo.layerObject&&(e=a.parentLayerInfo.layerObject,l=b.id),c=a.layerObject,g=l?l:b.id,this.layerList[g]={type:e?h:c.type,layerObject:e?e:c,visible:!0,pl:a,li:b,filter:this.supportsFilter&&f?f.getFilter():"1\x3d1",infoTemplate:m},this.updateRenderer(g)):"ArcGISStreamLayer"===a.layerType?(c=a.layerObject,this.layerList[c.id]={type:"StreamLayer",layerObject:c,visible:!0,id:c.id,filter:this.supportsFilter&&f?f.getFilter():"1\x3d1",infoTemplate:m}):
b.symbolData.clusteringEnabled?(c=this._getClusterLayer(b,a,f,h),this.layerList[c.id]={type:"ClusterLayer",layerObject:c,visible:!0,id:c.id,li:b,filter:this.supportsFilter&&f?f.getFilter():"1\x3d1",infoTemplate:m},this.own(d(c,"update-end",k.hitch(this,function(){this._loadList(this.layerList[c.id],!0)}))),this.numClusterLayers+=1):(a.parentLayerInfo&&a.parentLayerInfo.layerObject&&(e=a.parentLayerInfo.layerObject,l=e.visibleLayers?a.id:e.id),c=a.layerObject,g=l?l:a.id,this.layerList[g]={type:e?h:
c?c.type:h,layerObject:e?e:c?c:a,visible:!0,pl:a,li:b,filter:this.supportsFilter&&f?f.getFilter():"1\x3d1",infoTemplate:m},this.updateRenderer(g));this._addPanelItem(e?e:c?c:a,b)},updateRenderer:function(a){a=this.layerList[a];if("LayerSymbol"!==a.li.symbolData.symbolType){"undefined"===typeof a.li.orgRenderer&&(a.li.orgRenderer=a.layerObject.renderer?a.layerObject.renderer:a.li.renderer);var b=new R(O.fromJson(a.li.symbolData.symbol));a.li.newRenderer=b;if(a.layerObject.setRenderer)a.layerObject.setRenderer(b);
else if(a.layerObject.setLayerDrawingOptions){var c=[],f=new Q;f.renderer=b;c[a.li.subLayerId]=f;a.layerObject.setLayerDrawingOptions(c)}else console.log("Error setting the new renderer...will use the default rendering of the layer");a.layerObject.refresh()}},_addPanelItem:function(a,t){a.setVisibility&&a.setVisibility(!0);var h=a.visibleLayers?t.id:a.id,f=this.layerList[h].type,e=b.create("div",{"class":"rec solidBorder",id:"rec_"+h},this.pageMain);b.create("div",{"class":"expand expandDown",id:"exp_"+
h},e);var l=b.create("div",{"class":"recIcon active",id:"recIcon_"+h},e);l.innerHTML=t.panelImageData;x.set(l.firstChild,"border-radius","41px");var g;this.config.countEnabled?(g=b.create("div",{"class":"recLabel",innerHTML:"\x3cp\x3e"+t.label+"\x3c/p\x3e"},e),c.setStyle(g,"top","20px"),g=b.create("div",{"class":"recNum",id:"recNum_"+h,innerHTML:""},e)):b.create("div",{"class":"recLabelNoCount",innerHTML:"\x3cp\x3e"+t.label+"\x3c/p\x3e"},e);"ClusterLayer"===f?(a.node=g,this._addLegend(h,this.layerList[h]),
a._updateNode(a.nodeCount)):("StreamLayer"===f?(this.layerList[h].node=g,this.countFeatures(a,g)):this.layerList[h].node=g,this._addLegend(h,this.layerList[h]));d(l,"click",k.hitch(this,this._toggleLayer,this.layerList[h]));d(e,"click",k.hitch(this,this._toggleLegend,this.layerList[h]));this.layerList[h].pl&&(this.layerList[h].pl.featureSet||this.countFeatures(this.layerList[h].layerObject,g))},_addLegend:function(a,c){c.legendNode=b.create("div",{"class":"legendLayer legendOff",id:"legend_"+a},this.pageMain)},
_loadList:function(a,b){var c=[],f=[],d=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;b&&this._addSearching(d);var e=[];if(a.layerObject&&a.layerObject.infoTemplate){var l=a.layerObject.infoTemplate.info.fieldInfos;if("undefined"!==typeof l)for(var g=0;g<l.length;g++)4>e.length&&l[g].visible&&e.push(l[g].fieldName)}if(a.li.symbolData&&(l=a.li.symbolData.featureDisplayOptions)&&l.fields)for(g=0;g<l.fields.length;g++)-1===e.indexOf(l.fields[g].name)&&e.push(l.fields[g].name);0===e.length&&
(e=["*"]);"*"!==e[0]&&a.layerObject&&a.layerObject.objectIdField&&-1===e.indexOf(a.layerObject.objectIdField)&&e.push(a.layerObject.objectIdField);if("ClusterLayer"===a.type){var n=[];if(a.layerObject.clusterGraphics){d=a.layerObject.clusterGraphics;for(l=0;l<d.length;l++)if(g=d[l],g.graphics&&0<g.graphics.length)for(var p=0;p<g.graphics.length;p++)n.push(g.graphics[p]);setTimeout(k.hitch(this,function(){this._updateList(n,a.legendNode,a.layerObject.node,e,b,a)}),8)}else this._removeSearching(d,!0)}d=
["StreamLayer","GeoRSS","KML","Feature Layer"];if("ClusterLayer"!==a.type){if(a.pl&&a.pl.featureSet){this.getFeatures(a,e,b);return}if(-1<d.indexOf(a.type)||"CSV"===a.pl.type){this.getFeatures(a,e,b);return}}if(a.li&&(a.li.url&&"ClusterLayer"!==a.type&&"undefined"===typeof a.queryFeatures)&&(l=a.li.url,-1<l.indexOf("MapServer")||-1<l.indexOf("FeatureServer")))this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),d=new m,d.where=a.filter?a.filter:"1\x3d1",d.geometry=this.map.extent,
d.returnGeometry=!0,d.outFields=e,l=new M(l),c.push(l.execute(d)),f.push({node:a.node,legendNode:a.legendNode,fields:e,updateCount:b,li:a.li});0<c.length&&(this.promises=B(c).then(k.hitch(this,function(a){this.promises=void 0;if(a)for(var b=0;b<a.length;b++)if(a[b]){var c=f[b];this._updateList(a[b].features,c.legendNode,c.node,c.fields,c.updateCount,c.li)}})))},_addSearching:function(b){a.contains("exp_"+b,"expandDown")&&(a.remove("exp_"+b,"expandDown"),a.add("exp_"+b,"expandSearching"));a.contains("exp_"+
b,"expandUp")&&(a.remove("exp_"+b,"expandUp"),a.add("exp_"+b,"expandSearching"))},_removeSearching:function(b,c){a.contains("exp_"+b,"expandSearching")&&(a.remove("exp_"+b,"expandSearching"),a.add("exp_"+b,c?"expandUp":"expandDown"))},_getClusterLayer:function(a,c,h,f){var d=c.layerObject?c.layerObject:c,e=a.infoTemplate,k=d&&d.originOperLayer?d.originOperLayer:c.parentLayerInfo;c=null;c=a.id+this.UNIQUE_APPEND_VAL_CL;-1<this.map.graphicsLayerIds.indexOf(c)?(c=this.map.getLayer(c),d=f=!1,JSON.stringify(c.symbolData)!==
JSON.stringify(a.symbolData)&&(c.symbolData=a.symbolData,c.countColor=a.symbolData._highLightColor,d=!0),h=b.toDom(a.panelImageData),JSON.stringify(c.icon)!==JSON.stringify(h.src)&&(c.icon=h.src,d=!0),b.destroy(h.id),c.displayFeatureCount=a.symbolData.displayFeatureCount,c.refresh!==a.refresh&&(c.refresh=a.refresh,f=!0),d&&c._setupSymbols(),c.countEnabled=this.config.countEnabled,f?c.refreshFeatures(c.url):d&&c.clusterFeatures()):c=new T({name:a.label+this.UNIQUE_APPEND_VAL_CL,id:c,map:this.map,node:g.byId("recNum_"+
c),infoTemplate:"undefined"!==typeof d.infoTemplate?d.infoTemplate:e,refreshInterval:this.config.refreshInterval,refreshEnabled:this.config.refreshEnabled,parentLayer:d,lyrInfo:a,lyrType:f,_styleColor:this._styleColor,originOperLayer:k,countEnabled:this.config.countEnabled,filter:this.supportsFilter&&h?h.getFilter():"1\x3d1"});return c},_createImageDataDiv:function(a,c,h,f){var d;if(a){d=c;var e=h;if(a.height&&a.width){var k;if(a.height>a.width)k=a.width/a.height,e=c*k;else if(a.width===a.height||
a.width>a.height)e=c,k=a.width/a.height,d=0<k?h*k:h}"undefined"!==typeof a.setWidth?"undefined"!==typeof a.setHeight?(a.setWidth(e),a.setHeight(d)):a.setWidth(2):"undefined"!==typeof a.size&&20<a.size&&a.setSize(20);d=b.create("div",{"class":"imageDataGFX"},f);f=v.createSurface(d,c,h);a=O.getShapeDescriptors(a);f.createShape(a.defaultShape).setFill(a.fill).setStroke(a.stroke).applyTransform({dx:c/2,dy:h/2})}return d},_updateUI:function(a){this.styleName=a;0<Object.keys(this.layerList).length&&(this.themeColorManager=
new P({updateNodes:this.legendNodes,layerList:this.layerList,theme:this.appConfig.theme,stylename:a}))},_toggleLayer:function(b,c){c.stopPropagation();this.map.infoWindow.hide();var h=b.id?b.id:b.layerObject.id,f=this.layerList[h];f||(f=this.layerList[h]);f||(b.pl&&(h=b.pl.id),f=this.layerList[h]);if(f){var d=!1;f.li&&f.li.hasOwnProperty("subLayerId")&&(d="undefined"!==typeof f.li.subLayerId);a.contains("recIcon_"+h,"active")?(a.remove("recIcon_"+h,"active"),d&&"ClusterLayer"!==f.type?(h=f.layerObject.visibleLayers,
d=h.indexOf(f.li.subLayerId),-1<d&&h.splice(d,1),f.layerObject.setVisibleLayers(h),f.layerObject.setVisibility(!0)):f&&(f.layerObject.setVisibility(!1),this.layerList[h].visible=!1,"undefined"!==typeof f.pl&&(f.pl.visibility=!1,-1<this.map.graphicsLayerIds.indexOf(h)&&(f=this.map.getLayer(h),f.setVisibility(!1))))):(a.add("recIcon_"+h,"active"),d&&"ClusterLayer"!==f.type?(h=f.layerObject.visibleLayers,h.push(f.li.subLayerId),f.layerObject.setVisibleLayers(h),f.layerObject.setVisibility(!0)):f&&(f.layerObject.setVisibility(!0),
"ClusterLayer"===f.type&&f.layerObject.flashFeatures(),this.layerList[h].visible=!0,"undefined"!==typeof f.pl&&(f.pl.visibility=!0,-1<this.map.graphicsLayerIds.indexOf(h)&&(f=this.map.getLayer(h),f.setVisibility(!0)))))}return!1},_toggleLegend:function(b,c){if("thumb2"!==c.currentTarget.className&&"recIcon"!==c.currentTarget.className){var h=b.layerObject.id in this.layerList?b.layerObject.id:b.li.id;a.contains("legend_"+h,"legendOff")?(a.remove("legend_"+h,"legendOff"),a.add("legend_"+h,"legendOn"),
a.contains("exp_"+h,"expandDown")&&(a.remove("exp_"+h,"expandDown"),a.add("exp_"+h,"expandSearching")),this.layerList[h].legendOpen=!0,"undefined"===typeof this.layerList[h].li.layerListExtentChanged&&(this.layerList[h].li.layerListExtentChanged=!0),this.layerList[h].li.layerListExtentChanged?this._loadList(b,!1):this._removeSearching(h,!0)):a.contains("legend_"+h,"legendOn")&&(this.layerList[h].legendOpen=!1,a.remove("legend_"+h,"legendOn"),a.add("legend_"+h,"legendOff"),a.contains("exp_"+h,"expandUp")&&
(a.remove("exp_"+h,"expandUp"),a.add("exp_"+h,"expandDown")))}c.stopPropagation()},_toggleGroup:function(b,d){var h=d.currentTarget.id.slice(0,-2),f=!0;d.target.parentNode&&(""!==d.target.parentNode.id&&a.contains(d.target.parentNode.id,"featureItem")&&(f=!1),""!==d.target.id&&a.contains(d.target.id,"featureItem")&&(f=!1));if(f){var f=b.layerObject.id in this.layerList?b.layerObject.id:b.li.id,e=document.getElementById(d.currentTarget.id);a.contains(h,"groupOff")?(this.layerList[f].openGroups&&0<
this.layerList[f].openGroups.length?-1===this.layerList[f].openGroups.indexOf(h)&&this.layerList[f].openGroups.push(h):this.layerList[f].openGroups=[h],a.remove(h,"groupOff"),a.add(h,"groupOn"),this.layerList[f].groupOpen=!0,-1<e.childNodes[0].childNodes[2].className.indexOf("groupItemImage")&&(c.removeClass(e.childNodes[0].childNodes[2],"groupItemImageDown"),c.addClass(e.childNodes[0].childNodes[2],"groupItemImageUp"))):a.contains(h,"groupOn")&&(a.remove(h,"groupOn"),a.add(h,"groupOff"),this.layerList[f].openGroups&&
0<this.layerList[f].openGroups.length?(h=this.layerList[f].openGroups.indexOf(h),-1<h&&this.layerList[f].openGroups.splice(h,1),0===this.layerList[f].openGroups.length&&(this.layerList[f].groupOpen=!1)):this.layerList[f].groupOpen=!1,-1<e.childNodes[0].childNodes[2].className.indexOf("groupItemImage")&&(c.removeClass(e.childNodes[0].childNodes[2],"groupItemImageUp"),c.addClass(d.currentTarget.childNodes[0].childNodes[2],"groupItemImageDown")))}},onAppConfigChanged:function(a,b,c){switch(b){case "themeChange":case "layoutChange":this.destroy();
break;case "styleChange":this._updateUI(c);this._updateStyleColor(c);break;case "widgetChange":this.widgetChange=!0;c&&c.config.layerInfos&&this.removeOldClusterLayers(c.config.layerInfos);break;case "mapChange":this._clearMap()}},_updateStyleColor:function(a){K.get({url:"./themes/"+this.appConfig.theme.name+"/manifest.json",handleAs:"json",sync:this.initialLoad,load:k.hitch(this,function(a){this.initialLoad=!1;a=a.styles;var b=0;for(;b<a.length;b++){var c;C.forEach(document.styleSheets,function(a){(a=
a.rules?a.rules:a.cssRules)&&C.forEach(a,function(a){".jimu-main-background"===a.selectorText&&(c=a.style.getPropertyValue("background-color"))})});this._styleColor=J.fromRgb(c).toHex();for(var d in this.layerList){var e=this.layerList[d];"ClusterLayer"===e.type&&e.layerObject.setStyleColor(this._styleColor)}}})})},_clearMap:function(){if(this.layerList){for(var a in this.layerList){var b=this.layerList[a];"ClusterLayer"===b.type&&(b.layerObject._clear(),this.map.removeLayer(b.layerObject))}this.layerList=
{}}},setPosition:function(a,b){var d;"BoxTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=d={right:"0px",bottom:"0px",top:"0px",height:"auto","z-index":"auto"},d=p.getPositionStyle(this.position),d.position="absolute",b=this.map.id,c.place(this.domNode,b),c.setStyle(this.domNode,d),x.set(this.pageContent,"bottom","60px")):("DartTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=d={right:"0px",bottom:"80px",top:"0px",height:"auto","z-index":"auto"},
d=p.getPositionStyle(this.position),d.position="absolute",b=this.map.id,c.place(this.domNode,b)):"LaunchpadTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=d={right:"0px",bottom:"130px",top:"70px",height:"auto","z-index":"auto"},d=p.getPositionStyle(this.position),d.position="absolute",b=this.map.id,c.place(this.domNode,b)):470>=window.innerWidth?(this.position=d={right:"0px",bottom:"0px",height:"none","z-index":"auto",relativeTo:"browser"},d=p.getPositionStyle(this.position),
d.position="absolute",c.place(this.domNode,window.jimuConfig.layoutId),g.byId("map").style.bottom=window.innerHeight/2+"px"):(this.position=d={right:"0px",bottom:"0px",height:"none","z-index":"auto"},d=p.getPositionStyle(this.position),d.position="absolute",c.place(this.domNode,this.map.id)),c.setStyle(this.domNode,d))},_close:function(){this.widgetManager.closeWidget(this.id)},onClose:function(){this.inherited(arguments);this.queryList&&(this.queryList.cancel(),this.queryLookupList=[]);this.layerVisibilityManager&&
(this.layerVisibilityManager.resetLayerVisibility(),this.layerVisibilityManager=null);for(var a in this.layerList){var b=this.layerList[a];b.li&&b.li.orgRenderer&&(b.layerObject.setRenderer?b.layerObject.setRenderer(b.li.orgRenderer):b.layerObject.setLayerDrawingOptions?b.layerObject.setLayerDrawingOptions([]):console.log("Error re-setting the renderer"),b.layerObject.refresh())}0!==this.refreshInterval&&(this.refreshIntervalValue=0,clearInterval(this.refreshInterval),this.refreshInterval=0);this.mapExtentChangedHandler.remove();
this.mapExtentChangedHandler=void 0;this._resetMapDiv()},_resetMapDiv:function(){g.byId("map").style.bottom="0px"},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},onUpdateEnd:function(a){a=this.layerList.hasOwnProperty(a.target.id)?a.target.id:a.target.id+"_CL";if(a=this.layerList[a])a.updateList?this._loadList(a,a.updateList):(this.config.countEnabled&&this.countFeatures(a.layerObject,a.node),this._loadList(a,!0))},_mapExtentChange:function(){var b=[],c=[],d;for(d in this.layerList){var f=
this.layerList[d];if(!f.legendOpen||f.groupEnabled&&!f.groupOpen){if(this._clearList(f),f.li&&(f.li.layerListExtentChanged=!0),this.config.countEnabled){if(f.li&&f.li.url&&"ClusterLayer"!==f.type&&"undefined"===typeof f.layerObject.queryCount){var e=f.li.url;if(-1<e.indexOf("MapServer")||-1<e.indexOf("FeatureServer")){this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0);var k=new m;k.where=f.filter?f.filter:"1\x3d1";k.geometry=this.map.extent;k.returnGeometry=!1;e=new M(e);b.push(e.executeForIds(k));
c.push(f.node)}}"ClusterLayer"===f.type&&f.layerObject.initalLoad&&f.layerObject._updateNode(f.layerObject.node.innerHTML);k=["StreamLayer","GeoRSS","KML"];"ClusterLayer"!==f.type&&("undefined"===typeof f.layerObject?console.log("layer object not known"):f.pl&&f.pl.featureSet?this.countFeatures(f.layerObject,f.node):-1<k.indexOf(f.type)||"CSV"===f.pl.type?this.countFeatures(f.layerObject,f.node):f.layerObject._autoSnapshot&&this.countFeatures(f.layerObject,f.node))}}else f.updateList=!0,this._loadList(f,
f.updateList)}0<b.length&&(this.promises=B(b).then(function(b){this.promises=void 0;if(b)for(var d=0;d<b.length;d++)b[d]?(a.contains(c[d].id,"searching")&&a.remove(c[d].id,"searching"),c[d].innerHTML=b[d].length.toLocaleString()):c[d].innerHTML=0}))},getFeatures:function(a,b,c){var d=a.layerObject,e=a.legendNode,l=a.node,g=[],n=new m;n.geometry=this.map.extent;n.outFields=b;n.returnGeometry=!0;if(d.queryFeatures)g.push(d.queryFeatures(n));else if(d=a.li.url,-1<d.indexOf("MapServer")||-1<d.indexOf("FeatureServer"))d=
new M(d),n.where=a.filter?a.filter:"1\x3d1",g.push(d.execute(n));0<g.length&&(this.featurePromises&&(this.featurePromises.cancel("redundant",!1),this.featurePromises=void 0),B(g).then(k.hitch(this,function(d){d[0].features&&setTimeout(k.hitch(this,function(){this._updateList(d[0].features,e,l,b,c,a)}),8)})))},_getInfoTemplate:function(a){var b;b=a.parentLayerInfo?a.parentLayerInfo:a;if(b.controlPopupInfo&&(a=b.controlPopupInfo.infoTemplates)&&b.layerObject&&b.layerObject.url)if(b=b.layerObject.url,
b=b.split("/").pop())if(a.indexOf){if(-1<a.indexOf(b))return a[b].infoTemplate}else if(a.hasOwnProperty(b))return a[b].infoTemplate},_clearList:function(a){a.legendNode&&(a.legendNode.innerHTML="")},_updateList:function(c,e,h,f,l,g){"ClusterLayer"===g.type&&g.layerObject.node&&a.contains(g.layerObject.node.id,"searching")&&a.remove(g.layerObject.node.id,"searching");var m;if("undefined"!==typeof g.li.subLayerId){var n=g.layerObject.infoTemplates;n&&n.hasOwnProperty(g.li.subLayerId)&&(m=n[g.li.subLayerId].infoTemplate)}n=
g.li.symbolData.featureDisplayOptions;e.innerHTML="";l&&(h&&this.config.countEnabled)&&(h.innerHTML=c.length.toLocaleString());if(0<c.length){var p;c[0]._graphicsLayer?p=c[0]._graphicsLayer.renderer:"ClusterLayer"===g.type?p=g.layerObject.renderer:g.li.renderer&&(p=S.fromJson(g.li.renderer));l=[];var r=[];h=[];for(var w=0;w<c.length;w++){var A=c[w];"undefined"===typeof A.infoTemplate&&m&&(A.infoTemplate=m);var s,x;A._layer&&A._layer.objectIdField?(s=A.attributes[A._layer.objectIdField],x=A._layer.objectIdField):
g.li&&g.li.oidFieldName?(s=A.attributes[g.li.oidFieldName.name],x=g.li.oidFieldName.name):g.layerObject&&g.layerObject.objectIdField?(s=A.attributes[g.layerObject.objectIdField],x=g.layerObject.objectIdField):s=e.id+w;var v,z=!1;"*"===f[0]?v=A.attributes:(v=f,z=!0);v=this.getDisplayString(A,g,v,n,x,z);var E,y,B;if(n.groupEnabled){E=n.groupField;var D="group_"+g.li.id+"_"+E.name+"_"+A.attributes[E.name],F=!0,G;0<l.length&&C.forEach(l,function(a){D===a.id&&A.attributes[E.name]===a.value&&(F=!1,G=a.node,
B=a.parent)});if(F){B=b.create("div",{"class":"groupItem",id:D+"_c"});y=b.create("div",{"class":"groupItemTitle",id:D+"_t"},B);var z="",I=E.name+": ";""!==E.label&&(I=z=E.label+": ");": "===z&&(I=z="");b.create("div",{"class":"groupField",innerHTML:z+A.attributes[E.name],title:I+A.attributes[E.name]},y);I=!1;g.openGroups&&0<g.openGroups.length&&(I=-1<g.openGroups.indexOf(D));z=b.create("div",{"class":"groupCountLabel"},y);y=b.create("div",{"class":"expandImageContainer"},y);var H="groupItemImage",
H=H+(I?" groupItemImageUp":" groupItemImageDown");b.create("div",{"class":H},y);H="groupItem";H=g.groupOpen&&I?H+" groupOn":H+" groupOff";y=b.create("div",{"class":H,id:D},B);l.push({id:"group_"+g.li.id+"_"+E.name+"_"+A.attributes[E.name],node:y,parent:B,value:A.attributes[E.name]});r.push({value:A.attributes[E.name],node:B,countNode:z,count:1});d(B,"click",k.hitch(this,this._toggleGroup,g))}else r.filter(function(a){if(a.node.id===G.id+"_c")return a})[0].count+=1,y=G}s=b.create("div",{"class":"featureItem",
id:"feature_"+g.li.id+"_"+s});d(s,"click",k.hitch(this,this._panToFeature,A));p&&p.getSymbol&&this._createImageDataDiv(k.clone(p.getSymbol(A)),30,30,s);-1<v.indexOf(" - ")&&(v=v.slice(0,-3));b.create("div",{style:"padding: 7px 5px 5px 45px; text-align: left;",innerHTML:v,title:v},s);h.push({node:s,updateNode:y?y:e})}if(0<r.length){c=r.sort(function(a,b){return"undefined"===typeof a.value?b.value:"undefined"===typeof b.value?a.value:isNaN(a.value)?a.value.localeCompare(b.value):parseFloat(a.value)-
parseFloat(b.value)});var J=this.config.countEnabled;C.forEach(c,function(a){J&&(a.countNode.innerHTML=a.count.toLocaleString());e.appendChild(a.node)})}0<h.length&&C.forEach(h,function(a){b.place(a.node,a.updateNode)})}g.li.layerListExtentChanged=!1;this._removeSearching(g.layerObject.id in this.layerList?g.layerObject.id:g.li.id,g.legendOpen)},getDisplayString:function(a,b,c,d,e,g){var k,l,m="",n,p,r,s;for(s in c)if(r=g?c[s]:s,l=this._checkDateField(b,r),k=!0,d.fields&&0<d.fields.length&&(k=this._checkDisplayField(d.fields,
r)),n=""!==k.label?": ":" ",p=a.attributes[r],l&&(p=this.formatDateValue(p,r,b)),k&&d.fields&&0<d.fields.length)m+=k.label+n+p+" - ";else if(k)if(e&&r!==e){m+=r+n+p;break}else if("undefined"===typeof e){m+=r+n+p;break}return m},formatDateValue:function(a,b,c){var d,e;c.layerObject&&c.layerObject.infoTemplate?e=c.layerObject.infoTemplate:c.li&&c.li.infoTemplate&&(e=c.li.infoTemplate);if(e&&(c=e._fieldsMap))for(var g in c)c[g].fieldName===b&&(d=this._getDateFormat(c[g].format.dateFormat));"undefined"===
typeof d&&(d={month:"long",day:"2-digit",year:"numeric"});return(new Date(a)).toLocaleDateString(navigator.language,d)},_checkDateField:function(a,b){var c=a.li.fields;if(c){for(var d=0;d<c.length;d++){var e=c[d];if(e.name===b){if("esriFieldTypeDate"===e.type)return!0;break}}return!1}},_getDateFormat:function(a){var b;switch(a){case "shortDate":b={month:"2-digit",day:"2-digit",year:"numeric"};break;case "shortDateLE":b={day:"2-digit",month:"2-digit",year:"numeric"};break;case "longMonthDayYear":b=
{month:"long",day:"2-digit",year:"numeric"};break;case "dayShortMonthYear":b={day:"2-digit",month:"short",year:"numeric"};break;case "longDate":b={weekday:"long",month:"long",day:"2-digit",year:"numeric"};break;case "shortDateLongTime":b={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0};break;case "shortDateLELongTime":b={day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0};break;case "shortDateShortTime":b=
{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};break;case "shortDateLEShortTime":b={day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};break;case "shortDateShortTime24":b={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!1};break;case "shortDateLEShortTime24":b={day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!1};break;case "longMonthYear":b={month:"long",
year:"numeric"};break;case "shortMonthYear":b={month:"short",year:"numeric"};break;case "year":b={year:"numeric"}}return b},_checkDisplayField:function(a,b){var c=!0;if(a)for(var d=0;d<a.length;d++){if(a[d].name===b)return a[d];c=!1}return c},_flashFeature:function(a){var b;if(a.geometry){var c=J.fromHex(this._styleColor),d=k.clone(c);d.a=0.4;switch(a.geometry.type){case "point":b=new w(w.STYLE_CIRCLE,15,new z(z.STYLE_SOLID,c,1),d);break;case "polyline":b=new z(z.STYLE_SOLID,c,3);break;case "polygon":b=
new D(D.STYLE_DIAGONAL_CROSS,new z(z.STYLE_SOLID,c,2),d)}}a=new e(a.geometry,b);this.map.graphics.add(a);if(b=a.getDojoShape())r.animateStroke({shape:b,duration:900,color:{start:b.strokeStyle.color,end:b.strokeStyle.color},width:{start:25,end:0}}).play(),setTimeout(this._clearFeature,1075,a)},_clearFeature:function(a){a.getLayer().remove(a)},_panToFeature:function(a){if(a.geometry){var b=a.geometry;if("polyline"===b.type)var c=b.paths[Math.ceil(b.paths.length/2)-1],c=c[Math.ceil((c.length-1)/2)],
b=new G(c[0],c[1],b.spatialReference);"point"!==b.type&&(b=b.getExtent().getCenter());this._flashFeature(a);this.map.infoWindow.setFeatures([a]);this.map.infoWindow.select(0);this.map.infoWindow.show(b)}},countFeatures:function(a,b){var c=new m;c.geometry=this.map.extent;a.queryCount&&this.config.countEnabled&&a.queryCount(c,k.hitch(this,function(a){b&&(b.innerHTML=a.toLocaleString())}))}})});