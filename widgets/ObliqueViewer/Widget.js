// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/ObliqueViewer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../tasks/QueryTask ../tasks/query ./_EventedWidget dijit/_Widget ./_ObliqueRotationWidget dojo/_base/array ../ImageSpatialReference ../tasks/ImageServiceProjectTask ../tasks/ProjectParameters ../layers/MosaicRule ../geometry/Extent ../geometry/Polygon ../lang ../config ./RasterList dojo/store/Observable dojo/store/Memory dojo/Deferred".split(" "),function(c,g,n,l,a,b,k,h,w,f,q,m,z,t,
s,u,r,v,x,y,B,D){return c([k,h],{declaredClass:"esri.dijit.ObliqueViewer",azimuthField:"SensorAzimuth",elevationThreshold:70,elevationField:"SensorElevation",snap:!0,_refreshOK:!0,isNadir:!1,showThumbnail:!0,noQueryOnExtentChange:!1,azimuthTolerance:10,rasterListRefresh:!0,extents:[],maxExtentIdx:5,currentExtentIdx:null,setNextExtent:function(){if(!(this.currentExtentIdx>=this.maxExtentIdx||this.currentExtentIdx>=this.extents.length-1)){var d=this;this.currentExtentIdx++;var e=new t,p;e.method=t.METHOD_LOCKRASTER;
e.lockRasterIds=[this.extents[this.currentExtentIdx].spatialReference.icsid];d.imageServiceLayer.setMosaicRule(e,!0);d._refreshOK=!1;d.map.spatialReference=this.extents[this.currentExtentIdx].spatialReference;p=v.defaults.map.zoomDuration;v.defaults.map.zoomDuration=0;d.map.setExtent(this.extents[this.currentExtentIdx]).then(function(){d._refreshOK=!0;v.defaults.map.zoomDuration=p})}},setPreviousExtent:function(){if(!(0>=this.currentExtentIdx)){var d=this;this.currentExtentIdx--;var e=new t,p;e.method=
t.METHOD_LOCKRASTER;e.lockRasterIds=[this.extents[this.currentExtentIdx].spatialReference.icsid];d.imageServiceLayer.setMosaicRule(e,!0);d._refreshOK=!1;d.map.spatialReference=this.extents[this.currentExtentIdx].spatialReference;p=v.defaults.map.zoomDuration;v.defaults.map.zoomDuration=0;d.map.setExtent(this.extents[this.currentExtentIdx]).then(function(){d._refreshOK=!0;v.defaults.map.zoomDuration=p})}},isPreviousAvailable:function(){},isNextAvailable:function(){},_isICS:function(d){return!(!d.ics&&
!d.icsid)},resizeRotationGauge:function(d){this._rotationWidget.resize(d)},_initializeTasks:function(){this.obliqueRecordsQueryTask=new a(this.imageServiceUrl);this.projectTask=new m},_verifyRasterInfoFields:function(){return this.rasterInfoFields&&this.rasterInfoFields.length},_setupRasterList:function(){var d=this,e=[{name:this.imageServiceLayer.objectIdField,alias:"Object ID",display:!0},{name:this.azimuthField,alias:"Azimuth",display:!0},{name:this.elevationField,alias:this.elevationField,display:!0}];
this.rasterInfoFields=this._verifyRasterInfoFields()?this.rasterInfoFields:e;this.rasterList=new x({data:new y(new B),showThumbnail:this.showThumbnail,imageServiceUrl:this.imageServiceLayer.url,fields:this.rasterInfoFields},this.rasterListDiv);this.rasterList.on("raster-select",function(e){d.selectedRasterId=e[d.imageServiceLayer.objectIdField];d.emit("raster-select",{selectedRasterId:d.selectedRasterId});d.setImage(d.selectedRasterId,d.map.extent);f.forEach(d.filteredRecords,function(e){delete e.attributes.selected;
e.attributes[d.imageServiceLayer.objectIdField]===d.selectedRasterId&&(e.attributes.selected=!0)});d._rotationWidget&&d._rotationWidget.setAzimuth(e[d.azimuthField])});this.rasterList.startup()},_setupRotationWidget:function(){var d=this;this._rotationWidget=new w({snap:this.snap,azimuthAngle:this.azimuthAngle},this.rotationDiv);this._rotationWidget.startup();this.own(this._rotationWidget.on("azimuth-change",function(e){e=e.azimuth;d.currentExtentIdx=0;d.extents=[];d.emit("azimuth-change",{azimuth:e});
e?(d.azimuthAngle=e,d._checkExtentOrientation(),d._filterByAzimuth(),d._rotationWidget.refresh({features:d.records}),d._refreshListDijit(d.filteredRecords),d._refreshImage(d.map.extent),d._oldAzimuth=e,d.isNadir=!1):d._switchToNadir()}))},_checkExtentOrientation:function(){var d=Math.abs((this._oldAzimuth-this.azimuthAngle)/90%2);this._azimuthExtentChanged=0.25>d||1.75<d?!1:!0},_refreshListDijit:function(d){d=this._prepareListData(d);this.rasterList&&this.rasterListRefresh&&this.rasterList.setData(d);
this.emit("records-refresh",{records:this.records,filteredRecords:this.filteredRecords})},_prepareListData:function(d){var e=[],p,a=this.imageServiceLayer.objectIdField;f.forEach(d,function(d){p=d.attributes;p.thumbnailUrl=this.imageServiceUrl+"/"+p[a]+"/thumbnail";e.push(p)},this);return new y(new B({data:e,idProperty:this.imageServiceLayer.objectIdField}))},_switchToNadir:function(){var d=!!this.map.extent.spatialReference.icsid,e=this.defaultNadirMosaicRule||this.imageServiceLayer.mosaicRule||
new t;this._oldAzimuth=this.azimuthAngle=null;this._azimuthExtentChanged=!1;e.method=e.method||t.METHOD_NONE;e.where=this.elevationField+"\x3e"+this.elevationThreshold;this.defaultNadirMosaicRule=e;this.imageServiceLayer.setMosaicRule(e,d);if(d){var p=this,a;this.projectGeometry(this.map.extent,this.nadirSpatialReference).then(function(e){p._verifyExtent(e[0])&&(p._refreshOK=!1,p.map.spatialReference=e[0].spatialReference,a=v.defaults.map.zoomDuration,v.defaults.map.zoomDuration=0,p.map.setExtent((new s(e[0])).setSpatialReference(e[0].spatialReference)).then(function(){p._refreshOK=
!0;p.isNadir=!0;v.defaults.map.zoomDuration=a;p.selectedRasterId=null;p.selectedRaster=null;p.filteredRecords=null}))})}},projectGeometry:function(d,e){var p=new z;e=e||this.map.spatialReference;p.geometries=[d];p.outSR=e;return this.projectTask.execute(p)},_verifyExtent:function(d){return!isNaN(d.xmin)&&!isNaN(d.xmax)&&!isNaN(d.ymin)&&!isNaN(d.ymax)},_verifyPoint:function(d){return!isNaN(d.x)&&!isNaN(d.y)},_refreshRecords:function(d){function e(e){p._verifyExtent(e[0].getExtent())?(p.nadirExtent=
e[0].getExtent(),p.emit("extent-change",{extent:e[0]}),p.search(p._trimExtent(p.nadirExtent,a)).then(function(e){if(!e||!e.features||!e.features.length)return console.log("Oblique viewer: no records returned");p.records=e.features;p._rotationWidget&&p._rotationWidget.refresh({features:p.records});p.isNadir?p._refreshListDijit(p.records):(p._filterByAzimuth(),p._refreshListDijit(p.filteredRecords),d&&(p.filteredRecords&&p.filteredRecords.length)&&p._refreshImage(p.map.extent))})):(console.error("Oblique viewer: Project Operation returned invalid extent"),
p.search(p._trimExtent(p.map.extent,a)).then(function(e){if(!e||!e.features||!e.features.length)return console.log("Oblique viewer: no records returned");p.records=e.features;p._rotationWidget&&p._rotationWidget.refresh({features:p.records});p.isNadir?p._refreshListDijit(p.records):(p._filterByAzimuth(),p._refreshListDijit(p.filteredRecords),d&&(p.filteredRecords&&p.filteredRecords.length)&&p._refreshImage((new u(p.filteredRecords[0].geometry)).getExtent()))}))}var p=this,a=0.15;this.nadirSpatialReference.equals(this.map.extent.spatialReference)?
e([this.map.extent]):this.projectGeometry(this._convertExtentToPolygon(this.map.extent),this.nadirSpatialReference).then(e)},_convertExtentToPolygon:function(d){var e=new u(d.spatialReference);e.addRing([[d.xmax,d.ymin],[d.xmax,d.ymax],[d.xmin,d.ymax],[d.xmin,d.ymin],[d.xmax,d.ymin]]);return e},postCreate:function(){this.inherited(arguments);(!this.map||!this.imageServiceLayer)&&console.error("ObliqueViewer: Map or Image service layer not provided.");this.imageServiceUrl=this.imageServiceLayer.url;
this.nadirSpatialReference=this.map.extent.spatialReference;this._initializeTasks();(this.isNadir=!r.isDefined(this.azimuthAngle))&&this._switchToNadir();this.rotationDiv&&this._setupRotationWidget();if(this.rasterListDiv)if(this.imageServiceLayer.loaded)this._setupRasterList();else this.imageServiceLayer.on("load",g.hitch(this,this._setupRasterList));this.sorter||(this.sorter=this._sortSpatially);this.own(this.map.on("extent-change",g.hitch(this,function(d){this._refreshOK&&!this.noQueryOnExtentChange&&
(this._isICS(this.map.extent.spatialReference)||(this.nadirExtent=this.map.extent,this._switchToNadir(),this.emit("extent-change",{extent:this._convertExtentToPolygon(this.nadirExtent)})),this._refreshRecords(!0),this._azimuthExtentChanged=!1)})));r.isDefined(this.azimuthAngle)&&!this.noQueryOnExtentChange&&this._refreshRecords()},_refreshImage:function(d){!this.filteredRecords||!this.filteredRecords.length||this.selectedRasterId===this.filteredRecords[0].attributes[this.imageServiceLayer.objectIdField]?
this._refreshSavedExtents():this._setSelectedRaster(d)},_refreshSavedExtents:function(){this._isICS(this.map.extent.spatialReference)&&(!this.extents||!this.extents.length?(this.currentExtentIdx=0,this.extents=[]):(this.extents.length>this.maxExtentIdx&&(this.extents.shift(),this.currentExtentIdx--),this.currentExtentIdx<this.extents.length-1?this.currentExtentIdx=this.extents.length-1:this.currentExtentIdx++),this.extents.push(this.map.extent))},_createExtent:function(d,e,p){var a=1.00001*(p.getWidth()/
2);p=p.getHeight()/2;return new s(d.x-a,d.y-p,d.x+a,d.y+p,e)},setImage:function(d,e){function p(e){if(k)if(a._verifyPoint(e[0]))h=a._createExtent(e[0],a.imageSpatialReference,k),a.projectGeometry(a._convertExtentToPolygon(h),a.nadirSpatialReference).then(function(e){a.emit("extent-change",{extent:e[0]})});else return console.log("Project operation returned invalid result.");else{if(!k&&!a._verifyExtent(e[0]))return console.log("Project operation returned invalid extent.");h=e[0]}b=new t;b.method=
t.METHOD_LOCKRASTER;b.lockRasterIds=[d];a.imageServiceLayer.setMosaicRule(b,!0);a._refreshOK=!1;a.map.spatialReference=h.spatialReference;f=v.defaults.map.zoomDuration;m=v.defaults.map.panDuration=0;v.defaults.map.zoomDuration=0;v.defaults.map.panDuration=0;a.map.setExtent((new s(h)).setSpatialReference(h.spatialReference)).then(function(){a._refreshOK=!0;v.defaults.map.zoomDuration=f;v.defaults.map.panDuration=m;a._refreshSavedExtents();a.projectGeometry(a._convertExtentToPolygon(h),a.nadirSpatialReference).then(function(e){a.emit("extent-change",
{extent:e[0]})})})}if(!d)return console.error("Object ID of raster to be displayed not provided");var a=this,b,f,m,k=e&&(e.spatialReference.icsid||e.spatialReference.ics)?e:null,h;this.imageSpatialReference=new q({icsid:d,url:this.imageServiceUrl});e&&e.spatialReference&&!e.spatialReference.ics&&!e.spatialReference.icsid?(a.nadirExtent=e.getExtent(),a.projectGeometry(a.nadirExtent,a.imageSpatialReference).then(p)):this.projectGeometry(this._convertExtentToPolygon(this._adjustExtentAspectRatio(e)),
this.nadirSpatialReference).then(function(d){a.nadirExtent=d[0].getExtent().setSpatialReference(a.nadirSpatialReference);a.projectGeometry(e.getCenter(),a.imageSpatialReference).then(p)})},locate:function(d){if(!d)return console.error("Geometry not specified.");var e=this,a=d.type&&"extent"===d.type?d:d.getExtent();this.search(d).then(function(d){e.setData(d.features,a)})},search:function(d){if(!d)return console.error("Oblique viewer: no geometry provided for search.");var e,a=new D,f=this;e=new b;
e.geometry=d;e.outFields=this._getQueryFields()||[this.imageServiceLayer.objectIdField,this.azimuthField];e.returnGeometry=!0;e.where=this.elevationField+"\x3c"+this.elevationThreshold;e.outSpatialReference=d.spatialReference;e.spatialRel="esriSpatialRelContains";this.obliqueRecordsQueryTask.execute(e).then(function(e){a.resolve({features:f.sorter(f._processRecords(e.features),d)})});return a.promise},_sortSpatially:function(d,e){if(d&&d.length&&this.map.loaded){var a=0,b=0,m=d[0],h,k,r,E,a=0,t;t=
this.nadirExtent||this.map.extent;e&&("extent"===e.type&&e.spatialReference.equals(d[0].geometry.spatialReference))&&(t=e);t=t.getCenter();this.selectedRaster&&this._extentContained(this.selectedRaster,this.nadirExtent)&&(f.some(d,function(e,a){if(e.attributes[this.imageServiceLayer.objectIdField]===this.selectedRasterId)return r=d[a],d[a]=m,d[0]=r,!0},this),a=1);for(;a<d.length;a++){h=Math.sqrt((d[a].center.x-t.x)*(d[a].center.x-t.x)+(d[a].center.y-t.y)*(d[a].center.y-t.y));E=a;for(b=a+1;b<d.length;b++)k=
Math.sqrt((d[b].center.x-t.x)*(d[b].center.x-t.x)+(d[b].center.y-t.y)*(d[b].center.y-t.y)),h>k&&(m=d[b],h=k,E=b);a!==E&&(r=d[a],d[a]=m,d[E]=r)}}return d},_filterByAzimuth:function(){this.filteredRecords=[];f.forEach(this.records,function(d){Math.min(Math.abs(d.attributes[this.azimuthField]-this.azimuthAngle),Math.abs(d.attributes[this.azimuthField]-this.azimuthAngle-360))<=this.azimuthTolerance&&this.filteredRecords.push(d)},this);this.filteredRecords&&this.filteredRecords.length&&(this.filteredRecords[0].attributes.selected=
!0)},_processRecords:function(d){var e;f.forEach(d,function(d){e=(new u(d.geometry)).setSpatialReference(this.nadirSpatialReference).getCentroid();d.center=e},this);return d},_computeAzimuthFilter:function(){var d=(this.azimuthAngle+350)%360,e=(this.azimuthAngle+10)%360;return d<e?this.azimuthField+" BETWEEN "+d+" AND "+e:"("+this.azimuthField+" BETWEEN 0 AND "+e+" OR "+this.azimuthField+" BETWEEN "+d+" AND 360)"},_getIds:function(d){var e=[],a=this;f.forEach(d,function(d){e.push(d.attributes[a.imageServiceLayer.objectIdField])});
return e},_adjustExtentAspectRatio:function(d){var e;if(!this._azimuthExtentChanged){var a=0.45*d.getHeight(),b=0.45*d.getWidth();e=d.getCenter();return d=new s(e.x-b,e.y-a,e.x+b,e.y+a,d.spatialReference)}var f;e=d.getCenter();b=d.getWidth();a=d.getHeight();f=a>b?0.8<b/a?0.5:0.36:0.7<a/b?0.5:0.65;a=Math.min(a,b)*f;return d=new s(e.x-a,e.y-a,e.x+a,e.y+a,d.spatialReference)},_setRasterListRefreshAttr:function(d){this._set("rasterListRefresh",d);d&&this._refreshListDijit(this.isNadir?this.records:this.filteredRecords)},
_extentContained:function(d,e){if(!d||!e)return!1;var a=(new u(d.geometry)).getExtent();return this._trimExtent(a,0.2).contains(e)},setData:function(d,e){if(!d)return console.error("Oblique viewer: records not provided.");e=e||this.map.extent;this._set("records",d);this._filterByAzimuth();if(this.filteredRecords&&this.filteredRecords.length)if(this._refreshListDijit(this.filteredRecords),this.imageServiceLayer.loaded)this._setSelectedRaster(e);else this.imageServiceLayer.on("load",g.hitch(this,function(){this._setSelectedRaster(e)}));
else this.selectedRasterId=this.selectedRaster=null,this.emit("raster-select",{selectedRasterId:null})},_setSelectedRaster:function(d){this.selectedRaster=this.filteredRecords[0];this.selectedRasterId=this.selectedRaster.attributes[this.imageServiceLayer.objectIdField];this.setImage(this.selectedRaster.attributes[this.imageServiceLayer.objectIdField],d);this.emit("raster-select",{selectedRasterId:this.selectedRasterId})},setExtent:function(d){var e=new D,a=this;this.projectGeometry(d,this.map.spatialReference).then(function(d){a._verifyExtent(d[0])&&
a.map.setExtent(d[0]).then(function(){e.resolve()})});return e.promise},zoomToSelectedImage:function(){if(!r.isDefined(this.selectedRasterId))return console.error("Oblique viewer: no selected raster.");if(this.isNadir)return console.log("Viewer in nadir mode, no selected raster.");var d=this,e;this._getImageGeometry(this.selectedRasterId,this.map.spatialReference).then(function(a){a.features&&a.features.length&&(e=(new u(a.features[0].geometry)).setSpatialReference(d.map.spatialReference),d.map.setExtent(e.getExtent()))})},
_getImageGeometry:function(d,e){var a=new b;a.objectIds=[d];a.returnGeometry=!0;a.outSpatialReference=e;return this.obliqueRecordsQueryTask.execute(a)},_getQueryFields:function(){var a=[];f.forEach(this.rasterInfoFields,function(e){e.name&&a.push(e.name)});0>f.indexOf(a,this.azimuthField)&&a.push(this.azimuthField);0>f.indexOf(a,this.imageServiceLayer.objectIdField)&&a.push(this.imageServiceLayer.objectIdField);return a},_trimExtent:function(a,e){var b,f,m;e=e||0.15;b=a.ymax-a.ymin;f=b*(1-e);b*=1-
e;m=a.getCenter();return new s({xmin:m.x-b/2,ymin:m.y-f/2,xmax:m.x+b/2,ymax:m.y+f/2,spatialReference:a.spatialReference})}})})},"esri/dijit/_ObliqueRotationWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ./_EventedWidget dijit/_Widget dijit/_TemplatedMixin dojo/text!./templates/_ObliqueRotationWidget.html dojo/_base/html dojo/on dojox/dgauges/CircularGauge ./ObliqueViewer/OVCircularScale dojox/dgauges/CircularRangeIndicator ./ObliqueViewer/OVCircularValueIndicator dojox/dgauges/LinearScaler dojo/dom-geometry dojo/dom-construct dojo/i18n!../nls/jsapi dojo/dom-style dojo/query dojo/dom-attr".split(" "),
function(c,g,n,l,a,b,k,h,w,f,q,m,z,t,s,u,r,v,x,y,B,D,d){return c([k,h,w],{baseClass:"esriObliqueRotationWidget",declaredClass:"esri.dijit._ObliqueRotationWidget",templateString:f,azimuthAngle:0,azimuthField:"SensorAzimuth",isNadir:!1,_rangeIndicatorWidth:8,constructor:function(e,a){g.mixin(this,e);this._i18n=y;this.isNadir=!b.isDefined(this.azimuthAngle)},postCreate:function(){this.inherited(arguments);this._coords=this.domNode.getBoundingClientRect();this._computeCircleRadius();this._getCenter();
this.refresh()},startup:function(){this.inherited(arguments);this._setupGauge();this._addTooltips()},_getFontWeight:function(e){return 120<=e?"bold":"normal"},_getFontSize:function(e){return 120<=e?10:7},labelGap:5,resize:function(e){e=e||Math.min(this.domNode.getBoundingClientRect().height,this.domNode.getBoundingClientRect().width);this._getFontSize(e);var a=this._getFontWeight(e);this._gauge.resize(e,e);this._gauge.set("font",{family:"Helvetica",style:"normal",size:"10pt",color:"black",weight:a});
this._scale.set("labelGap",this.labelGap);this._addTooltips()},_setupGauge:function(){var e=this,a=Math.min(this._coords.height,this._coords.width);this._gauge=new z({value:0,font:{family:"Helvetica",style:"normal",size:this._getFontSize(a)+"pt",color:"black",weight:this._getFontWeight(a)},style:"margin: -2px;"},this.gaugeNode);this._addGaugeBackground();this._addGaugeScale();this._addGaugeIndicators();this._gauge.startup();this.own(m(this._gauge.domNode,"mouseup",function(a){e._getCenter();var d=
a.pageX-e._centerLocnInPage[0];a=a.pageY-e._centerLocnInPage[1];10>=Math.abs(d)&&10>=Math.abs(a)?(e._scale.azimuthAngle=null,e._switchToNadir()):(e.azimuthAngle=e._convertAngleToAzimuthNotation(e._calculateAngleFromXY(d,a)),e._switchToOblique())}));this.own(this._gauge.on("endEditing",g.hitch(this,function(a){e.isNadir||(this.snap&&this._snap(),e.azimuthAngle=this._convertAngleToAzimuthNotation(a.indicator.value),e.emit("azimuth-change",{azimuth:e.azimuthAngle}))})));this.on("azimuth-change",function(){e.rotateGauge();
e._azimuthIndicator.azimuthAngle=e.azimuthAngle;e.textNodes=e.gaugeNode.querySelectorAll("text")})},rotateGauge:function(){this.gaugeNode&&(this.isNadir?(this.rotateAngle=0,this._scale.azimuthAngle=null,B.set(this.gaugeNode,"transform","none")):(this.rotateAngle=this.rotateAngle||0,this.rotateAngle=Math.abs(this.rotateAngle+this.azimuthAngle)>Math.abs(this.rotateAngle-(360-this.azimuthAngle))?360-this.azimuthAngle:0-this.azimuthAngle,B.set(this.gaugeNode,"transform","rotate("+this.rotateAngle+"deg)"),
this._scale.azimuthAngle=this.azimuthAngle))},_addGaugeBackground:function(){var e="M "+this._center.join(",")+"m "+(0-this._radius)+",0 a "+this._radius+","+this._radius+" 0 1,0 "+2*this._radius+",0 a "+this._radius+","+this._radius+" 0 1,0 "+(0-2*this._radius)+",0";this._gauge.addElement("background",function(a){a.createPath({path:e}).setFill("rgba(255,255,255,0.8)").setStroke("rgba(89, 106, 114, 1)")});this._addNadirDataIndicator()},_addNadirDataIndicator:function(){var a="M "+this._center.join(",")+
"m -7,0 a 7,7 0 1,0 14,0 a 7,7 0 1,0 -14,0";this._gauge.addElement("nadirDataIndicator",function(d){d.createPath({path:a}).setFill("#00BDFF").setStroke("rgba(0,0,0, 0)")})},_addGaugeScale:function(){Math.min(this._coords.width,this._coords.height);this._scale=new t({originX:this._center[0],originY:this._center[1],radius:this._radius,startAngle:0,endAngle:359.999,orientation:"clockwise",scaler:new r({minimum:0,maximum:360,majorTickInterval:90,minorTickInterval:45}),tickShapeFunc:function(a,d,b){if(!b.isMinor)return a.createLine({x1:0,
y1:0,x2:b.isMinor?15:8,y2:0}).setStroke({color:"black",width:1})},labelGap:this.labelGap,tickLabelFunc:function(a){var d=["E","S","W","N"];return!a.isMinor?0===a.value%90?d[a.value/90]:a.value:" "}});this._gauge.addElement("scale",this._scale)},_addGaugeIndicators:function(){var a=new s({value:359.9999,radius:this._radius,startThickness:8,endThickness:8,fill:"rgba(0,0,0,0.6)"});this._scale.addIndicator("indicatorBg",a);this.isNadir?(this._nadirIndicator=this._createNadirIndicator(),this._scale.addIndicator("nadir_indicator",
this._nadirIndicator)):(this._azimuthIndicator=this._createObliqueIndicator(),this._scale.addIndicator("azimuth_indicator",this._azimuthIndicator))},_convertAngleToAzimuthNotation:function(a){if(b.isDefined(a))return(a+90)%360},_convertAngleToGaugeNotation:function(a){if(b.isDefined(a))return(a+270)%360},_computeCircleRadius:function(){var a;a=Math.min(this._coords.width/2,this._coords.height/2);return this._radius=a=Math.floor(a-2)},showAvailableData:function(a){var d=this,b=this.azimuthAngle;this._snap();
this.azimuthAngle!==b&&this.emit("azimuth-change",{azimuth:this.azimuthAngle});if(a=a||this.features){n.forEach(this._availableDataIndicators,function(a){d._scale.removeIndicator(a)});this._availableDataIndicators=[];this.features=a;for(var b=0,f,b=0;b<a.length;b++)f=new s({start:this._convertAngleToGaugeNotation(a[b].attributes[this.azimuthField]-5),value:this._convertAngleToGaugeNotation(a[b].attributes[this.azimuthField]+5),radius:this._radius,startThickness:7,endThickness:7,fill:"#00BDFF",stroke:"#00BDFF"}),
this._scale.addIndicator("indicator_"+b,f),this._availableDataIndicators.push("indicator_"+b)}},refresh:function(a){g.mixin(this,a);this.showAvailableData()},_getCenter:function(){var a=[],d,b=[];this._coords=this.gaugeNode.getBoundingClientRect();a.push(Math.ceil(this._coords.width/2));a.push(Math.ceil(this._coords.height/2));d=v.position(this.gaugeNode);b.push(d.x+a[0]);b.push(d.y+a[1]);this._centerLocnInPage=b;return this._center=a},_snap:function(){if(this._azimuthIndicator&&this.features&&this.features.length){var a=
this._convertAngleToAzimuthNotation(this._azimuthIndicator.value),d,b,f=1E3;n.forEach(this.features,function(m){b=Math.min(Math.abs(m.attributes[this.azimuthField]-a),Math.abs(m.attributes[this.azimuthField]-a-360));b<=f&&(d=m.attributes[this.azimuthField],f=b)},this);this.azimuthAngle=d;this._azimuthIndicator.set("value",this._convertAngleToGaugeNotation(this.azimuthAngle))}},_switchToNadir:function(){this.isNadir||(this._scale.azimuthAngle=null,this._nadirIndicator=this._createNadirIndicator(),
this._scale.removeIndicator("azimuth_indicator"),this._scale.addIndicator("nadir_indicator",this._nadirIndicator),this.isNadir=!0,this.emit("azimuth-change",{azimuth:null}))},_switchToOblique:function(){this.isNadir&&(this._azimuthIndicator=this._createObliqueIndicator(),this._scale.removeIndicator("nadir_indicator"),this._scale.addIndicator("azimuth_indicator",this._azimuthIndicator),this._snap(),this.isNadir=!1,this.emit("azimuth-change",{azimuth:this.azimuthAngle}))},_createNadirIndicator:function(){return new u({interactionArea:"gauge",
title:"Nadir",interactionMode:"none",indicatorShapeFunc:function(a){return a.createPolyline([-7,0,7,0,0,0,0,7,0,-7]).setStroke({color:"#000000",width:1})},value:0})},_createObliqueIndicator:function(){var a=this;return new u({interactionArea:"gauge",title:"Change Azimuth",indicatorShapeFunc:function(d){return d.createPolyline([0,-1,a._radius-1,-10,a._radius-1,10,0,1,0,-1]).setFill("rgba(0, 189, 255, 0.5)").setStroke("rgba(0, 189, 255, 0.5)")},value:this._convertAngleToGaugeNotation(this.azimuthAngle),
azimuthAngle:this._convertAngleToGaugeNotation(this.azimuthAngle)})},_calculateAngleFromXY:function(a,d){var b;b=Math.atan2(d,a);return 180*(b/Math.PI)+(0<b?0:360)},_addTooltips:function(){var a=this,d,f=this.domNode.getBoundingClientRect(),f=Math.min(f.width/2,f.height/2);n.forEach(this._tooltipNodes,function(a){this.gaugeNode.removeChild(a.node)},this);this._tooltipNodes=[{top:0,left:f-5,direction:"north",angle:0},{top:f-5,left:2*(f-5),direction:"east",angle:90},{top:2*(f-5),left:f,direction:"south",
angle:180},{top:f-5,left:0,direction:"west",angle:270},{top:f-5,left:f-5,direction:"nadir",angle:null}];n.forEach(this._tooltipNodes,function(f){d=x.create("div");d.style.top=f.top+"px";d.style.left=f.left+"px";d.style.position="absolute";d.style.height="10px";d.style.width="10px";d.style.cursor="pointer";d.style.zIndex=999;d.id=this.domNode.id+"_tooltip_"+f.direction;x.place(d,this.gaugeNode);d.title=this._i18n.widgets.obliqueViewer[f.direction+"Tooltip"];d.onclick=function(){b.isDefined(f.angle)&&
(a.azimuthAngle=f.angle,a._azimuthIndicator.set("value",a._convertAngleToGaugeNotation(f.angle)),a.snap&&a._snap(),a.emit("azimuth-change",{azimuth:a.azimuthAngle}))};f.node=d},this)},setAzimuth:function(a){b.isDefined(a)&&(this.azimuthAngle=a,this.isNadir?this._switchToOblique():this._azimuthIndicator.set("value",this._convertAngleToGaugeNotation(this.azimuthAngle)))}})})},"dojox/dgauges/CircularGauge":function(){define(["dojo/_base/declare","dojo/dom-geometry","dojox/gfx","./GaugeBase"],function(c,
g,n,l){return c("dojox.dgauges.CircularGauge",l,{_transformProperties:null,refreshRendering:function(){if(!(0>=this._widgetBox.w||0>=this._widgetBox.h)){for(var a in this._elementsIndex)this._elementsRenderers[a]=this._elementsIndex[a].refreshRendering();var b=this._computeBoundingBox(this._gfxGroup),k=(b.x+b.width)/(b.y+b.height),h=this._widgetBox.w,w=this._widgetBox.h,f=a=0,q=0,m=0;k>this._widgetBox.w/this._widgetBox.h?(m=h,q=m/k,f=(w-q)/2):(q=w,m=q*k,a=(h-m)/2);b=Math.max(m/(b.x+b.width),q/(b.y+
b.height));this._transformProperties={scale:b,tx:a,ty:f};this._gfxGroup.setTransform([n.matrix.scale(b),n.matrix.translate(a/b,f/b)])}},_gaugeToPage:function(a,b){if(this._transformProperties){var k=g.position(this.domNode,!0);return{x:k.x+a*this._transformProperties.scale+this._transformProperties.tx,y:k.y+b*this._transformProperties.scale+this._transformProperties.ty}}return null}})})},"dojox/dgauges/GaugeBase":function(){define("dojo/_base/lang dojo/_base/declare dojo/dom-geometry dijit/registry dijit/_WidgetBase dojo/_base/html dojo/_base/event dojox/gfx dojox/widget/_Invalidating ./ScaleBase dojox/gfx/matrix".split(" "),
function(c,g,n,l,a,b,k,h,w,f,q){return g("dojox.dgauges.GaugeBase",[a,w],{_elements:null,_scales:null,_elementsIndex:null,_elementsRenderers:null,_gfxGroup:null,_mouseShield:null,_widgetBox:null,_node:null,value:0,_mainIndicator:null,_getValueAttr:function(){if(this._mainIndicator)return this._mainIndicator.get("value");this._setMainIndicator();return this._mainIndicator?this._mainIndicator.get("value"):this.value},_setValueAttr:function(a){this._set("value",a);this._mainIndicator?this._mainIndicator.set("value",
a):(this._setMainIndicator(),this._mainIndicator&&this._mainIndicator.set("value",a))},_setMainIndicator:function(){for(var a,b=0;b<this._scales.length;b++)if(a=this._scales[b].getIndicator("indicator"))this._mainIndicator=a},_resetMainIndicator:function(){this._mainIndicator=null},font:null,constructor:function(a,f){this.font={family:"Helvetica",style:"normal",variant:"small-caps",weight:"bold",size:"10pt",color:"black"};this._elements=[];this._scales=[];this._elementsIndex={};this._elementsRenderers=
{};this._node=l.byId(f);var k=b.getMarginBox(f);this.surface=h.createSurface(this._node,k.w||1,k.h||1);this._widgetBox=k;this._baseGroup=this.surface.createGroup();this._mouseShield=this._baseGroup.createGroup();this._gfxGroup=this._baseGroup.createGroup()},_setCursor:function(a){this._node&&(this._node.style.cursor=a)},_computeBoundingBox:function(a){return a?a.getBoundingBox():{x:0,y:0,width:0,height:0}},destroy:function(){this.surface.destroy();this.inherited(arguments)},resize:function(a,b){switch(arguments.length){case 1:n.setMarginBox(this._node,
a);break;case 2:n.setMarginBox(this._node,{w:a,h:b})}var f=n.getMarginBox(this._node);this._widgetBox=f;var k=this.surface.getDimensions();return k.width!=f.w||k.height!=f.h?(this.surface.setDimensions(f.w,f.h),this._mouseShield.clear(),this._mouseShield.createRect({x:0,y:0,width:f.w,height:f.h}).setFill([0,0,0,0]),this.invalidateRendering()):this},addElement:function(a,b){this._elementsIndex[a]&&this._elementsIndex[a]!=b&&this.removeElement(a);if(c.isFunction(b)){var k={};c.mixin(k,new w);k._name=
a;k._gfxGroup=this._gfxGroup.createGroup();k.width=0;k.height=0;k._isGFX=!0;k.refreshRendering=function(){k._gfxGroup.clear();return b(k._gfxGroup,k.width,k.height)};this._elements.push(k);this._elementsIndex[a]=k}else b._name=a,b._gfxGroup=this._gfxGroup.createGroup(),b._gauge=this,this._elements.push(b),this._elementsIndex[a]=b,b instanceof f&&this._scales.push(b);return this.invalidateRendering()},removeElement:function(a){var b=this._elementsIndex[a];if(b){b._gfxGroup.removeShape();var k=this._elements.indexOf(b);
this._elements.splice(k,1);b instanceof f&&(k=this._scales.indexOf(b),this._scales.splice(k,1),this._resetMainIndicator());delete this._elementsIndex[a];delete this._elementsRenderers[a]}this.invalidateRendering();return b},getElement:function(a){return this._elementsIndex[a]},getElementRenderer:function(a){return this._elementsRenderers[a]},onStartEditing:function(a){},onEndEditing:function(a){}})})},"dojox/widget/_Invalidating":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful"],
function(c,g,n){return c("dojox.widget._Invalidating",n,{invalidatingProperties:null,invalidRendering:!1,postscript:function(c){this.inherited(arguments);if(this.invalidatingProperties)for(var a=this.invalidatingProperties,b=0;b<a.length;b++)this.watch(a[b],g.hitch(this,this.invalidateRendering)),c&&a[b]in c&&this.invalidateRendering()},addInvalidatingProperties:function(c){this.invalidatingProperties=this.invalidatingProperties?this.invalidatingProperties.concat(c):c},invalidateRendering:function(){this.invalidRendering||
(this.invalidRendering=!0,setTimeout(g.hitch(this,this.validateRendering),0))},validateRendering:function(){this.invalidRendering&&(this.refreshRendering(),this.invalidRendering=!1)},refreshRendering:function(){}})})},"dojox/dgauges/ScaleBase":function(){define("dojo/_base/lang dojo/_base/declare dojox/gfx dojo/_base/array dojox/widget/_Invalidating dojo/_base/sniff".split(" "),function(c,g,n,l,a,b){return g("dojox.dgauges.ScaleBase",a,{scaler:null,font:null,labelPosition:null,labelGap:1,tickStroke:null,
_gauge:null,_gfxGroup:null,_bgGroup:null,_fgGroup:null,_indicators:null,_indicatorsIndex:null,_indicatorsRenderers:null,constructor:function(){this._indicators=[];this._indicatorsIndex={};this._indicatorsRenderers={};this._gfxGroup=this._gauge=null;this.tickStroke={color:"black",width:8>=b("ie")?1:0.5};this.addInvalidatingProperties("scaler font labelGap labelPosition tickShapeFunc tickLabelFunc tickStroke".split(" "));this.watch("scaler",c.hitch(this,this._watchScaler))},postscript:function(a){this.inherited(arguments);
a&&a.scaler&&this._watchScaler("scaler",null,a.scaler)},_watchers:null,_watchScaler:function(a,b,w){l.forEach(this._watchers,c.hitch(this,function(a){a.unwatch()}));a=w.watchedProperties;this._watchers=[];l.forEach(a,c.hitch(this,function(a){this._watchers.push(w.watch(a,c.hitch(this,this.invalidateRendering)))}))},_getFont:function(){var a=this.font;a||(a=this._gauge.font);a||(a=n.defaultFont);return a},positionForValue:function(a){return 0},valueForPosition:function(a){},tickLabelFunc:function(a){return a.isMinor?
null:String(a.value)},tickShapeFunc:function(a,b,c){return a.createLine({x1:0,y1:0,x2:c.isMinor?6:10,y2:0}).setStroke(this.tickStroke)},getIndicatorRenderer:function(a){return this._indicatorsRenderers[a]},removeIndicator:function(a){var b=this._indicatorsIndex[a];if(b){b._gfxGroup.removeShape();var c=this._indicators.indexOf(b);this._indicators.splice(c,1);b._disconnectListeners();delete this._indicatorsIndex[a];delete this._indicatorsRenderers[a]}this._gauge&&this._gauge._resetMainIndicator();this.invalidateRendering();
return b},getIndicator:function(a){return this._indicatorsIndex[a]},addIndicator:function(a,b,c){this._indicatorsIndex[a]&&this._indicatorsIndex[a]!=b&&this.removeIndicator(a);this._indicators.push(b);this._indicatorsIndex[a]=b;this._ticksGroup||this._createSubGroups();b._gfxGroup=(c?this._bgGroup:this._fgGroup).createGroup();b.scale=this;return this.invalidateRendering()},_createSubGroups:function(){this._gfxGroup&&!this._ticksGroup&&(this._bgGroup=this._gfxGroup.createGroup(),this._ticksGroup=this._gfxGroup.createGroup(),
this._fgGroup=this._gfxGroup.createGroup())},refreshRendering:function(){this._ticksGroup||this._createSubGroups()}})})},"esri/dijit/ObliqueViewer/OVCircularScale":function(){define(["dojo/_base/declare","dojox/dgauges/CircularScale","dojox/gfx"],function(c,g,n){var l=Math.PI/180;return c([g],{_layoutLabel:function(a,b,k,h,c,f,q){var m=this._getFont();b=n._base._getTextBox(b,{font:n.makeFontString(n.makeParameters(n.defaultFont,m))}).w;m=n.normalizedLength(m.size);this.azimuthAngle=this.azimuthAngle||
0;var g=this.azimuthAngle*l,t=k+Math.cos(f)*c-b/2,s=h-Math.sin(f)*c-m/2,u,r=[],v=u=t;u=-Math.tan(f)*u+h+Math.tan(f)*k;u>=s&&u<=s+m&&r.push({x:v,y:u});v=u=t+b;u=-Math.tan(f)*u+h+Math.tan(f)*k;u>=s&&u<=s+m&&r.push({x:v,y:u});u=s;v=-1/Math.tan(f)*u+k+1/Math.tan(f)*h;v>=t&&v<=t+b&&r.push({x:v,y:u});u=s+m;v=-1/Math.tan(f)*u+k+1/Math.tan(f)*h;v>=t&&v<=t+b&&r.push({x:v,y:u});if("inside"==q)for(q=0;q<r.length;q++){if(v=r[q],v=this._distance(v.x,v.y,k,h)-c,0<=v){t=k+Math.cos(f)*(c-v)-b/2;s=h-Math.sin(f)*(c-
v)-m/2;break}}else for(q=0;q<r.length;q++)if(v=r[q],v=this._distance(v.x,v.y,k,h)-c,0>=v){t=k+Math.cos(f)*(c-v)-b/2;s=h-Math.sin(f)*(c-v)-m/2;break}315<this.azimuthAngle&&360>=this.azimuthAngle||0<=this.azimuthAngle&&45>=this.azimuthAngle?b/=2:45<this.azimuthAngle&&135>=this.azimuthAngle?(b=0,m/=2):135<this.azimuthAngle&&225>=this.azimuthAngle?(b/=2,m=0):m/=2;a&&a.setTransform([{dx:t+b,dy:s+m,xx:Math.cos(g),xy:-Math.sin(g),yx:Math.sin(g),yy:Math.cos(g)}])}})})},"dojox/dgauges/CircularScale":function(){define(["dojo/_base/declare",
"dojox/gfx","./ScaleBase","./_circularUtils"],function(c,g,n,l){return c("dojox.dgauges.CircularScale",n,{originX:50,originY:50,radius:50,startAngle:0,endAngle:180,orientation:"clockwise",constructor:function(){this.labelPosition="inside";this.addInvalidatingProperties("originX originY radius startAngle endAngle orientation".split(" "))},_getOrientationNum:function(){return"cclockwise"==this.orientation?-1:1},positionForValue:function(a){var b=l.computeTotalAngle(this.startAngle,this.endAngle,this.orientation);
a=this.scaler.positionForValue(a);return l.modAngle(this.startAngle+this._getOrientationNum()*b*a,360)},_positionForTickItem:function(a){var b=l.computeTotalAngle(this.startAngle,this.endAngle,this.orientation);return l.modAngle(this.startAngle+this._getOrientationNum()*b*a.position,360)},valueForPosition:function(a){if(this.positionInRange(a))var b=l.modAngle(this._getOrientationNum()*(a-this.startAngle),360),k=l.computeTotalAngle(this.startAngle,this.endAngle,this.orientation),b=b/k;else{b=l.modAngle(this.startAngle-
a,360);k=360-b;a=l.modAngle(this.endAngle-a,360);var h=360-a,b=Math.min(b,k)<Math.min(a,h)?0:1}return this.scaler.valueForPosition(b)},positionInRange:function(a){if(this.startAngle==this.endAngle)return!0;a=l.modAngle(a,360);return 1==this._getOrientationNum()?this.startAngle<this.endAngle?a>=this.startAngle&&a<=this.endAngle:!(a>this.endAngle&&a<this.startAngle):this.startAngle<this.endAngle?!(a>this.startAngle&&a<this.endAngle):a>=this.endAngle&&a<=this.startAngle},_distance:function(a,b,k,h){return Math.sqrt((k-
a)*(k-a)+(h-b)*(h-b))},_layoutLabel:function(a,b,k,h,c,f,q){var m=this._getFont();b=g._base._getTextBox(b,{font:g.makeFontString(g.makeParameters(g.defaultFont,m))}).w;var m=g.normalizedLength(m.size),l=k+Math.cos(f)*c-b/2,t=h-Math.sin(f)*c-m/2,s,u=[],r=s=l;s=-Math.tan(f)*s+h+Math.tan(f)*k;s>=t&&s<=t+m&&u.push({x:r,y:s});r=s=l+b;s=-Math.tan(f)*s+h+Math.tan(f)*k;s>=t&&s<=t+m&&u.push({x:r,y:s});s=t;r=-1/Math.tan(f)*s+k+1/Math.tan(f)*h;r>=l&&r<=l+b&&u.push({x:r,y:s});s=t+m;r=-1/Math.tan(f)*s+k+1/Math.tan(f)*
h;r>=l&&r<=l+b&&u.push({x:r,y:s});if("inside"==q)for(q=0;q<u.length;q++){if(r=u[q],r=this._distance(r.x,r.y,k,h)-c,0<=r){l=k+Math.cos(f)*(c-r)-b/2;t=h-Math.sin(f)*(c-r)-m/2;break}}else for(q=0;q<u.length;q++)if(r=u[q],r=this._distance(r.x,r.y,k,h)-c,0>=r){l=k+Math.cos(f)*(c-r)-b/2;t=h-Math.sin(f)*(c-r)-m/2;break}a&&a.setTransform([{dx:l+b/2,dy:t+m}])},refreshRendering:function(){this.inherited(arguments);if(this._gfxGroup&&this.scaler){this.startAngle=l.modAngle(this.startAngle,360);this.endAngle=
l.modAngle(this.endAngle,360);this._ticksGroup.clear();for(var a,b,k=this.scaler.computeTicks(),h,c=0;c<k.length;c++){b=k[c];a=this.tickShapeFunc(this._ticksGroup,this,b);h=this._gauge._computeBoundingBox(a);var f;f=b.position?this._positionForTickItem(b):this.positionForValue(b.value);a&&a.setTransform([{dx:this.originX,dy:this.originY},g.matrix.rotateg(f),{dx:this.radius-h.width-2*h.x,dy:0}]);if(b=this.tickLabelFunc(b)){a=this._ticksGroup.createText({x:0,y:0,text:b,align:"middle"}).setFont(this._getFont()).setFill(this._getFont().color?
this._getFont().color:"black");var q=this.radius,q="inside"==this.labelPosition?q-(h.width+this.labelGap):q+this.labelGap;this._layoutLabel(a,b,this.originX,this.originY,q,l.toRadians(360-f),this.labelPosition)}}for(var m in this._indicatorsIndex)this._indicatorsRenderers[m]=this._indicatorsIndex[m].invalidateRendering()}}})})},"dojox/dgauges/_circularUtils":function(){define(function(){return{computeTotalAngle:function(c,g,n){return c==g?360:this.computeAngle(c,g,n,360)},modAngle:function(c,g){void 0==
g&&(g=6.28318530718);if(c>=g){do c-=g;while(c>=g)}else for(;0>c;)c+=g;return c},computeAngle:function(c,g,n,l){void 0==l&&(l=6.28318530718);return g==c?l:this.modAngle("clockwise"==n?g<c?l-(c-g):g-c:g<c?c-g:l-(g-c),l)},toRadians:function(c){return c*Math.PI/180},toDegrees:function(c){return 180*c/Math.PI}}})},"dojox/dgauges/CircularRangeIndicator":function(){define(["dojo/_base/declare","./ScaleIndicatorBase","./_circularUtils","dojo/_base/event"],function(c,g,n,l){return c("dojox.dgauges.CircularRangeIndicator",
g,{start:0,radius:NaN,startThickness:6,endThickness:6,fill:null,stroke:null,constructor:function(){this.indicatorShapeFunc=null;this.fill=[255,120,0];this.stroke={color:"black",width:0.2};this.interactionMode="none";this.addInvalidatingProperties("start radius startThickness endThickness fill stroke".split(" "))},_interpolateColor:function(a,b,k){return((1-k)*(a>>16&255)+k*(b>>16&255)&255)<<16|((1-k)*(a>>8&255)+k*(b>>8&255)&255)<<8|(1-k)*(a&255)+k*(b&255)&255},_colorsInterpolation:function(a,b,k){for(var h=
[],c=0,f=0;f<a.length-1;f++)c=(b[f+1]-b[f])*k,c=Math.round(c),h=h.concat(_colorInterpolation(a[f],a[f+1],c));return h},_alphasInterpolation:function(a,b,k){for(var c=[],g=0,f=0;f<a.length-1;f++)g=(b[f+1]-b[f])*k,g=Math.round(g),c=c.concat(_alphaInterpolation(a[f],a[f+1],g));return c},_alphaInterpolation:function(a,b,c){b=(b-a)/(c-1);for(var h=[],g=0;g<c;g++)h.push(a+g*b);return h},_colorInterpolation:function(a,b,c){for(var h=[],g=0;g<c;g++)h.push(_interpolateColor(a,b,g/(c-1)));return h},_getEntriesFor:function(a,
b){for(var c=[],h,g=0;g<a.length;g++)h=a[g],h=null==h[b]||isNaN(h[b])?g/(a.length-1):h[b],c.push(h);return c},_drawColorTrack:function(a,b,c,h,g,f,q,m,l,t,s,u){var r=0.05;q=6.28318530718-n.computeAngle(f,q,g);isNaN(u)||(u=n.computeAngle(f,u,g),l*=u/q,q=u);u=Math.max(2,Math.floor(q/r));var r=q/u,v=0;q=-m;var v=(m-l)/u,x;"clockwise"==g&&(r=-r);var y=[];g=b+Math.cos(f)*(h+q);m=c-Math.sin(f)*(h+q);y.push(g,m);for(l=0;l<u;l++)x=f+l*r,g=b+Math.cos(x+r)*(h+q+l*v),m=c-Math.sin(x+r)*(h+q+l*v),y.push(g,m);
isNaN(x)&&(x=f);g=b+Math.cos(x+r)*(h+0+0*(u-1));m=c-Math.sin(x+r)*(h+0+0*(u-1));y.push(g,m);for(l=u-1;0<=l;l--)x=f+l*r,g=b+Math.cos(x+r)*(h+0+0*l),m=c-Math.sin(x+r)*(h+0+0*l),y.push(g,m);g=b+Math.cos(f)*(h+0);m=c-Math.sin(f)*(h+0);y.push(g,m);g=b+Math.cos(f)*(h+q);m=c-Math.sin(f)*(h+q);y.push(g,m);a.createPolyline(y).setFill(t).setStroke(s)},refreshRendering:function(){this.inherited(arguments);var a=this._gfxGroup;a.clear();var b=this.scale.originX,c=this.scale.originY,h=isNaN(this.radius)?this.scale.radius:
this.radius,g=this.scale.orientation,f=n.toRadians(360-this.scale.positionForValue(this.start)),l=isNaN(this._transitionValue)?this.value:this._transitionValue,l=n.toRadians(360-this.scale.positionForValue(l));this._drawColorTrack(a,b,c,h,g,f,l,this.startThickness,this.endThickness,this.fill,this.stroke,NaN)},_onMouseDown:function(a){this.inherited(arguments);var b=this.scale._gauge._gaugeToPage(this.scale.originX,this.scale.originY),b=180*Math.atan2(a.pageY-b.y,a.pageX-b.x)/Math.PI;this.set("value",
this.scale.valueForPosition(b));l.stop(a)},_onMouseMove:function(a){this.inherited(arguments);var b=this.scale._gauge._gaugeToPage(this.scale.originX,this.scale.originY),b=180*Math.atan2(a.pageY-b.y,a.pageX-b.x)/Math.PI;this.set("value",this.scale.valueForPosition(b))}})})},"dojox/dgauges/ScaleIndicatorBase":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/window dojo/on dojo/touch dojo/_base/fx dojox/gfx dojox/widget/_Invalidating ./IndicatorBase".split(" "),function(c,g,n,l,a,b,
k,h,w){return g("dojox.dgauges.ScaleIndicatorBase",w,{scale:null,value:0,interactionArea:"gauge",interactionMode:"mouse",animationDuration:0,animationEaser:null,_indicatorShapeFuncFlag:!0,_interactionAreaFlag:!0,_downListeners:null,_cursorListeners:null,_moveAndUpListeners:null,_transitionValue:NaN,_preventAnimation:!1,_animation:null,constructor:function(){this.watch("value",c.hitch(this,function(){this.valueChanged(this)}));this.watch("value",c.hitch(this,this._startAnimation));this.watch("interactionArea",
c.hitch(this,function(){this._interactionAreaFlag=!0}));this.watch("interactionMode",c.hitch(this,function(){this._interactionAreaFlag=!0}));this.watch("indicatorShapeFunc",c.hitch(this,function(){this._indicatorShapeFuncFlag=!0}));this.addInvalidatingProperties(["scale","value","indicatorShapeFunc","interactionArea","interactionMode"]);this._downListeners=[];this._moveAndUpListeners=[];this._cursorListeners=[]},_startAnimation:function(a,g,h){0!==this.animationDuration&&(this._animation&&(this._preventAnimation||
g==h)?this._animation.stop():(this._animation=new b.Animation({curve:[g,h],duration:this.animationDuration,easing:this.animationEaser?this.animationEaser:b._defaultEasing,onAnimate:c.hitch(this,this._updateAnimation),onEnd:c.hitch(this,this._endAnimation),onStop:c.hitch(this,this._endAnimation)}),this._animation.play()))},_updateAnimation:function(a){this._transitionValue=a;this.invalidateRendering()},_endAnimation:function(){this._transitionValue=NaN;this.invalidateRendering()},refreshRendering:function(){null===
this._gfxGroup||null===this.scale||(this._indicatorShapeFuncFlag&&c.isFunction(this.indicatorShapeFunc)&&(this._gfxGroup.clear(),this.indicatorShapeFunc(this._gfxGroup,this),this._indicatorShapeFuncFlag=!1),this._interactionAreaFlag&&(this._interactionAreaFlag=this._connectDownListeners()))},valueChanged:function(a){l.emit(this,"valueChanged",{target:this,bubbles:!0,cancelable:!0})},_disconnectDownListeners:function(){for(var a=0;a<this._downListeners.length;a++)this._downListeners[a].remove();this._downListeners=
[]},_disconnectMoveAndUpListeners:function(){for(var a=0;a<this._moveAndUpListeners.length;a++)this._moveAndUpListeners[a].remove();this._moveAndUpListeners=[]},_disconnectListeners:function(){this._disconnectDownListeners();this._disconnectMoveAndUpListeners();this._disconnectCursorListeners()},_connectCursorListeners:function(b){var g=b.on(a.over,c.hitch(this,function(){this.scale._gauge._setCursor("pointer")}));this._cursorListeners.push(g);g=b.on(a.out,c.hitch(this,function(a){this.scale._gauge._setCursor("")}));
this._cursorListeners.push(g)},_disconnectCursorListeners:function(){for(var a=0;a<this._cursorListeners.length;a++)this._cursorListeners[a].remove();this._cursorListeners=[]},_connectDownListeners:function(){this._disconnectDownListeners();this._disconnectCursorListeners();var b=null;if("mouse"==this.interactionMode||"touch"==this.interactionMode)if("indicator"==this.interactionArea)b=this._gfxGroup.on(a.press,c.hitch(this,this._onMouseDown)),this._downListeners.push(b),this._connectCursorListeners(this._gfxGroup);
else if("gauge"==this.interactionArea){if(!this.scale||!this.scale._gauge||!this.scale._gauge._gfxGroup)return!0;b=this.scale._gauge._gfxGroup.on(a.press,c.hitch(this,this._onMouseDown));this._downListeners.push(b);b=this._gfxGroup.on(a.press,c.hitch(this,this._onMouseDown));this._downListeners.push(b);this._connectCursorListeners(this.scale._gauge._gfxGroup)}else if("area"==this.interactionArea){if(!this.scale||!this.scale._gauge||!this.scale._gauge._baseGroup)return!0;b=this.scale._gauge._baseGroup.on(a.press,
c.hitch(this,this._onMouseDown));this._downListeners.push(b);b=this._gfxGroup.on(a.press,c.hitch(this,this._onMouseDown));this._downListeners.push(b);this._connectCursorListeners(this.scale._gauge._baseGroup)}return!1},_connectMoveAndUpListeners:function(){var b=null,b=l(n.doc,a.move,c.hitch(this,this._onMouseMove));this._moveAndUpListeners.push(b);b=l(n.doc,a.release,c.hitch(this,this._onMouseUp));this._moveAndUpListeners.push(b)},_onMouseDown:function(a){this._connectMoveAndUpListeners();this._startEditing()},
_onMouseMove:function(a){this._preventAnimation=!0;this._animation&&this._animation.stop()},_onMouseUp:function(a){this._disconnectMoveAndUpListeners();this._preventAnimation=!1;this._endEditing()},_startEditing:function(){if(this.scale&&this.scale._gauge)this.scale._gauge.onStartEditing({indicator:this})},_endEditing:function(){if(this.scale&&this.scale._gauge)this.scale._gauge.onEndEditing({indicator:this})}})})},"dojox/dgauges/IndicatorBase":function(){define(["dojo/_base/declare","dojox/widget/_Invalidating"],
function(c,g){return c("dojox.dgauges.IndicatorBase",g,{value:null})})},"esri/dijit/ObliqueViewer/OVCircularValueIndicator":function(){define(["dojo/_base/declare","dojox/gfx","dojox/dgauges/ScaleIndicatorBase","dojo/_base/event"],function(c,g,n,l){return c("esri.dijit.ObliqueViewer.OVCircularValueIndicator",n,{indicatorShapeFunc:function(a,b){return a.createLine({x1:0,y1:0,x2:40,y2:0}).setStroke({color:"black",width:1})},refreshRendering:function(){this.inherited(arguments);var a=isNaN(this._transitionValue)?
this.value:this._transitionValue,a=this.scale.positionForValue(a);this._gfxGroup.setTransform([{dx:this.scale.originX,dy:this.scale.originY},g.matrix.rotateg(a)])},_onMouseDown:function(a){this.inherited(arguments);var b=this.scale._gauge._gaugeToPage(this.scale.originX,this.scale.originY),b=180*Math.atan2(a.pageY-b.y,a.pageX-b.x)/Math.PI+this.azimuthAngle;this.set("value",this.scale.valueForPosition(b));l.stop(a)},_onMouseMove:function(a){this.inherited(arguments);var b=this.scale._gauge._gaugeToPage(this.scale.originX,
this.scale.originY),b=180*Math.atan2(a.pageY-b.y,a.pageX-b.x)/Math.PI+this.azimuthAngle;this.set("value",this.scale.valueForPosition(b))}})})},"dojox/dgauges/LinearScaler":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Stateful"],function(c,g,n){return g("dojox.dgauges.LinearScaler",n,{minimum:0,maximum:100,snapInterval:1,majorTickInterval:NaN,minorTickInterval:NaN,minorTicksEnabled:!0,majorTicks:null,minorTicks:null,_computedMajorTickInterval:NaN,_computedMinorTickInterval:NaN,constructor:function(){this.watchedProperties=
"minimum maximum majorTickInterval minorTickInterval snapInterval minorTicksEnabled".split(" ")},_buildMinorTickItems:function(){var c=this.majorTicks,a=[];if(this.maximum>this.minimum)for(var b=Math.floor((this.maximum-this.minimum)/this.getComputedMajorTickInterval())+1,g=Math.floor(this.getComputedMajorTickInterval()/this.getComputedMinorTickInterval()),h,n=0;n<b-1;n++)for(var f=1;f<g;f++)h={scaler:this,isMinor:!0},h.value=c[n].value+f*this.getComputedMinorTickInterval(),h.position=(Number(h.value)-
this.minimum)/(this.maximum-this.minimum),a.push(h);return a},_buildMajorTickItems:function(){var c=[];if(this.maximum>this.minimum)for(var a=Math.floor((this.maximum-this.minimum)/this.getComputedMajorTickInterval())+1,b,g=0;g<a;g++)b={scaler:this,isMinor:!1},b.value=this.minimum+g*this.getComputedMajorTickInterval(),b.position=(Number(b.value)-this.minimum)/(this.maximum-this.minimum),c.push(b);return c},getComputedMajorTickInterval:function(){if(!isNaN(this.majorTickInterval))return this.majorTickInterval;
isNaN(this._computedMajorTickInterval)&&(this._computedMajorTickInterval=(this.maximum-this.minimum)/10);return this._computedMajorTickInterval},getComputedMinorTickInterval:function(){if(!isNaN(this.minorTickInterval))return this.minorTickInterval;isNaN(this._computedMinorTickInterval)&&(this._computedMinorTickInterval=this.getComputedMajorTickInterval()/5);return this._computedMinorTickInterval},computeTicks:function(){this.majorTicks=this._buildMajorTickItems();this.minorTicks=this.minorTicksEnabled?
this._buildMinorTickItems():[];return this.majorTicks.concat(this.minorTicks)},positionForValue:function(c){var a;if(null==c||isNaN(c)||c<=this.minimum)a=0;c>=this.maximum&&(a=1);isNaN(a)&&(a=(c-this.minimum)/(this.maximum-this.minimum));return a},valueForPosition:function(c){var a=Math.abs(this.minimum-this.maximum);c=this.minimum+a*c;!isNaN(this.snapInterval)&&0<this.snapInterval&&(c=Math.round((c-this.minimum)/this.snapInterval)*this.snapInterval+this.minimum);return c}})})},"esri/tasks/ImageServiceProjectTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/_base/Deferred dojo/_base/array ../kernel ../request ../deferredUtils ./Task ../urlUtils ../geometry/jsonUtils".split(" "),
function(c,g,n,l,a,b,k,h,w,f,q){return c(w,{constructor:function(){this._handler=g.hitch(this,this._handler)},execute:function(a,b,c){var s=this._getImageServiceUrl(a),u=new l(h._dfdCanceller);if(s){var s=f.urlToObject(s),r=this._encode(g.mixin({},s.query,{f:"json"},a.toJson())),v=this._handler,n=this._errorHandler,w=q.getJsonType(a.geometries[0]),B=a.outSR;u._pendingDfd=k({url:s.path+"/project",content:r,callbackParamName:"callback",load:function(a){v(a,w,B,b,c,u)},error:function(a){n(a,c,u)}})}else u.reject("Input arguments do not contain image service URL.");
return u},_handler:function(a,b,c,f,g,h){try{var k=this._decodeGeometries(a,b,c);this._successHandler([k],"onComplete",f,h)}catch(l){this._errorHandler(l,g,h)}},_encodeGeometries:function(a){var b=[],c,f=a.length;for(c=0;c<f;c++)b.push(a[c].toJson());return{geometryType:q.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(b,c,f){var h=q.getGeometryType(c),k=[],r={spatialReference:f},l=g.mixin;a.forEach(b.geometries,function(a,b){k[b]=new h(l(a,r))});return k},onComplete:function(){},_getImageServiceUrl:function(a){var b;
if(a&&a.geometries&&a.geometries.length&&a.outSR)if(!a.geometries[0].spatialReference&&!a.geometries[0].spatialReference.url&&!a.outSR.url)this.onError(Error("Spatial reference doesn't contain Image Service URL"));else if(a.geometries[0].spatialReference.url&&a.outSR.url&&a.geometries[0].spatialReference.url!==a.outSR.url)this.onError(Error("Input and output spatial reference must be from one image service"));else b=a.geometries[0].spatialReference&&a.geometries[0].spatialReference.url?a.geometries[0].spatialReference.url:
a.outSR.url;return b}})})},"esri/dijit/RasterList":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/array dgrid/OnDemandList dgrid/extensions/DijitRegistry dgrid/Selection dojo/_base/lang dojo/dom-class dojo/dom-construct".split(" "),function(c,g,n,l,a,b,k,h,w,f,q){var m=c([b,k,h],{selectionMode:"single",selection:!0,maxRowsPerPage:2,minRowsPerPage:2,farOffRemoval:500});return c([g,n,l],{templateString:'\x3cdiv style\x3d"height: 300px; width: 250px; background-color: white;"\x3e \x3cdiv data-dojo-attach-point \x3d "listDiv" style\x3d"height: 100%; width: 100%;" class\x3d"obliqueRasterList"\x3e\x3c/div\x3e\x3c/div\x3e',
showThumbnail:!1,setData:function(a){this.rasterList.set("store",a)},startup:function(){this.inherited(arguments);var b=this;this.rasterList=new m({store:this.store,minRowsPerPage:5,maxRowsPerPage:6,bufferRows:3,selectionMode:"single",renderRow:function(c){c=c.attributes||c;var g,h=q.create("div");b.showThumbnail?f.add(h,"esriRasterListThumbnailRow"):f.add(h,"esriRasterListNoThumbnailRow");var r=q.create("div");f.add(r,"esriRasterListInfoTag");a.forEach(b.fields,function(a){c[a.name]&&a.display&&
(g=c[a.name].toFixed&&0<c[a.name].toString().indexOf(".")?c[a.name].toFixed(2):c[a.name],r.innerHTML+="\x3cstrong\x3e"+a.alias+": \x3c/strong\x3e"+g+"\x3cbr/\x3e")});var k=q.create("table"),m=q.create("tr");f.add(k,"esriRasterListRowTable");if(b.showThumbnail){var l=q.create("img",{className:"esriRasterListThumbnail",src:c.thumbnailUrl}),n=q.create("td");q.place(l,n);q.place(n,m)}l=q.create("td");q.place(r,l);q.place(l,m);q.place(m,k);q.place(k,h);c.selected&&b.rasterList.select(b.rasterList.row(c));
return h}},this.listDiv);this.rasterList.startup();this.own(this.rasterList.on(".dgrid-row:click",function(a){a=b.rasterList.row(a).data;b.emit("raster-select",a)}),this.rasterList.on(".dgrid-row:mouseover",function(a){a=b.rasterList.row(a).data;b.emit("raster-mouseover",a)}),this.rasterList.on(".dgrid-row:mouseout",function(a){b.emit("raster-mouseout")}))}})})},"dgrid/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/registry"],function(c,g,n){return c("dgrid.extensions.DijitRegistry",
null,{minSize:0,maxSize:Infinity,layoutPriority:0,showTitle:!0,buildRendering:function(){n.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);var c=n.getEnclosingWidget(this.domNode.parentNode);c&&c.isLayoutContainer&&this._resizeHandle.remove()}},destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);n.remove(this.id)},getChildren:function(){return[]},isLeftToRight:function(){return!this.isRTL},
resize:function(c){c&&g.setMarginBox(this.domNode,c);this.inherited(arguments)},_set:function(c,a){this[c]=a},watch:function(){},getParent:function(){return n.getEnclosingWidget(this.domNode.parentNode)}})})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(c,g,n,l){c=function(a){function b(b,c){var g=a[b];g&&(a[b]=function(h){var k;"put"===b&&(k=a.getIdentity(h));if(f)return g.apply(this,arguments);f=!0;try{var l=g.apply(this,arguments);
n(l,function(a){c("object"==typeof a&&a||h,k)});return l}finally{f=!1}})}var c=[],h=0;a=g.delegate(a);a.notify=function(a,b){h++;for(var f=c.slice(),g=0,l=f.length;g<l;g++)f[g](a,b)};var w=a.query;a.query=function(b,f){f=f||{};var z=w.apply(this,arguments);if(z&&z.forEach){var t=g.mixin({},f);delete t.start;delete t.count;var s=a.queryEngine&&a.queryEngine(b,t),u=h,r=[],v;z.observe=function(b,g){1==r.push(b)&&c.push(v=function(b,d){n(z,function(e){var c=e.length!=f.count,k,q;if(++u!=h)throw Error("Query is out of date, you must observe() the query prior to any data modifications");
var v,n=-1,t=-1;if(void 0!==d){var E=[].concat(e);s&&!b&&(E=s(e));k=0;for(q=e.length;k<q;k++){var H=e[k];if(a.getIdentity(H)==d&&!(0>E.indexOf(H))){v=H;n=k;(s||!b)&&e.splice(k,1);break}}}if(s){if(b&&(s.matches?s.matches(b):s([b]).length))k=-1<n?n:e.length,e.splice(k,0,b),t=l.indexOf(s(e),b),e.splice(k,1),f.start&&0==t||!c&&t==e.length?t=-1:e.splice(t,0,b)}else b&&(void 0!==d?t=n:f.start||(t=a.defaultIndex||0,e.splice(t,0,b)));if((-1<n||-1<t)&&(g||!s||n!=t)){c=r.slice();for(k=0;e=c[k];k++)e(b||v,n,
t)}})});var q={};q.remove=q.cancel=function(){var a=l.indexOf(r,b);-1<a&&(r.splice(a,1),r.length||c.splice(l.indexOf(c,v),1))};return q}}return z};var f;b("put",function(b,c){a.notify(b,c)});b("add",function(b){a.notify(b)});b("remove",function(b){a.notify(void 0,b)});return a};g.setObject("dojo.store.Observable",c);return c})},"esri/dijit/ImageServiceMeasure":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n!../nls/jsapi dojo/text!./templates/ImageServiceMeasure.html dojo/has ../kernel dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../toolbars/ImageServiceMeasureTool dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/MenuSeparator dijit/PopupMenuItem dijit/RadioMenuItem dijit/CheckedMenuItem ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/Point dojo/_base/Color dojo/dom-class dojo/_base/array ../tasks/ImageServiceMeasureParameters ../units dojo/dom-construct dijit/form/ToggleButton dojo/html".split(" "),
function(c,g,n,l,a,b,k,h,w,f,q,m,z,t,s,u,r,v,x,y,B,D,d,e,p,C,A,F,I,G){return c([k,h,w],{declaredClass:"esri.dijit.ImageServiceMeasure",templateString:l,widgetsInTemplate:!0,layer:null,map:null,layout:"dropDown",displayOperations:null,markerSymbol:null,lineSymbol:null,fillSymbol:null,displayMeasureResultInPopup:null,angularUnit:null,linearUnit:null,areaUnit:null,_supportedMeasureOperations:[],_supportedUnits:{},_currentGraphic:null,_defaultUnits:{angularUnit:"DECIMAL_DEGREES",linearUnit:"METERS",areaUnit:"SQUARE_METERS"},
_desiredDropDownOrder:"OPERATION_POINT OPERATION_DISTANCE_ANGLE OPERATION_AREA_PERIMETER OPERATION_CENTROID OPERATION_BASE_TOP OPERATION_TOP_TOP_SHADOW OPERATION_BASE_TOP_SHADOW".split(" "),_map3DOperations:{OPERATION_POINT:"OPERATION_POINT_3D",OPERATION_DISTANCE_ANGLE:"OPERATION_DISTANCE_ANGLE_3D",OPERATION_AREA_PERIMETER:"OPERATION_AREA_PERIMETER_3D",OPERATION_CENTROID:"OPERATION_CENTROID_3D",OPERATION_BASE_TOP:"OPERATION_BASE_TOP",OPERATION_TOP_TOP_SHADOW:"OPERATION_TOP_TOP_SHADOW",OPERATION_BASE_TOP_SHADOW:"OPERATION_BASE_TOP_SHADOW"},
_menu:null,_dropDownButton:null,_currentOperation:null,_activeMeasureOpMenuItem:null,_has3DOperations:!1,_enabled3DCheckbox:!1,_dropDownMenuItemMap:{},_toggleButtonMenuItemMap:{},_decimalDegreesConstantValue:"esriDUDecimalDegrees",_decimalDegreesConstantKeyword:"DECIMAL_DEGREES",constructor:function(a){c.safeMixin(this,a);this._setDefaultSymbols();this._i18n=n},startup:function(){this.inherited(arguments)},postCreate:function(){this.map&&this.layer&&(this.measureToolbar=new f({map:this.map,layer:this.layer}),
this.measureToolbar.on("draw-end",g.hitch(this,this._addGraphic)),this.measureToolbar.on("draw-start",g.hitch(this,this._onDrawStart)),this.measureToolbar.on("measure-end",g.hitch(this,this._addInfoWindow)),this.measureToolbar.on("unit-change",g.hitch(this,this._onUnitChange)),this._supportedMeasureOperations=this._getSupportedMeasureOperations(),this._has3DOperations=this._check3DSupported(),this._reorderMeasureOperations(),this._supportedUnits=this._getSupportedUnits(),this._setDefaultUnits());
this._checkValidLayoutValue();0<this._supportedMeasureOperations.length?"dropDown"===this.layout?this._populateMeasureDropdown():"toolbar"===this.layout&&this._populateMeasureButtons():G.set(this.esriImageServiceMeasure,this._i18n.widgets.imageServiceMeasure.mensurationCapabilitiesAbsentText)},_checkValidLayoutValue:function(){"dropdown"===this.layout.toLowerCase()?this.layout="dropDown":"toolbar"===this.layout.toLowerCase()?this.layout="toolbar":(this.layout="dropDown",console.log("Invalid value for layout"))},
_getUnitKeyword:function(a){var b=null,d;if(a===this._decimalDegreesConstantValue)b=this._decimalDegreesConstantKeyword;else for(d in A)A.hasOwnProperty(d)&&A[d]===a&&(b=d);return b||null},_setUnitKeyword:function(a,b){var d;this[a]?(d=this._getUnitKeyword(this[a]),d||(d=this._defaultUnits[a],console.log("Incorrect "+b+" supplied. "+b+" set to default."))):d=this._defaultUnits[a];return d},_setDefaultUnits:function(){this.linearUnit=this._setUnitKeyword("linearUnit","Linear Unit");this.areaUnit=this._setUnitKeyword("areaUnit",
"Area Unit");this.angularUnit=this._setUnitKeyword("angularUnit","Angular Unit");this.measureToolbar.setLinearUnit(A[this.linearUnit]);this.measureToolbar.setAreaUnit(A[this.areaUnit]);this.measureToolbar.setAngularUnit(A[this.angularUnit])},_getSupportedMeasureOperations:function(){var a=[],b=this.displayOperations||this.measureToolbar.getSupportedMeasureOperations(),d=this.measureToolbar.getSupportedMeasureOperations(),e;p.forEach(b,function(b){for(e in C)C.hasOwnProperty(e)&&C[e]===b&&(-1<p.indexOf(d,
b)?a.push(e):console.log(b+" is not supported by the service."))},this);return a},_getSupportedUnits:function(){var a={},b=[],d=[],e=this.measureToolbar.getSupportedUnits(),c;for(c in e)e.hasOwnProperty(c)&&(d=e[c],b=[],p.forEach(d,function(a){b.push(this._getUnitString(a))},this),a[c]=b);return a},_check3DSupported:function(){return this._isSupportedMeasureOperation("OPERATION_POINT_3D")||this._isSupportedMeasureOperation("OPERATION_DISTANCE_ANGLE_3D")||this._isSupportedMeasureOperation("OPERATION_AREA_PERIMETER_3D")||
this._isSupportedMeasureOperation("OPERATION_CENTROID_3D")},_isSupportedMeasureOperation:function(a){return-1<this._supportedMeasureOperations.indexOf(a)},_reorderMeasureOperations:function(){var a=[];p.forEach(this._desiredDropDownOrder,function(b){-1<this._supportedMeasureOperations.indexOf(b)&&a.push(b)},this);this._supportedMeasureOperations=a},_setDefaultSymbols:function(){this.markerSymbol||(this.markerSymbol=new v,this.markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z"),
this.markerSymbol.setColor(new d("#00FFFF")));this.lineSymbol||(this.lineSymbol=new x(x.STYLE_SOLID,new d([255,0,0]),1.5));this.fillSymbol||(this.fillSymbol=new y(y.STYLE_SOLID,new x(x.STYLE_DASHDOT,new d([255,0,0]),2),new d([255,255,0,0.25])))},_populateMeasureDropdown:function(){var a,b;this._menu=new m;p.forEach(this._supportedMeasureOperations,function(b){a=new z({label:this._i18n.widgets.imageServiceMeasure.operationLabel[b],iconClass:C[b]});a.on("click",g.hitch(this,this._onDropDownMenuItemClick,
b,a));this._menu.addChild(a);this._dropDownMenuItemMap[b]=a},this);b=new t;this._menu.addChild(b);this._has3DOperations&&(b=new r({label:this._i18n.widgets.imageServiceMeasure.measure3DLabel,checked:!1}),b.on("change",g.hitch(this,this._on3DCheckBoxChange)),this._menu.addChild(b),b=new t,this._menu.addChild(b));this._addUnitsMenu();this._dropDownButton=new q({dropDown:this._menu,"class":"esriImageServiceMeasureDropdownContainer"},this.measureDropDownContainer);this._dropDownButton.startup();this._currentOperation=
this._defaultOperation=this._supportedMeasureOperations[0];this._toggleButton=new q({label:this._i18n.widgets.imageServiceMeasure.operationLabel[this._defaultOperation],iconClass:C[this._defaultOperation],"class":"esriImageServiceMeasureToggleButton",dropDown:new m({"class":"esriHiddenDropDownMenu"})},this.toggleButtonDiv);this._toggleButton.startup();this._toggleButton.on("click",g.hitch(this,this._toggle))},_populateMeasureButtons:function(){var a,b,d;e.add(this.esriImageServiceMeasure,"esriImageServiceMeasureToolbarLayout");
e.add(this.measureButtonContainer,"esriImageServiceMeasureButtonContainer");this._menu=new m;p.forEach(this._supportedMeasureOperations,function(b){d=F.create("div",{innerHTML:this._i18n.widgets.imageServiceMeasure.operationLabel[b]},this.measureButtonContainer);a=new I({showLabel:!1,checked:!1,label:this._i18n.widgets.imageServiceMeasure.operationLabel[b],iconClass:C[b],baseClass:"esriMeasureButton"},d);a.on("click",g.hitch(this,this._onButtonMenuItemClick,b));this._toggleButtonMenuItemMap[b]=a},
this);this._has3DOperations&&(b=new r({label:this._i18n.widgets.imageServiceMeasure.measure3DLabel,checked:!1}),b.on("change",g.hitch(this,this._on3DCheckBoxToolbarLayoutChange)),this._menu.addChild(b),b=new t,this._menu.addChild(b));this._addUnitsMenu();b=F.create("span",{innerHTML:"|"},this.measureButtonContainer);d=F.create("div",null,this.measureButtonContainer);this._dropDownButton=new q({dropDown:this._menu,label:this._i18n.widgets.imageServiceMeasure.settings,showLabel:!1,iconClass:"esriMensurationSettingsIcon",
"class":"esriMeasureSettingsButton"},d);this._dropDownButton.startup();if("false"===this.displayMeasureResultInPopup||!1===this.displayMeasureResultInPopup||!this.displayMeasureResultInPopup)this.measureResultContainer=F.create("div",{"class":"measureResultContainer"},this.esriImageServiceMeasure),this.esriMeasurementResultLabel=F.create("div",{innerHTML:this._i18n.widgets.imageServiceMeasure.infoWindowTitle,"class":"esriMeasurementResultLabel"},this.measureResultContainer),this.measureResultStringDiv=
F.create("div",{"class":"esriMeasurementResultString"},this.measureResultContainer)},_angularUnitsReqd:function(){if(p.some(this._supportedMeasureOperations,function(a){if("OPERATION_DISTANCE_ANGLE_3D"===a||"OPERATION_DISTANCE_ANGLE"===a)return!0}))return!0},_linearUnitsReqd:function(){if(p.some(this._supportedMeasureOperations,function(a){if(0>a.indexOf("OPERATION_POINT")&&0>a.indexOf("OPERATION_CENTROID"))return!0}))return!0},_areaUnitsReqd:function(){if(p.some(this._supportedMeasureOperations,
function(a){if("OPERATION_AREA_PERIMETER_3D"===a||"OPERATION_AREA_PERIMETER"===a)return!0}))return!0},_addUnitsMenu:function(){var a,b,d;this._angularUnitsReqd()&&(this.angularUnitMenu=new m,p.forEach(this._supportedUnits.angularUnits,function(a){d=this._isCurrentAngularUnit(a);b=new u({group:"angularUnit",checked:d,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":d?"esriSelectedOption":""});d&&(this._currentAngularUnitMenuItem=b);b.on("click",g.hitch(this,this._onAngularUnitClick,
a,b));this.angularUnitMenu.addChild(b)},this),a=new s({label:this._i18n.widgets.imageServiceMeasure.angularUnits,popup:this.angularUnitMenu}),this._menu.addChild(a));this._linearUnitsReqd()&&(this.linearUnitMenu=new m,p.forEach(this._supportedUnits.linearUnits,function(a){d=this._isCurrentLinearUnit(a);b=new u({group:"linearUnit",checked:d,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":d?"esriSelectedOption":""});d&&(this._currentLinearUnitMenuItem=b);b.on("click",g.hitch(this,
this._onLinearUnitClick,a,b));this.linearUnitMenu.addChild(b)},this),a=new s({label:this._i18n.widgets.imageServiceMeasure.linearUnits,popup:this.linearUnitMenu}),this._menu.addChild(a));this._areaUnitsReqd()&&(this.areaUnitMenu=new m,p.forEach(this._supportedUnits.areaUnits,function(a){d=this._isCurrentAreaUnit(a);b=new u({group:"areaUnit",checked:d,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":d?"esriSelectedOption":""});d&&(this._currentAreaUnitMenuItem=b);b.on("click",g.hitch(this,
this._onAreaUnitClick,a,b));this.areaUnitMenu.addChild(b)},this),a=new s({label:this._i18n.widgets.imageServiceMeasure.areaUnits,popup:this.areaUnitMenu}),this._menu.addChild(a))},_on3DCheckBoxChange:function(a){var b=this._currentOperation.replace("_3D","");this._enabled3DCheckbox=a;this._dropDownButton.openDropDown();this._activeMeasureOpMenuItem&&(this._activeMeasureOpMenuItem=null,this._onDropDownMenuItemClick(b,this._dropDownMenuItemMap[b]))},_on3DCheckBoxToolbarLayoutChange:function(a){this._enabled3DCheckbox=
a;this._dropDownButton.openDropDown();this._enabled3DCheckbox||(this._currentOperation=this._currentOperation.replace("_3D",""));this._currentOperation&&this._onButtonMenuItemClick(this._currentOperation)},_onDropDownMenuItemClick:function(a,b){var d=b.domNode;this._enabled3DCheckbox&&(a=this._map3DOperations[a]);this._disableMapNavigation();this._removeDraws();this._activeMeasureOpMenuItem?(e.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),e.add(d,"esriSelectedOption"),this._activeMeasureOpMenuItem=
b,this._currentOperation=a,this._toggleButton.set({label:this._i18n.widgets.imageServiceMeasure.operationLabel[a],iconClass:C[a.replace("_3D","")]})):(this._activeMeasureOpMenuItem=b,e.add(d,"esriSelectedOption"),this._currentOperation=a,this._toggleButton.set({label:this._i18n.widgets.imageServiceMeasure.operationLabel[a],iconClass:C[a.replace("_3D","")]}),e.add(this._toggleButton._buttonNode,"esriCheckedMeasureButton"));this.measureToolbar.activate(C[a]);this.measureToolbar.showDrawTooltip()},_uncheckOtherButtons:function(a){for(var b in this._toggleButtonMenuItemMap)this._toggleButtonMenuItemMap.hasOwnProperty(b)&&
b!==a&&(0<=p.indexOf(this._supportedMeasureOperations,b)?this._toggleButtonMenuItemMap[b].set("checked",!1):delete this._toggleButtonMenuItemMap[b])},_onButtonMenuItemClick:function(a){this._removeDraws();this._enabled3DCheckbox&&(a=this._map3DOperations[a]);this._uncheckOtherButtons(a.replace("_3D",""));this._currentOperation=a;this._toggleButtonMenuItemMap[a.replace("_3D","")].checked?(this._disableMapNavigation(),this.measureToolbar.activate(C[a]),this.measureToolbar.showDrawTooltip()):(this.measureToolbar.deactivate(),
this._enableMapNavigation());this.measureResultStringDiv&&G.set(this.measureResultStringDiv,"")},_isCurrentAngularUnit:function(a){return a===this.angularUnit?!0:!1},_isCurrentLinearUnit:function(a){return a===this.linearUnit?!0:!1},_isCurrentAreaUnit:function(a){return a===this.areaUnit?!0:!1},_onLinearUnitClick:function(a,b){e.remove(this._currentLinearUnitMenuItem.domNode,"esriSelectedOption");e.add(b.domNode,"esriSelectedOption");this._currentLinearUnitMenuItem=b;this.linearUnit=a;this.measureToolbar.setLinearUnit(A[a]);
this._dropDownButton.openDropDown()},_onAngularUnitClick:function(a,b){e.remove(this._currentAngularUnitMenuItem.domNode,"esriSelectedOption");e.add(b.domNode,"esriSelectedOption");this._currentAngularUnitMenuItem=b;this.angularUnit=a;this.measureToolbar.setAngularUnit(A[a]);this._dropDownButton.openDropDown()},_onAreaUnitClick:function(a,b){e.remove(this._currentAreaUnitMenuItem.domNode,"esriSelectedOption");e.add(b.domNode,"esriSelectedOption");this._currentAreaUnitMenuItem=b;this.areaUnit=a;this.measureToolbar.setAreaUnit(A[a]);
this._dropDownButton.openDropDown()},_onDrawStart:function(){this._removeDraws()},_addGraphic:function(a){var b=a.geometry;this.measureToolbar.hideDrawTooltip();a="point"===b.type?this.markerSymbol:"line"===b.type||"polyline"===b.type?this.lineSymbol:this.fillSymbol;this._removeDraws();this._currentGraphic=a=new B(b,a);this.map.graphics.add(a)},_addInfoWindow:function(a){a=this._measureResultString(a.measureResult,a.error);"dropDown"===this.layout||"toolbar"===this.layout&&("true"===this.displayMeasureResultInPopup||
!0===this.displayMeasureResultInPopup)?this._displayInfoWindowMeasureResult(a):"toolbar"===this.layout&&this._displayToolbarMeasureResult(a)},_measureResultString:function(a,b){var d="",e,c,f,g,h;if(a)for(h in a)a.hasOwnProperty(h)&&(a[h]&&"name"!==h&&"sensorName"!==h)&&(g="point"===h&&0<=this._currentOperation.toLowerCase().indexOf("centroid")?this._i18n.widgets.imageServiceMeasure.measureDialog.Centroid:this._i18n.widgets.imageServiceMeasure.measureDialog[h.charAt(0).toUpperCase()+h.slice(1)],"point"!=
h?(e=this._i18n.widgets.imageServiceMeasure.unitLabel[this._getUnitString(a[h].unit)],f=Math.abs(a[h].uncertainty).toFixed(2),c=this._getDisplayValue(a[h]),d+="\x3cstrong\x3e"+g+"\x3c/strong\x3e: "+c+" (\x26plusmn"+f+") "+e+"\x3cbr/\x3e"):(e=a[h].value.x.toFixed(2),c=a[h].value.y.toFixed(2),d+="\x3cstrong\x3e"+g+"\x3c/strong\x3e\x3cbr/\x3e"+this._i18n.widgets.imageServiceMeasure.measureDialog.X+" : "+e+"\x3cbr/\x3e"+this._i18n.widgets.imageServiceMeasure.measureDialog.Y+" : "+c+"\x3cbr/\x3e"));else d=
this._i18n.widgets.imageServiceMeasure.measurementErrorGeneric;return d},_getDisplayValue:function(a){return this.layer.currentVersion&&10.3<=this.layer.currentVersion?0>a.uncertainty?a.value.toFixed(2):Number(a.displayValue).toString():a.value.toFixed(2)},_getUnitString:function(a){var b,d;for(b in A)A.hasOwnProperty(b)&&(A[b]===a?d=b:a===this._decimalDegreesConstantValue&&(d=this._decimalDegreesConstantKeyword));return d},_displayInfoWindowMeasureResult:function(a){var b=this._currentGraphic.geometry,
d;this._currentGraphic&&("point"===b.type?this._currentInfowindow=b:"polyline"===b.type?(d=(b.paths[0][0][0]+b.paths[0][1][0])/2,b=(b.paths[0][0][1]+b.paths[0][1][1])/2,this._currentInfowindow=new D(d,b,this.map.spatialReference)):"polygon"===b.type&&(this._currentInfowindow=b.getCentroid()),this.map.infoWindow.setTitle(this._i18n.widgets.imageServiceMeasure.infoWindowTitle),this.map.infoWindow.setContent(a),this.map.infoWindow.on("hide",g.hitch(this,this._removeAssociatedGeometry)),this.map.infoWindow.show(this._currentInfowindow))},
_displayToolbarMeasureResult:function(a){G.set(this.measureResultStringDiv,a)},_removeAssociatedGeometry:function(){this._currentGraphic&&(this.map.graphics.remove(this._currentGraphic),this._currentGraphic=null)},_removeDraws:function(){this._removeAssociatedGeometry();this._currentInfowindow&&(this.map.infoWindow.hide(this._currentInfowindow),this._currentInfowindow=null)},_onUnitChange:function(a){this._addInfoWindow(a)},_toggle:function(){this._activeMeasureOpMenuItem?(this._removeDraws(),e.remove(this._activeMeasureOpMenuItem.domNode,
"esriSelectedOption"),this._activeMeasureOpMenuItem=null,this.measureToolbar.deactivate(),e.remove(this._toggleButton._buttonNode,"esriCheckedMeasureButton"),this._enableMapNavigation()):(this._menuItem=this._dropDownMenuItemMap[this._currentOperation.replace("_3D","")],this._onDropDownMenuItemClick(this._currentOperation.replace("_3D",""),this._menuItem))},deactivate:function(){this._removeDraws();this._activeMeasureOpMenuItem&&(e.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),
this._activeMeasureOpMenuItem=null);this._toggleButton&&e.remove(this._toggleButton._buttonNode,"esriCheckedMeasureButton");this.measureResultStringDiv&&G.set(this.measureResultStringDiv,"");"toolbar"===this.layout&&this._currentOperation&&this._toggleButtonMenuItemMap[this._currentOperation.replace("_3D","")].set("checked",!1);this.measureToolbar&&this.measureToolbar.deactivate();this._enableMapNavigation()},_disableMapNavigation:function(){this.map.disableMapNavigation();this.map.setInfoWindowOnClick(!1)},
_enableMapNavigation:function(){this.map.enableMapNavigation();this.map.setInfoWindowOnClick(!0)},destroy:function(){this.inherited(arguments)}})})},"esri/toolbars/ImageServiceMeasureTool":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has ../kernel ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ./draw ../tasks/ImageServiceMeasureParameters ../tasks/ImageServiceMeasureTask ../geometry/Point dojo/_base/array ../units".split(" "),
function(c,g,n,l,a,b,k,h,w,f,q,m,z,t,s){var u=c("CustomDraw",[f],{returnCurrentPoint:function(){return this._points},hideTooltip:function(){this._options.showTooltips=!1},showTooltip:function(){this._options.showTooltips=!0}});return c(b,{declaredClass:"esri.toolbars.imageServiceMeasure",_eventMap:{"draw-end":["geometry"],"draw-start":[],"measure-end":["measureResult","error","geometry"],"unit-change":["measureResult","error","geometry"]},_mensurationCapabilitiesMap:{Basic:["OPERATION_POINT","OPERATION_DISTANCE_ANGLE",
"OPERATION_AREA_PERIMETER","OPERATION_CENTROID"],"3D":["OPERATION_POINT_3D","OPERATION_DISTANCE_ANGLE_3D","OPERATION_AREA_PERIMETER_3D","OPERATION_CENTROID_3D"],"Base-Top Height":["OPERATION_BASE_TOP"],"Top-Top Shadow Height":["OPERATION_TOP_TOP_SHADOW"],"Base-Top Shadow Height":["OPERATION_BASE_TOP_SHADOW"]},_supportedMeasureOperations:[],_operationsMap:{OPERATION_POINT:{geometryType:"POINT"},OPERATION_DISTANCE_ANGLE:{geometryType:"LINE"},OPERATION_AREA_PERIMETER:{geometryType:"POLYGON"},OPERATION_BASE_TOP:{geometryType:"LINE"},
OPERATION_BASE_TOP_SHADOW:{geometryType:"LINE"},OPERATION_TOP_TOP_SHADOW:{geometryType:"LINE"},OPERATION_CENTROID:{geometryType:"POLYGON"},OPERATION_POINT_3D:{geometryType:"POINT"},OPERATION_DISTANCE_ANGLE_3D:{geometryType:"LINE"},OPERATION_AREA_PERIMETER_3D:{geometryType:"POLYGON"},OPERATION_CENTROID_3D:{geometryType:"POLYGON"}},_supportedUnits:{linearUnits:"INCHES FEET YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS DECIMETERS METERS KILOMETERS".split(" "),angularUnits:["RADIANS","DECIMAL_DEGREES"],
areaUnits:"SQUARE_INCHES SQUARE_FEET SQUARE_YARDS ACRES SQUARE_MILES SQUARE_MILLIMETERS SQUARE_CENTIMETERS SQUARE_DECIMETERS SQUARE_METERS ARES HECTARES SQUARE_KILOMETERS".split(" ")},markerSymbol:null,lineSymbol:null,fillSymbol:null,_drawToolbar:null,_currentGeometry:null,_currentOperation:null,linearUnit:null,angularUnit:null,areaUnit:null,_decimalDegreesConstantValue:"esriDUDecimalDegrees",_decimalDegreesConstantKeyword:"DECIMAL_DEGREES",constructor:function(a){c.safeMixin(this,a);this._checkMensurationSupport();
this._setDefaultSymbols()},_checkMensurationSupport:function(){this.layer.mensurationCapabilities?this._setSupportedMeasureOperations():console.log("Mensuration Capabilities not supported.")},_setDefaultSymbols:function(){this.markerSymbol||(this.markerSymbol=new k,this.markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z"),
this.markerSymbol.setColor(new n("#00FFFF")));this.lineSymbol||(this.lineSymbol=new h(h.STYLE_SOLID,new n([255,0,0]),1.5));this.fillSymbol||(this.fillSymbol=new w(w.STYLE_SOLID,new h(h.STYLE_DASHDOT,new n([255,0,0]),2),new n([255,255,0,0.25])))},_setSupportedMeasureOperations:function(){var a;this._supportedMeasureOperations=[];this.mensurationCapabilities=this.layer.mensurationCapabilities.split(",");t.forEach(this.mensurationCapabilities,function(b){a=this._mensurationCapabilitiesMap[b];t.forEach(a,
function(a){this._supportedMeasureOperations.push(a)},this)},this)},getSupportedMeasureOperations:function(){var a=[];t.forEach(this._supportedMeasureOperations,function(b){a.push(q[b])},this);return a},getSupportedUnits:function(){var a={},b=[],c=[],f;for(f in this._supportedUnits)this._supportedUnits.hasOwnProperty(f)&&(b=this._supportedUnits[f],c=[],t.forEach(b,function(a){a===this._decimalDegreesConstantKeyword?c.push(this._decimalDegreesConstantValue):c.push(s[a])},this),a[f]=c);return a},setLinearUnit:function(a){for(var b in s)s.hasOwnProperty(b)&&
s[b]===a&&(this.linearUnit=b);this._currentGeometry&&this._getUnitChangeResults(this._currentGeometry)},setAngularUnit:function(a){for(var b in s)s.hasOwnProperty(b)&&(s[b]===a?this.angularUnit=b:a===this._decimalDegreesConstantValue&&(this.angularUnit=this._decimalDegreesConstantKeyword));this._currentGeometry&&this._getUnitChangeResults(this._currentGeometry)},setAreaUnit:function(a){for(var b in s)s.hasOwnProperty(b)&&s[b]===a&&(this.areaUnit=b);this._currentGeometry&&this._getUnitChangeResults(this._currentGeometry)},
setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},setFillSymbol:function(a){this.fillSymbol=a},activate:function(a){t.forEach(this._supportedMeasureOperations,function(b){q[b]===a&&(this._currentOperation=b)},this);this.map.setMapCursor("crosshair");this._mapClickHandle=this.map.on("click",g.hitch(this,this._onMapClick));this._mapMouseDownHandle=this.map.on("mouse-down",g.hitch(this,this._onMapMouseDown));this._drawToolbar||(this._drawToolbar=new u(this.map,
{fillSymbol:this.fillSymbol,markerSymbol:this.markerSymbol,lineSymbol:this.lineSymbol}),this._drawToolbar.on("draw-end",g.hitch(this,this._setGeometry)));this._drawToolbar.activate(f[this._operationsMap[this._currentOperation].geometryType])},_onMapClick:function(){if(0===this._drawToolbar.returnCurrentPoint().length)this.onDrawStart()},_onMapMouseDown:function(){if(0===this._drawToolbar.returnCurrentPoint().length)this.onDrawStart()},deactivate:function(){this._drawToolbar&&this._drawToolbar.deactivate();
this.map.setMapCursor("default");this._currentOperation=this._currentGeometry=null;this._mapClickHandle&&(this._mapClickHandle.remove(),this._mapClickHandle=null);this._mapMouseDownHandle&&(this._mapMouseDownHandle.remove(),this._mapMouseDownHandle=null)},hideDrawTooltip:function(){this._drawToolbar.deactivate();this._drawToolbar.hideTooltip();this._drawToolbar.activate(f[this._operationsMap[this._currentOperation].geometryType])},showDrawTooltip:function(){this._drawToolbar.deactivate();this._drawToolbar.showTooltip();
this._drawToolbar.activate(f[this._operationsMap[this._currentOperation].geometryType])},_setGeometry:function(a){a=a.geometry;this.onDrawEnd(a);this._getMensurationResults(a);this._currentGeometry=a},_getImageServiceMeasureParameters:function(a){var b=new q;b.operation=q[this._currentOperation];b.mosaicRule=this.layer.mosaicRule;b.linearUnit=s[this.linearUnit];b.angularUnit=this.angularUnit===this._decimalDegreesConstantKeyword?this._decimalDegreesConstantValue:s[this.angularUnit];b.areaUnit=s[this.areaUnit];
"line"===a.type||"polyline"===a.type?(b.fromGeometry=new z(a.paths[0][0][0],a.paths[0][0][1],this.map.spatialReference),b.toGeometry=new z(a.paths[0][1][0],a.paths[0][1][1],this.map.spatialReference)):b.fromGeometry=a;return b},_getMensurationResults:function(a){a=this._getImageServiceMeasureParameters(a);(new m(this.layer.url)).execute(a,g.hitch(this,this._measureTaskSuccess),g.hitch(this,this._measureTaskError))},_measureTaskSuccess:function(a){this.onMeasureEnd(a,null,this._currentGeometry)},_measureTaskError:function(a){this.onMeasureEnd(null,
a,this._currentGeometry)},_getUnitChangeResults:function(a){a=this._getImageServiceMeasureParameters(a);(new m(this.layer.url)).execute(a,g.hitch(this,this._unitChangeSuccess),g.hitch(this,this._unitChangeError))},_unitChangeSuccess:function(a){this.onUnitChange(a,null,this._currentGeometry)},_unitChangeError:function(a){this.onUnitChange(null,a,this._currentGeometry)},onDrawStart:function(){},onDrawEnd:function(){},onMeasureEnd:function(){},onUnitChange:function(){}})})},"esri/tasks/ImageServiceMeasureParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(c,g,n,l,a,b){c=c(null,{declaredClass:"esri.tasks.ImageServiceMeasureParameters",fromGeometry:null,toGeometry:null,operation:null,pixelSize:null,mosaicRule:!1,linearUnit:null,angularUnit:null,areaUnit:null,toJson:function(a){var c=a&&a.fromGeometry||this.fromGeometry;a={fromGeometry:c,toGeometry:a&&a.toGeometry||this.toGeometry,measureOperation:this.operation,mosaicRule:this.mosaicRule?n.toJson(this.mosaicRule.toJson()):null,linearUnit:this.linearUnit,angularUnit:this.angularUnit,areaUnit:this.areaUnit};
c&&(a.geometryType=b.getJsonType(c));this.pixelSize&&(a.pixelSize=this.pixelSize?n.toJson(this.pixelSize.toJson()):null);return a}});g.mixin(c,{OPERATION_POINT:"esriMensurationPoint",OPERATION_DISTANCE_ANGLE:"esriMensurationDistanceAndAngle",OPERATION_AREA_PERIMETER:"esriMensurationAreaAndPerimeter",OPERATION_BASE_TOP:"esriMensurationHeightFromBaseAndTop",OPERATION_BASE_TOP_SHADOW:"esriMensurationHeightFromBaseAndTopShadow",OPERATION_TOP_TOP_SHADOW:"esriMensurationHeightFromTopAndTopShadow",OPERATION_CENTROID:"esriMensurationCentroid",
OPERATION_POINT_3D:"esriMensurationPoint3D",OPERATION_DISTANCE_ANGLE_3D:"esriMensurationDistanceAndAngle3D",OPERATION_AREA_PERIMETER_3D:"esriMensurationAreaAndPerimeter3D",OPERATION_CENTROID_3D:"esriMensurationCentroid3D"});return c})},"esri/tasks/ImageServiceMeasureTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task".split(" "),function(c,g,n,l,a,b,k){c=c(k,{declaredClass:"esri.tasks.ImageServiceMeasureTask",constructor:function(a){this._url.path+=
"/measure";this._handler=g.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["fromGeometry","toGeometry"]}],e:2}],_handler:function(a,b,c,g,k){try{this._successHandler([a],"onComplete",c,k)}catch(l){this._errorHandler(l,g,k)}},execute:function(b,c,f,k){var l=k.assembly;b=this._encode(g.mixin({},this._url.query,{f:"json"},b.toJson(l&&l[0])));var n=this._handler,t=this._errorHandler;return a({url:this._url.path,content:b,callbackParamName:"callback",load:function(a,b){n(a,b,c,f,k.dfd)},
error:function(a){t(a,f,k.dfd)}})},onComplete:function(){}});b._createWrappers(c);return c})},"dijit/PopupMenuItem":function(){define("dojo/_base/declare dojo/dom-style dojo/_base/lang dojo/query ./popup ./registry ./MenuItem ./hccss".split(" "),function(c,g,n,l,a,b,k){return c("dijit.PopupMenuItem",k,{baseClass:"dijitMenuItem dijitPopupMenuItem",_fillContent:function(){if(this.srcNodeRef){var a=l("*",this.srcNodeRef);this.inherited(arguments,[a[0]]);this.dropDownContainer=this.srcNodeRef}},_openPopup:function(b,
c){var f=this.popup;a.open(n.delegate(b,{popup:this.popup,around:this.domNode}));c&&f.focus&&f.focus()},_closePopup:function(){a.close(this.popup);this.popup.parentMenu=null},startup:function(){if(!this._started){this.inherited(arguments);if(!this.popup){var a=l("[widgetId]",this.dropDownContainer)[0];this.popup=b.byNode(a)}this.ownerDocumentBody.appendChild(this.popup.domNode);this.popup.domNode.setAttribute("aria-labelledby",this.containerNode.id);this.popup.startup();this.popup.domNode.style.display=
"none";this.arrowWrapper&&g.set(this.arrowWrapper,"visibility","");this.focusNode.setAttribute("aria-haspopup","true")}},destroyDescendants:function(a){this.popup&&(this.popup._destroyed||this.popup.destroyRecursive(a),delete this.popup);this.inherited(arguments)}})})},"dijit/RadioMenuItem":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/query!css2 ./CheckedMenuItem ./registry".split(" "),function(c,g,n,l,a,b){return g("dijit.RadioButtonMenuItem",a,{baseClass:"dijitMenuItem dijitRadioMenuItem",
role:"menuitemradio",checkedChar:"*",group:"",_setGroupAttr:"domNode",_setCheckedAttr:function(a){this.inherited(arguments);this._created&&a&&this.group&&c.forEach(this._getRelatedWidgets(),function(a){a!=this&&a.checked&&a.set("checked",!1)},this)},_onClick:function(a){!this.disabled&&!this.checked&&(this.set("checked",!0),this.onChange(!0));this.onClick(a)},_getRelatedWidgets:function(){var a=[];l("[group\x3d"+this.group+"][role\x3d"+this.role+"]").forEach(function(c){(c=b.getEnclosingWidget(c))&&
a.push(c)});return a}})})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(c,g,n,l,a,b,k){return c([b,k],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(a,b){this._initialize(a,b);this.useMapImage=b&&b.useMapImage||!1},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=
!0;this.inherited(arguments);this.disableClientCaching=b}},exportMapImage:function(b,c){var f=a.defaults.map,f=g.mixin({size:f.width+","+f.height},this._params,b?b.toJson(this.normalization):{},{f:"json"});delete f._ts;this._exportMapImage(this._url.path+"/exportImage",f,c)}})})},"widgets/ObliqueViewer/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:esri/dijit/templates/_ObliqueRotationWidget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"gaugeNode" class\x3d"esriObliqueRotationWidgetGauge"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/ImageServiceMeasure.html":'\x3cdiv data-dojo-attach-point\x3d"esriImageServiceMeasure" class\x3d"esriImageServiceMeasure"\x3e\r\n  \x3cdiv class\x3d"esriImageServiceMeasureToggleButton" data-dojo-attach-point\x3d"toggleButtonDiv"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriImageServiceMeasureDropdownContainer" data-dojo-attach-point\x3d"measureDropDownContainer"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"measureButtonContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/ObliqueViewer/Widget.html":'\x3cdiv class\x3d"obliqueViewerWidget"\x3e\r\n  \x3cdiv class\x3d"obliqueViewerWidgetDiv"\x3e\r\n    \x3cdiv id\x3d"ovMap" class\x3d"ovMap"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"obliqueRotationDivPassive" data-dojo-attach-point\x3d"rotationDivContainer"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"obliqueRotationDiv"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"toolbar" class\x3d"toolbar"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"locateButtonContainer"\x3e\r\n      \x3c/div\x3e   \r\n      \x3cdiv data-dojo-attach-point\x3d"clearButtonContainer"\x3e\r\n      \x3c/div\x3e \r\n      \x3cdiv data-dojo-attach-point\x3d"zoomButtonContainer"\x3e\r\n      \x3c/div\x3e   \r\n      \x3cdiv data-dojo-attach-point\x3d"syncButtonContainer"\x3e\r\n      \x3c/div\x3e    \r\n      \x3cdiv data-dojo-attach-point\x3d"listTitlePaneDiv" class\x3d"listDivTitlePane"\x3e     \r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d\'measureWidget\' title\x3d"{nls.measureWidgetLabel}"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n\r\n\r\n',
"url:widgets/ObliqueViewer/css/style.css":'.obliqueViewerWidgetDiv {height: 100%; width:100%;}.obliqueViewerWidget, .obliqueViewerWidgetDiv{height: 100%; width: 100%;}.ovMap{height: 100%; width: 100%;}.obliqueViewerWidgetDiv .dijitReset.dijitInline.dijitArrowButtonInner{background-image: url(../images/arrow-drop-down.png) !important; background-position: center;}.esriMensurationHeightFromBaseAndTop{background-image: url(../images/measure_base_top.png) !important; background-position: center; background-size: 17px;}.esriMensurationHeightFromTopAndTopShadow {background-image: url(../images/measure_top_top_shadow.png) !important; background-position: center; background-size: 17px;}.esriMensurationHeightFromBaseAndTopShadow{background-image: url(../images/measure_base_top_shadow.png) !important; background-position: center; background-size: 17px;}.obliqueViewerWidgetDiv .dijitButtonNode,.obliqueViewerWidgetDiv .dijitDropDownButton.dijitButtonNode{background-color: rgba(0,0,0,0)!important; background-image: none!important;}.obliqueViewerWidgetDiv .obliqueRotationDivPassive {display: block; position: absolute; background-color: rgba(255, 255, 255, 0); bottom: 15px; right: 10px; border-radius: 10px; height:90px; width:90px;}.obliqueViewerWidgetDiv .toolbar {position: absolute; display: block; top: 5px; left: 5px; height: 40px; overflow: visible; background-color: rgba(255,255,255, 0.8); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr\x3d\'#ffffff\', endColorstr\x3d\'#dddddd\',GradientType\x3d0 ); -webkit-box-shadow: 3px 2px 3px 0px rgba(50, 50, 50, 0.69); -moz-box-shadow: 3px 2px 3px 0px rgba(50, 50, 50, 0.69); box-shadow: 3px 2px 3px 0px rgba(50, 50, 50, 0.69);}.obliqueViewerWidgetDiv .listDivTitlePane {display: inline;}.obliqueViewerWidgetDiv .esriSimpleSliderTL {display: none;}.obliqueViewerWidgetDiv .zoomButtonContainer {display: inline; padding-left: 3px;}.obliqueViewerWidgetDiv .zoomIcon {height: 16px; width: 16px; background: url(../images/zoom.png); -webkit-background-size: 16px; -moz-background-size: 16px; background-size: 16px; background-position: center;}.obliqueViewerWidgetDiv .measureWidget {display: inline;}.obliqueViewerWidgetDiv .measureWidget .dijitButtonText{display: none;}.obliqueViewerWidgetDiv .rastersListIcon {background-image: url("../images/rasters_list.png"); width: 16px; height: 16px; -webkit-background-size: 16px; -moz-background-size: 16px; background-size: 16px; background-position: center; background-repeat: no-repeat;}.dgrid-row-odd {background: #E6EBFA;}.dgrid-scroller {margin-top: 0 !important; margin-bottom: 0 !important; height: 100% !important; overflow: auto!important;}.esriRasterListThumbnail {height:70px; width:70px;}.dgrid-header {z-index: 1;}.dgrid-header-scroll {display: none;}.dgrid-header-row th {height: 25px;}th.dgrid-cell {text-align: center;}.dgrid-content {margin-top: 27px; height: auto;}.dgrid-content .dgrid-cell {border-collapse: collapse !important;}td.dgrid-cell {padding-left: 5px;}.dgrid-row {font-size:10px;}.field-id {width: 30px;}.obliqueRasterList .dgrid-content {margin-top: 0!important;}.obliqueRasterList .dgrid-row {padding: 3px; border-bottom: 1px solid slategray;}.esriRasterListThumbnailRow.dgrid-row {height:80px;}.obliqueViewerWidgetDiv .dijitDialogUnderlay {background: #000000; opacity: 0.4;}.obliqueViewerWidgetDiv .dijitIcon{display: inline-block!important;}.obliqueViewerWidgetDiv .dijitButton .dijitButtonNode,.obliqueViewerWidgetDiv .dijitToggleButton .dijitButtonNode,.obliqueViewerWidgetDiv .dijitButtonHover .dijitButtonNode,.obliqueViewerWidgetDiv .dijitToggleButtonHover .dijitButtonNode{padding-left: 6px!important; padding-right: 6px!important; border-width: 1px!important; border-radius: 0px!important; margin-top: -7px; padding-top: 11px!important; height: 100%; border-color: rgba(0,0,0,0)!important; border-width: 1px!important; box-shadow: none!important; min-width: 0!important;}.obliqueViewerWidgetDiv .dijitDropDownButton .dijitButtonNode,.obliqueViewerWidgetDiv .dijitComboButton .dijitButtonNode,.obliqueViewerWidgetDiv .dijitDropDownButtonHover .dijitButtonNode,.obliqueViewerWidgetDiv .dijitComboButtonHover .dijitButtonNode{padding-left: 6px!important; padding-right: 6px!important; border-radius: 0px!important; z-index: 1; border-color: rgba(0,0,0,0)!important; border-width: 1px!important; margin-top: -2px; padding-top: 11px!important; height: 100%; box-shadow: none!important; min-width: 0!important;}.obliqueViewerWidgetDiv .dijitButtonHover .dijitButtonNode,.obliqueViewerWidgetDiv .dijitToggleButtonHover .dijitButtonNode,.obliqueViewerWidgetDiv .dijitDropDownButtonHover .dijitButtonNode,.obliqueViewerWidgetDiv .dijitComboButtonHover .dijitButtonNode{background-color: rgba(255,255,255,0.9)!important; background-image: none!important;}.obliqueViewerWidgetDiv .dijit.dijitReset.dijitInline.dijitDropDownButton{height: 100%;}.obliqueViewerWidgetDiv .dijitToggleButtonChecked .dijitButtonNode,.obliqueViewerWidgetDiv .esriCheckedMeasureButton{border-width: 1px; background-color: rgba(255,255,255,0.9)!important; box-shadow: none!important; border-color: rgba(0,0,0,0)!important; border-radius: 0px!important; min-width: 0;}.obliqueViewerWidgetDiv .locateIcon {background-image: url("../images/locate.png"); width: 16px; height: 16px; -webkit-background-size: 16px; -moz-background-size: 16px; background-position: center; background-repeat: no-repeat; filter: grayscale(50%);}.obliqueViewerWidgetDiv .syncIcon {background-image: url("../images/sync.png"); width: 16px; height: 16px; -webkit-background-size: 16px; -moz-background-size: 16px; background-size: 16px; background-position: center; background-repeat: no-repeat; filter: grayscale(50%);}.obliqueViewerWidgetDiv .clearIcon {background-image: url("../images/clear.png"); width: 16px; height: 16px; -webkit-background-size: 16px; -moz-background-size: 16px; background-size: 16px; background-position: center; background-repeat: no-repeat;}.obliqueViewerWidgetDiv .clearButtonContainer {display: inline;}.obliqueViewerWidgetDiv .locateButtonContainer {display: inline;}.obliqueViewerWidgetDiv .syncButtonContainer {display: inline;}.obliqueViewerWidgetDiv .esriImageServiceMeasureToggleButton{margin-right: 4px!important; padding-left: 2px!important;}.obliqueViewerWidgetDiv .dijitMenuItem td{background-color: transparent!important; border-color: transparent!important; border-width: 1px 0 1px 0!important; padding: 2px!important; color: #000000!important;}.obliqueViewerWidgetDiv.dijitMenuTable{background-color: rgba(255,255,255,0.8)!important; border: none!important; color: #000000!important;}.obliqueViewerWidgetDiv .dijitMenuItemHover,.obliqueViewerWidgetDiv .dijitMenuItemChecked,.obliqueViewerWidgetDiv .dijitMenuItemFocused,.obliqueViewerWidgetDiv .dijitMenuItemSelected{background-color: rgba(255,255,255,0.8)!important; background-image: none!important; border-color: rgba(255,255,255,0.8)!important; border-width: 1px 0 1px 0!important; padding: 2px!important; color: #000000!important;}.obliqueViewerWidgetDiv.dijitTooltipDialog{padding:0!important;}.obliqueViewerWidgetDiv .dijitTooltipConnector{display: none;}.obliqueViewerWidgetDiv .dijitTooltipContainer{padding: 0px!important; background-color: transparent!important; background-image: none!important; border: none!important; box-shadow: none!important;}#rasterListDiv{background-color: rgba(255,255,255,0.8)!important; border: none;}.obliqueRasterList .dgrid-row{border-bottom: 1px solid slategray; background: transparent!important;}.obliqueViewerWidgetDiv .dgrid-selected{background: rgba(255,255,255,0.8)!important;}',
"*now":function(c){c(['dojo/i18n!*preload*widgets/ObliqueViewer/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare jimu/BaseWidget esri/map esri/dijit/ObliqueViewer dojo/_base/lang dojo/dom dijit/form/Button dojo/_base/array esri/dijit/ImageServiceMeasure dijit/form/DropDownButton dijit/TooltipDialog dijit/form/ToggleButton esri/layers/ArcGISImageServiceLayer esri/symbols/PictureMarkerSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleLineSymbol esri/Color esri/graphic esri/geometry/geometryEngine esri/geometry/Point dojo/dom-style dojo/dom-class".split(" "),function(c,g,n,l,a,
b,k,h,w,f,q,m,z,t,s,u,r,v,x,y,B,D){return c([g],{baseClass:"jimu-widget-ObliqueViewer",name:"ObliqueViewer",imageServiceMeasureWidget:null,imageLayer:"",ovMap:null,startAzimuthAngle:0,startup:function(){this.inherited(arguments);var b=this._getLayerUrl(this.config.ObliqueViewer.layerTitle);this.imageLayer=new z(b);this.setImageLayerProperties();this.ovMap=new n("ovMap");this.own(this.imageLayer.on("load",a.hitch(this,this._addObliqueViewerWidget)));this.ovMap.addLayer(this.imageLayer);this.nativePointSymbol=
new t({angle:0,xoffset:2,yoffset:4,type:"esriPMS",url:"./widgets/ObliqueViewer/images/BlueShinyPin.png",contentType:"image/png",width:24,height:24});this.obliqueExtentSymbol=(new s).setOutline((new u).setColor(new r("red")).setWidth(2)).setColor(new r([0,0,0,0]))},setImageLayerProperties:function(){this.renderingRule&&this.imageLayer.setRenderingRule(this.renderingRule);this.mosaicRule&&this.imageLayer.setMosaicRule(this.mosaicRule)},onOpen:function(){if(this.oblique){var a=x.buffer(this.map.extent.getCenter(),
100,"meters").getExtent();this.oblique.locate(a)}else this._setInitialExtent()},_getRasterInfoFieldsObj:function(){var b=[],c=this.imageLayer.fields;h.forEach(this.config.ObliqueViewer.rasterInfoFields,function(f){h.forEach(c,function(c){if(c.name===f||c.alias===f)c.display=!0,b.push(a.clone(c))})},this);return b},_setInitialExtent:function(){var a=this.map.extent,a=new y((a.xmax+a.xmin)/2,(a.ymax+a.ymin)/2,a.spatialReference),a=x.buffer(a,100,"meters").getExtent();this.oblique?this.oblique.setExtent(a):
this.ovMap.setExtent(a)},_addObliqueViewerWidget:function(){this._addLocateButton();this._addClearButton();this._addZoomButton();this._addSyncButton();this._addTitlePane();this.oblique=new l({map:this.ovMap,imageServiceLayer:this.imageLayer,azimuthField:this.config.ObliqueViewer.azimuthField,elevationField:this.config.ObliqueViewer.elevationField,showThumbnail:this.config.ObliqueViewer.showThumbnail,rasterInfoFields:this._getRasterInfoFieldsObj(),rotationDiv:this.obliqueRotationDiv,azimuthAngle:this.startAzimuthAngle,
rasterListDiv:b.byId("rasterListDiv"),rasterListRefresh:this.dropDown.dropDown.open});this.measureWidget=new w({layer:this.imageLayer,map:this.ovMap,"class":"measureWidget",title:this.nls.measureWidgetLabel,displayOperations:["esriMensurationHeightFromBaseAndTop","esriMensurationHeightFromTopAndTopShadow","esriMensurationHeightFromBaseAndTopShadow"]},this.measureWidget);this.measureWidget.startup();this.own(this.measureWidget.measureToolbar.on("measure-end",a.hitch(this,this.publishMeasureResult)),
this.measureWidget.measureToolbar.on("unit-change",a.hitch(this,this.publishMeasureResult)),this.zoomButton.on("click",a.hitch(this,function(){this.oblique.zoomToSelectedImage()})),this.locateButton.on("change",a.hitch(this,this._locateClick)),this.clearButton.on("click",a.hitch(this,this._clearAll)),this.oblique.on("raster-select",a.hitch(this,this._closeDropDown)),this.oblique.on("azimuth-change",a.hitch(this,this._handleZoomButton)),this.oblique.on("extent-change",a.hitch(this,this._updateExtentOnNadirMap)));
this._addClassesToMenus();this.syncButton&&this.own(this.syncButton.on("click",a.hitch(this,this._updateNadirExtent,!0)))},_addClassesToMenus:function(){this.measureWidget&&(this.measureWidget._menu&&D.add(this.measureWidget._menu.domNode,"obliqueViewerWidgetDiv"),this.measureWidget.linearUnitMenu&&D.add(this.measureWidget.linearUnitMenu.domNode,"obliqueViewerWidgetDiv"))},publishMeasureResult:function(a){this.publishData({measureResult:a.measureResult})},_updateExtentOnNadirMap:function(a){this.obliqueExtentGraphic?
this.obliqueExtentGraphic.setGeometry(a.extent):this.obliqueExtentGraphic=this.map.graphics.add(new v(a.extent,this.obliqueExtentSymbol));!this.map.extent.contains(a.extent)&&this.config.ObliqueViewer.autoSync&&this._updateNadirExtent()},_updateNadirExtent:function(a){a?this.map.setExtent(this.map.extent.centerAt(this.oblique.nadirExtent.getCenter())):this.map.setExtent(this._getAdjustedExtent(this.map.extent,this.oblique.nadirExtent))},_getAdjustedExtent:function(b,c){if(b&&c){var f=0,g=0;b=a.clone(b);
c.xmax>b.xmax?f=c.xmax-b.xmax:c.xmin<b.xmin&&(f=c.xmin-b.xmin);c.ymax>b.ymax?g=c.ymax-b.ymax:c.ymin<b.ymin&&(g=c.ymin-b.ymin);return b.offset(f,g)}},_handleZoomButton:function(a){a=a.azimuth;null===a||"undefined"===typeof a?this.zoomButton.set("disabled",!0):this.zoomButton.set("disabled",!1)},_closeDropDown:function(){this.dropDown.closeDropDown()},_locateClick:function(b){var c;b?(this.map.setMapCursor("crosshair"),this.map.disableMapNavigation(),this.map.setInfoWindowOnClick(!1),this.own(c=this.map.on("click",
a.hitch(this,function(a){c.remove();this.map.enableMapNavigation();this.map.setInfoWindowOnClick(!0);this.locateButton.set("checked",!1);this.map.setMapCursor("default");this._clearAll();this._addPoint(a.mapPoint)})))):(this.map.setMapCursor("default"),this.map.enableMapNavigation(),this.map.setInfoWindowOnClick(!0),c&&c.remove())},_clearAll:function(){this.map.graphics.clear();delete this.obliqueExtentGraphic},_addPoint:function(a){var b=x.buffer(a,100,"meters").getExtent();this.oblique.locate(b);
this.map.graphics.add(new v(a,this.nativePointSymbol))},_addTitlePane:function(){var b=new q({content:'\x3cdiv id\x3d"rasterListDiv"\x3e\x3c/div\x3e'});this.dropDown=new f({label:this.nls.rasterListLabel,showLabel:!1,iconClass:"rastersListIcon",dropDown:b},this.listTitlePaneDiv);this.own(b.on("open",a.hitch(this,this._enableRasterList)),b.on("close",a.hitch(this,this._disableRasterList)));this.dropDown.startup();D.add(b.domNode,"obliqueViewerWidgetDiv")},_disableRasterList:function(){this.oblique.set("rasterListRefresh",
!1)},_enableRasterList:function(){this.oblique.set("rasterListRefresh",!0)},_addZoomButton:function(){this.zoomButton=new k({showLabel:!1,iconClass:"zoomIcon",label:this.nls.zoomButtonLabel,disabled:!1,"class":"zoomButtonContainer"},this.zoomButtonContainer)},_addLocateButton:function(){this.locateButton=new m({showLabel:!1,iconClass:"locateIcon",label:this.nls.locateButtonLabel,"class":"locateButtonContainer"},this.locateButtonContainer)},_addClearButton:function(){this.clearButton=new k({showLabel:!1,
iconClass:"clearIcon",label:this.nls.clearButtonLabel,"class":"clearButtonContainer"},this.clearButtonContainer)},_addSyncButton:function(){this.config.ObliqueViewer.autoSync?B.set(this.syncButtonContainer,"display","none"):this.syncButton=new k({showLabel:!1,iconClass:"syncIcon",label:this.nls.syncButtonLabel,"class":"syncButtonContainer"},this.syncButtonContainer)},onClose:function(){this._clearAll()},_getLayerUrl:function(a){var b=this.map.itemInfo.itemData.operationalLayers,c,f,g;for(c in b)b.hasOwnProperty(c)&&
b[c].title===a&&(g=b[c],f=g.url,this.renderingRule=g.layerObject.renderingRule,this.mosaicRule=g.layerObject.mosaicRule);return f}})});