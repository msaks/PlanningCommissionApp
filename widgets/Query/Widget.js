// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/Query/TaskSetting":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./TaskSetting.html dojo/on dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/promise/all jimu/filterUtils jimu/dijit/FilterParameters ./utils ./SingleQueryLoader ./SpatialFilterByDrawing jimu/dijit/SpatialFilterByFeatures esri/tasks/query".split(" "),function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w,u,m,x,r){return l([n,
p,k,c],{baseClass:"query-task-setting",templateString:e,askForValues:!1,_defaultRelationship:"SPATIAL_REL_INTERSECTS",nls:null,map:null,currentAttrs:null,layerInfosObj:null,postCreate:function(){this.inherited(arguments);this._initSelf()},run:function(){var m=this._getCleanClonedCurrentAttrs(this.currentAttrs);m.query.relationship=this._getRestRelationship();var b=this.getWhere(),q=this.getGeometry();a([b,q]).then(d.hitch(this,function(a){this.deactivate();m.query.where=a[0];m.query.geometry=a[1];
m.query.geometry||console.log("Don't use geometry to query.");if("function"===typeof this.onApply)this.onApply(m)}),d.hitch(this,function(a){console.error(a)}))},_getCleanClonedCurrentAttrs:function(a){var m=u.getCleanCurrentAttrsTemplate(),b=null,q;for(q in a)"queryTr"!==q&&"query"!==q&&(b=a[q],m[q]=d.clone(b));m.queryTr=a.queryTr;return m},onGetQueryResponse:function(){this.deactivate();this._tryResetSpatialFilterByDrawing();this._tryResetSpatialFilterByFeatures()},getWhere:function(){var a=new h,
m=this._getWhereInfo();if(1===m.status){var b=this.currentAttrs.config.webMapLayerId;if(b){var q=null,q=w.isTable(this.currentAttrs.layerInfo)?this.layerInfosObj.getTableInfoById(b):this.layerInfosObj.getLayerInfoById(b),b="";q&&(b=q.getFilter());q=m.where;b&&(q="("+b+") AND ("+m.where+")");a.resolve(q)}else a.resolve(m.where)}else a.reject("Can't get a valid sql");return a},_getWhereInfo:function(){var a={status:0,where:""};if(this.askForValues){var m=this.filterParams.getFilterExpr();m&&"string"===
typeof m?(a.status=1,a.where=m):(a.status=-1,a.where=null)}else a.status=1,a.where=this.currentAttrs.config.filter.expr;1===a.status&&!a.where&&(a.where="1\x3d1");return a},getGeometry:function(){var a=new h,m=this.spatialTypeSelect.get("value");"currentMapExtent"===m?a.resolve(this.map.extent):"drawing"===m?(m=this.spatialFilterByDrawing.getGeometryInfo(),0>m.status?a.reject("Invalid search distance"):(0===m.status&&console.log("User doesn't draw anything"),a.resolve(m.geometry))):"useFeatures"===
m?this.spatialFilterByFeatures.getGeometryInfo().then(d.hitch(this,function(m){-2===m.status?a.reject("Invalid search distance"):(-1===m.status?console.log("User doesn't select a layer"):0===m.status&&console.log("User doesn't select any features"),a.resolve(m.geometry))}),d.hitch(this,function(m){a.reject(m)})):a.resolve(null);return a},deactivate:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.deactivate();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.deactivate()},
clearAllGraphics:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.clearAllGraphics();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.clearAllGraphics()},canAutoRunning:function(){return this._canAttributeFilterAutoRunning()&&this._canSpatialFilterAutoRunning()},_canAttributeFilterAutoRunning:function(){return 0<this._getWhereInfo().status&&!this.askForValues},_canSpatialFilterAutoRunning:function(){var a=this.spatialTypeSelect.getOptions()||[];return 0===a.length?!0:
1===a.length?(a=this.spatialTypeSelect.get("value"),"drawing"!==a&&"useFeatures"!==a):!1},_initSelf:function(){var a=this.currentAttrs.layerInfo;this.taskNameDiv.innerHTML=this.currentAttrs.config.name||"";this.taskNameDiv.title=this.taskNameDiv.innerHTML;this.filterParams=new s;this.filterParams.placeAt(this.sqlDiv,"before");var e=d.clone(this.currentAttrs.config.filter);this.filterParams.build(this.currentAttrs.config.url,this.currentAttrs.layerInfo,e);this.askForValues=(new q).isAskForValues(this.currentAttrs.config.filter);
e=!0;this.askForValues?(e=!0,this.currentAttrs.config.filter.expr&&(this.sqlDiv.innerHTML=this.currentAttrs.config.filter.expr),this.own(f(this.filterParams,"change",d.hitch(this,function(a){this.sqlDiv.innerHTML="";a&&(this.sqlDiv.innerHTML=a)})))):(e=this.currentAttrs.config.showSQL?"1\x3d1"!==this.currentAttrs.config.filter.expr:!1,this.sqlDiv.innerHTML=this.currentAttrs.config.filter.expr);this.currentAttrs.config.showSQL?g.removeClass(this.sqlDiv,"not-visible"):g.addClass(this.sqlDiv,"not-visible");
e?g.removeClass(this.attributesSectionDiv,"not-visible"):g.addClass(this.attributesSectionDiv,"not-visible");var c=this.currentAttrs.config.spatialFilter,r=null;c||(c={});w.isTable(a)&&(c={});c.currentMapExtent&&(r={value:"currentMapExtent",label:this.nls.useCurrentExtentTip},this.spatialTypeSelect.addOption(r),c.currentMapExtent["default"]&&this.spatialTypeSelect.set("value",r.value));c.drawing&&(r={value:"drawing",label:this.nls.useDrawGraphicTip},this.spatialTypeSelect.addOption(r),c.drawing["default"]&&
this.spatialTypeSelect.set("value",r.value),r=c.drawing.buffer,this.spatialFilterByDrawing=new m({drawBoxOption:{map:this.map,geoTypes:c.drawing.geometryTypes},nls:this.nls,enableBuffer:!!r,distance:d.getObject("defaultDistance",!1,r)||0,unit:d.getObject("defaultUnit",!1,r)||""}),this.spatialFilterByDrawing.placeAt(this.drawingSection));c.useFeatures&&(r={value:"useFeatures",label:this.nls.useFeaturesTip},this.spatialTypeSelect.addOption(r),c.useFeatures["default"]&&this.spatialTypeSelect.set("value",
r.value),r=c.useFeatures.buffer,this.spatialFilterByFeatures=new x({map:this.map,nls:this.nls,enableBuffer:!!r,distance:d.getObject("defaultDistance",!1,r)||0,unit:d.getObject("defaultUnit",!1,r)||"",showLoading:!1}),this.spatialFilterByFeatures.tipNode&&g.setStyle(this.spatialFilterByFeatures.tipNode,"display","block"),this.spatialFilterByFeatures.placeAt(this.featuresSection),this.own(f(this.spatialFilterByFeatures,"loading",d.hitch(this,function(){this.domNode&&this.shelter.show()}))),this.own(f(this.spatialFilterByFeatures,
"unloading",d.hitch(this,function(){this.domNode&&this.shelter.hide()}))),(r=c.useFeatures.relationships)&&0<r.length?b.forEach(r,d.hitch(this,function(a){this.relationshipSelect.addOption({value:a.relationship,label:a.label})})):this.relationshipSelect.addOption({value:this._defaultRelationship,label:this._defaultRelationship}));c.fullLayerExtent&&(r={value:"fullLayerExtent",label:this.nls.noSpatialLimitTip},this.spatialTypeSelect.addOption(r),c.fullLayerExtent["default"]&&this.spatialTypeSelect.set("value",
r.value));c=!0;r=this.spatialTypeSelect.getOptions()||[];0===r.length?(c=!1,this.spatialFilterTip.innerHTML=this.nls.noSpatialLimitTip):1===r.length?(c="fullLayerExtent"!==r[0].value,this.spatialFilterTip.innerHTML=r[0].label,g.addClass(this.spatialTypeSelect.domNode,"not-visible")):c=!0;w.isTable(a)&&(c=!1);c?g.removeClass(this.spatialSectionDiv,"not-visible"):g.addClass(this.spatialSectionDiv,"not-visible");this._onSpatialTypeSelectChanged();!e&&!c&&g.removeClass(this.noFilterTip,"not-visible")},
_getConstantRelationship:function(){var a=this._defaultRelationship;"useFeatures"===this.spatialTypeSelect.get("value")&&(a=this.relationshipSelect.get("value"));return a},_getRestRelationship:function(){var a=this._getConstantRelationship();return r[a]},_onSpatialTypeSelectChanged:function(){var a=this.spatialTypeSelect.get("value");"drawing"===a?g.setStyle(this.drawingSection,"display","block"):(g.setStyle(this.drawingSection,"display","none"),this._tryResetSpatialFilterByDrawing());"useFeatures"===
a?g.setStyle(this.featuresSection,"display","block"):(g.setStyle(this.featuresSection,"display","none"),this._tryResetSpatialFilterByFeatures());this.spatialTypeSelect.domNode.title="";if(a&&(a=this.spatialTypeSelect.getOptions(a)))this.spatialTypeSelect.domNode.title=a.label},_tryResetSpatialFilterByDrawing:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.reset()},_tryResetSpatialFilterByFeatures:function(){this.spatialFilterByFeatures&&this.spatialFilterByFeatures.reset()},_onBtnParamsBackClicked:function(){this._tryResetSpatialFilterByDrawing();
this._tryResetSpatialFilterByFeatures();if("function"===typeof this.onBack)this.onBack()},_onBtnApplyClicked:function(){this.run()}})})},"jimu/dijit/FilterParameters":function(){define("dojo/on dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/_base/array dojo/query dijit/registry jimu/filterUtils jimu/utils ./_SingleFilterParameter".split(" "),function(l,n,p,k,c,e,f,h,d,g,b,a,q,s){return p([k,c,e,n],{baseClass:"jimu-filter-parameters",
templateString:'\x3cdiv\x3e\x3ctable style\x3d"width:100%;border-collapse:collapse;"\x3e\x3ctbody data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e',nls:null,partsObj:null,layerInfo:null,OPERATORS:null,url:null,_filterUtils:null,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this._filterUtils=new a;this.OPERATORS=f.clone(this._filterUtils.OPERATORS)},destroy:function(){this.clear();this._filterUtils=null;this.inherited(arguments)},getFilterExpr:function(a){void 0===
a&&(a=!0);for(var d=this.partsObj,m=this._getAllInteractiveSinglePartArray(d),s=0;s<m.length;s++){var f=m[s],c=f.spId;if(c&&(c=g("#"+c,this.tbody)[0])){c=b.byNode(c).getValueObj(a);if(!c)return null;f.valueObj=c}}this._filterUtils.isHosted=q.isHostedService(this.url);return this._filterUtils.getExprByFilterObj(d)},clear:function(){this.url=null;var a=g(".jimu-widget-query-single-parameter",this.tbody);d.forEach(a,f.hitch(this,function(a){b.byNode(a).destroy()}));h.empty(this.tbody);this.layerInfo=
this.partsObj=null},build:function(a,b,m){this.clear();this.url=a;this.layerInfo=b;this.partsObj=f.clone(m);a=this._getAllInteractiveSinglePartArray(this.partsObj);d.forEach(a,f.hitch(this,function(a){var m=h.create("tr",{innerHTML:"\x3ctd\x3e\x3c/td\x3e"},this.tbody),m=g("td",m)[0],b=this._getFieldInfo(a.fieldObj.name,this.layerInfo),b=new s({nls:this.nls,part:a,fieldInfo:b,OPERATORS:this.OPERATORS,url:this.url});this.own(l(b,"change",f.hitch(this,this._onSingleFilterParameterChanged)));b.placeAt(m);
b.startup();a.spId=b.id}))},_getFieldInfo:function(a,b){for(var m=b.fields,q=0;q<m.length;q++){var d=m[q];if(a===d.name)return d}return null},_getAllInteractiveSinglePartArray:function(a){for(var b=[],m=0;m<a.parts.length;m++){var q=a.parts[m];if(q.parts)for(var d=0;d<q.parts.length;d++){var s=q.parts[d];s.interactiveObj&&b.push(s)}else q.interactiveObj&&b.push(q)}return b},_onSingleFilterParameterChanged:function(){this.emit("change",this.getFilterExpr(!1))}})})},"jimu/dijit/_SingleFilterParameter":function(){define("dojo/on dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilterParameter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/store/Memory jimu/utils dijit/form/FilteringSelect dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/NumberTextBox".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b){return n([p,k,c],{baseClass:"jimu-single-filter-parameter",templateString:e,fieldInfo:null,part:null,nls:null,OPERATORS:null,url:null,_type:-1,postCreate:function(){this.inherited(arguments);var a=new g({idProperty:"id",data:[]});this.stringUniqueValuesSelect.set("store",a);a=new g({idProperty:"id",data:[]});this.numberUniqueValuesSelect.set("store",a);this.fieldInfo&&this.part&&this.build(this.fieldInfo,this.part);var b=["dijit.form.FilteringSelect","dijit.form.ValidationTextBox",
"dijit.form.DateTextBox","dijit.form.NumberTextBox"];this._attachPoints&&0<this._attachPoints.length&&d.forEach(this._attachPoints,f.hitch(this,function(a){(a=this[a])&&a.domNode&&0<=b.indexOf(a.declaredClass)&&this.own(l(a,"change",f.hitch(this,this._onDijitChanged)))}))},getValueObj:function(a){var b=null,d=this.part.fieldObj.shortType;"string"===d?b=this._getStirngValueObj(a):"number"===d?b=this._getNumberValueObj(a):"date"===d&&(b=this._getDateValueObj(a));b&&(b.type=this.part.valueObj.type,b.isValid=
!0);return b},_getStirngValueObj:function(a){var b=null;if(1===this._type){if(!this.stringTextBox.validate())return a&&this._showValidationErrorTip(this.stringTextBox),null;b={};b.value=this.stringTextBox.get("value")}else if(2===this._type){if(!this.stringCodedValuesFS.validate())return a&&this._showValidationErrorTip(this.stringCodedValuesFS),null;b={};a=this._getSelectedFilteringItem(this.stringCodedValuesFS);b.value=a.code}else if(3===this._type){if(!this.stringUniqueValuesSelect.validate())return a&&
this._showValidationErrorTip(this.stringUniqueValuesSelect),null;b={};a=this._getSelectedFilteringItem(this.stringUniqueValuesSelect);b.value=a.value}return b},_getNumberValueObj:function(a){var b=null;if(1===this._type){if(!this.numberTextBox.validate())return a&&this._showValidationErrorTip(this.numberTextBox),null;b={};b.value=parseFloat(this.numberTextBox.get("value"))}else if(2===this._type){if(!this.numberCodedValuesFS.validate())return a&&this._showValidationErrorTip(this.numberCodedValuesFS),
null;b={};a=this._getSelectedFilteringItem(this.numberCodedValuesFS);b.value=parseFloat(a.code)}else if(3===this._type){if(!this.numberTextBox1.validate())return a&&this._showValidationErrorTip(this.numberTextBox1),null;if(!this.numberTextBox2.validate())return a&&this._showValidationErrorTip(this.numberTextBox2),null;b={};b.value1=parseFloat(this.numberTextBox1.get("value"));b.value2=parseFloat(this.numberTextBox2.get("value"))}else if(4===this._type){if(!this.numberUniqueValuesSelect.validate())return a&&
this._showValidationErrorTip(this.numberUniqueValuesSelect),null;b={};a=this.numberUniqueValuesSelect.get("item");b.value=parseFloat(a.value)}return b},_getDateValueObj:function(a){var b=null;if(1===this._type){if(!this.dateTextBox.validate())return a&&this._showValidationErrorTip(this.dateTextBox),null;b={};b.value=this.dateTextBox.get("value").toDateString()}else if(2===this._type){if(!this.dateTextBox1.validate())return a&&this._showValidationErrorTip(this.dateTextBox1),null;if(!this.dateTextBox2.validate())return a&&
this._showValidationErrorTip(this.dateTextBox2),null;b={};b.value1=this.dateTextBox1.get("value").toDateString();b.value2=this.dateTextBox2.get("value").toDateString()}return b},build:function(a,b){this.fieldInfo=a;this.part=b;var d=b.interactiveObj;d&&(this.promptNode.innerHTML=d.prompt||"",this.hintNode.innerHTML=d.hint||"");d=this.part.fieldObj.shortType;"string"===d?this._buildString(a,this.part):"number"===d?this._buildNumber(a,this.part):"date"===d&&this._buildDate(a,this.part)},_getCodedValues:function(a){var b=
null;if((a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length)b=a.codedValues;return b},_buildString:function(a,q){h.setStyle(this.stringTextBoxContainer,"display","block");h.setStyle(this.numberTextBoxContainer,"display","none");h.setStyle(this.dateTextBoxContainer,"display","none");this._hideDijit(this.stringTextBox);this._hideDijit(this.stringCodedValuesFS);this._hideDijit(this.stringUniqueValuesSelect);var c=q.fieldObj,e=q.valueObj,u=e.type,m=this._getCodedValues(a);m?(this._type=
2,this._showDijit(this.stringCodedValuesFS),u=d.map(m,f.hitch(this,function(a,b){var m=f.mixin({},a);m.id=b;return m})),m=new g({data:u}),this.stringCodedValuesFS.set("store",m),e&&(m=d.filter(u,f.hitch(this,function(a){return a.code===e.value})),0<m.length?this.stringCodedValuesFS.set("value",m[0].id):this.stringCodedValuesFS.set("value",u[0].id))):"unique"===u?(this._type=3,this._showDijit(this.stringUniqueValuesSelect),b.getUniqueValues(this.url,c.name).then(f.hitch(this,function(a){var b=-1;a=
d.map(a,f.hitch(this,function(a,m){var d=a;"number"===c.shortType&&(a=parseFloat(a),d=this._tryLocaleNumber(a));d={id:m,value:a,label:d};e&&e.value===a&&(b=m);return d}));this.stringUniqueValuesSelect.store.setData(a);0<=b&&(a=this.stringUniqueValuesSelect.store.get(b))&&this.stringUniqueValuesSelect.set("item",a)}),f.hitch(this,function(a){console.error(a)}))):(this._type=1,this._showDijit(this.stringTextBox),this.stringTextBox.set("value",e.value||""))},_tryLocaleNumber:function(a){var d=b.localizeNumber(a);
if(null===d||void 0===d)d=a;return d},_buildNumber:function(a,q){h.setStyle(this.stringTextBoxContainer,"display","none");h.setStyle(this.numberTextBoxContainer,"display","block");h.setStyle(this.dateTextBoxContainer,"display","none");this._hideDijit(this.numberTextBox);this._hideDijit(this.numberCodedValuesFS);h.setStyle(this.numberRangeTable,"display","none");this._hideDijit(this.numberUniqueValuesSelect);var c=q.fieldObj,e=q.valueObj,u=e.type,m=q.operator,x=m===this.OPERATORS.numberOperatorIsNotBetween;
if(m===this.OPERATORS.numberOperatorIsBetween||x)this._type=3,h.setStyle(this.numberRangeTable,"display","table"),b.isValidNumber(e.value1)&&this.numberTextBox1.set("value",e.value1),b.isValidNumber(e.value2)&&this.numberTextBox2.set("value",e.value2);else if(h.setStyle(this.numberRangeTable,"display","none"),m=this._getCodedValues(a))if(this._type=2,this._showDijit(this.numberCodedValuesFS),u=d.map(m,f.hitch(this,function(a,b){var m=f.clone(a);m.id=b;return m})),m=new g({data:u}),this.numberCodedValuesFS.set("store",
m),e&&b.isValidNumber(e.value)){var r=parseFloat(e.value),m=d.filter(u,f.hitch(this,function(a){return parseFloat(a.code)===r}));0<m.length?this.numberCodedValuesFS.set("value",m[0].id):this.numberCodedValuesFS.set("value",u[0].id)}else this.numberCodedValuesFS.set("value",u[0].id);else"unique"===u?(this._type=4,this._showDijit(this.numberUniqueValuesSelect),b.getUniqueValues(this.url,c.name).then(f.hitch(this,function(a){var b=-1;a=d.map(a,f.hitch(this,function(a,m){var d=a;"number"===c.shortType&&
(a=parseFloat(a),d=this._tryLocaleNumber(a));d={id:m,value:a,label:d};e&&e.value===a&&(b=m);return d}));this.numberUniqueValuesSelect.store.setData(a);0<=b&&(a=this.numberUniqueValuesSelect.store.get(b))&&this.numberUniqueValuesSelect.set("item",a)}),f.hitch(this,function(a){console.error(a)}))):(this._type=1,this._showDijit(this.numberTextBox),e&&b.isValidNumber(e.value)&&this.numberTextBox.set("value",e.value))},_buildDate:function(a,b){h.setStyle(this.stringTextBoxContainer,"display","none");h.setStyle(this.numberTextBoxContainer,
"display","none");h.setStyle(this.dateTextBoxContainer,"display","block");var d=b.valueObj,e=b.operator,c=e===this.OPERATORS.dateOperatorIsNotBetween;e===this.OPERATORS.dateOperatorIsBetween||c?(this._type=2,h.setStyle(this.dateRangeTable,"display","table"),this._hideDijit(this.dateTextBox),this.dateTextBox1.set("value",new Date(d.value1)),this.dateTextBox2.set("value",new Date(d.value2))):(this._type=1,h.setStyle(this.dateRangeTable,"display","none"),this._showDijit(this.dateTextBox),this.dateTextBox.set("value",
new Date(d.value)))},_getSelectedFilteringItem:function(a){if(a.validate()){var b=a.get("item");if(b)return b}this._showValidationErrorTip(a);return null},_showValidationErrorTip:function(a){!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),a.focusNode.blur())},_showDijit:function(a){a&&a.domNode&&h.setStyle(a.domNode,"display","inline-block")},_hideDijit:function(a){a&&a.domNode&&h.setStyle(a.domNode,"display","none")},_onRangeNumberBlur:function(){if(this.numberTextBox1.validate()&&this.numberTextBox2.validate()){var a=
parseFloat(this.numberTextBox1.get("value")),b=parseFloat(this.numberTextBox2.get("value"));a>b&&(this.numberTextBox1.set("value",b),this.numberTextBox2.set("value",a))}},_onRangeDateBlur:function(){if(this.dateTextBox1.validate()&&this.dateTextBox2.validate()){var a=this.dateTextBox1.get("value"),b=a.getTime(),d=this.dateTextBox2.get("value"),e=d.getTime();b>e&&(this.dateTextBox1.set("value",d),this.dateTextBox2.set("value",a))}},_onDijitChanged:function(){this.emit("change")}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(l,n,p,k,c){return l("dijit.form.FilteringSelect",[k,c],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(e,c,h,d){c&&c[this.searchAttr]!==this._lastQuery||!c&&e.length&&this.store.getIdentity(e[0])!=this._lastQuery||
(e.length?this.set("item",e[0],d):this.set("value","",d||void 0===d&&!this.focused,this.textbox.value,null))},_openResultList:function(e,c,h){c[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(c,f,h,d){this._onChangeActive||(f=null);if(void 0===d){if(null===c||""===c)if(c="",!n.isString(h)){this._setDisplayedValueAttr(h||"",f);
return}var g=this;this._lastQuery=c;p(this.store.get(c),function(b){g._callbackSetLabel(b?[b]:[],void 0,void 0,f)})}else this.valueNode.value=c,this.inherited(arguments,[c,f,h,d])},_setItemAttr:function(c,f,h){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(c){return c.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(c,f){null==c&&(c="");if(!this._created){if(!("displayedValue"in this.params))return;f=!1}if(this.store){this.closeDropDown();
var h=n.clone(this.query),d=this._getDisplayQueryString(c),g;this.store._oldAPI?g=d:(g=this._patternToRegExp(d),g.toString=function(){return d});this._lastQuery=h[this.searchAttr]=g;this._lastDisplayedValue=this.textbox.value=c;this._set("displayedValue",c);var b=this,a={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};n.mixin(a,this.fetchProperties);this._fetchHandle=this.store.query(h,a);p(this._fetchHandle,function(d){b._fetchHandle=null;b._callbackSetLabel(d||[],h,a,f)},function(a){b._fetchHandle=
null;b._cancelingQuery||console.error("dijit.form.FilteringSelect: "+a.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(l,n,p){return l("dijit.form.DateTextBox",p,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:n,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w,u,m){var x=k("dijit.Calendar",[q,s,w],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){h.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new x._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:g.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(b(this.domNode,"keydown",g.hitch(this,"_onKeyDown")),b(this.dateRowsNode,"mouseover",g.hitch(this,"_onDayMouseOver")),b(this.dateRowsNode,"mouseout",g.hitch(this,"_onDayMouseOut")),b(this.dateRowsNode,"mousedown",g.hitch(this,"_onDayMouseDown")),b(this.dateRowsNode,"mouseup",g.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=
new this.dateClassObj(this.currentFocus);b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var m=this.currentFocus.getDate();b.setDate(Math.min(m,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){if((a=e.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!e.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode))e.add(a,"dijitCalendarHoveredDate"),this._currentNode=a},_onDayMouseOut:function(a){this._currentNode&&
!(a.relatedTarget&&a.relatedTarget.parentNode==this._currentNode)&&(a="dijitCalendarHoveredDate",e.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),e.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){if((a=a.target.parentNode)&&a.dijitDateValue&&!e.contains(a,"dijitCalendarDisabledDate"))e.add(a,"dijitCalendarActiveDate"),this._currentNode=a},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&e.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,m,c=this.currentFocus;switch(a.keyCode){case d.RIGHT_ARROW:b=1;case d.LEFT_ARROW:m="day";this.isLeftToRight()||(b*=-1);break;case d.DOWN_ARROW:b=1;case d.UP_ARROW:m="week";break;case d.PAGE_DOWN:b=1;case d.PAGE_UP:m=a.ctrlKey||a.altKey?"year":"month";break;case d.END:c=this.dateModule.add(c,"month",1),m="day";case d.HOME:c=new this.dateClassObj(c);c.setDate(1);break;default:return!0}m&&(c=this.dateModule.add(c,m,b));this._setCurrentFocusAttr(c);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});x._MonthDropDownButton=k("dijit.Calendar._MonthDropDownButton",m,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new x._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(b){var m=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b);this.dropDown.set("months",
m);this.containerNode.innerHTML=(6==a("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+m[b.getMonth()]+"\x3c/div\x3e"}});x._MonthDropDown=k("dijit.Calendar._MonthDropDown",[s,u,w],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";l.forEach(a,function(a,b){f.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(c.get(a.target,"month"))},onChange:function(){}});return x})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w){var u=n("dijit.CalendarLite",[q,s],{templateString:w,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=e.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){a&&
(a=new this.dateClassObj(a),a.setHours(1,0,0,0));return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),d=this.dateModule.getDaysInMonth(a),c=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),q=new this.dateClassObj,e=0<=this.dayOffset?this.dayOffset:p.getFirstDayOfWeek(this.lang);e>b&&
(e-=7);if(!this.summary){var f=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",f[a.getMonth()])}this._date2cell={};l.forEach(this.dateCells,function(f,s){var t=s+e,z=new this.dateClassObj(a),v="dijitCalendar",g=0;t<b?(t=c-b+t+1,g=-1,v+="Previous"):t>=b+d?(t=t-b-d+1,g=1,v+="Next"):(t=t-b+1,v+="Current");g&&(z=this.dateModule.add(z,"month",g));z.setDate(t);this.dateModule.compare(z,q,"date")||(v="dijitCalendarCurrentDate "+v);this.isDisabledDate(z,
this.lang)?(v="dijitCalendarDisabledDate "+v,f.setAttribute("aria-disabled","true")):(v="dijitCalendarEnabledDate "+v,f.removeAttribute("aria-disabled"),f.setAttribute("aria-selected","false"));(g=this.getClassForDate(z,this.lang))&&(v=g+" "+v);f.className=v+"Month dijitCalendarDateTemplate";v=z.valueOf();this._date2cell[v]=f;f.dijitDateValue=v;this._setText(this.dateLabels[s],z.getDateLocalized?z.getDateLocalized(this.lang):z.getDate())},this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);
a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,d=new this.dateClassObj;l.forEach(["previous","current","next"],function(a){d.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(d,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?d.getObject(a.datePackage,!1):k;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?
d.getObject(a.datePackage+".locale",!1):c},_createMonthWidget:function(){return u._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var b=this.dowTemplateString,d=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),c=0<=this.dayOffset?this.dayOffset:p.getFirstDayOfWeek(this.lang);this.dayCellsHtml=a.substitute([b,b,b,b,b,b,b].join(""),{d:""},function(){return d[c++%7]});b=a.substitute(this.weekTemplateString,
{d:this.dateTemplateString});this.dateRowsHtml=[b,b,b,b,b,b].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);f.setSelectable(this.domNode,!1);b=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",b,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=d.hitch(this,function(a,b,m){this[a].dojoClick=!0;return g(this[a],"click",d.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,
b,m))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,d){var c=this.currentFocus,q=this._getNodeByDate(c);a=this._patchDate(a);this._set("currentFocus",a);if(!this._date2cell||0!=this.dateModule.difference(c,a,"month"))this._populateGrid(),this._populateControls(),this._markSelectedDates([this.value]);c=this._getNodeByDate(a);c.setAttribute("tabIndex",this.tabIndex);(this.focused||
d)&&c.focus();q&&q!=c&&(b("webkit")?q.setAttribute("tabIndex","-1"):q.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue;a=a.parentNode);a&&!h.contains(a,"dijitCalendarDisabledDate")&&this.set("value",a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,
d){h.toggle(d,"dijitCalendarSelectedDate",a);d.setAttribute("aria-selected",a?"true":"false")}l.forEach(this._selectedCells||[],d.partial(b,!1));this._selectedCells=l.filter(l.map(a,this._getNodeByDate,this),function(a){return a});l.forEach(this._selectedCells,d.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});u._MonthWidget=n("dijit.CalendarLite._MonthWidget",q,{_setMonthAttr:function(a){var d=this.dateLocaleModule.getNames("months","wide","standAlone",
this.lang,a),c=6==b("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+l.map(d,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=c+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+d[a.getMonth()]+"\x3c/div\x3e"}});return u})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(l,n,p,k,c,e,f,h){new Date("X");return k("dijit.form._DateTimeTextBox",[e,f],{templateString:h,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:n.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(d,c){var b=this._isInvalidDate(d),a=this._isInvalidDate(c);if(b||a)return b&&a?0:!b?1:-1;var b=this.format(d,this._unboundedConstraints),a=this.format(c,this._unboundedConstraints),
q=this.parse(b,this._unboundedConstraints),f=this.parse(a,this._unboundedConstraints);return b==a?0:l.compare(q,f,this._selector)},autoWidth:!0,format:function(d,c){return!d?"":this.dateLocaleModule.format(d,c)},parse:function(d,c){return this.dateLocaleModule.parse(d,c)||(this._isEmpty(d)?null:void 0)},serialize:function(d,c){d.toGregorian&&(d=d.toGregorian());return p.toISOString(d,c)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(d){d=
d||{};this.dateModule=d.datePackage?c.getObject(d.datePackage,!1):l;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=d.datePackage?c.getObject(d.datePackage+".locale",!1):n;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(d){d.selector=this._selector;d.fullYear=!0;var f=p.fromISOString;"string"==typeof d.min&&(d.min=f(d.min),this.dateClassObj instanceof Date||(d.min=new this.dateClassObj(d.min)));"string"==typeof d.max&&(d.max=f(d.max),this.dateClassObj instanceof Date||(d.max=new this.dateClassObj(d.max)));this.inherited(arguments);this._unboundedConstraints=c.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(d){return!d||
isNaN(d)||"object"!=typeof d||d.toString()==this._invalidDate},_setValueAttr:function(d,c,b){void 0!==d&&("string"==typeof d&&(d=p.fromISOString(d)),this._isInvalidDate(d)&&(d=null),d instanceof Date&&!(this.dateClassObj instanceof Date)&&(d=new this.dateClassObj(d)));this.inherited(arguments,[d,c,b]);this.value instanceof Date&&(this.filterString="");!1!==c&&this.dropDown&&this.dropDown.set("value",d,!1)},_set:function(d,c){if("value"==d){c instanceof Date&&!(this.dateClassObj instanceof Date)&&
(c=new this.dateClassObj(c));var b=this._get("value");if(b instanceof this.dateClassObj&&0==this.compare(c,b))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(d){this._isInvalidDate(d)&&(d=new this.dateClassObj);this._set("dropDownDefaultValue",d)},openDropDown:function(d){this.dropDown&&this.dropDown.destroy();var f=c.isString(this.popupClass)?c.getObject(this.popupClass,!1):this.popupClass,b=this,a=this.get("value");this.dropDown=new f({onChange:function(a){b.set("value",
a,!0)},id:this.id+"_popup",dir:b.dir,lang:b.lang,value:a,textDir:b.textDir,currentFocus:!this._isInvalidDate(a)?a:this.dropDownDefaultValue,constraints:b.constraints,filterString:b.filterString,datePackage:b.datePackage,isDisabledDate:function(a){return!b.rangeCheck(a,b.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(d,c){this._setValueAttr(this.parse(d,this.constraints),c,d)}})})},"widgets/Query/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred jimu/utils jimu/LayerInfos/LayerInfos esri/request".split(" "),
function(l,n,p,k,c,e){return{getDefaultPopupInfo:function(c,e,d){var g={title:"",fieldInfos:[],description:null,showAttachments:!1,mediaInfos:[]};d=!!d;if(c.displayField)g.title="{"+c.displayField+"}";else{var b=k.getObjectIdField(c);b&&(g.title="{"+b+"}")}g.showAttachments=!!c.hasAttachments;b=c=c.fields;e||(b=n.filter(c,l.hitch(this,function(a){return"esriFieldTypeGeometry"!==a.type})));e=n.map(b,l.hitch(this,function(a){a=k.getDefaultPortalFieldInfo(a);a.visible=d;return a}));g.fieldInfos=e;return g},
getPortalFieldInfosWithoutShape:function(c,e){return n.filter(e,l.hitch(this,function(d){return"esriFieldTypeGeometry"!==k.getFieldInfoByFieldName(c.fields,d.fieldName).type}))},getPopupInfoByAttributes:function(c,e){var d=this.getDefaultPopupInfo(c,!1),g=[],b={},a;for(a in e){g.push(a);var q=k.getFieldInfoByFieldName(c.fields,a).type;if("esriFieldTypeSingle"===q||"esriFieldTypeDouble"===q)q=e[a],null!==q&&void 0!==q&&(q=parseFloat(q),isNaN(q)||(q=q.toString().split("."),2===q.length&&(b[a]=q[1].length)));
d.fieldInfos=n.map(d.fieldInfos,l.hitch(this,function(a){var c=a.fieldName;b.hasOwnProperty(c)&&(a.format.places=b[c]);return g.indexOf(c)}))}return d},upgradePopupToPopupInfo:function(c,e){var d=this.getDefaultPopupInfo(c,!1,!1);d.title=e.title||"";d.title=d.title.replace("${","{");if(e.fields){var g={};n.forEach(e.fields,l.hitch(this,function(b){g[b.name]=b}));n.forEach(d.fieldInfos,l.hitch(this,function(b){var a=b.fieldName,c=g[a];c&&(b.label=c.alias||b.label,b.visible=!0,"image"===c.specialType&&
(a="{"+a+"}",d.mediaInfos.push({title:"",type:"image",caption:b.label,value:{sourceURL:a,linkURL:a}})))}))}return d},isImageServiceLayer:function(c){return c.url&&-1<c.url.indexOf("/ImageServer")},isTable:function(c){return"Table"===c.type},getConfigWithValidDataSource:function(e){var h={queries:[]},d=c.getInstanceSync();h.queries=n.filter(e.queries,l.hitch(this,function(c){return(c=c.webMapLayerId)?d.getLayerInfoById(c)?!0:!!d.getTableInfoById(c):!0}));return h},removePopupInfoUnsupportFields:function(c,
e){var d=n.map(c.fields,l.hitch(this,function(c){return c.name}));e.fieldInfos&&0<e.fieldInfos.length&&(e.fieldInfos=n.filter(e.fieldInfos,l.hitch(this,function(c){return 0<=d.indexOf(c.fieldName)})))},overridePopupTemplateMethodGetAttachments:function(c,h,d){c.getAttachments=function(c){var b=new p;try{var a=c.attributes[d],q=h+"/"+a+"/attachments";e({url:q,content:{f:"json"},callbackParamName:"callback"}).then(function(c){c=c.attachmentInfos;n.forEach(c,function(b){b.url=q+"/"+b.id;b.objectId=a});
b.resolve(c)},function(a){b.reject(a)})}catch(f){console.error(f)}return b}}}})},"widgets/Query/SingleQueryLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred jimu/utils esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer esri/tasks/RelationshipQuery".split(" "),function(l,n,p,k,c,e,f,h,d){function g(){return{queryTr:null,config:null,layerInfo:null,relationshipLayerInfos:null,relationshipPopupTemplates:null,queryType:-1,query:{maxRecordCount:1E3,
resultLayer:null,where:"",geometry:null,relationship:null,nextIndex:0,allCount:0,objectIds:[]}}}l=l(null,{tempResultLayer:null,map:null,currentAttrs:null,constructor:function(b,a){this.map=b;this.currentAttrs=a},resetCurrentAttrs:function(){this.currentAttrs=g()},getCurrentAttrs:function(){return this.currentAttrs},executeQueryForFirstTime:function(){var b=null,b=this.currentAttrs.query.where,a=this.currentAttrs.query.geometry;return b=1===this.currentAttrs.queryType?this.doQuery_SupportOrderByAndPagination(b,
a):2===this.currentAttrs.queryType?this.doQuery_SupportObjectIds(b,a):this.doQuery_NotSupportObjectIds(b,a)},executeQueryWhenScrollToBottom:function(){var b=null;1===this.currentAttrs.queryType?b=this.onResultsScroll_SupportOrderByAndPagination():2===this.currentAttrs.queryType&&(b=this.onResultsScroll_SupportObjectIds());return b},_isServiceSupportsOrderBy:function(b){var a=!1;b.advancedQueryCapabilities&&b.advancedQueryCapabilities.supportsOrderBy&&(a=!0);return a},_isServiceSupportsPagination:function(b){var a=
!1;b.advancedQueryCapabilities&&b.advancedQueryCapabilities.supportsPagination&&(a=!0);return a},_tryLocaleNumber:function(b){var a=c.localizeNumber(b);if(null===a||void 0===a)a=b;return a},_tryLocaleDate:function(b){var a=c.localizeDate(b);a||(a=b.toLocaleDateString());return a},_getLayerIndexByLayerUrl:function(b){var a=b.lastIndexOf("/");b=b.slice(a+1,b.length);return parseInt(b,10)},_getServiceUrlByLayerUrl:function(b){var a=b.lastIndexOf("/");return b.slice(0,a)},_isSupportObjectIds:function(b){var a=
0;b.currentVersion&&(a=parseFloat(b.currentVersion));return 10<=a||b.hasOwnProperty("typeIdField")},_isImageServiceLayer:function(b){return-1<b.indexOf("/ImageServer")},_isTable:function(b){return"Table"===b.type},_getBestQueryName:function(b){for(var a=b=b?b+(" _"+this.nls.queryResult):b+this.nls.queryResult,c=p.map(this.map.graphicsLayerIds,n.hitch(this,function(a){return this.map.getLayer(a).name})),d=2;0<=p.indexOf(c,a);)a=b+"_"+d,d++;return a},doQuery_SupportOrderByAndPagination:function(b,a){var c=
new k,d=n.hitch(this,function(a){console.error(a);c.reject(a)}),e=this.currentAttrs.query.relationship;this._queryCount(b,a,e).then(n.hitch(this,function(f){this.currentAttrs.query.allCount=f;0===f?c.resolve([]):(this.currentAttrs.query.nextIndex=0,this._queryWithPaginationAndOrder(b,a,0,this.currentAttrs.query.maxRecordCount,e).then(n.hitch(this,function(a){a=a.features;this.currentAttrs.query.nextIndex+=a.length;c.resolve(a)}),d))}),d);return c},onResultsScroll_SupportOrderByAndPagination:function(){var b=
new k,a=this.currentAttrs.query.nextIndex;if(a>=this.currentAttrs.query.allCount)return b.resolve([]),b;var c=n.hitch(this,function(a){console.error(a);b.reject(a)});this._queryWithPaginationAndOrder(this.currentAttrs.query.where,this.currentAttrs.query.geometry,a,this.currentAttrs.query.maxRecordCount,this.currentAttrs.query.relationship).then(n.hitch(this,function(a){a=a.features;this.currentAttrs.query.nextIndex+=a.length;b.resolve(a)}),c);return b},doQuery_SupportObjectIds:function(b,a){var c=
new k,d=n.hitch(this,function(a){console.error(a);c.reject(a)}),e=this.currentAttrs.query.relationship;this._queryIds(b,a,e).then(n.hitch(this,function(a){if(a&&0<a.length){var b=this.currentAttrs.query.allCount=a.length;this.currentAttrs.query.objectIds=a;this.currentAttrs.query.nextIndex=0;var f=this.currentAttrs.query.maxRecordCount,h=[],h=b>f?a.slice(0,f):a;this._queryByObjectIds(h,!0,e).then(n.hitch(this,function(a){a=a.features;this.currentAttrs.query.maxRecordCount=a.length;this.currentAttrs.query.nextIndex+=
a.length;c.resolve(a)}),n.hitch(this,function(a){d(a)}))}else this.currentAttrs.query.allCount=0,c.resolve([])}),d);return c},onResultsScroll_SupportObjectIds:function(){var b=new k,a=this.currentAttrs.query.objectIds,c=this.currentAttrs.query.nextIndex;if(c>=this.currentAttrs.query.allCount)b.resolve([]);else{var d=Math.min(a.length-c,this.currentAttrs.query.maxRecordCount),a=a.slice(c,c+d);if(0===a.length)b.resolve([]);else return this._queryByObjectIds(a,!0,this.currentAttrs.query.relationship).then(n.hitch(this,
function(a){a=a.features;this.currentAttrs.query.nextIndex+=a.length;b.resolve(a)}),n.hitch(this,function(a){b.reject(a)})),b}},doQuery_NotSupportObjectIds:function(b,a){var c=new k;this._query(b,a,!0,this.currentAttrs.query.relationship).then(n.hitch(this,function(a){a=a.features;this.currentAttrs.query.allCount=a.length;c.resolve(a)}),n.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_getObjectIdField:function(){return this.currentAttrs.config.objectIdField},getOutputFields:function(){var b=
[],a=[];a.push(this.currentAttrs.config.objectIdField);var c=this._getRequiredFieldNames(),a=a.concat(c),c=this._getPopupInfoFieldNames(),a=a.concat(c);p.forEach(a,n.hitch(this,function(a){0>b.indexOf(a)&&b.push(a)}));return b},_getRequiredFieldNames:function(){var b=n.clone(this.currentAttrs.layerInfo);return(new h({layerDefinition:b,featureSet:null})).getOutFields()},_getPopupInfoFieldNames:function(){var b=[],a=[],c=p.filter(this.currentAttrs.layerInfo.fields,n.hitch(this,function(a){return"esriFieldTypeGeometry"!==
a.type})),d=this.currentAttrs.config.popupInfo,a=a.concat(this._getPlaceholderFieldNames(c,d.title));d.description?a=a.concat(this._getPlaceholderFieldNames(c,d.description)):d.fieldInfos&&0<d.fieldInfos.length&&p.forEach(d.fieldInfos,n.hitch(this,function(b){b.visible&&a.push(b.fieldName)}));d.mediaInfos&&0<d.mediaInfos.length&&p.forEach(d.mediaInfos,n.hitch(this,function(b){a=a.concat(this._getPlaceholderFieldNames(c,b.title));a=a.concat(this._getPlaceholderFieldNames(c,b.caption));if(b=b.value){var d=
b.fields;d&&0<d.length&&p.forEach(d,n.hitch(this,function(b){a.push(b)}));b.normalizeField&&a.push(b.normalizeField);b.tooltipField&&a.push(b.tooltipField);b.sourceURL&&(a=a.concat(this._getPlaceholderFieldNames(c,b.sourceURL)));b.linkURL&&(a=a.concat(this._getPlaceholderFieldNames(c,b.linkURL)))}}));p.forEach(a,n.hitch(this,function(a){0>b.indexOf(a)&&b.push(a)}));return b},_getPlaceholderFieldNames:function(b,a){var c=[];if(a){var d=[];p.forEach(b,n.hitch(this,function(b){b=b.name;0<=a.indexOf("{"+
b+"}")&&d.push(b)}));p.forEach(d,n.hitch(this,function(a){0>c.indexOf(a)&&c.push(a)}))}return c},_query:function(b,a,c,d){var h=new e;h.where=b;a&&(h.geometry=a);h.outSpatialReference=this.map.spatialReference;h.returnGeometry=!!c;h.spatialRelationship=d;h.outFields=this.getOutputFields();return(new f(this.currentAttrs.config.url)).execute(h)},_queryIds:function(b,a,c){var d=new e;d.where=b;a&&(d.geometry=a);d.returnGeometry=!1;d.spatialRelationship=c;d.outSpatialReference=this.map.spatialReference;
return(new f(this.currentAttrs.config.url)).executeForIds(d)},_queryByObjectIds:function(b,a,c){var d=new k,h=new e;h.returnGeometry=!!a;h.outSpatialReference=this.map.spatialReference;h.outFields=this.getOutputFields();h.objectIds=b;h.spatialRelationship=c;(new f(this.currentAttrs.config.url)).execute(h).then(n.hitch(this,function(a){d.resolve(a)}),n.hitch(this,function(e){if(400===e.code){var m=this._getObjectIdField(),f="",h=b.length;p.forEach(b,n.hitch(this,function(a,b){f+=m+" \x3d "+a;b!==h-
1&&(f+=" OR ")}));this._query(f,null,a,c).then(n.hitch(this,function(a){d.resolve(a)}),n.hitch(this,function(a){d.reject(a)}))}else d.reject(e)}));return d},_queryCount:function(b,a,c){var d=new e;d.where=b;a&&(d.geometry=a);d.returnGeometry=!1;d.outSpatialReference=this.map.spatialReference;d.spatialRelationship=c;return(new f(this.currentAttrs.config.url)).executeForCount(d)},_queryWithPaginationAndOrder:function(b,a,c,d,h){var g=new e;g.where=b;a&&(g.geometry=a);g.outSpatialReference=this.map.spatialReference;
g.returnGeometry=!0;g.spatialRelationship=h;g.outFields=this.getOutputFields();g.start=c;g.num=d;if((b=this.currentAttrs.config.orderByFields)&&0<b.length)g.orderByFields=b,b=p.map(b,n.hitch(this,function(a){return a.split(" ")[0]})),p.forEach(b,n.hitch(this,function(a){0>g.outFields.indexOf(a)&&g.outFields.push(a)}));return(new f(this.currentAttrs.config.url)).execute(g)},_getCurrentRelationships:function(){return this.currentAttrs.layerInfo.relationships||[]},_queryRelatedFeaturesById:function(b){var a=
[],c=this._getCurrentRelationships();if(c&&0<c.length){var e=new f(this.currentAttrs.config.url);p.forEach(c,n.hitch(this,function(c){var f=new d;f.objectIds=b;f.relationshipId=c.id;var m=p.map(c.fields,function(a){return a.name});f.outFields=m;f.returnGeometry=!1;f=e.executeRelationshipQuery(f);a.push({relationshipId:c.id,promise:f})}))}return a},_findRelationshipInfo:function(b){for(var a=this._getCurrentRelationships(),c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null},_findRelationshipFields:function(b){var a=
[];if(b=this._findRelationshipInfo(b))a=b.fields;return a}});l.getCleanCurrentAttrsTemplate=g;return l})},"widgets/Query/SpatialFilterByDrawing":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/on dojo/Evented dojo/_base/html dojo/_base/lang jimu/symbolUtils jimu/dijit/DrawBox jimu/dijit/SearchDistance esri/graphic esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/geometry/geometryEngine".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w,u){return l([n,p,k,e],{baseClass:"jimu-query-spatial-filter-drawing",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"drawBoxDiv"\x3e\x3c/div\x3e\x3cdiv class\x3d"search-distance-div" data-dojo-attach-point\x3d"searchDistanceDiv"\x3e\x3c/div\x3e\x3c/div\x3e',map:null,bufferLayer:null,drawBoxOption:null,nls:null,enableBuffer:!0,distance:0,unit:"",postCreate:function(){this.inherited(arguments);this.map=this.drawBoxOption.map;this.bufferLayer=new s;
var a=q.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}}),e=new w(a);this.bufferLayer.setRenderer(e);this.map.addLayer(this.bufferLayer);this.drawBoxOption.showClear=!0;this.drawBoxOption.keepOneGraphic=!0;this.drawBox=new g(this.drawBoxOption);this.drawBox.setPolygonSymbol(a);a=d.getGreyPinMarkerSymbol();this.drawBox.setPointSymbol(a);this.drawBox.setLineSymbol(q.fromJson({color:[79,129,189,255],width:1.5,
type:"esriSLS",style:"esriSLSDash"}));this.drawBox.placeAt(this.drawBoxDiv);this.own(c(this.drawBox,"user-clear",h.hitch(this,this._onDrawBoxClear)));this.own(c(this.drawBox,"draw-end",h.hitch(this,this._onDrawEnd)));this.drawBox.btnClear?f.removeClass(this.drawBox.btnClear,"jimu-float-trailing"):f.addClass(this.drawBox.btnClear,"jimu-float-leading");this.searchDistance=new b({distance:this.distance,unit:this.unit});this.searchDistance.placeAt(this.searchDistanceDiv);this.enableBuffer?(this.searchDistance.enable(),
this.own(c(this.searchDistance,"change",h.hitch(this,this._onSearchDistanceChange)))):(this.searchDistance.disable(),f.setStyle(this.searchDistanceDiv,"display","none"))},reset:function(a){this.drawBox.reset();this.clearAllGraphics();a&&(this.searchDistance.reset(),this.searchDistance.setDistance(this.distance),this.searchDistance.setUnit(this.unit))},clearAllGraphics:function(){this.drawBox.clear();this._clearBufferLayer()},deactivate:function(){this.drawBox&&this.drawBox.deactivate()},getGeometryInfo:function(){var a=
{status:0,geometry:null},b=this._getStatusOfSearchDistance();0>b?(a.status=-1,a.geometry=null,this.searchDistance.tryShowValidationError()):0===b?(a.geometry=this._getGeometryFromDrawBox(),a.status=a.geometry?1:0):0<b&&(0<this.bufferLayer.graphics.length&&(a.geometry=this.bufferLayer.graphics[0].geometry),a.status=a.geometry?1:0);return a},_getGeometryFromDrawBox:function(){var a=null,b=this.drawBox.getFirstGraphic();b&&(a=b.geometry);return a},_getGeometryFromBufferLayer:function(){var a=null;0<
this.bufferLayer.graphics.length&&(a=this.bufferLayer.graphics[0].geometry);return a},_getStatusOfSearchDistance:function(){return this.searchDistance.getStatus()},_onSearchDistanceChange:function(){this._updateBuffer()},_onDrawBoxClear:function(){this._clearBufferLayer()},_onDrawEnd:function(){this._updateBuffer()},_clearBufferLayer:function(){this.bufferLayer&&this.bufferLayer.clear()},_updateBuffer:function(){this._clearBufferLayer();if(0<this._getStatusOfSearchDistance()){var b=this._getGeometryFromDrawBox();
if(b){var c=this.searchDistance.getData(),b=u.simplify(b),b=u.buffer(b,c.distance,c.bufferUnit,!0),b=new a(b);this.bufferLayer.add(b)}}},destroy:function(){this.bufferLayer&&this.map.removeLayer(this.bufferLayer);this.bufferLayer=null;this.inherited(arguments)}})})},"jimu/dijit/SearchDistance":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SearchDistance.html dojo/Evented dojo/_base/lang jimu/utils jimu/dijit/CheckBox esri/tasks/GeometryService dijit/form/Select dijit/form/NumberTextBox".split(" "),
function(l,n,p,k,c,e,f,h,d,g){return l([n,p,k,e],{baseClass:"jimu-dijit-searchdistance",templateString:c,lastMeters:0,tip:"",distance:0,unit:"",postMixInProperties:function(){this.inherited(arguments);this.nls=f.clone(window.jimuNls.units);this.tip||(this.tip=window.jimuNls.searchDistance.applySearchDistance)},postCreate:function(){this.inherited(arguments);this.cbx=new d({label:this.tip,onChange:f.hitch(this,this._onCbxChanged)});this.cbx.placeAt(this.cbxDiv);this.reset();this.setDistance(this.distance);
this.setUnit(this.unit);this.lastMeters=this.getMeters()},enable:function(){this.cbx.check()},disable:function(){this.cbx.uncheck()},isEnabled:function(){return this.cbx.getValue()},reset:function(){this.numberTextBox.set("value",0);this.unitSelect.set("value","MILES")},getData:function(){return{status:this.getStatus(),isEnabled:this.isEnabled(),distance:this.getDistance(),unit:this.getUnit(),bufferUnit:this.getUnitToBuffer(),meters:this.getMeters()}},getStatus:function(){var b;this.isEnabled()?(b=
this.getDistance(),b=0<b?1:0===b?0:-1):b=0;return b},getMeters:function(){var b=0,a=this.getStatus();if(0<a){var a=this.getDistance(),c=this.getUnit();"MILES"===c?b=1609.344*a:"KILOMETERS"===c?b=1E3*a:"FEET"===c?b=0.3048*a:"METERS"===c?b=a:"YARDS"===c?b=0.9144*a:"NAUTICAL_MILES"===c&&(b=1852*a);b=parseFloat(b.toFixed(3))}else 0===a?b=0:0>a&&(b=-1);return b},setDistance:function(b){"number"===typeof b&&0<=b&&this.numberTextBox.set("value",b)},setUnit:function(b){b&&"string"===typeof b&&this.unitSelect.set("value",
b)},tryShowValidationError:function(){this.numberTextBox.validate()||h.showValidationErrorTipForFormDijit(this.numberTextBox)},getDistance:function(){return!this.numberTextBox.validate()?(h.showValidationErrorTipForFormDijit(this.numberTextBox),-1):this.numberTextBox.get("value")},getUnit:function(){return this.unitSelect.get("value")},getUnitToBuffer:function(){var b="";switch(this.unitSelect.get("value")){case "MILES":b=g.UNIT_STATUTE_MILE;break;case "KILOMETERS":b=g.UNIT_KILOMETER;break;case "FEET":b=
g.UNIT_FOOT;break;case "METERS":b=g.UNIT_METER;break;case "YARDS":b=g.UNIT_INTERNATIONAL_YARD;break;case "NAUTICAL_MILES":b=g.UNIT_NAUTICAL_MILE}return b},_onCbxChanged:function(){this.cbx.getValue()?(this.numberTextBox.set("disabled",!1),this.unitSelect.set("disabled",!1)):(this.numberTextBox.set("disabled",!0),this.unitSelect.set("disabled",!0));this._emitEvent()},_onNumberTextBoxChanged:function(){this._emitEvent()},_onUnitSelectChanged:function(){this._emitEvent()},_emitEvent:function(){var b=
this.getData();b.meters!==this.lastMeters&&(this.lastMeters=b.meters,this.emit("change",b))}})})},"jimu/dijit/SpatialFilterByFeatures":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SpatialFilterByFeatures.html dojo/on dojo/Evented dojo/Deferred dojo/_base/html dojo/_base/lang jimu/utils jimu/dijit/Message jimu/dijit/CheckBox jimu/dijit/FeaturelayerChooserFromMap jimu/dijit/LayerChooserFromMapWithDropbox jimu/dijit/SearchDistance jimu/LayerInfos/LayerInfos esri/graphic esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/geometry/geometryEngine jimu/dijit/FeatureSetChooserForSingleLayer".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w,u,m,x,r,C,E,D,A){var y=l([n,p,k,f],{baseClass:"jimu-dijit-spatial-filter-features",templateString:c,_bufferLayer:null,_defaultRelationship:"SPATIAL_REL_INTERSECTS",drawBox:null,selectionRadio:null,_selectionHandle:null,layerInfosObj:null,map:null,types:null,enableBuffer:!1,distance:0,unit:"",showLoading:!1,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.spatialFilterByFeatures},postCreate:function(){this.inherited(arguments);
this.selectionRadio=new q({label:this.nls.selectedFeatures});this.selectionRadio.placeAt(this.selectionOptionDiv);this.selectionRadio.setStatus(!1);this.own(e(this.selectionRadio,"change",g.hitch(this,this._onRadioChanged)));d.setStyle(this.domNode,"position","relative");var a=r.fromJson({style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}}),a=new E(a);this._bufferLayer=new C;this._bufferLayer.setRenderer(a);this.map.addLayer(this._bufferLayer);
a=new s({createMapResponse:this.map.webMapResponse,types:this.types,showLayerFromFeatureSet:!0,onlyShowVisible:!1,updateWhenLayerInfosIsShowInMapChanged:!0});this.layerChooserFromMapWithDropbox=new w({layerChooser:a});this.layerChooserFromMapWithDropbox.placeAt(this.layerSelectDiv);this.own(e(this.layerChooserFromMapWithDropbox,"selection-change",g.hitch(this,this._onLayerChanged)));this.layerInfosObj=m.getInstanceSync();this.own(e(this.layerInfosObj,"layerInfosIsShowInMapChanged",g.hitch(this,this._onLayerInfosIsShowInMapChanged)));
this.searchDistance=new u({tip:window.jimuNls.searchDistance.applySearchDistanceToFeatures,distance:this.distance,unit:this.unit});this.searchDistance.placeAt(this.searchDistanceDiv);this.enableBuffer?(this.searchDistance.enable(),this.own(e(this.searchDistance,"change",g.hitch(this,this._onSearchDistanceChange)))):(this.searchDistance.disable(),d.setStyle(this.searchDistanceDiv,"display","none"));this._onLayerChanged()},reset:function(a){a&&(this.searchDistance.reset(),this.searchDistance.setDistance(this.distance),
this.searchDistance.setUnit(this.unit));this.clearAllGraphics()},disable:function(a){a&&this._hideAllLayers()},enable:function(){this._showAllLayers()},deactivate:function(){this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.deactivate()},clearAllGraphics:function(){this._clearBufferLayer();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.clearAllGraphics()},setSelectedLayer:function(a){return this.layerChooserFromMapWithDropbox.setSelectedLayer(a)},
getSelectedLayer:function(){return this._getSelectedLayerInfomation().layer},checkSelectedFeaturesRadio:function(){this.selectionRadio.getValue()||this.selectionRadio.check()},uncheckSelectedFeaturesRadio:function(){this.selectionRadio.getValue()&&this.selectionRadio.uncheck()},getGeometryInfo:function(a){var b=new h,c={status:null,geometry:null};this._updateBuffer();if(0===this._getSelectedLayerInfomation().type)return c.status=-1,b.resolve(c),b;if(0>this.searchDistance.getData().status)return c.status=
-2,b.resolve(c),b;this._getFeatures(a).then(g.hitch(this,function(){c.geometry=this._updateBuffer();c.status=c.geometry?1:0;b.resolve(c)}),g.hitch(this,function(a){b.reject(a)}));return b},getFeatureSet:function(a){var c=new h,d=null,v=this._getSelectedLayerInfomation().layer;v?this._getFeatures(a).then(g.hitch(this,function(a){d=b.getFeatureSetByLayerAndFeatures(v,a);c.resolve(d)}),g.hitch(this,function(a){c.reject(a)})):c.resolve(d);return c},_getFeatures:function(b){var c=new h,d=[],v=this._getSelectedLayerInfomation(),
e=v.type;0===e?c.resolve(d):this.selectionRadio.getStatus()&&this.selectionRadio.getValue()?(d=v.layer.getSelectedFeatures(),c.resolve(d)):this.featureSetChooserForSingleLayer.isLoading()?c=this.featureSetChooserForSingleLayer.getFeatures():(d=this.featureSetChooserForSingleLayer.syncGetFeatures(),0<d.length?c.resolve(d):3===e?(d=v.layer.graphics,c.resolve(d)):(b||new a({message:this.nls.selectFeaturesOrDrawShapesTip}),c.reject({type:y.NONE_SELECTED_FEATURES_NOT_DRAW_SHAPES,message:this.nls.selectFeaturesOrDrawShapesTip})));
return c},_syncGetFeatures:function(){var a=[],b=this._getSelectedLayerInfomation(),c=b.type;0!==c&&(this.selectionRadio.getStatus()&&this.selectionRadio.getValue()?a=b.layer.getSelectedFeatures():(a=this.featureSetChooserForSingleLayer.syncGetFeatures(),0===a.length&&3===c&&(a=b.layer.graphics)));return a},isLoading:function(){return this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.isLoading()},_onLoading:function(){this.showLoading&&this.loading.show();this.emit("loading")},
_onUnloading:function(){this.loading.hide();this.emit("unloading")},_showAllLayers:function(){this._bufferLayer&&this._bufferLayer.show()},_hideAllLayers:function(){this._bufferLayer&&this._bufferLayer.hide()},_onRadioChanged:function(){this.selectionRadio.getValue()&&this.featureSetChooserForSingleLayer&&(this.featureSetChooserForSingleLayer.deactivate(),this.featureSetChooserForSingleLayer.clearAllGraphics());this._updateBuffer()},_getSelectedLayerInfomation:function(){var a=0,b=null,c=null,d=this.layerChooserFromMapWithDropbox.getSelectedItems();
0<d.length&&(b=d[0]);b&&(c=b.layerInfo.layerObject,a=c.url?0<=this.map.graphicsLayerIds.indexOf(c.id)?1:2:3);return{type:a,layerItem:b,layer:c}},_onLayerChanged:function(){this.clearAllGraphics();this._clearSelectionHandle();this._updateSelectedFeaturesCount();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.destroy();this.featureSetChooserForSingleLayer=null;var a=this._getSelectedLayerInfomation();0<a.type&&(this.featureSetChooserForSingleLayer=new A({map:this.map,featureLayer:a.layer,
updateSelection:!1}),this._selectionHandle=e(a.layer,"selection-complete",g.hitch(this,function(){var a=this.selectionRadio.getStatus()&&this.selectionRadio.getValue();this._updateSelectedFeaturesCount();a&&this._updateBuffer()})),this.own(e(this.featureSetChooserForSingleLayer,"user-clear",g.hitch(this,this._onUserClear))),this.own(e(this.featureSetChooserForSingleLayer,"loading",g.hitch(this,g.hitch(this,function(){this._clearBufferLayer();this._onLoading()})))),this.own(e(this.featureSetChooserForSingleLayer,
"unloading",g.hitch(this,g.hitch(this,function(){this._onUnloading();this._updateBuffer()})))),this.featureSetChooserForSingleLayer.placeAt(this.featureSetChooserDiv),this.own(e(this.featureSetChooserForSingleLayer,"draw-activate",g.hitch(this,function(){this.uncheckSelectedFeaturesRadio()}))));this._updateFeatureSetChooserForSingleLayerStatus();this._updateBuffer()},_onLayerInfosIsShowInMapChanged:function(){this._updateFeatureSetChooserForSingleLayerStatus()},_onSearchDistanceChange:function(){this._updateBuffer()},
_updateFeatureSetChooserForSingleLayerStatus:function(){if(this.featureSetChooserForSingleLayer){var a=!1,b=this.featureSetChooserForSingleLayer.getFeatureLayer();(b=this.layerInfosObj.getLayerInfoById(b.id))&&(a=b.isShowInMap());a?(this.featureSetChooserForSingleLayer.enable(),d.removeClass(this.featureSetChooserForSingleLayer.domNode,"not-visible")):(this.featureSetChooserForSingleLayer.disable(),this.featureSetChooserForSingleLayer.clearAllGraphics(),d.addClass(this.featureSetChooserForSingleLayer.domNode,
"not-visible"),this._updateBuffer())}},_updateBuffer:function(){this._clearBufferLayer();var a=this.searchDistance.getData(),c=a.status,d=a.distance,a=a.bufferUnit;if(0>c)return null;var v=this._syncGetFeatures(),v=b.combineGeometriesByGraphics(v);return 0===c?v:v?(v=D.simplify(v),c=D.buffer(v,d,a,!0),d=new x(c),this._bufferLayer.add(d),c):null},_onUserClear:function(){this.clearAllGraphics()},_clearBufferLayer:function(){this._bufferLayer&&this._bufferLayer.clear()},_updateSelectedFeaturesCount:function(){this.selectionRadio.setStatus(!0);
var a=this._getSelectedLayerInfomation(),b=0;if(a.layer&&(a=a.layer.getSelectedFeatures()))b=a.length;0===b?(this.selectionRadio.getValue()&&this.selectionRadio.uncheck(),this.selectionRadio.setStatus(!1),d.addClass(this.selectionOptionDiv,"not-visible")):d.removeClass(this.selectionOptionDiv,"not-visible");this.selectionRadio.setLabel(this.nls.selectedFeatures+(window.isRTL?"\x26rlm;":" ")+"("+b+")")},_clearSelectionHandle:function(){this._selectionHandle&&this._selectionHandle.remove();this._selectionHandle=
null},destroy:function(){this._bufferLayer&&this.map.removeLayer(this._bufferLayer);this._bufferLayer=null;this._clearSelectionHandle();this.inherited(arguments)}});y.NONE_SELECTED_FEATURES_NOT_DRAW_SHAPES="NONE_SELECTED_FEATURES_NOT_DRAW_SHAPES";return y})},"jimu/dijit/FeaturelayerChooserFromMap":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/html","dojo/_base/lang","./LayerChooserFromMap"],function(l,n,p,k,c){return l([c],{baseClass:"jimu-featurelayer-chooser-from-map",declaredClass:"jimu.dijit.FeaturelayerChooserFromMap",
types:null,showLayerFromFeatureSet:!1,showTable:!1,onlyShowVisible:!1,postMixInProperties:function(){this.inherited(arguments);this.basicFilter=k.hitch(this,this.basicFilter);this.filter=c.createFeaturelayerFilter(this.types,this.showLayerFromFeatureSet,this.showTable)},postCreate:function(){this.inherited(arguments);p.addClass(this.domNode,"jimu-basic-layer-chooser-from-map")},basicFilter:function(c){var f=new n;this.onlyShowVisible&&"Table"!==c.getLayerType()?f.resolve(c.isShowInMap()):f.resolve(!0);
return f},getHandledItem:function(c){var f=this.inherited(arguments),h=c&&c.layerInfo,h=h&&h.layerObject;f.url=h&&h.url||"";return f}})})},"jimu/dijit/LayerChooserFromMap":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/on dojo/store/Memory dojo/Deferred dojo/store/Observable dijit/tree/ObjectStoreModel dojo/promise/all dojo/_base/lang dojo/_base/html dojo/_base/array jimu/utils jimu/dijit/_Tree jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w,u,m,x){var r=l([n,p,k,c],{templateString:'\x3cdiv style\x3d"width:100%;"\x3e\x3cdiv data-dojo-attach-point\x3d"errorTipSection" class\x3d"error-tip-section"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text" data-dojo-attach-point\x3d"errTip"\x3e${nls.noLayersTip}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',_store:null,_id:0,_treeClass:"layer-chooser-tree",createMapResponse:null,multiple:!1,onlyShowVisible:!1,
updateWhenLayerInfosIsShowInMapChanged:!1,postMixInProperties:function(){this.nls=window.jimuNls.basicLayerChooserFromMap},postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-basic-layer-chooser-from-map");this.multiple=!!this.multiple;this.shelter=new x({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this._createTree();this.basicFilter=a.hitch(this,this.basicFilter);this.filter=r.andCombineFilters([this.basicFilter,this.filter]);this.createMapResponse&&
this.setCreateMapResponse(this.createMapResponse)},basicFilter:function(a){var b=new h;this.onlyShowVisible?b.resolve(a.isShowInMap()):b.resolve(!0);return b},filter:function(a){a=new h;a.resolve(!0);return a},getSelectedItems:function(){var b=this.tree.getSelectedItems();return s.map(b,a.hitch(this,function(a){return this.getHandledItem(a)}))},getAllItems:function(){var b=this.tree.getAllItems(),c=[];s.forEach(b,a.hitch(this,function(a){"root"!==a.id&&(a=this.getHandledItem(a),c.push(a))}));return c},
getHandledItem:function(a){return{name:a.name,layerInfo:a.layerInfo}},_isLeafItem:function(a){return a.isLeaf},setCreateMapResponse:function(b){this.createMapResponse=b;m.getInstance(this.createMapResponse.map,this.createMapResponse.itemInfo).then(a.hitch(this,function(b){this.layerInfosObj=b;this.own(e(this.layerInfosObj,"layerInfosChanged",a.hitch(this,this._onLayerInfosChanged)));this.updateWhenLayerInfosIsShowInMapChanged&&this.own(e(this.layerInfosObj,"layerInfosIsShowInMapChanged",a.hitch(this,
this._onLayerInfosIsShowInMapChanged)));this._buildTree(this.layerInfosObj)}))},_onLayerInfosChanged:function(a,b){this._buildTree(this.layerInfosObj);this.emit("update")},_onLayerInfosIsShowInMapChanged:function(a){this._buildTree(this.layerInfosObj);this.emit("update")},_buildTree:function(b){this._clear();q.setStyle(this.errorTipSection,"display","block");var c=b.getLayerInfoArray(),c=c.concat(b.getTableInfoArray());0!==c.length&&(q.setStyle(this.errorTipSection,"display","none"),s.forEach(c,a.hitch(this,
function(a){this._addDirectLayerInfo(a)})))},_addDirectLayerInfo:function(b){b&&b.getLayerObject().then(a.hitch(this,function(){this._addItem("root",b)}),a.hitch(this,function(a){console.error(a)}))},_clear:function(){var b=this._store.query({parent:"root"});s.forEach(b,a.hitch(this,function(a){a&&"root"!==a.id&&this._store.remove(a.id)}))},_addItem:function(c,d){var e=null,f=d.getLayerType(),m=this.filter(d);b({layerType:f,valid:m}).then(a.hitch(this,function(f){if(f.valid){var m=a.hitch(this,function(a,
b){this._id++;e={name:d.title||"",parent:c,layerInfo:d,type:f.layerType,layerClass:d.layerObject.declaredClass,id:this._id.toString(),isLeaf:a,hasChildren:b};this._store.add(e)}),h=d.getSubLayers(),v=0===h.length;v?m(v,!1):(h=s.map(h,a.hitch(this,function(a){return this.filter(a)})),b(h).then(a.hitch(this,function(a){(a=s.some(a,function(a){return a}))&&m(v,a)})))}}))},_getRootItem:function(){return{id:"root",name:"Map Root",type:"root",isLeaf:!1,hasChildren:!0}},_createTree:function(){var b=this._getRootItem(),
b=new f({data:[b],getChildren:function(a){return this.query({parent:a.id})}});this._store=new d(b);b=new g({store:this._store,query:{id:"root"},mayHaveChildren:a.hitch(this,this._mayHaveChildren)});this.tree=new u({multiple:this.multiple,model:b,showRoot:!1,isLeafItem:a.hitch(this,this._isLeafItem),style:{width:"100%"},onOpen:a.hitch(this,function(a,b){"root"!==a.id&&this._onTreeOpen(a,b)}),onClick:a.hitch(this,function(a,b,c){this._onTreeClick(a,b,c);this.emit("tree-click",a,b,c)}),getIconStyle:a.hitch(this,
function(a,b){var c=null;if(!a||"root"===a.id)return null;var d={width:"20px",height:"20px",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundImage:""},e=window.location.protocol+"//"+window.location.host+require.toUrl("jimu"),f=this._getIconImageName(a,b);f&&(d.backgroundImage="url("+e+"/css/images/"+f+")",c=d);return c})});q.addClass(this.tree.domNode,this._treeClass);this.tree.placeAt(this.shelter.domNode,"before")},_mayHaveChildren:function(a){return a.hasChildren},_getIconImageName:function(a,
b){var c="";if("ArcGISDynamicMapServiceLayer"===a.type||"ArcGISTiledMapServiceLayer"===a.type)c=b?"mapserver_open.png":"mapserver_close.png";else if("GroupLayer"===a.type)c=b?"group_layer2.png":"group_layer1.png";else if("FeatureLayer"===a.type){var d=w.getTypeByGeometryType(a.layerInfo.layerObject.geometryType);"point"===d?c="point_layer1.png":"polyline"===d?c="line_layer1.png":"polygon"===d&&(c="polygon_layer1.png")}else c="Table"===a.type?"table.png":"ArcGISImageServiceLayer"===a.type||"ArcGISImageServiceVectorLayer"===
a.type?"image_layer.png":b?"mapserver_open.png":"mapserver_close.png";return c},_onTreeOpen:function(c,d){if("root"!==c.id){var e=[],f=[],e=c.layerInfo.getSubLayers();c.checked||(this.shelter.show(),f=s.map(e,a.hitch(this,function(a){return a.getLayerObject()})),b(f).then(a.hitch(this,function(){this.domNode&&(s.forEach(e,a.hitch(this,function(a){this._addItem(c.id,a)})),c.checked=!0,this.shelter.hide())}),a.hitch(this,function(a){console.error(a);this.shelter.hide()})))}},_onTreeClick:function(a,
b,c){},destroy:function(){this.shelter&&this.shelter.destroy();this.tree&&this.tree.destroy();this.shelter=null;this.tree.destroy();this.inherited(arguments)}});r.createFilterByLayerType=function(c){a.isArrayLike(c)||(c=[]);return function(a){var d=new h;if(0===c.length)d.resolve(!0);else{var e=[];a.traversal(function(a){e.push(a.getLayerType())});b(e).then(function(a){for(var b=0;b<a.length;b++)for(var e=0;e<c.length;e++)if(a[b]===c[e]){d.resolve(!0);return}d.resolve(!1)},function(a){console.error(a);
d.reject(a)})}return d}};r.createFeaturelayerFilter=function(a,c,d){var e=["point","polyline","polygon"];a&&0<a.length?(a=s.filter(a,function(a){return 0<=e.indexOf(a)}),0===a.length&&(a=e)):a=e;return function(e){var f=new h,m=e.getLayerType();e=e.getLayerObject();b({layerType:m,layerObject:e}).then(function(b){var e=b.layerType;b=b.layerObject;"ArcGISDynamicMapServiceLayer"===e?f.resolve(!0):"ArcGISTiledMapServiceLayer"===e?f.resolve(!0):"GroupLayer"===e?f.resolve(!0):"FeatureCollection"===e?f.resolve(!0):
"FeatureLayer"===e?(e=w.getTypeByGeometryType(b.geometryType),e=0<=s.indexOf(a,e),b.url?(b=w.isFeaturelayerUrlSupportQuery(b.url,b.capabilities),f.resolve(e&&b)):f.resolve(c&&e)):"Table"===e?(b=w.isFeaturelayerUrlSupportQuery(b.url,b.capabilities),f.resolve(d&&b)):f.resolve(!1)},function(a){console.log(a);f.reject(a)});return f}};r.createImageServiceLayerFilter=function(a){return function(c){var d=new h,e=c.getLayerType();c=c.getLayerObject();b({layerType:e,layerObject:c}).then(function(b){var c=
b.layerType;"ArcGISImageServiceLayer"===c||"ArcGISImageServiceVectorLayer"===c?a?w.isImageServiceSupportQuery(b.layerObject.capabilities)?d.resolve(!0):d.resolve(!1):d.resolve(!0):d.resolve(!1)},function(a){console.log(a);d.reject(a)});return d}};r.createQueryableLayerFilter=function(){var a=r.createFeaturelayerFilter(["point","polyline","polygon"],!1,!0),b=r.createImageServiceLayerFilter(!0);return r.orCombineFilters([a,b])};r.andCombineFilters=function(a){return r._combineFilters(a,!0)};r.orCombineFilters=
function(a){return r._combineFilters(a,!1)};r._combineFilters=function(a,c){return function(d){var e=new h,f=s.map(a,function(a){return a(d)});b(f).then(function(a){var b=!1,b=c?s.every(a,function(a){return a}):s.some(a,function(a){return a});e.resolve(b)},function(a){console.error(a);e.reject(a)});return e}};return r})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(l,n,p,k){l=function(c){function e(b,a){var d=c[b];d&&(c[b]=function(e){var f;
"put"===b&&(f=c.getIdentity(e));if(g)return d.apply(this,arguments);g=!0;try{var h=d.apply(this,arguments);p(h,function(b){a("object"==typeof b&&b||e,f)});return h}finally{g=!1}})}var f=[],h=0;c=n.delegate(c);c.notify=function(b,a){h++;for(var c=f.slice(),d=0,e=c.length;d<e;d++)c[d](b,a)};var d=c.query;c.query=function(b,a){a=a||{};var e=d.apply(this,arguments);if(e&&e.forEach){var g=n.mixin({},a);delete g.start;delete g.count;var l=c.queryEngine&&c.queryEngine(b,g),u=h,m=[],x;e.observe=function(b,
d){1==m.push(b)&&f.push(x=function(b,f){p(e,function(e){var g=e.length!=a.count,t,q;if(++u!=h)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var v,s=-1,n=-1;if(void 0!==f){var r=[].concat(e);l&&!b&&(r=l(e));t=0;for(q=e.length;t<q;t++){var p=e[t];if(c.getIdentity(p)==f&&!(0>r.indexOf(p))){v=p;s=t;(l||!b)&&e.splice(t,1);break}}}if(l){if(b&&(l.matches?l.matches(b):l([b]).length))t=-1<s?s:e.length,e.splice(t,0,b),n=k.indexOf(l(e),b),e.splice(t,1),a.start&&
0==n||!g&&n==e.length?n=-1:e.splice(n,0,b)}else b&&(void 0!==f?n=s:a.start||(n=c.defaultIndex||0,e.splice(n,0,b)));if((-1<s||-1<n)&&(d||!l||s!=n)){g=m.slice();for(t=0;e=g[t];t++)e(b||v,s,n)}})});var g={};g.remove=g.cancel=function(){var a=k.indexOf(m,b);-1<a&&(m.splice(a,1),m.length||f.splice(k.indexOf(f,x),1))};return g}}return e};var g;e("put",function(b,a){c.notify(b,a)});e("add",function(b){c.notify(b)});e("remove",function(b){c.notify(void 0,b)});return c};n.setObject("dojo.store.Observable",
l);return l})},"dijit/tree/ObjectStoreModel":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/_base/lang dojo/when ../Destroyable".split(" "),function(l,n,p,k,c,e,f){return p("dijit.tree.ObjectStoreModel",f,{store:null,labelAttr:"name",labelType:"text",root:null,query:null,constructor:function(e){c.mixin(this,e);this.childrenCache={}},getRoot:function(f,d){if(this.root)f(this.root);else{var g=this.store.query(this.query);g.then&&this.own(g);e(g,c.hitch(this,function(b){if(1!=
b.length)throw Error("dijit.tree.ObjectStoreModel: root query returned "+b.length+" items, but must return exactly one");this.root=b[0];f(this.root);g.observe&&g.observe(c.hitch(this,function(a){this.onChange(a)}),!0)}),d)}},mayHaveChildren:function(){return!0},getChildren:function(f,d,g){var b=this.store.getIdentity(f);if(this.childrenCache[b])e(this.childrenCache[b],d,g);else{var a=this.childrenCache[b]=this.store.getChildren(f);a.then&&this.own(a);a.observe&&this.own(a.observe(c.hitch(this,function(b,
d,g){this.onChange(b);d!=g&&e(a,c.hitch(this,"onChildrenChange",f))}),!0));e(a,d,g)}},isItem:function(){return!0},getIdentity:function(c){return this.store.getIdentity(c)},getLabel:function(c){return c[this.labelAttr]},newItem:function(c,d,e,b){return this.store.put(c,{parent:d,before:b})},pasteItem:function(e,d,f,b,a,q){var n=new k;if(d===f&&!b&&!q)return n.resolve(!0),n;d&&!b?this.getChildren(d,c.hitch(this,function(a){a=[].concat(a);var b=l.indexOf(a,e);a.splice(b,1);this.onChildrenChange(d,a);
n.resolve(this.store.put(e,{overwrite:!0,parent:f,oldParent:d,before:q}))})):n.resolve(this.store.put(e,{overwrite:!0,parent:f,oldParent:d,before:q}));return n},onChange:function(){},onChildrenChange:function(){},onDelete:function(){}})})},"jimu/dijit/_Tree":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_TreeNode.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/event dojo/query dojo/aspect dojo/on dojo/Evented dijit/registry dijit/Tree jimu/utils".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w){var u=l([s._TreeNode,a],{templateString:k,declaredClass:"jimu._TreeNode",isLeaf:!1,groupId:"",postCreate:function(){this.inherited(arguments);e.addClass(this.domNode,"jimu-tree-node");this.isLeaf=!!this.isLeaf;this.groupId?(this.checkNode=e.toDom('\x3cinput type\x3d"radio" /\x3e'),this.checkNode.name=this.groupId):this.checkNode=e.toDom('\x3cinput type\x3d"checkbox" /\x3e');e.addClass(this.checkNode,"jimu-tree-check-node");e.place(this.checkNode,this.contentNode,
"first");this.own(b(this.checkNode,"click",c.hitch(this,this._onClick)));this.isLeaf?this.groupId?e.setStyle(this.checkNode,"display","none"):e.setStyle(this.checkNode,"display","inline"):e.setStyle(this.checkNode,"display","none");this.isLeaf?e.addClass(this.domNode,"jimu-tree-leaf-node"):e.addClass(this.domNode,"jimu-tree-not-leaf-node")},select:function(){this.isLeaf&&(this.checkNode.checked=!0,e.addClass(this.domNode,"jimu-tree-selected-leaf-node"))},unselect:function(){this.isLeaf&&(this.checkNode.checked=
!1,e.removeClass(this.domNode,"jimu-tree-selected-leaf-node"))},toggleSelect:function(){this.isLeaf&&(this.checkNode.checked?this.unselect():this.select())},_onClick:function(a){(a.target||a.srcElement)===this.checkNode?this.tree._onCheckNodeClick(this,this.checkNode.checked,a):this.tree._onClick(this,a)},_onChange:function(){this.isLeaf&&setTimeout(c.hitch(this,function(){this.checkNode.checked?this.emit("tn-select",this):this.emit("tn-unselect",this)}),100)},destroy:function(){delete this.tree;
this.inherited(arguments)}});return l([s,a],{declaredClass:"jimu._Tree",openOnClick:!0,multiple:!0,uniqueId:"",showRoot:!1,postMixInProperties:function(){this.inherited(arguments);this.uniqueId="tree_"+w.getRandomString()},postCreate:function(){this.inherited(arguments);e.addClass(this.domNode,"jimu-tree");this.own(g.before(this,"onClick",c.hitch(this,this._jimuBeforeClick)));this.rootLoadingIndicator&&e.setStyle(this.rootLoadingIndicator,"display","none");this.dndController.singular=!0},removeItem:function(a){this.model.store.remove(a)},
getAllItems:function(){var a=this.getAllTreeNodeWidgets();return f.map(a,c.hitch(this,function(a){var b=a.item;b.selected=a.checkNode.checked;return b}))},getSelectedItems:function(){var a=this.getAllTreeNodeWidgets(),a=f.filter(a,c.hitch(this,function(a){return a.checkNode.checked}));return f.map(a,c.hitch(this,function(a){return a.item}))},getFilteredItems:function(a){var b=this.getAllTreeNodeWidgets(),b=f.map(b,c.hitch(this,function(a){var b=a.item;b.selected=a.checkNode.checked;return b}));return f.filter(b,
c.hitch(this,function(b){return a(b)}))},getTreeNodeByItemId:function(a){for(var b=this._getAllTreeNodeDoms(),c=0;c<b.length;c++){var d=q.byNode(b[c]);if(d.item.id.toString()===a.toString())return d}return null},selectItem:function(a){(a=this.getTreeNodeByItemId(a))&&a.isLeaf&&this.selectNodeWidget(a)},unselectItem:function(a){(a=this.getTreeNodeByItemId(a))&&a.isLeaf&&a.unselect()},getAllLeafTreeNodeWidgets:function(){var a=this.getAllTreeNodeWidgets();return f.filter(a,c.hitch(this,function(a){return a.isLeaf}))},
getAllTreeNodeWidgets:function(){var a=this._getAllTreeNodeDoms();return f.map(a,c.hitch(this,function(a){return q.byNode(a)}))},isLeafItem:function(a){return a&&a.isLeaf},_getAllTreeNodeDoms:function(){return d(".dijitTreeNode",this.domNode)},_createTreeNode:function(a){a.isLeaf=this.isLeafItem(a.item);this.multiple||(a.groupId=this.uniqueId);return new u(a)},_onTreeNodeSelect:function(a){this.emit("item-select",{item:a.item,treeNode:a})},_onTreeNodeUnselect:function(a){this.emit("item-unselect",
{item:a.item,treeNode:a})},selectNodeWidget:function(a){this.multiple||this.unselectAllLeafNodeWidgets();a.select()},_jimuBeforeClick:function(a,b,c){b.isLeaf&&(e.hasClass(c.target||c.srcElement,"jimu-tree-check-node")||(this.multiple?b.toggleSelect():this.selectNodeWidget(b)));return arguments},_onCheckNodeClick:function(a,b,d){!this.multiple&&b&&this.unselectAllLeafNodeWidgets();h.stop(d);this.focusNode(a);setTimeout(c.hitch(this,function(){b?this.selectNodeWidget(a):a.unselect();this.onClick(a.item,
a,d)}),0)},unselectAllLeafNodeWidgets:function(){var a=this.getAllLeafTreeNodeWidgets();f.forEach(a,c.hitch(this,function(a){a.unselect()}))}})})},"dijit/Tree":function(){define("dojo/_base/array dojo/aspect dojo/cookie dojo/_base/declare dojo/Deferred dojo/promise/all dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/errors/create dojo/fx dojo/has dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/topic dojo/touch dojo/when ./a11yclick ./focus ./registry ./_base/manager ./_Widget ./_TemplatedMixin ./_Container ./_Contained ./_CssStateMixin ./_KeyNavMixin dojo/text!./templates/TreeNode.html dojo/text!./templates/Tree.html ./tree/TreeStoreModel ./tree/ForestStoreModel ./tree/_dndSelector dojo/query!css2".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w,u,m,x,r,C,E,D,A,y,F,t,z,v,I,J,K,L,O,M,N){function B(a){return u.delegate(a.promise||a,{addCallback:function(a){this.then(a)},addErrback:function(a){this.otherwise(a)}})}var H=k("dijit._TreeNode",[F,t,z,v,I],{item:null,isTreeNode:!0,label:"",_setLabelAttr:function(a){this.labelNode["html"==this.labelType?"innerHTML":"innerText"in this.labelNode?"innerText":"textContent"]=a;this._set("label",a);q("dojo-bidi")&&this.applyTextDir(this.labelNode)},labelType:"text",
isExpandable:null,isExpanded:!1,state:"NotLoaded",templateString:K,baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow"},_setTooltipAttr:{node:"rowNode",type:"attribute",attribute:"title"},buildRendering:function(){this.inherited(arguments);this._setExpando();this._updateItemClasses(this.item);this.isExpandable&&this.labelNode.setAttribute("aria-expanded",this.isExpanded);this.setSelected(!1)},_setIndentAttr:function(a){var b=Math.max(a,0)*this.tree._nodePixelIndent+"px";g.set(this.domNode,
"backgroundPosition",b+" 0px");g.set(this.rowNode,this.isLeftToRight()?"paddingLeft":"paddingRight",b);l.forEach(this.getChildren(),function(b){b.set("indent",a+1)});this._set("indent",a)},markProcessing:function(){this.state="Loading";this._setExpando(!0)},unmarkProcessing:function(){this._setExpando(!1)},_updateItemClasses:function(a){var b=this.tree,c=b.model;b._v10Compat&&a===c.root&&(a=null);this._applyClassAndStyle(a,"icon","Icon");this._applyClassAndStyle(a,"label","Label");this._applyClassAndStyle(a,
"row","Row");this.tree._startPaint(!0)},_applyClassAndStyle:function(a,b,c){var d="_"+b+"Class";b+="Node";var e=this[d];this[d]=this.tree["get"+c+"Class"](a,this.isExpanded);h.replace(this[b],this[d]||"",e||"");g.set(this[b],this.tree["get"+c+"Style"](a,this.isExpanded)||{})},_updateLayout:function(){var a=this.getParent(),a=!a||!a.rowNode||"none"==a.rowNode.style.display;h.toggle(this.domNode,"dijitTreeIsRoot",a);h.toggle(this.domNode,"dijitTreeIsLast",!a&&!this.getNextSibling())},_setExpando:function(a){var b=
["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"];a=a?0:this.isExpandable?this.isExpanded?1:2:3;h.replace(this.expandoNode,b[a],b);this.expandoNodeText.innerHTML=["*","-","+","*"][a]},expand:function(){if(this._expandDeferred)return B(this._expandDeferred);this._collapseDeferred&&(this._collapseDeferred.cancel(),delete this._collapseDeferred);this.isExpanded=!0;this.labelNode.setAttribute("aria-expanded","true");(this.tree.showRoot||this!==this.tree.rootNode)&&
this.containerNode.setAttribute("role","group");h.add(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","true");var b=a.wipeIn({node:this.containerNode,duration:y.defaultDuration}),d=this._expandDeferred=new c(function(){b.stop()});n.after(b,"onEnd",function(){d.resolve(!0)},!0);b.play();return B(d)},collapse:function(){if(this._collapseDeferred)return B(this._collapseDeferred);
this._expandDeferred&&(this._expandDeferred.cancel(),delete this._expandDeferred);this.isExpanded=!1;this.labelNode.setAttribute("aria-expanded","false");this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","false");h.remove(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);var b=a.wipeOut({node:this.containerNode,duration:y.defaultDuration}),d=this._collapseDeferred=new c(function(){b.stop()});n.after(b,"onEnd",
function(){d.resolve(!0)},!0);b.play();return B(d)},indent:0,setChildItems:function(a){var b=this.tree,c=b.model,d=[],v=b.focusedChild,t=this.getChildren();l.forEach(t,function(a){z.prototype.removeChild.call(this,a)},this);this.defer(function(){l.forEach(t,function(a){if(!a._destroyed&&!a.getParent()){b.dndController.removeTreeNode(a);var d=function(a){var e=c.getIdentity(a.item),f=b._itemNodesMap[e];1==f.length?delete b._itemNodesMap[e]:(e=l.indexOf(f,a),-1!=e&&f.splice(e,1));l.forEach(a.getChildren(),
d)};d(a);if(b.persist){var e=l.map(a.getTreePath(),function(a){return b.model.getIdentity(a)}).join("/"),t;for(t in b._openedNodes)t.substr(0,e.length)==e&&delete b._openedNodes[t];b._saveExpandedNodes()}b.lastFocusedChild&&!f.isDescendant(b.lastFocusedChild,b.domNode)&&delete b.lastFocusedChild;v&&!f.isDescendant(v,b.domNode)&&b.focus();a.destroyRecursive()}})});this.state="Loaded";a&&0<a.length?(this.isExpandable=!0,l.forEach(a,function(a){var e=c.getIdentity(a),f=b._itemNodesMap[e],v;if(f)for(var t=
0;t<f.length;t++)if(f[t]&&!f[t].getParent()){v=f[t];v.set("indent",this.indent+1);break}v||(v=this.tree._createTreeNode({item:a,tree:b,isExpandable:c.mayHaveChildren(a),label:b.getLabel(a),labelType:b.model&&b.model.labelType||"text",tooltip:b.getTooltip(a),ownerDocument:b.ownerDocument,dir:b.dir,lang:b.lang,textDir:b.textDir,indent:this.indent+1}),f?f.push(v):b._itemNodesMap[e]=[v]);this.addChild(v);(this.tree.autoExpand||this.tree._state(v))&&d.push(b._expandNode(v))},this),l.forEach(this.getChildren(),
function(a){a._updateLayout()})):this.isExpandable=!1;this._setExpando&&this._setExpando(!1);this._updateItemClasses(this.item);a=e(d);this.tree._startPaint(a);return B(a)},getTreePath:function(){for(var a=this,b=[];a&&a!==this.tree.rootNode;)b.unshift(a.item),a=a.getParent();b.unshift(this.tree.rootNode.item);return b},getIdentity:function(){return this.tree.model.getIdentity(this.item)},removeChild:function(a){this.inherited(arguments);var b=this.getChildren();0==b.length&&(this.isExpandable=!1,
this.collapse());l.forEach(b,function(a){a._updateLayout()})},makeExpandable:function(){this.isExpandable=!0;this._setExpando(!1)},setSelected:function(a){this.labelNode.setAttribute("aria-selected",a?"true":"false");h.toggle(this.rowNode,"dijitTreeRowSelected",a)},focus:function(){D.focus(this.focusNode)}});q("dojo-bidi")&&H.extend({_setTextDirAttr:function(a){if(a&&(this.textDir!=a||!this._created))this._set("textDir",a),this.applyTextDir(this.labelNode),l.forEach(this.getChildren(),function(b){b.set("textDir",
a)},this)}});var G=k("dijit.Tree",[F,J,t,I],{baseClass:"dijitTree",store:null,model:null,query:null,label:"",showRoot:!0,childrenAttr:["children"],paths:[],path:[],selectedItems:null,selectedItem:null,openOnClick:!1,openOnDblClick:!1,templateString:L,persist:!1,autoExpand:!1,dndController:N,dndParams:"onDndDrop itemCreator onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,
dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(a,b){x.publish(this.id,u.mixin({tree:this,event:a},b||{}))},postMixInProperties:function(){this.tree=this;this.autoExpand&&(this.persist=!1);this._itemNodesMap={};!this.cookieName&&this.id&&(this.cookieName=this.id+"SaveStateCookie");this.expandChildrenDeferred=new c;this.pendingCommandsPromise=this.expandChildrenDeferred.promise;this.inherited(arguments)},postCreate:function(){this._initState();var a=this;this.own(m(this.containerNode,
m.selector(".dijitTreeNode",r.enter),function(b){a._onNodeMouseEnter(A.byNode(this),b)}),m(this.containerNode,m.selector(".dijitTreeNode",r.leave),function(b){a._onNodeMouseLeave(A.byNode(this),b)}),m(this.containerNode,m.selector(".dijitTreeRow",E.press),function(b){a._onNodePress(A.getEnclosingWidget(this),b)}),m(this.containerNode,m.selector(".dijitTreeRow",E),function(b){a._onClick(A.getEnclosingWidget(this),b)}),m(this.containerNode,m.selector(".dijitTreeRow","dblclick"),function(b){a._onDblClick(A.getEnclosingWidget(this),
b)}));this.model||this._store2model();this.own(n.after(this.model,"onChange",u.hitch(this,"_onItemChange"),!0),n.after(this.model,"onChildrenChange",u.hitch(this,"_onItemChildrenChange"),!0),n.after(this.model,"onDelete",u.hitch(this,"_onItemDelete"),!0));this.inherited(arguments);if(this.dndController){u.isString(this.dndController)&&(this.dndController=u.getObject(this.dndController));for(var b={},c=0;c<this.dndParams.length;c++)this[this.dndParams[c]]&&(b[this.dndParams[c]]=this[this.dndParams[c]]);
this.dndController=new this.dndController(this,b)}this._load();this.onLoadDeferred=B(this.pendingCommandsPromise);this.onLoadDeferred.then(u.hitch(this,"onLoad"))},_store2model:function(){this._v10Compat=!0;s.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var a={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};this.params.mayHaveChildren&&(a.mayHaveChildren=u.hitch(this,"mayHaveChildren"));this.params.getItemChildren&&
(a.getChildren=u.hitch(this,function(a,b,c){this.getItemChildren(this._v10Compat&&a===this.model.root?null:a,b,c)}));this.model=new M(a);this.showRoot=Boolean(this.label)},onLoad:function(){},_load:function(){this.model.getRoot(u.hitch(this,function(a){var b=this.rootNode=this.tree._createTreeNode({item:a,tree:this,isExpandable:!0,label:this.label||this.getLabel(a),labelType:this.model.labelType||"text",textDir:this.textDir,indent:this.showRoot?0:-1});this.showRoot?(this.domNode.setAttribute("aria-multiselectable",
!this.dndController.singular),this.rootLoadingIndicator.style.display="none"):(b.rowNode.style.display="none",this.domNode.setAttribute("role","presentation"),this.domNode.removeAttribute("aria-expanded"),this.domNode.removeAttribute("aria-multiselectable"),this["aria-label"]?(b.containerNode.setAttribute("aria-label",this["aria-label"]),this.domNode.removeAttribute("aria-label")):this["aria-labelledby"]&&(b.containerNode.setAttribute("aria-labelledby",this["aria-labelledby"]),this.domNode.removeAttribute("aria-labelledby")),
b.labelNode.setAttribute("role","presentation"),b.labelNode.removeAttribute("aria-selected"),b.containerNode.setAttribute("role","tree"),b.containerNode.setAttribute("aria-expanded","true"),b.containerNode.setAttribute("aria-multiselectable",!this.dndController.singular));this.containerNode.appendChild(b.domNode);a=this.model.getIdentity(a);this._itemNodesMap[a]?this._itemNodesMap[a].push(b):this._itemNodesMap[a]=[b];b._updateLayout();this._expandNode(b).then(u.hitch(this,function(){this._destroyed||
(this.rootLoadingIndicator.style.display="none",this.expandChildrenDeferred.resolve(!0))}))}),u.hitch(this,function(a){console.error(this,": error loading root: ",a)}))},getNodesByItem:function(a){if(!a)return[];a=u.isString(a)?a:this.model.getIdentity(a);return[].concat(this._itemNodesMap[a])},_setSelectedItemAttr:function(a){this.set("selectedItems",[a])},_setSelectedItemsAttr:function(a){var b=this;return this.pendingCommandsPromise=this.pendingCommandsPromise.always(u.hitch(this,function(){var c=
l.map(a,function(a){return!a||u.isString(a)?a:b.model.getIdentity(a)}),d=[];l.forEach(c,function(a){d=d.concat(b._itemNodesMap[a]||[])});this.set("selectedNodes",d)}))},_setPathAttr:function(a){return a.length?B(this.set("paths",[a]).then(function(a){return a[0]})):B(this.set("paths",[]).then(function(a){return a[0]}))},_setPathsAttr:function(a){function b(a,d){var e=a.shift(),f=l.filter(d,function(a){return a.getIdentity()==e})[0];if(f)return a.length?c._expandNode(f).then(function(){return b(a,
f.getChildren())}):f;throw new G.PathError("Could not expand path at "+e);}var c=this;return B(this.pendingCommandsPromise=this.pendingCommandsPromise.always(function(){return e(l.map(a,function(a){a=l.map(a,function(a){return a&&u.isObject(a)?c.model.getIdentity(a):a});if(a.length)return b(a,[c.rootNode]);throw new G.PathError("Empty path");}))}).then(function(a){c.set("selectedNodes",a);return c.paths}))},_setSelectedNodeAttr:function(a){this.set("selectedNodes",[a])},_setSelectedNodesAttr:function(a){this.dndController.setSelection(a)},
expandAll:function(){function a(c){return b._expandNode(c).then(function(){var b=l.filter(c.getChildren()||[],function(a){return a.isExpandable});return e(l.map(b,a))})}var b=this;return B(a(this.rootNode))},collapseAll:function(){function a(c){var d=l.filter(c.getChildren()||[],function(a){return a.isExpandable}),d=e(l.map(d,a));return!c.isExpanded||c==b.rootNode&&!b.showRoot?d:d.then(function(){return b._collapseNode(c)})}var b=this;return B(a(this.rootNode))},mayHaveChildren:function(){},getItemChildren:function(){},
getLabel:function(a){return this.model.getLabel(a)},getIconClass:function(a,b){return!a||this.model.mayHaveChildren(a)?b?"dijitFolderOpened":"dijitFolderClosed":"dijitLeaf"},getLabelClass:function(){},getRowClass:function(){},getIconStyle:function(){},getLabelStyle:function(){},getRowStyle:function(){},getTooltip:function(){return""},_onDownArrow:function(a,b){var c=this._getNext(b);c&&c.isTreeNode&&this.focusNode(c)},_onUpArrow:function(a,b){var c=b.getPreviousSibling();if(c)for(b=c;b.isExpandable&&
b.isExpanded&&b.hasChildren();)c=b.getChildren(),b=c[c.length-1];else if(c=b.getParent(),this.showRoot||c!==this.rootNode)b=c;b&&b.isTreeNode&&this.focusNode(b)},_onRightArrow:function(a,b){b.isExpandable&&!b.isExpanded?this._expandNode(b):b.hasChildren()&&(b=b.getChildren()[0])&&b.isTreeNode&&this.focusNode(b)},_onLeftArrow:function(a,b){if(b.isExpandable&&b.isExpanded)this._collapseNode(b);else{var c=b.getParent();c&&(c.isTreeNode&&(this.showRoot||c!==this.rootNode))&&this.focusNode(c)}},focusLastChild:function(){var a=
this._getLast();a&&a.isTreeNode&&this.focusNode(a)},_getFirst:function(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0]},_getLast:function(){for(var a=this.rootNode;a.isExpanded;){var b=a.getChildren();if(!b.length)break;a=b[b.length-1]}return a},_getNext:function(a){if(a.isExpandable&&a.isExpanded&&a.hasChildren())return a.getChildren()[0];for(;a&&a.isTreeNode;){var b=a.getNextSibling();if(b)return b;a=a.getParent()}return null},childSelector:".dijitTreeRow",isExpandoNode:function(a,
b){return f.isDescendant(a,b.expandoNode)||f.isDescendant(a,b.expandoNodeText)},_onNodePress:function(a,b){this.focusNode(a)},__click:function(a,b,c,d){var e=this.isExpandoNode(b.target,a);a.isExpandable&&(c||e)?this._onExpandoClick({node:a}):(this._publish("execute",{item:a.item,node:a,evt:b}),this[d](a.item,a,b),this.focusNode(a));b.stopPropagation();b.preventDefault()},_onClick:function(a,b){this.__click(a,b,this.openOnClick,"onClick")},_onDblClick:function(a,b){this.__click(a,b,this.openOnDblClick,
"onDblClick")},_onExpandoClick:function(a){a=a.node;this.focusNode(a);a.isExpanded?this._collapseNode(a):this._expandNode(a)},onClick:function(){},onDblClick:function(){},onOpen:function(){},onClose:function(){},_getNextNode:function(a){s.deprecated(this.declaredClass+"::_getNextNode(node) is deprecated. Use _getNext(node) instead.","","2.0");return this._getNext(a)},_getRootOrFirstNode:function(){s.deprecated(this.declaredClass+"::_getRootOrFirstNode() is deprecated. Use _getFirst() instead.","",
"2.0");return this._getFirst()},_collapseNode:function(a){a._expandNodeDeferred&&delete a._expandNodeDeferred;if("Loading"!=a.state&&a.isExpanded){var b=a.collapse();this.onClose(a.item,a);this._state(a,!1);this._startPaint(b);return b}},_expandNode:function(a){if(a._expandNodeDeferred)return a._expandNodeDeferred;var b=this.model,d=a.item,e=this;a._loadDeferred||(a.markProcessing(),a._loadDeferred=new c,b.getChildren(d,function(b){a.unmarkProcessing();a.setChildItems(b).then(function(){a._loadDeferred.resolve(b)})},
function(b){console.error(e,": error loading "+a.label+" children: ",b);a._loadDeferred.reject(b)}));b=a._loadDeferred.then(u.hitch(this,function(){var b=a.expand();this.onOpen(a.item,a);this._state(a,!0);return b}));this._startPaint(b);return b},focusNode:function(a){var b=this.domNode.scrollLeft;this.focusChild(a);this.domNode.scrollLeft=b},_onNodeMouseEnter:function(){},_onNodeMouseLeave:function(){},_onItemChange:function(a){var b=this.model.getIdentity(a);if(b=this._itemNodesMap[b]){var c=this.getLabel(a),
d=this.getTooltip(a);l.forEach(b,function(b){b.set({item:a,label:c,tooltip:d});b._updateItemClasses(a)})}},_onItemChildrenChange:function(a,b){var c=this.model.getIdentity(a);(c=this._itemNodesMap[c])&&l.forEach(c,function(a){a.setChildItems(b)})},_onItemDelete:function(a){a=this.model.getIdentity(a);var b=this._itemNodesMap[a];b&&(l.forEach(b,function(a){this.dndController.removeTreeNode(a);var b=a.getParent();b&&b.removeChild(a);this.lastFocusedChild&&!f.isDescendant(this.lastFocusedChild,this.domNode)&&
delete this.lastFocusedChild;this.focusedChild&&!f.isDescendant(this.focusedChild,this.domNode)&&this.focus();a.destroyRecursive()},this),delete this._itemNodesMap[a])},_initState:function(){this._openedNodes={};if(this.persist&&this.cookieName){var a=p(this.cookieName);a&&l.forEach(a.split(","),function(a){this._openedNodes[a]=!0},this)}},_state:function(a,b){if(!this.persist)return!1;var c=l.map(a.getTreePath(),function(a){return this.model.getIdentity(a)},this).join("/");if(1===arguments.length)return this._openedNodes[c];
b?this._openedNodes[c]=!0:delete this._openedNodes[c];this._saveExpandedNodes()},_saveExpandedNodes:function(){if(this.persist&&this.cookieName){var a=[],b;for(b in this._openedNodes)a.push(b);p(this.cookieName,a.join(","),{expires:365})}},destroy:function(){this._curSearch&&(this._curSearch.timer.remove(),delete this._curSearch);this.rootNode&&this.rootNode.destroyRecursive();this.dndController&&!u.isString(this.dndController)&&this.dndController.destroy();this.rootNode=null;this.inherited(arguments)},
destroyRecursive:function(){this.destroy()},resize:function(a){a&&d.setMarginBox(this.domNode,a);this._nodePixelIndent=d.position(this.tree.indentDetector).w||this._nodePixelIndent;this.expandChildrenDeferred.then(u.hitch(this,function(){this.rootNode.set("indent",this.showRoot?0:-1);this._adjustWidths()}))},_outstandingPaintOperations:0,_startPaint:function(a){this._outstandingPaintOperations++;this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);var b=u.hitch(this,
function(){this._outstandingPaintOperations--;0>=this._outstandingPaintOperations&&(!this._adjustWidthsTimer&&this._started)&&(this._adjustWidthsTimer=this.defer("_adjustWidths"))});C(a,b,b)},_adjustWidths:function(){this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);this.containerNode.style.width="auto";this.containerNode.style.width=this.domNode.scrollWidth>this.domNode.offsetWidth?"auto":"100%"},_createTreeNode:function(a){return new H(a)},focus:function(){this.lastFocusedChild?
this.focusNode(this.lastFocusedChild):this.focusFirstChild()}});q("dojo-bidi")&&G.extend({_setTextDirAttr:function(a){a&&this.textDir!=a&&(this._set("textDir",a),this.rootNode.set("textDir",a))}});G.PathError=b("TreePathError");G._TreeNode=H;return G})},"dijit/tree/TreeStoreModel":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(l,n,p,k){return p("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",
root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(c){k.mixin(this,c);this.connects=[];c=this.store;if(!c.getFeatures()["dojo.data.api.Identity"])throw Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");c.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([n.after(c,"onNew",k.hitch(this,"onNewItem"),!0),n.after(c,"onDelete",k.hitch(this,"onDeleteItem"),!0),n.after(c,"onSet",k.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var c;c=
this.connects.pop();)c.remove()},getRoot:function(c,e){this.root?c(this.root):this.store.fetch({query:this.query,onComplete:k.hitch(this,function(e){if(1!=e.length)throw Error("dijit.tree.TreeStoreModel: root query returned "+e.length+" items, but must return exactly one");this.root=e[0];c(this.root)}),onError:e})},mayHaveChildren:function(c){return l.some(this.childrenAttrs,function(e){return this.store.hasAttribute(c,e)},this)},getChildren:function(c,e,f){var h=this.store;if(h.isItemLoaded(c)){for(var d=
[],g=0;g<this.childrenAttrs.length;g++)var b=h.getValues(c,this.childrenAttrs[g]),d=d.concat(b);var a=0;this.deferItemLoadingUntilExpand||l.forEach(d,function(b){h.isItemLoaded(b)||a++});0==a?e(d):l.forEach(d,function(b,c){h.isItemLoaded(b)||h.loadItem({item:b,onItem:function(b){d[c]=b;0==--a&&e(d)},onError:f})})}else{var q=k.hitch(this,arguments.callee);h.loadItem({item:c,onItem:function(a){q(a,e,f)},onError:f})}},isItem:function(c){return this.store.isItem(c)},fetchItemByIdentity:function(c){this.store.fetchItemByIdentity(c)},
getIdentity:function(c){return this.store.getIdentity(c)},getLabel:function(c){return this.labelAttr?this.store.getValue(c,this.labelAttr):this.store.getLabel(c)},newItem:function(c,e,f){var h={parent:e,attribute:this.childrenAttrs[0]},d;this.newItemIdAttr&&c[this.newItemIdAttr]?this.fetchItemByIdentity({identity:c[this.newItemIdAttr],scope:this,onItem:function(g){g?this.pasteItem(g,null,e,!0,f):(d=this.store.newItem(c,h))&&void 0!=f&&this.pasteItem(d,e,e,!1,f)}}):(d=this.store.newItem(c,h))&&void 0!=
f&&this.pasteItem(d,e,e,!1,f)},pasteItem:function(c,e,f,h,d){var g=this.store,b=this.childrenAttrs[0];e&&l.forEach(this.childrenAttrs,function(a){if(g.containsValue(e,a,c)){if(!h){var d=l.filter(g.getValues(e,a),function(a){return a!=c});g.setValues(e,a,d)}b=a}});if(f)if("number"==typeof d){var a=g.getValues(f,b).slice();a.splice(d,0,c);g.setValues(f,b,a)}else g.setValues(f,b,g.getValues(f,b).concat(c))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(c,
e){e&&this.getChildren(e.item,k.hitch(this,function(c){this.onChildrenChange(e.item,c)}))},onDeleteItem:function(c){this.onDelete(c)},onSetItem:function(c,e){if(-1!=l.indexOf(this.childrenAttrs,e))this.getChildren(c,k.hitch(this,function(e){this.onChildrenChange(c,e)}));else this.onChange(c)}})})},"dijit/tree/ForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","./TreeStoreModel"],function(l,n,p,k,c){return n("dijit.tree.ForestStoreModel",
c,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(c){this.root={store:this,root:!0,id:c.rootId,label:c.rootLabel,children:c.rootChildren}},mayHaveChildren:function(c){return c===this.root||this.inherited(arguments)},getChildren:function(c,f,h){c===this.root?this.root.children?f(this.root.children):this.store.fetch({query:this.query,onComplete:k.hitch(this,function(c){this.root.children=c;f(c)}),onError:h}):this.inherited(arguments)},isItem:function(c){return c===this.root?!0:this.inherited(arguments)},
fetchItemByIdentity:function(c){if(c.identity==this.root.id){var f=c.scope||p.global;c.onItem&&c.onItem.call(f,this.root)}else this.inherited(arguments)},getIdentity:function(c){return c===this.root?this.root.id:this.inherited(arguments)},getLabel:function(c){return c===this.root?this.root.label:this.inherited(arguments)},newItem:function(c,f,h){return f===this.root?(this.onNewRootItem(c),this.store.newItem(c)):this.inherited(arguments)},onNewRootItem:function(){},pasteItem:function(c,f,h,d,g){if(f===
this.root&&!d)this.onLeaveRoot(c);this.inherited(arguments,[c,f===this.root?null:f,h===this.root?null:h,d,g]);if(h===this.root)this.onAddToRoot(c)},onAddToRoot:function(c){console.log(this,": item ",c," added to root")},onLeaveRoot:function(c){console.log(this,": item ",c," removed from root")},_requeryTop:function(){var c=this.root.children||[];this.store.fetch({query:this.query,onComplete:k.hitch(this,function(f){this.root.children=f;if(c.length!=f.length||l.some(c,function(c,d){return f[d]!=c}))this.onChildrenChange(this.root,
f)})})},onNewItem:function(c,f){this._requeryTop();this.inherited(arguments)},onDeleteItem:function(c){-1!=l.indexOf(this.root.children,c)&&this._requeryTop();this.inherited(arguments)},onSetItem:function(c,f,h,d){this._requeryTop();this.inherited(arguments)}})})},"dijit/tree/_dndSelector":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/dnd/common dojo/dom dojo/mouse dojo/on dojo/touch ../a11yclick ./_dndContainer".split(" "),function(l,n,p,k,c,e,f,h,
d,g,b){return n("dijit.tree._dndSelector",b,{constructor:function(){this.selection={};this.anchor=null;this.events.push(h(this.tree.domNode,d.press,k.hitch(this,"onMouseDown")),h(this.tree.domNode,d.release,k.hitch(this,"onMouseUp")),h(this.tree.domNode,d.move,k.hitch(this,"onMouseMove")),h(this.tree.domNode,g.press,k.hitch(this,"onClickPress")),h(this.tree.domNode,g.release,k.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var a=[],b=this.selection,c;for(c in b)a.push(b[c]);
return a},selectNone:function(){this.setSelection([]);return this},destroy:function(){this.inherited(arguments);this.selection=this.anchor=null},addTreeNode:function(a,b){this.setSelection(this.getSelectedTreeNodes().concat([a]));b&&(this.anchor=a);return a},removeTreeNode:function(a){var b=l.filter(this.getSelectedTreeNodes(),function(b){return!e.isDescendant(b.domNode,a.domNode)});this.setSelection(b);return a},isTreeNodeSelected:function(a){return a.id&&!!this.selection[a.id]},setSelection:function(a){var b=
this.getSelectedTreeNodes();l.forEach(this._setDifference(b,a),k.hitch(this,function(a){a.setSelected(!1);this.anchor==a&&delete this.anchor;delete this.selection[a.id]}));l.forEach(this._setDifference(a,b),k.hitch(this,function(a){a.setSelected(!0);this.selection[a.id]=a}));this._updateSelectionProperties()},_setDifference:function(a,b){l.forEach(b,function(a){a.__exclude__=!0});var c=l.filter(a,function(a){return!a.__exclude__});l.forEach(b,function(a){delete a.__exclude__});return c},_updateSelectionProperties:function(){var a=
this.getSelectedTreeNodes(),b=[],c=[];l.forEach(a,function(a){var d=a.getTreePath();c.push(a);b.push(d)},this);a=l.map(c,function(a){return a.item});this.tree._set("paths",b);this.tree._set("path",b[0]||[]);this.tree._set("selectedNodes",c);this.tree._set("selectedNode",c[0]||null);this.tree._set("selectedItems",a);this.tree._set("selectedItem",a[0]||null)},onClickPress:function(a){if(!this.current||!this.current.isExpandable||!this.tree.isExpandoNode(a.target,this.current)){"mousedown"==a.type&&
f.isLeft(a)&&a.preventDefault();var b="keydown"==a.type?this.tree.focusedChild:this.current;if(b){var d=c.getCopyKeyState(a),e=b.id;!this.singular&&!a.shiftKey&&this.selection[e]?this._doDeselect=!0:(this._doDeselect=!1,this.userSelect(b,d,a.shiftKey))}}},onClickRelease:function(a){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==a.type?this.tree.focusedChild:this.current,c.getCopyKeyState(a),a.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},
_compareNodes:function(a,b){if(a===b)return 0;if("sourceIndex"in document.documentElement)return a.sourceIndex-b.sourceIndex;if("compareDocumentPosition"in document.documentElement)return a.compareDocumentPosition(b)&2?1:-1;if(document.createRange){var c=doc.createRange();c.setStartBefore(a);var d=doc.createRange();d.setStartBefore(b);return c.compareBoundaryPoints(c.END_TO_END,d)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser");},userSelect:function(a,
b,c){if(this.singular)this.anchor==a&&b?this.selectNone():(this.setSelection([a]),this.anchor=a);else if(c&&this.anchor){b=this._compareNodes(this.anchor.rowNode,a.rowNode);c=this.anchor;0>b?b=c:(b=a,a=c);for(c=[];b!=a;)c.push(b),b=this.tree._getNext(b);c.push(a);this.setSelection(c)}else this.selection[a.id]&&b?this.removeTreeNode(a):b?this.addTreeNode(a,!0):(this.setSelection([a]),this.anchor=a)},getItem:function(a){return{data:this.selection[a],type:["treeNode"]}},forInSelectedItems:function(a,
b){b=b||p.global;for(var c in this.selection)a.call(b,this.getItem(c),c,this)}})})},"dijit/tree/_dndContainer":function(){define("dojo/aspect dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/on dojo/touch".split(" "),function(l,n,p,k,c,e){return n("dijit.tree._dndContainer",null,{constructor:function(f,h){this.tree=f;this.node=f.domNode;k.mixin(this,h);this.containerState="";p.add(this.node,"dojoDndContainer");this.events=[c(this.node,e.enter,k.hitch(this,"onOverEvent")),c(this.node,e.leave,
k.hitch(this,"onOutEvent")),l.after(this.tree,"_onNodeMouseEnter",k.hitch(this,"onMouseOver"),!0),l.after(this.tree,"_onNodeMouseLeave",k.hitch(this,"onMouseOut"),!0),c(this.node,"dragstart, selectstart",function(c){c.preventDefault()})]},destroy:function(){for(var c;c=this.events.pop();)c.remove();this.node=this.parent=null},onMouseOver:function(c){this.current=c},onMouseOut:function(){this.current=null},_changeState:function(c,e){var d="dojoDnd"+c,g=c.toLowerCase()+"State";p.replace(this.node,d+
e,d+this[g]);this[g]=e},_addItemClass:function(c,e){p.add(c,"dojoDndItem"+e)},_removeItemClass:function(c,e){p.remove(c,"dojoDndItem"+e)},onOverEvent:function(){this._changeState("Container","Over")},onOutEvent:function(){this._changeState("Container","")}})})},"jimu/dijit/LayerChooserFromMapWithDropbox":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/Evented dojo/Deferred dijit/popup dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/LayerChooserFromMapWithDropbox.html jimu/LayerInfos/LayerInfos".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b){return l([h,d,c],{templateString:g,baseClass:"jimu-layer-chooser-from-map-withdropbox",declaredClass:"jimu.dijit.LayerChooserFromMapWithDropbox",_selectedItem:null,_isLayerChooserShow:!1,layerInfosObj:null,layerChooser:null,postCreate:function(){this.inherited(arguments);this.layerInfosObj=b.getInstanceSync();p.addClass(this.layerChooser.domNode,"jimu-layer-chooser-from-map-withdropbox-popup");this.layerChooser.domNode.style.zIndex=1;this.layerChooser.tree.domNode.style.borderTop=
"0";this.own(k(this.layerChooser,"tree-click",n.hitch(this,this._onTreeClick)));this.own(k(this.layerChooser,"update",n.hitch(this,this._onLayerChooserUpdate)));this.own(k(document.body,"click",n.hitch(this,this._onBodyClicked)))},destroy:function(){this.hideLayerChooser();this.layerChooser&&this.layerChooser.destroy();this.layerChooser=null;this.inherited(arguments)},getLayerChooser:function(){return this.layerChooser},setSelectedLayer:function(a){var b=new e;if(a){var c=this.layerInfosObj.getLayerInfoById(a.id);
c?this.layerChooser.filter(c).then(n.hitch(this,function(d){d?(this._onSelectNewItem({layerInfo:c,name:c.title,url:a.url}),b.resolve(!0)):b.resolve(!1)}),n.hitch(this,function(){b.resolve(!1)})):b.resolve(!1)}else this._onSelectNewItem(null),b.resolve(!0);return b},getSelectedItem:function(){return this._selectedItem},getSelectedItems:function(){return[this._selectedItem]},_onBodyClicked:function(a){a=a.target||a.srcElement;a===this.domNode||p.isDescendant(a,this.domNode)||a===this.layerChooser.domNode||
p.isDescendant(a,this.layerChooser.domNode)||this.hideLayerChooser()},_onDropDownClick:function(a){a.stopPropagation();a.preventDefault();this._isLayerChooserShow?this.hideLayerChooser():this.showLayerChooser()},_getSelectedItems:function(){return this.layerChooser.getSelectedItems()},showLayerChooser:function(){var a=this.domNode.clientWidth;200>a&&(a=200);this.layerChooser.domNode.style.width=a+2+"px";f.open({parent:this,popup:this.layerChooser,around:this.domNode});(a=this.layerChooser.domNode.parentNode)&&
p.addClass(a,"jimu-layer-chooser-from-map-withdropbox-popup");this._isLayerChooserShow=!0},hideLayerChooser:function(){f.close(this.layerChooser);this._isLayerChooserShow=!1},_onLayerChooserUpdate:function(){this._selectedItem&&this.layerChooser.onlyShowVisible&&!this._selectedItem.layerInfo.isShowInMap()&&(this._selectedItem=null,this.emit("selection-change",[]))},_onSelectNewItem:function(a){var b=n.getObject("layerInfo.id",!1,this._selectedItem)||-1,c=n.getObject("layerInfo.id",!1,a)||-1,b=b!==
c;this._selectedItem=a;this.hideLayerChooser();a=n.getObject("layerInfo.title",!1,this._selectedItem)||"";this.layerNameNode.innerHTML=a;a=n.getObject("layerInfo.layerObject",!1,this._selectedItem);b&&this.emit("selection-change",[a])},_onTreeClick:function(){var a=this._getSelectedItems();this._onSelectNewItem(0<a.length?a[0]:null)}})})},"jimu/dijit/FeatureSetChooserForSingleLayer":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin jimu/dijit/DrawBox jimu/dijit/_FeatureSetChooserCore".split(" "),
function(l,n,p,k,c,e,f,h,d,g){return c([e,f,h,n],{baseClass:"jimu-single-layer-featureset-chooser",templateString:"\x3cdiv\x3e\x3c/div\x3e",drawBox:null,map:null,featureLayer:null,updateSelection:!1,postCreate:function(){this.inherited(arguments);this.drawBox=new d({map:this.map,showClear:!0,keepOneGraphic:!0,geoTypes:["EXTENT"]});var b=this.drawBox.getDrawItemIcons();k.forEach(b,p.hitch(this,function(a){a.title=""}));this.drawBox.extentIcon.title=window.jimuNls.spatialFilterByFeatures.drawShapesTip;
this.drawBox.placeAt(this.domNode);this.own(l(this.drawBox,"user-clear",p.hitch(this,this._onDrawBoxUserClear)));this.own(l(this.drawBox,"draw-activate",p.hitch(this,function(){this.emit("draw-activate")})));this.own(l(this.drawBox,"draw-deactivate",p.hitch(this,function(){this.emit("draw-deactivate")})));this.own(l(this.drawBox,"draw-end",p.hitch(this,this._onDrawEnd)));this.featureSetChooserCore=new g({map:this.map,featureLayer:this.featureLayer,drawBox:this.drawBox,updateSelection:this.updateSelection});
this.own(l(this.featureSetChooserCore,"loading",p.hitch(this,function(){this.emit("loading")})));this.own(l(this.featureSetChooserCore,"unloading",p.hitch(this,function(){this.emit("unloading")})));this.own(l(this.featureLayer,"visibility-change",p.hitch(this,function(){this.featureLayer.visible?this.drawBox.enable():this.drawBox.disable()})))},getFeatures:function(){return this.featureSetChooserCore.getFeatures()},syncGetFeatures:function(){return this.featureSetChooserCore.syncGetFeatures()},disable:function(){this.drawBox.disable()},
enable:function(){this.drawBox.enable()},deactivate:function(){this.drawBox.deactivate()},clearAllGraphics:function(){this.featureSetChooserCore.clear(!1)},isLoading:function(){return this.featureSetChooserCore.isLoading()},getFeatureLayer:function(){return this.featureLayer},destroy:function(){this.featureSetChooserCore&&this.featureSetChooserCore.destroy();this.featureSetChooserCore=null;this.inherited(arguments)},_onDrawEnd:function(){this.drawBox.clear()},_onDrawBoxUserClear:function(){this.clearAllGraphics();
this.emit("user-clear")}})})},"jimu/dijit/_FeatureSetChooserCore":function(){define("dojo/on dojo/sniff dojo/Evented dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/declare jimu/utils jimu/symbolUtils jimu/SelectionManager jimu/LayerInfos/LayerInfos esri/graphic esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer".split(" "),function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w){return f([p],{baseClass:"jimu-featureset-chooser-core",_middleFeatureLayer:null,_isLoading:!1,_def:null,_isDestroyed:!1,
_handles:null,selectionManager:null,layerInfosObj:null,map:null,featureLayer:null,drawBox:null,updateSelection:!1,fullyWithin:!1,constructor:function(a){c.mixin(this,a);this.layerInfosObj=b.getInstanceSync();this.selectionManager=g.getInstance();this.featureLayer.getSelectionSymbol()||this.selectionManager.setSelectionSymbol(this.featureLayer);a=h.getFeatureLayerDefinition(this.featureLayer);delete a.id;this._middleFeatureLayer=new w({layerDefinition:a,featureSet:null},{id:"featureLayer_"+h.getRandomString()});
a=null;var e=this._middleFeatureLayer.geometryType;"esriGeometryPoint"===e?a=d.getDefaultMarkerSymbol():"esriGeometryPolyline"===e?a=d.getDefaultLineSymbol():"esriGeometryPolygon"===e&&(a=d.getDefaultFillSymbol());this._middleFeatureLayer.setSelectionSymbol(a);a=l(this.drawBox,"user-clear",c.hitch(this,this._onDrawBoxUserClear));e=l(this.drawBox,"draw-end",c.hitch(this,this._onDrawEnd));this._handles=[a,e]},clear:function(a){this.drawBox.clear();this._clearMiddleFeatureLayer();a&&this.selectionManager.clearSelection(this.featureLayer)},
getFeatures:function(){var a=new k,b=c.hitch(this,function(){var b=this.syncGetFeatures();a.resolve(b)}),d=c.hitch(this,function(b){a.reject(b)});1===this._getDeferredStatus(this._def)?this._def.then(b,d):b();return a},syncGetFeatures:function(){return(this.updateSelection?this.featureLayer:this._middleFeatureLayer).getSelectedFeatures()},isLoading:function(){return 1===this._getDeferredStatus(this._def)},_onLoading:function(){this.drawBox.deactivate();this.emit("loading")},_onUnloading:function(){this.emit("unloading")},
_getDeferredStatus:function(a){var b=0;return b=a?a.isResolved()?2:a.isRejected()?-1:1:0},_onDrawEnd:function(a,b,d,e,f,g){console.log(b,d);if(this.isLoading())throw"should not draw when loading";if(this.featureLayer.visible){var h=new k;this._def=h;var l=w.SELECTION_NEW;e&&(l=w.SELECTION_ADD);n("mac")?g&&(l=w.SELECTION_SUBTRACT):f&&(l=w.SELECTION_SUBTRACT);this._onLoading();this._getFeaturesByGeometry(a.geometry).then(c.hitch(this,function(a){this.selectionManager.updateSelectionByFeatures(this.updateSelection?
this.featureLayer:this._middleFeatureLayer,a,l);this._onUnloading();h.resolve(a)}),c.hitch(this,function(a){console.error(a);this._onUnloading();h.reject(a)}))}},_getFeaturesByGeometry:function(b){var d=new k,f=[];if(this.featureLayer.getMap())b=this.selectionManager.getClientFeaturesByGeometry(this.featureLayer,b,this.fullyWithin),0<b.length&&(f=e.map(b,c.hitch(this,function(b){return new a(b.toJson())}))),d.resolve(f);else{f=new q;f.geometry=b;f.outSpatialReference=this.map.spatialReference;f.returnGeometry=
!0;(b=this.featureLayer.getDefinitionExpression())||(b="1\x3d1");var g=this.layerInfosObj.getLayerInfoById(this.featureLayer.id);g&&(g=g.getFilter())&&(b="("+b+") AND ("+g+")");b&&(f.where=b);f.outFields=["*"];(new s(this.featureLayer.url)).execute(f).then(c.hitch(this,function(a){d.resolve(a.features)}),c.hitch(this,function(a){d.reject(a)}))}return d},_onDrawBoxUserClear:function(){this.clear()},_clearMiddleFeatureLayer:function(){this._middleFeatureLayer&&(this._middleFeatureLayer.clear(),this.selectionManager.clearSelection(this._middleFeatureLayer))},
destroy:function(){this._isDestroyed||(e.forEach(this._handles,c.hitch(this,function(a){a.remove()})),this._handles=null,this.clear());this._isDestroyed=!0}})})},"widgets/Query/SingleQueryResult":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./SingleQueryResult.html dojo/_base/lang dojo/_base/query dojo/_base/html dojo/_base/array dojo/Deferred esri/lang esri/tasks/QueryTask esri/tasks/FeatureSet esri/symbols/jsonUtils esri/dijit/PopupTemplate esri/dijit/PopupRenderer esri/tasks/RelationshipQuery jimu/utils jimu/symbolUtils jimu/dijit/Message jimu/dijit/PopupMenu jimu/BaseFeatureAction jimu/LayerInfos/LayerInfos jimu/FeatureActionManager ./SingleQueryLoader ./RelatedRecordsResult jimu/dijit/LoadingShelter".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w,u,m,x,r,C,E,D,A,y,F,t,z){return l([n,p,k,c],{baseClass:"single-query-result",templateString:e,singleQueryLoader:null,featureLayer:null,relatedRecordsResult:null,popupMenu:null,map:null,nls:null,currentAttrs:null,queryWidget:null,getCurrentAttrs:function(){return this.singleQueryLoader?this.singleQueryLoader.getCurrentAttrs():null},postCreate:function(){this.inherited(arguments);this.singleQueryLoader=new t(this.map,this.currentAttrs);this.popupMenu=D.getInstance();
this.featureActionManager=F.getInstance()},destroy:function(){this.queryWidget=null;var a=this.getCurrentAttrs();a&&a.query&&(a.query.resultLayer&&a.query.resultLayer.getMap()&&this.map.removeLayer(a.query.resultLayer),a.query.resultLayer=null);this.inherited(arguments)},zoomToLayer:function(){var a=this.getCurrentAttrs(),b=a.query.resultLayer;b&&!this._isTable(a.layerInfo)&&(a=g.filter(b.graphics,f.hitch(this,function(a){return!!a.geometry})),0<a.length&&(a=r.graphicsExtent(a,1.4))&&this.map.setExtent(a))},
executeQueryForFirstTime:function(){var a=new b;this._clearResultPage();this._hideResultsNumberDiv();var c=this.getCurrentAttrs(),d=c.query.resultLayer,e=f.hitch(this,function(b){if(this.domNode){this.shelter.hide();var e=c.query.allCount;this._updateNumSpan(e);0<e&&(this._addResultItems(b,d),this._addResultLayerToMap(d));a.resolve(e)}}),t=f.hitch(this,function(b){console.error(b);this.domNode&&(this.shelter.hide(),d&&this.map.removeLayer(d),d=null,this._showQueryErrorMsg(),a.reject(b))});this.shelter.show();
3!==c.queryType&&this._showResultsNumberDiv();this.singleQueryLoader.executeQueryForFirstTime().then(e,t);return a},_addResultLayerToMap:function(a){0>this.map.graphicsLayerIds.indexOf(a.id)&&this.map.addLayer(a)},_showResultsNumberDiv:function(){d.setStyle(this.resultsNumberDiv,"display","block")},_hideResultsNumberDiv:function(){d.setStyle(this.resultsNumberDiv,"display","none")},_updateNumSpan:function(a){this.numSpan.innerHTML=r.localizeNumber(a)},_isTable:function(a){return"Table"===a.type},
_onResultsScroll:function(){if(r.isScrollToBottom(this.resultsContainer)){var a=this.getCurrentAttrs();if(!(a.query.nextIndex>=a.query.allCount)){var b=a.query.resultLayer,a=f.hitch(this,function(a){this.domNode&&(this.shelter.hide(),this._addResultItems(a,b))}),c=f.hitch(this,function(a){console.error(a);this.domNode&&(this._showQueryErrorMsg(),this.shelter.hide())});this.shelter.show();this.singleQueryLoader.executeQueryWhenScrollToBottom().then(a,c)}}},_clearResultPage:function(){this._hideInfoWindow();
this._unSelectResultTr();d.empty(this.resultsTbody);this._updateNumSpan(0)},_unSelectResultTr:function(){this.resultTr&&d.removeClass(this.resultTr,"jimu-state-active");this.resultTr=null},_selectResultTr:function(a){this._unSelectResultTr();(this.resultTr=a)&&d.addClass(this.resultTr,"jimu-state-active")},_addResultItems:function(a,b){var c=this.getCurrentAttrs(),d=null,e=c.config.url,t=c.config.objectIdField;c.config.resultsSymbol&&(d=w.fromJson(c.config.resultsSymbol));var h=this._getCurrentRelationships(),
l=f.clone(c.config.popupInfo);l.mediaInfos=[];var k=new u(l),m=!0;b.renderer||(m=!1);g.forEach(a,f.hitch(this,function(a,f){var v="",v=0===f%2?"even":"odd";a.geometry&&d&&a.setSymbol(d);b.add(a);this._createQueryResultItem({resultLayer:b,feature:a,trClass:v,popupTemplate2:k,relationships:h,objectIdField:t,url:e,relationshipPopupTemplates:c.relationshipPopupTemplates,shouldCreateSymbolNode:m})}));this.zoomToLayer()},_createQueryResultItem:function(a){var b=a.resultLayer,c=a.feature,e=a.trClass,t=a.popupTemplate2,
l=a.relationships,k=a.objectIdField,n=a.url,z=a.relationshipPopupTemplates;a=a.shouldCreateSymbolNode;if(c&&c.attributes){var p=c.attributes[k],k=d.toDom('\x3ctr class\x3d"jimu-table-row jimu-table-row-separator query-result-item"  cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctd\x3e\x3ctable class\x3d"query-result-item-table"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd class\x3d"symbol-td"\x3e\x3c/td\x3e\x3ctd class\x3d"popup-td"\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e');
d.addClass(k,e);d.place(k,this.resultsTbody);k.feature=c;e=h(".symbol-td",k)[0];if(a)try{var q=b.renderer;if(q){var r=q.getSymbol(c);if(r){var s=C.createSymbolNode(r,{width:32,height:32});s&&d.place(s,e)}}}catch(u){console.error(u)}else d.destroy(e);var x=h(".popup-td",k)[0],b=new m({template:t,graphic:c,chartTheme:t.chartTheme});d.place(b.domNode,x);b.startup();l&&0<l.length&&g.forEach(l,f.hitch(this,function(a){var b=this._getRelationshipLyaerInfo(a.relatedTableId),c=b.name,e=z[a.relatedTableId],
f=d.create("div",{"class":"related-table-btn",innerHTML:c},x);f.queryStatus="unload";f.url=n;f.layerName=c;f.objectId=p;f.relationship=a;f.relationshipLayerInfo=b;f.relationshipPopupTemplate=e}))}},_onBtnRelatedBackClicked:function(){this._showFeaturesResultDiv()},_showFeaturesResultDiv:function(){this.relatedRecordsResult&&this.relatedRecordsResult.destroy();this.relatedRecordsResult=null;d.removeClass(this.featuresResultDiv,"not-visible");d.addClass(this.relatedRecordsResultDiv,"not-visible");this.emit("hide-related-records")},
_showRelatedRecordsDiv:function(){d.addClass(this.featuresResultDiv,"not-visible");d.removeClass(this.relatedRecordsResultDiv,"not-visible");this.emit("show-related-records")},_onRelatedTableButtonClicked:function(a){this.relatedRecordsResult&&this.relatedRecordsResult.destroy();this.relatedRecordsResult=null;var b=a.url,c=a.layerName,d=a.objectId,e=a.relationship,t=a.relationshipLayerInfo,h=a.relationshipPopupTemplate;this.relatedRecordsResult=new z({map:this.map,layerDefinition:t,nls:this.nls});
this.relatedRecordsResult.placeAt(this.relatedRecordsResultDiv,"first");this._showRelatedRecordsDiv();var l=f.hitch(this,function(){var b=new s;b.fields=f.clone(t.fields);b.features=a.relatedFeatures;b.geometryType=t.geometryType;b.fieldAliases={};g.forEach(b.fields,f.hitch(this,function(a){var c=a.name;b.fieldAliases[c]=a.alias||c}));this.relatedRecordsResult.setResult(h,b);this.relatedTitleDiv.innerHTML=c});if("unload"===a.queryStatus){a.queryStatus="loading";this.shelter.show();var b=new q(b),
k=new x;k.objectIds=[d];k.relationshipId=e.id;k.outFields=["*"];k.returnGeometry=!0;k.outSpatialReference=this.map.spatialReference;b.executeRelationshipQuery(k).then(f.hitch(this,function(b){this.domNode&&(this.shelter.hide(),b=(b=(b=b&&b[d])&&b.features)||[],a.relatedFeatures=b,a.queryStatus="loaded",l())}),f.hitch(this,function(b){this.domNode&&(this.shelter.hide(),console.error(b),a.queryStatus="unload",l())}))}else"loaded"===a.queryStatus&&l()},_getCurrentRelationships:function(){return this.getCurrentAttrs().queryTr.layerInfo.relationships||
[]},_getRelationshipInfo:function(a){for(var b=this._getCurrentRelationships(),c=0;c<b.length;c++)if(b[c].id===a)return b[c];return null},_getRelationshipLyaerInfo:function(a){return this.getCurrentAttrs().relationshipLayerInfos[a]},_tryLocaleNumber:function(b){var c=b;if(a.isDefined(b)&&isFinite(b))try{var d=r.localizeNumber(b);"string"===typeof d&&(c=d)}catch(e){console.error(e)}return c+""},_showQueryErrorMsg:function(a){new E({message:a||this.nls.queryError})},_onResultsTableClicked:function(a){a=
a.target||a.srcElement;if(d.isDescendant(a,this.resultsTable))if(d.hasClass(a,"related-table-btn"))this._onRelatedTableButtonClicked(a);else if(a=r.getAncestorDom(a,f.hitch(this,function(a){return d.hasClass(a,"query-result-item")}),this.resultsTbody)){this._selectResultTr(a);d.addClass(a,"jimu-state-active");var c=a.feature;if(a=c.geometry){var e=a.type,t,g=null;if("point"===e||"multipoint"===e){var h=f.hitch(this,function(){g=new b;var a=this.map.getNumLevels(),c=this.map.getLevel(),a=Math.max(c,
Math.floor(2*a/3));0<=this.map.getMaxZoom()?this.map.setLevel(a).then(f.hitch(this,function(){this.map.centerAt(t).then(f.hitch(this,function(){g.resolve()}))})):this.map.centerAt(t).then(f.hitch(this,function(){g.resolve()}))});if("point"===e)t=a,h();else if("multipoint"===e)if(1===a.points.length)t=a.getPoint(0),h();else if(1<a.points.length&&(e=a.getExtent()))e=e.expand(1.4),t=a.getPoint(0),g=this.map.setExtent(e)}else"polyline"===e?(e=a.getExtent(),e=e.expand(1.4),t=e.getCenter(),g=this.map.setExtent(e)):
"polygon"===e?(e=a.getExtent(),e=e.expand(1.4),t=e.getCenter(),g=this.map.setExtent(e)):"extent"===e&&(e=a.expand(1.4),t=e.getCenter(),g=this.map.setExtent(e));g&&g.then(f.hitch(this,function(){"function"===typeof this.map.infoWindow.setFeatures&&this.map.infoWindow.setFeatures([c]);"function"===typeof this.map.infoWindow.reposition&&this.map.infoWindow.reposition();this.map.infoWindow.show(t)}))}}},_hideInfoWindow:function(){this.map&&this.map.infoWindow&&(this.map.infoWindow.hide(),"function"===
typeof this.map.infoWindow.setFeatures&&this.map.infoWindow.setFeatures([]))},_getFeatureSet:function(){var a=this.currentAttrs.query.resultLayer,b=new s;b.fields=f.clone(a.fields);b.features=[].concat(a.graphics);b.geometryType=a.geometryType;b.fieldAliases={};g.forEach(b.fields,f.hitch(this,function(a){var c=a.name;b.fieldAliases[c]=a.alias||c}));return b},_onBtnMenuClicked:function(a){var b=d.position(a.target||a.srcElement),c=this._getFeatureSet(),e=this.getCurrentAttrs();this.featureActionManager.getSupportedActions(c,
e.query.resultLayer).then(f.hitch(this,function(a){g.forEach(a,f.hitch(this,function(a){a.data=c}));if(!e.config.enableExport){var d=["ExportToCSV","ExportToFeatureCollection","ExportToGeoJSON"];a=g.filter(a,f.hitch(this,function(a){return 0>d.indexOf(a.name)}))}a=g.filter(a,f.hitch(this,function(a){return"CreateLayer"!==a.name}));var t=new A({name:"RemoveQueryResult",iconClass:"icon-close",label:this.nls.removeThisResult,iconFormat:"svg",map:this.map,onExecute:f.hitch(this,this._removeResult)});
t.name="RemoveQueryResult";t.data=c;a.push(t);this.popupMenu.setActions(a);this.popupMenu.show(b)}))},_removeResult:function(){this.queryWidget.removeSingleQueryResult(this);this._hideInfoWindow()},_getAvailableWidget:function(a){return(a=this.queryWidget.appConfig.getConfigElementsByName(a)[0])&&a.visible?a:null},_openAttributeTable:function(){var a=this._getAvailableWidget("AttributeTable");if(a){var b=y.getInstanceSync().getLayerInfoById(this.currentAttrs.query.resultLayer.id);this.queryWidget.widgetManager.triggerWidgetOpen(a.id).then(f.hitch(this,
function(){this.queryWidget.publishData({target:"AttributeTable",layer:b})}))}}})})},"widgets/Query/RelatedRecordsResult":function(){define("dojo/query dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./RelatedRecordsResult.html esri/dijit/PopupRenderer esri/layers/GraphicsLayer esri/renderers/SimpleRenderer jimu/utils jimu/symbolUtils jimu/dijit/PopupMenu jimu/FeatureActionManager".split(" "),
function(l,n,p,k,c,e,f,h,d,g,b,a,q,s,w,u,m){return e([f,h,d,n],{baseClass:"related-records-result",templateString:g,popupMenu:null,featureActionManager:null,featureSet:null,layer:null,map:null,layerDefinition:null,nls:null,postCreate:function(){this.inherited(arguments);this.popupMenu=u.getInstance();this.featureActionManager=m.getInstance();if("Table"!==this.layerDefinition.type){this.layer=new a;var b=s.getTypeByGeometryType(this.layerDefinition.geometryType),c=null;"point"===b?c=w.getDefaultMarkerSymbol():
"polyline"===b?c=w.getDefaultLineSymbol():"polygon"===b&&(c=w.getDefaultFillSymbol());c&&(b=new q(c),this.layer.setRenderer(b));this.map.addLayer(this.layer)}},destroy:function(){this.layer&&this.map.removeLayer(this.layer);this.layer=null;this.inherited(arguments)},setResult:function(a,b){this.layer&&this.layer.clear();this.featureSet=b;0<b.features.length?(c.forEach(b.features,k.hitch(this,function(b){this._createItem(a,b);this.layer&&this.layer.add(b)})),p.removeClass(this.btnAction,"not-visible"),
p.addClass(this.noResultTip,"not-visible"),p.removeClass(this.content,"not-visible"),s.featureAction.zoomTo(this.map,b.features)):(p.addClass(this.btnAction,"not-visible"),p.removeClass(this.noResultTip,"not-visible"),p.addClass(this.content,"not-visible"))},showLayer:function(){this.layer&&this.layer.show()},hideLayer:function(){this.layer&&this.layer.hide()},_createItem:function(a,c){var d='\x3cdiv class\x3d"item"\x3e\x3cdiv class\x3d"item-title"\x3e'+(a.getTitle(c)||"")+'\x3c/div\x3e\x3cdiv class\x3d"item-content"\x3e\x3c/div\x3e\x3c/div\x3e',
d=p.toDom(d),e=l(".item-content",d)[0],f=new b({template:a,graphic:c,chartTheme:a.chartTheme});p.place(f.domNode,e);f.startup();p.place(d,this.content)},_onContentClicked:function(a){a=a.target||a.srcElement;var b=null;if(b=p.hasClass(a,"item-title")?a:s.getAncestorDom(a,function(a){return p.hasClass(a,"item-title")},this.content))a=b.parentNode,p.toggleClass(a,"selected"),b=p.hasClass(a,"selected"),l(".item",this.content).removeClass("selected"),b&&p.addClass(a,"selected")},_onBtnBackClicked:function(){this.emit("back")},
_onBtnMenuClicked:function(a){if(this.featureSet){var b=p.position(a.target||a.srcElement);this.featureActionManager.getSupportedActions(this.featureSet).then(k.hitch(this,function(a){c.forEach(a,k.hitch(this,function(a){a.data=this.featureSet}));a=c.filter(a,k.hitch(this,function(a){return"CreateLayer"!==a.name}));this.popupMenu.setActions(a);this.popupMenu.show(b)}))}}})})},"widgets/Query/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],
function(){})},"url:widgets/Query/TaskSetting.html":'\x3cdiv\x3e\r\n  \x3ctable class\x3d"top"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"first-td"\x3e\r\n        \x3cdiv class\x3d"back-arrow" data-dojo-attach-event\x3d"onclick:_onBtnParamsBackClicked"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd class\x3d"second-td"\x3e\r\n        \x3cdiv class\x3d"task-name jimu-ellipsis" data-dojo-attach-point\x3d"taskNameDiv"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd class\x3d"third-td"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n  \x3cdiv class\x3d"params-container" data-dojo-attach-point\x3d"paramsContainer"\x3e\r\n    \x3cdiv class\x3d"not-visible" data-dojo-attach-point\x3d"noFilterTip"\x3e${nls.noAttributeSpatialFilterTip}\x3c/div\x3e\r\n    \x3cdiv class\x3d"attributes-section" data-dojo-attach-point\x3d"attributesSectionDiv"\x3e\r\n      \x3cdiv class\x3d"first-stress attribute-filter-label"\x3e${nls.attributeCriteira}\x3c/div\x3e\r\n      \x3cdiv class\x3d"sql-div jimu-widget-note" data-dojo-attach-point\x3d"sqlDiv"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"spatial-section" data-dojo-attach-point\x3d"spatialSectionDiv"\x3e\r\n      \x3cdiv class\x3d"spearator not-visible" data-dojo-attach-point\x3d"spatialSpearator"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"first-stress spatial-filter-label"\x3e${nls.spatialFilter}\x3c/div\x3e\r\n      \x3cdiv class\x3d"spatial-filter-tip" data-dojo-attach-point\x3d"spatialFilterTip"\x3e\x3c/div\x3e\r\n      \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"spatialTypeSelect" data-dojo-attach-event\x3d"change:_onSpatialTypeSelectChanged" class\x3d"restrict-select-width" style\x3d"width:100%;box-sizing:border-box;"\x3e\x3c/select\x3e\r\n      \x3cdiv class\x3d"spatial-filter-content" data-dojo-attach-point\x3d"spatialFilterContent"\x3e\r\n        \x3cdiv class\x3d"drawing-section" data-dojo-attach-point\x3d"drawingSection"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"features-section" data-dojo-attach-point\x3d"featuresSection"\x3e\r\n          \x3cdiv class\x3d"relationship-section"\x3e\r\n            \x3cdiv class\x3d"second-stress relationship-tip"\x3e${nls.spatialRelationship}\x3c/div\x3e\r\n            \x3cselect data-dojo-attach-point\x3d"relationshipSelect" data-dojo-type\x3d"dijit/form/Select" class\x3d"restrict-select-width" style\x3d"width:100%;"\x3e\x3c/select\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"jimu-btn btn-execute" data-dojo-attach-event\x3d"onclick:_onBtnApplyClicked"\x3e${nls.execute}\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilterParameter.html":'\x3cdiv\x3e\r\n  \x3ctable style\x3d"width:100%;"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"first-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"prompt" data-dojo-attach-point\x3d"promptNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"second-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"allValueBoxContainer" style\x3d"width:100%;"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"stringTextBoxContainer" style\x3d"display:none;"\x3e\r\n              \x3cinput data-dojo-attach-point\x3d"stringTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"display:none;width:100%;" class\x3d"dijit-form-ValidationTextBox" /\x3e\r\n\r\n              \x3cdiv data-dojo-attach-point\x3d"stringCodedValuesFS" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"name",required:true,intermediateChanges:true\' class\x3d"dijit-form-FilteringSelect" style\x3d"display:none;width:100%;"\x3e\x3c/div\x3e\r\n\r\n              \x3cdiv data-dojo-attach-point\x3d"stringUniqueValuesSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"label",required:true,intermediateChanges:true\' class\x3d"dijit-form-FilteringSelect" style\x3d"display:none;width:100%;"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv data-dojo-attach-point\x3d"numberTextBoxContainer" style\x3d"display:none;"\x3e\r\n              \x3cinput data-dojo-attach-point\x3d"numberTextBox" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d\'"required":true,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' class\x3d"dijit-form-NumberTextBox" style\x3d"display:none;width:100%;" /\x3e\r\n\r\n              \x3cdiv data-dojo-attach-point\x3d"numberCodedValuesFS" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"name",required:true,intermediateChanges:true\' class\x3d"dijit-form-FilteringSelect" style\x3d"display:none;width:100%;"\x3e\x3c/div\x3e\r\n\r\n              \x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"display:none;width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd style\x3d"width:40%;"\x3e\r\n                      \x3cinput data-dojo-attach-point\x3d"numberTextBox1" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":true,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' class\x3d"dijit-form-NumberTextBox" style\x3d"width:100%;" /\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n                      \x3cspan\x3e${nls.and}\x3c/span\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd style\x3d"width:40%;"\x3e\r\n                      \x3cinput data-dojo-attach-point\x3d"numberTextBox2" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":true,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' class\x3d"dijit-form-NumberTextBox" style\x3d"width:100%;" /\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n\r\n              \x3cdiv data-dojo-attach-point\x3d"numberUniqueValuesSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"label",required:true,intermediateChanges:true\' class\x3d"dijit-form-FilteringSelect" style\x3d"display:none;width:100%;"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv data-dojo-attach-point\x3d"dateTextBoxContainer" style\x3d"display:none;"\x3e\r\n              \x3cinput data-dojo-attach-point\x3d"dateTextBox" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-props\x3d\'required:true, trim:true\' class\x3d"dijit-form-DateTextBox" style\x3d"display:none;width:100%;" /\x3e\r\n\r\n              \x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"display:none;width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd style\x3d"width:40%;"\x3e\r\n                      \x3cinput data-dojo-attach-point\x3d"dateTextBox1" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-event\x3d"change:_onRangeDateBlur" data-dojo-props\x3d\'value:new Date(),required:true,trim:true\' class\x3d"dijit-form-DateTextBox" style\x3d"width:100%;" /\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n                      \x3cspan\x3e${nls.and}\x3c/span\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                      \x3cinput data-dojo-attach-point\x3d"dateTextBox2" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-event\x3d"change:_onRangeDateBlur" data-dojo-props\x3d\'value:new Date(),required:true,trim:true\' class\x3d"dijit-form-DateTextBox" style\x3d"width:100%;" /\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"third-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/SearchDistance.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"cbxDiv"\x3e\x3c/div\x3e\r\n\t\x3ctable style\x3d"table-layout:fixed;width:100%;"\x3e\r\n\t\t\x3ccolgroup\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"15px"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\x3c/colgroup\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"numberTextBox" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n\t\t\t\t\t data-dojo-props\x3d\'"required":true,intermediateChanges:false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n\t\t\t\t\t style\x3d"width:100%;" data-dojo-attach-event\x3d"change:_onNumberTextBoxChanged" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"unitSelect"\r\n\t\t\t\t\tdata-dojo-attach-event\x3d"change:_onUnitSelectChanged" style\x3d"width:100%;"\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"MILES" selected\x3e${nls.miles}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"KILOMETERS"\x3e${nls.kilometers}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"FEET"\x3e${nls.feet}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"METERS"\x3e${nls.meters}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"YARDS"\x3e${nls.yards}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"NAUTICAL_MILES"\x3e${nls.nauticalMiles}\x3c/option\x3e\r\n\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/SpatialFilterByFeatures.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"layer-tip second-stress" data-dojo-attach-point\x3d"tipNode"\x3e${nls.relatedLayer}\x3c/div\x3e\r\n\t\x3ctable\x3e\r\n\t\t\x3ccolgroup\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"100"\x3e\x3c/col\x3e\r\n\t\t\x3c/colgroup\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"layers-select-div" data-dojo-attach-point\x3d"layerSelectDiv"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-float-trailing" data-dojo-attach-point\x3d"featureSetChooserDiv"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\r\n\t\x3cdiv class\x3d"selection-option not-visible" data-dojo-attach-point\x3d"selectionOptionDiv"\x3e\x3c/div\x3e\r\n\r\n\t\x3cdiv class\x3d"search-distance-div" data-dojo-attach-point\x3d"searchDistanceDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"contentNode" class\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem" tabindex\x3d"-1" aria-selected\x3d"false"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation" style\x3d"display: none;"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"contentNode"\r\n\t\t\tclass\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem"\r\n\t\t\t\t   tabindex\x3d"-1" aria-selected\x3d"false" id\x3d"${id}_label"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\r\n\t\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation"\r\n\t\t style\x3d"display: none;" aria-labelledby\x3d"${id}_label"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/Tree.html":'\x3cdiv role\x3d"tree"\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitTreeIndent" style\x3d"position: absolute; top: -9999px" data-dojo-attach-point\x3d"indentDetector"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTreeExpando dijitTreeExpandoLoading" data-dojo-attach-point\x3d"rootLoadingIndicator"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeContainer" role\x3d"presentation"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:jimu/dijit/templates/LayerChooserFromMapWithDropbox.html":'\x3cdiv\x3e\r\n  \x3ctable data-dojo-attach-event\x3d"onclick: _onDropDownClick"\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol width\x3d"10px"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"30px"\x3e\x3c/col\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"layer-name jimu-ellipsis" data-dojo-attach-point\x3d"layerNameNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"drop-select jimu-float-trailing" data-dojo-attach-point\x3d"dropArrowNode"\x3e\r\n            \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Query/SingleQueryResult.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"features-result" data-dojo-attach-point\x3d"featuresResultDiv"\x3e\r\n    \x3cdiv class\x3d"results-number" data-dojo-attach-point\x3d"resultsNumberDiv"\x3e\r\n      \x3cspan\x3e${nls.numberFound}: \x3c/span\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"numSpan"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"popup-menu-button query-result-action-button" data-dojo-attach-event\x3d"click:_onBtnMenuClicked"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"results-container" data-dojo-attach-point\x3d"resultsContainer" data-dojo-attach-event\x3d"onscroll:_onResultsScroll" onselectstart\x3d"return false;"\x3e\r\n      \x3ctable data-dojo-attach-point\x3d"resultsTable" valign\x3d"top" class\x3d"results-table" data-dojo-attach-event\x3d"onclick:_onResultsTableClicked" cellpadding\x3d"0" cellspacing\x3d"0" \x3e\r\n        \x3ctbody data-dojo-attach-point\x3d"resultsTbody"\x3e\x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"related-records-section not-visible" data-dojo-attach-point\x3d"relatedRecordsResultDiv"\x3e\r\n    \x3ctable class\x3d"related-records-header"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv class\x3d"back-arrow" data-dojo-attach-event\x3d"click:_onBtnRelatedBackClicked"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"middle-td"\x3e\r\n            \x3cdiv class\x3d"related-records-title jimu-ellipsis" data-dojo-attach-point\x3d"relatedTitleDiv"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"last-td"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/RelatedRecordsResult.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"popup-menu-button related-records-action-button not-visible" data-dojo-attach-point\x3d"btnAction" data-dojo-attach-event\x3d"click:_onBtnMenuClicked"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"noresult-tip not-visible" data-dojo-attach-point\x3d"noResultTip"\x3e${nls.noResult}\x3c/div\x3e\r\n  \x3cdiv class\x3d"content not-visible" data-dojo-attach-point\x3d"content" data-dojo-attach-event\x3d"click:_onContentClicked"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"jimu-widget-normal query-widget-content"\x3e\r\n    \x3cdiv class\x3d"query-tab-header" data-dojo-attach-point\x3d"tabHeader" data-dojo-attach-event\x3d"onclick:_onTabHeaderClicked"\x3e\r\n      \x3cdiv class\x3d"query-tab-item jimu-float-leading selected" data-dojo-attach-point\x3d"taskQueryItem"\x3e${nls.tasks}\x3c/div\x3e\r\n      \x3cdiv class\x3d"query-tab-item jimu-float-trailing" data-dojo-attach-point\x3d"resultQueryItem"\x3e${nls.queryResults}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"query-tabs-container"\x3e\r\n      \x3cdiv class\x3d"query-tab-view task-tab-view selected" data-dojo-attach-point\x3d"taskTabView"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"taskList" class\x3d"task-list"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"tasksNode" class\x3d"tasks"\x3e\r\n              \x3cdiv class\x3d"execute-tip not-visible"\x3e${nls.executeQueryTip}\x3c/div\x3e\r\n              \x3cdiv class\x3d"tasks-table-container"\x3e\r\n                \x3ctable data-dojo-attach-event\x3d"onclick:_onTaskListClicked"\r\n                cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"list-table tasks-table" onselectstart\x3d"return false;"\x3e\r\n                  \x3ccolgroup\x3e\r\n                    \x3ccol width\x3d"40px"\x3e\x3c/col\x3e\r\n                    \x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n                  \x3c/colgroup\x3e\r\n                  \x3ctbody data-dojo-attach-point\x3d"tasksTbody"\x3e\x3c/tbody\x3e\r\n                \x3c/table\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"noQueryTipSection" class\x3d"no-query-tip"\x3e${nls.noTask}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"taskSettingContainer" class\x3d"task-setting-container"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"query-tab-view result-tab-view" data-dojo-attach-point\x3d"resultTabView"\x3e\r\n        \x3cdiv class\x3d"result-section" data-dojo-attach-point\x3d"resultSection"\x3e\r\n          \x3cdiv class\x3d"single-result-details" data-dojo-attach-point\x3d"singleResultDetails"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"resultlayers-select-div" data-dojo-attach-point\x3d"resultLayersSelectDiv"\x3e\r\n            \x3cdiv data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"resultLayersSelect" class\x3d"restrict-select-width" style\x3d"width:100%;" data-dojo-attach-event\x3d"change:_onResultLayerSelectChanged"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"no-result-section" data-dojo-attach-point\x3d"noresultSection"\x3e${nls.noResult}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/css/style.css":'.jimu-widget-query{position: relative; width: 99%; height: 100%; min-width: 222px; min-height: 237px; overflow-x: hidden;}.jimu-widget-query .first-stress{font-family: "Avenir Light"; font-size: 14px; color: #000; margin-bottom: 5px; font-weight: bold;}.jimu-widget-query .second-stress{font-size: 12px; color: #353535; margin-bottom: 5px;}.jimu-widget-query .jimu-table-row{color: #000;}.jimu-widget-query .jimu-table-row.jimu-state-active{font-weight: normal; background-color: #eee;}.jimu-widget-query .query-result-item.jimu-table-row:first-child{border-top: 1px solid #cbcbcb;}.jimu-widget-query .not-visible{display: none !important;}.jimu-widget-query .jimu-checkbox .label{font-size: 12px; position: relative; top: 2px;}.jimu-widget-query .query-widget-content{position: absolute; width: 100%; left: 0; right: 0; height: auto; top: 0; bottom: 0;}.jimu-widget-query .query-tab-header{position: absolute; width: 100%; height: 30px; left: 0; right: 0; top: 0; font-size: 14px;}.jimu-widget-query .query-tab-item{width: 50%; height: 100%; line-height: 30px; cursor: pointer; text-align: center; border-bottom: 1px solid #ccc;}.jimu-widget-query .query-tab-item.selected{border-bottom: 2px solid #898989; font-weight: bold; color: #000;}.jimu-widget-query .query-tabs-container{position: absolute; width: 100%; left: 0; right: 0; top: 30px; bottom: 0;}.jimu-widget-query .query-tab-view{display: none; position: relative; width: 100%; height: 100%;}.jimu-widget-query .query-tab-view.selected{display: block;}.jimu-widget-query .list-table{width: 99%; border-collapse: collapse; table-layout: fixed; margin-left: auto; margin-right: auto;}.jimu-widget-query .list-table tr.single-task{border-top: 1px solid #D7D7D7; border-bottom: 1px solid #D7D7D7;}.jimu-widget-query .list-table tr.single-task:first-child{border-top: 0;}.jimu-widget-query .list-table tr.single-task:hover, .jimu-widget-query .list-table tr.single-task.selected{background-color: #eee;}.jimu-widget-query .list-table tr.single-task \x3e td{padding-top: 13px; padding-bottom: 13px; cursor: pointer; vertical-align: top;}.jimu-widget-query .list-table tr.single-task .list-item-name{width: 100%; overflow: hidden; text-overflow: ellipsis; display: inline-block; line-height: 16px;}.jimu-widget-query .list-table tr.single-task .first-td{text-align: center;}.jimu-widget-query .list-table tr.single-task .task-icon{width: 16px; height: 16px; vertical-align: middle;}.jimu-widget-query .task-list{position: absolute; top: 10px; bottom: 0; width: 100%;}.jimu-widget-query .task-list .tasks{position: absolute; width: 100%; height: 100%; left: 0; top: 0; overflow-y: auto;}.jimu-widget-query .task-list .tasks .execute-tip{margin-top: 10px; line-height: 20px;}.jimu-widget-query .task-list .tasks .tasks-table-container{width: 100%;}.jimu-widget-query .task-list .invalid-config{display: none; position: absolute; width: 100%; height: 100%; left: 0; top: 0;}.jimu-widget-query .task-list .no-query-tip{display: none; line-height: 20px;}.jimu-widget-query .task-setting-container{height: 100%; display: none;}.jimu-widget-query .query-task-setting{position: relative; height: 100%;}.jimu-widget-query .query-task-setting table.top{width: 100%; table-layout: fixed; padding-top: 12px;}.jimu-widget-query .query-task-setting table.top .first-td{width: 30px;}.jimu-widget-query .query-task-setting table.top .second-td{width: auto;}.jimu-widget-query .query-task-setting table.top .third-td{width: 30px;}.jimu-widget-query.only-one-task .query-task-setting table.top .first-td,.jimu-widget-query.only-one-task .query-task-setting table.top .third-td{width: 0;}.jimu-widget-query.only-one-task .query-task-setting table.top .first-td,.jimu-widget-query.only-one-task .query-task-setting table.top .third-td{display: none; overflow: hidden;}.jimu-widget-query .back-arrow{display: inline-block; width: 16px; height: 16px; cursor: pointer; background-position: center center; background-repeat: no-repeat; background-image: url(images/arrow_left_normal.png); vertical-align: middle;}.jimu-widget-query .back-arrow:hover{background-image: url(images/arrow_left_hover.png);}.jimu-rtl .jimu-widget-query .back-arrow{background-image: url(images/arrow_right_normal.png);}.jimu-rtl .jimu-widget-query .back-arrow:hover{background-image: url(images/arrow_right_hover.png);}.jimu-widget-query .query-task-setting .task-name{text-align: center;}.jimu-widget-query .query-task-setting .params-container{position: absolute; width: 100%; top: 50px; bottom: 50px; overflow: auto;}.jimu-widget-query .query-task-setting .spatial-section .spearator{height: 1px; margin-bottom: 12px; border-top: 1px solid #D7D7D7; display: none;}.jimu-widget-query .query-task-setting .spatial-section .relationship-section{margin-top: 10px;}.jimu-widget-query .query-task-setting .spatial-section .jimu-dijit-spatial-filter-features{margin-top: 10px;}.jimu-widget-query .query-task-setting .attributes-section{margin-bottom: 12px;}.jimu-widget-query .query-task-setting .attributes-section .attribute-filter-label{margin-bottom: 5px;}.jimu-widget-query .query-task-setting .btn-execute.jimu-btn{position: absolute; width: 100%; bottom: 0; text-align: center; background-color: #59A700; border-radius: 0;}.jimu-widget-query .query-task-setting .btn-execute:hover{background-color: #417505;}.jimu-widget-query .query-task-setting .btn-execute:active{background-color: #59A700;}.jimu-query-spatial-filter-drawing .search-distance-div{margin-top: 15px;}.jimu-query-spatial-filter-drawing .jimu-draw-box .drawings-clear{margin-left: 18px;}.jimu-rtl .jimu-query-spatial-filter-drawing .jimu-draw-box .drawings-clear{margin-left: 0; margin-right: 18px;}.jimu-widget-query .result-list{padding-top: 10px;}.jimu-widget-query .result-tab-view .result-section{position: absolute; left: 0; right: 0; top: 0; bottom: 0;}.jimu-widget-query .result-tab-view .no-result-section{padding-top: 20px;}.jimu-widget-query .resultlayers-select-div{position: absolute; left: 0; right: 37px; top: 15px; text-align: center; overflow: visible;}.jimu-rtl .jimu-widget-query .resultlayers-select-div{left: 37px; right: 0;}.jimu-widget-query .single-result-details{position: absolute; width: 100%; left: 0; right: 0; top: 0; bottom: 0;}.jimu-widget-query .single-query-result,.jimu-widget-query .single-query-result .features-result,.jimu-widget-query .single-query-result .related-records-section{position: relative; width: 100%; height: 100%;}.jimu-widget-query .single-query-result .query-result-action-button{position: absolute; top: 12px; right: -8px;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-action-button{right: auto; left: -8px;}.jimu-widget-query .single-query-result .results-number{position: relative; top: 58px;}.jimu-widget-query .single-query-result .results-container{position: absolute; width: 100%; left: 0; right: 0; top: 85px; bottom: 0; overflow-x: hidden; overflow-y: auto;}.jimu-widget-query .single-query-result .results-table{table-layout: fixed; width: 100%; border-collapse: collapse;}.jimu-widget-query .single-query-result .query-result-item.jimu-table-row{border-left: 0 !important; border-right: 0 !important;}.jimu-widget-query .single-query-result .query-result-item \x3e td{padding-top: 12px; padding-bottom: 12px; cursor: pointer;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item \x3e td{padding-left: 0; padding-right: 15px;}.jimu-widget-query .single-query-result .query-result-item\x3e.esriViewPopup .header{margin-bottom: 5px;}.jimu-widget-query .single-query-result .query-result-item .esriViewPopup .hzLine{display: none;}.jimu-widget-query .single-query-result .query-result-item .esriViewPopup .mainSection .break{display: none;}.jimu-widget-query .single-query-result .query-result-item-table{width: 100%; table-layout: fixed; border-collapse: collapse;}.jimu-widget-query .single-query-result .query-result-item-table .symbol-td{width: 36px;}.jimu-widget-query .single-query-result .query-result-item-table .popup-td{width: auto;}.jimu-widget-query .single-query-result .query-result-item .related-table-btn{height: 30px; line-height: 30px; margin: 5px 0; padding: 0 5px; background: url(images/arrow_right1.png) right center no-repeat content-box; overflow: hidden; text-overflow: hidden; white-space: nowrap; font-family: "Avenir Medium"; color: #000;}.jimu-widget-query .single-query-result .query-result-item .related-table-btn:hover{font-weight: bold; background: url(images/arrow_right2.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item .related-table-btn{background: url(images/arrow_left1.png) left center no-repeat content-box;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item .related-table-btn:hover{background: url(images/arrow_left2.png) left center no-repeat content-box;}.jimu-widget-query .related-records-section table.related-records-header{position: absolute; width: 100%; min-height: 36px; border-collapse: collapse; table-layout: fixed;}.jimu-widget-query .related-records-section table.related-records-header\x3etbody\x3etr\x3etd{height: 36px;}.jimu-widget-query .related-records-section table.related-records-header\x3etbody\x3etr\x3e.first-td{width: 30px;}.jimu-widget-query .related-records-section table.related-records-header\x3etbody\x3etr\x3e.middle-td{width: auto;}.jimu-widget-query .related-records-section table.related-records-header\x3etbody\x3etr\x3e.last-td{width: 40px;}.jimu-widget-query .related-records-section table.related-records-header .back-arrow{}.jimu-widget-query .related-records-section table.related-records-header .related-records-title{text-align: center;}.jimu-widget-query .related-records-result{position: absolute; left: 0; right: 0; top: 0; bottom: 0; width: 100%; height: 100%;}.jimu-widget-query .related-records-result .related-records-action-button{position: absolute; right: -8px; top: 0; z-index: 1;}.jimu-rtl .jimu-widget-query .related-records-result .related-records-action-button{position: absolute; right: auto; left: -8px; top: 0;}.jimu-widget-query .related-records-result .noresult-tip{margin-top: 50px;}.jimu-widget-query .related-records-result .content{position: absolute; left: 0; right: 0; top: 50px; bottom: 0; overflow: auto;}.jimu-widget-query .related-records-result .content .item{border-top: 1px solid #E2E2E2;}.jimu-widget-query .related-records-result .content .item:last-child{border-bottom: 1px solid #E2E2E2;}.jimu-widget-query .related-records-result .content .item-title{position: relative; height: 36px; line-height: 36px; cursor: pointer; background: url(images/arrow_right1.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .related-records-result .content .item-title{background: url(images/arrow_left1.png) left center no-repeat content-box;}.jimu-widget-query .related-records-result .content .item.selected .item-title{background: url(images/arrow_down.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .related-records-result .content .item.selected .item-title{background: url(images/arrow_down.png) left center no-repeat content-box;}.jimu-widget-query .related-records-result .content .item-title .esriNumericValue{position: absolute; left: 4px; right: 18px; top: 0; bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-rtl .jimu-widget-query .related-records-result .content .item-title .esriNumericValue{left: 18px; right: 4px;}.jimu-widget-query .related-records-result .content .item-content{border-top: 1px solid #E2E2E2; display: none;}.jimu-widget-query .related-records-result .content .item.selected .item-content{display: block;}.jimu-widget-query .related-records-result .esriViewPopup .header{display: none;}.jimu-widget-query .related-records-result .esriViewPopup .hzLine{display: none;}.query-resultlayer-tooltipdialog-content{cursor: default;}.query-resultlayer-tooltipdialog-content .result-item{height: 20px; line-height: 20px; cursor: pointer;}.query-operations-tooltipdialog-content{cursor: default;}.query-operations-tooltipdialog-content .operation-item{height: 20px; line-height: 20px; cursor: pointer;}',
"*now":function(l){l(['dojo/i18n!*preload*widgets/Query/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/on dojo/query dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/promise/all dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/MapManager jimu/filterUtils esri/layers/FeatureLayer esri/dijit/PopupTemplate esri/renderers/SimpleRenderer esri/symbols/jsonUtils esri/lang esri/request ./TaskSetting ./SingleQueryLoader ./SingleQueryResult ./utils jimu/LayerInfos/LayerInfos jimu/dijit/LoadingShelter dijit/form/Select".split(" "),function(l,
n,p,k,c,e,f,h,d,g,b,a,q,s,w,u,m,x,r,C,E,D,A,y,F){return h([g,d],{name:"Query",baseClass:"jimu-widget-query",currentTaskSetting:null,hiddenClass:"not-visible",_resultLayerInfos:null,_activeLayerId:null,mapManager:null,layerInfosObj:null,postMixInProperties:function(){this.inherited(arguments);this._resultLayerInfos=[];var a=r.substitute({clearResults:this.nls.clearResults},this.nls.operationalTip);this.nls.operationalTip=a;this.config&&(this.config=y.getConfigWithValidDataSource(this.config),this._updateConfig());
this.mapManager=q.getInstance();this.layerInfosObj=F.getInstanceSync()},_updateConfig:function(){this.config&&(this.config.queries&&0<this.config.queries.length)&&e.forEach(this.config.queries,k.hitch(this,function(a){this._rebuildFilter(a.url,a.filter)}))},_rebuildFilter:function(b,c){try{if(c){delete c.expr;var d=new s;d.isHosted=a.isHostedService(b);d.getExprByFilterObj(c)}}catch(e){console.log(e)}},postCreate:function(){this.inherited(arguments);this._initSelf();this._updateResultDetailUI();var a=
n(".single-task",this.tasksTbody);1===a.length&&(c.addClass(this.domNode,"only-one-task"),this._showTaskSettingPane(),this._onClickTaskTr(a[0]))},onOpen:function(){if(this._activeLayerId){var a=this.map.getLayer(this._activeLayerId);a&&a.show()}},onActive:function(){this.mapManager.disableWebMapPopup()},onDeActive:function(){this.currentTaskSetting&&this.currentTaskSetting.deactivate();this.mapManager.enableWebMapPopup()},onClose:function(){this._hideAllLayers();this._hideInfoWindow();this.inherited(arguments)},
destroy:function(){this._hideInfoWindow();this._removeResultLayerInfos(this._resultLayerInfos);this.inherited(arguments)},_initSelf:function(){var a=this.config.queries;0===a.length?(c.setStyle(this.tasksNode,"display","none"),c.setStyle(this.noQueryTipSection,"display","block")):e.forEach(a,k.hitch(this,function(a,b){var d=a.name,e=c.toDom('\x3ctr class\x3d"single-task"\x3e\x3ctd class\x3d"first-td"\x3e\x3cimg class\x3d"task-icon" /\x3e\x3c/td\x3e\x3ctd class\x3d"second-td"\x3e\x3cdiv class\x3d"list-item-name task-name-div"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e');
n(".task-name-div",e)[0].innerHTML=d;c.place(e,this.tasksTbody);n("img",e)[0].src=a.icon?a.icon:this.folderUrl+"css/images/default_task_icon.png";e.taskIndex=b;e.singleConfig=a;0===b%2?c.addClass(e,"even"):c.addClass(e,"odd")}))},_onTabHeaderClicked:function(a){a=a.target||a.srcElement;a===this.taskQueryItem?this._switchToTaskTab():a===this.resultQueryItem&&this._switchToResultTab()},_switchToTaskTab:function(){c.removeClass(this.resultQueryItem,"selected");c.removeClass(this.resultTabView,"selected");
c.addClass(this.taskQueryItem,"selected");c.addClass(this.taskTabView,"selected")},_switchToResultTab:function(){this._updateResultDetailUI();c.removeClass(this.taskQueryItem,"selected");c.removeClass(this.taskTabView,"selected");c.addClass(this.resultQueryItem,"selected");c.addClass(this.resultTabView,"selected")},_updateResultDetailUI:function(){0<this._resultLayerInfos.length?(c.removeClass(this.resultSection,this.hiddenClass),c.addClass(this.noresultSection,this.hiddenClass)):(c.addClass(this.resultSection,
this.hiddenClass),c.removeClass(this.noresultSection,this.hiddenClass))},_showTaskListPane:function(){this._switchToTaskTab();c.setStyle(this.taskList,"display","block");c.setStyle(this.taskSettingContainer,"display","none")},_showTaskSettingPane:function(){this._switchToTaskTab();c.setStyle(this.taskList,"display","none");c.setStyle(this.taskSettingContainer,"display","block")},_onTaskListClicked:function(b){(b=a.getAncestorDom(b.target||b.srcElement,k.hitch(this,function(a){return c.hasClass(a,
"single-task")}),10))&&this._onClickTaskTr(b)},_onClickTaskTr:function(b){this._getLayerInfoAndRelationshipLayerInfos(b).then(k.hitch(this,function(c){var d=c.layerInfo,e=c.relationshipLayerInfos;c=c.relationshipPopupTemplates;b.singleConfig.objectIdField=a.getObjectIdField(d);var f=this._getPopupInfo(d,b.singleConfig);f||console.error("can't get popupInfo");f.fieldInfos=y.getPortalFieldInfosWithoutShape(d,f.fieldInfos);delete f.readFromWebMap;var g=D.getCleanCurrentAttrsTemplate();g.queryTr=b;g.config=
k.clone(b.singleConfig);g.config.popupInfo=f;g.layerInfo=d;g.relationshipLayerInfos=e;g.relationshipPopupTemplates=c;g.query.maxRecordCount=d.maxRecordCount||1E3;this._isServiceSupportsOrderBy(d)&&this._isServiceSupportsPagination(d)?g.queryType=1:this._isSupportObjectIds(d)?g.queryType=2:g.queryType=3;this.currentTaskSetting&&this.currentTaskSetting.destroy();this.currentTaskSetting=null;this._showTaskSettingPane();this.currentTaskSetting=new E({nls:this.nls,map:this.map,currentAttrs:g,layerInfosObj:this.layerInfosObj,
onBack:k.hitch(this,function(){this._showTaskListPane()}),onApply:k.hitch(this,function(a){this._onBtnApplyClicked(a)})});this.currentTaskSetting.canAutoRunning()&&(this._switchToResultTab(),this.currentTaskSetting.run());this.currentTaskSetting.placeAt(this.taskSettingContainer)}),k.hitch(this,function(a){console.error("can't get layerInfo",a)}))},_getLayerInfoAndServiceInfo:function(a){var b=new p,c=this._getLayerInfo(a),d=this._getServiceInfo(a);this.shelter.show();f([c,d]).then(k.hitch(this,function(c){this.domNode&&
(this.shelter.hide(),a.layerInfo=c[0],a.serviceInfo=c[1],b.resolve({layerInfo:a.layerInfo,serviceInfo:a.serviceInfo}))}),k.hitch(this,function(a){console.error(a);if(this.domNode){this.shelter.hide();var c="";a&&403===a.httpCode&&(c=this.nls.noPermissionsMsg);this._showQueryErrorMsg(c);b.reject()}}));return b},_getLayerInfoAndRelationshipLayerInfos:function(a){var b=new p;this.shelter.show();this._getLayerInfo(a).then(k.hitch(this,function(c){a.layerInfo=c;this._getRelationshipLayerInfos(a).then(k.hitch(this,
function(d){if(this.domNode){a.relationshipLayerInfos=d;var e={},f;for(f in d){var g=y.getDefaultPopupInfo(d[f],!1,!0);e[f]=new u(g)}this.shelter.hide();b.resolve({layerInfo:c,relationshipLayerInfos:d,relationshipPopupTemplates:e})}}),k.hitch(this,function(a){this.domNode&&(this.shelter.hide(),b.reject(a))}))}),k.hitch(this,function(a){this.domNode&&(this.shelter.hide(),b.reject(a))}));return b},_getLayerInfo:function(a){var b=new p;a.layerInfo?b.resolve(a.layerInfo):C({url:a.singleConfig.url,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}).then(k.hitch(this,function(c){a.layerInfo=c;b.resolve(c)}),k.hitch(this,function(a){b.reject(a)}));return b},_getServiceInfo:function(a){var b=new p;if(a.serviceInfo)b.resolve(a.serviceInfo);else{var c=this._getServiceUrlByLayerUrl(a.singleConfig.url);C({url:c,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(k.hitch(this,function(c){a.serviceInfo=c;b.resolve(c)}),k.hitch(this,function(a){b.reject(a)}))}return b},_getRelationshipLayerInfos:function(a){var b=
new p;if(a.relationshipLayerInfos)b.resolve(a.relationshipLayerInfos);else{var c=a.layerInfo.relationships;if(c&&0<c.length){var d=this._getServiceUrlByLayerUrl(a.singleConfig.url),g=e.map(c,k.hitch(this,function(a){return C({url:d+"/"+a.relatedTableId,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})}));f(g).then(k.hitch(this,function(d){a.relationshipLayerInfos={};e.forEach(c,k.hitch(this,function(b,c){a.relationshipLayerInfos[b.relatedTableId]=d[c]}));b.resolve(a.relationshipLayerInfos)}),
k.hitch(this,function(c){a.relationshipLayerInfos=null;b.reject(c)}))}else a.relationshipLayerInfos={},b.resolve(a.relationshipLayerInfos)}return b},_getServiceUrlByLayerUrl:function(a){var b=a.lastIndexOf("/");return a.slice(0,b)},_getPopupInfo:function(a,b){var c=null,d=y.getDefaultPopupInfo(a,!1,!1),c=null;b.popupInfo?b.popupInfo.readFromWebMap?b.webMapLayerId?(c=null,c=(c=y.isTable(a)?this.layerInfosObj.getTableInfoById(b.webMapLayerId):this.layerInfosObj.getLayerInfoById(b.webMapLayerId))?(c=
c.getPopupInfo())?k.clone(c):d:d):c=d:(c=k.clone(b.popupInfo),delete c.readFromWebMap):c=b.popup?y.upgradePopupToPopupInfo(a,b.popup):d;c||(c=d);y.removePopupInfoUnsupportFields(a,c);return c},_onBtnApplyClicked:function(a){this.mapManager.enableWebMapPopup();c.addClass(this.resultTabView,this.hiddenClass);if(a.config.singleResultLayer){var b=this._getResultLayerInfosByTaskIndex(a.queryTr.taskIndex);0<b.length&&this._removeResultLayerInfos(b)}var d=this._getBestQueryName(a.config.name||"");this._createNewResultLayer(a,
d);this.shelter.show();var e=new A({map:this.map,nls:this.nls,label:d,currentAttrs:a,queryWidget:this,onBack:k.hitch(this,function(){this._switchToResultTab()})});this.own(l(e,"show-related-records",k.hitch(this,this._onShowRelatedRecords)));this.own(l(e,"hide-related-records",k.hitch(this,this._onHideRelatedRecords)));e.executeQueryForFirstTime().then(k.hitch(this,function(){this.domNode&&(this.shelter.hide(),c.removeClass(this.resultTabView,this.hiddenClass),this._onSingleQueryFinished(e,d),this._updateResultDetailUI())}),
k.hitch(this,function(a){console.error(a);this.domNode&&(this.shelter.hide(),c.removeClass(this.resultTabView,this.hiddenClass))}))},_getBestQueryName:function(a){for(var b=a=a?a+(" _"+this.nls.queryResult):a+this.nls.queryResult,c=e.map(this.map.graphicsLayerIds,k.hitch(this,function(a){return this.map.getLayer(a).name})),d=2;0<=e.indexOf(c,b);)b=a+"_"+d,d++;return b},_createNewResultLayer:function(a,b){var c=null,d=null,d=a.queryTr.taskIndex,c=k.clone(a.layerInfo);c.name=b;c.drawingInfo||(c.drawingInfo=
{});c.drawingInfo.transparency=0;c.minScale=0;c.maxScale=0;c.effectiveMinScale=0;c.effectiveMaxScale=0;c.defaultVisibility=!0;delete c.extent;var f=(new D(this.map,a)).getOutputFields();c.fields=e.filter(c.fields,k.hitch(this,function(a){return 0<=f.indexOf(a.name)}));c=new w({layerDefinition:c,featureSet:null});c._queryWidgetTaskIndex=d;var d=k.clone(a.config.popupInfo),g=new u(d);d.showAttachments&&y.overridePopupTemplateMethodGetAttachments(g,a.config.url,a.config.objectIdField);c.setInfoTemplate(g);
a.query.resultLayer=c;!y.isTable(a.layerInfo)&&(!a.config.useLayerSymbol&&a.config.resultsSymbol)&&(d=x.fromJson(a.config.resultsSymbol),d=new m(d),c.setRenderer(d));return c},_onSingleQueryFinished:function(b,d){this.currentTaskSetting.onGetQueryResponse();b.placeAt(this.singleResultDetails);this._hideAllSingleQueryResultDijits();this._switchToResultTab();c.setStyle(b.domNode,"display","block");var e=b.getCurrentAttrs().queryTr.taskIndex,e={value:a.getRandomString(),label:d,taskIndex:e,singleQueryResult:b};
this._resultLayerInfos.push(e);this.resultLayersSelect.addOption({value:e.value,label:e.label});this.resultLayersSelect.set("value",e.value);this._showResultLayerInfo(e);this._updateResultDetailUI()},_onResultLayerSelectChanged:function(){var a=this.resultLayersSelect.get("value");if(a&&(a=this._getResultLayerInfoByValue(a)))this._showResultLayerInfo(a),(a=a.singleQueryResult)&&a.zoomToLayer()},_getAllResultLayers:function(){var a=[];e.map(this._resultLayerInfos,k.hitch(this,function(b){if(b.singleQueryResult&&
(b=b.singleQueryResult.getCurrentAttrs())&&b.query)(b=b.query.resultLayer)&&a.push(b)}));return a},_hideAllLayers:function(a){var b=this._getAllResultLayers();e.forEach(b,k.hitch(this,function(b){b!==a&&b.hide()}))},_removeResultLayerInfosByTaskIndex:function(a){a=this._getResultLayerInfosByTaskIndex(a);this._removeResultLayerInfos(a)},_getResultLayerInfoByValue:function(a){var b=null;e.some(this._resultLayerInfos,k.hitch(this,function(c){return c.value===a?(b=c,!0):!1}));return b},_getResultLayerInfosByTaskIndex:function(a){var b=
this._resultLayerInfos;return b=e.filter(b,k.hitch(this,function(b){return b.taskIndex===a}))},_removeResultLayerInfoByValues:function(a){var b=[];e.forEach(this._resultLayerInfos,k.hitch(this,function(c,d){0<=a.indexOf(c.value)&&(b.push(d),c.singleQueryResult&&c.singleQueryResult.domNode&&c.singleQueryResult.destroy(),c.singleQueryResult=null)}));b.reverse();e.forEach(b,k.hitch(this,function(a){this._resultLayerInfos.splice(a,1)}));this.resultLayersSelect.removeOption(a);var c=this.resultLayersSelect.getOptions();
c&&0<c.length?this.resultLayersSelect.set("value",c[0].value):"function"===typeof this.resultLayersSelect._setDisplay&&this.resultLayersSelect._setDisplay("");this._updateResultDetailUI()},_removeResultLayerInfos:function(a){a=e.map(a,k.hitch(this,function(a){return a.value}));return this._removeResultLayerInfoByValues(a)},_getAllSingleQueryResultDijits:function(){var a=[];this._resultLayerInfos&&0<this._resultLayerInfos.length&&e.forEach(this._resultLayerInfos,k.hitch(this,function(b){b&&b.singleQueryResult&&
a.push(b.singleQueryResult)}));return a},_hideAllSingleQueryResultDijits:function(){var a=this._getAllSingleQueryResultDijits();e.forEach(a,k.hitch(this,function(a){c.setStyle(a.domNode,"display","none")}))},_showResultLayerInfo:function(a){this._hideAllSingleQueryResultDijits();a=a.singleQueryResult;var b=null;a&&(c.setStyle(a.domNode,"display","block"),a=a.getCurrentAttrs(),b=k.getObject("query.resultLayer",!1,a));b?(this._activeLayerId=b.id,this._hideAllLayers(b),b.show()):(this._activeLayerId=
null,this._hideAllLayers())},removeSingleQueryResult:function(a){var b=null;e.some(this._resultLayerInfos,k.hitch(this,function(c){return c.singleQueryResult===a?(b=c.value,!0):!1}));null!==b&&this._removeResultLayerInfoByValues([b])},_onShowRelatedRecords:function(){c.addClass(this.resultLayersSelectDiv,this.hiddenClass)},_onHideRelatedRecords:function(){c.removeClass(this.resultLayersSelectDiv,this.hiddenClass)},_isServiceSupportsOrderBy:function(a){var b=!1;a.advancedQueryCapabilities&&a.advancedQueryCapabilities.supportsOrderBy&&
(b=!0);return b},_isServiceSupportsPagination:function(a){var b=!1;a.advancedQueryCapabilities&&a.advancedQueryCapabilities.supportsPagination&&(b=!0);return b},_isSupportObjectIds:function(a){var b=0;a.currentVersion&&(b=parseFloat(a.currentVersion));return 10<=b||a.hasOwnProperty("typeIdField")},_isImageServiceLayer:function(a){return-1<a.indexOf("/ImageServer")},_showQueryErrorMsg:function(a){new b({message:a||this.nls.queryError})},_hideInfoWindow:function(){this.map&&this.map.infoWindow&&(this.map.infoWindow.hide(),
"function"===typeof this.map.infoWindow.setFeatures&&this.map.infoWindow.setFeatures([]))}})});