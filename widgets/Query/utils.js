// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred jimu/utils jimu/LayerInfos/LayerInfos esri/request".split(" "),function(f,h,m,k,n,p){return{getDefaultPopupInfo:function(a,b,c){var g={title:"",fieldInfos:[],description:null,showAttachments:!1,mediaInfos:[]};c=!!c;if(a.displayField)g.title="{"+a.displayField+"}";else{var e=k.getObjectIdField(a);e&&(g.title="{"+e+"}")}g.showAttachments=!!a.hasAttachments;e=a=a.fields;b||(e=h.filter(a,f.hitch(this,function(a){return"esriFieldTypeGeometry"!==
a.type})));b=h.map(e,f.hitch(this,function(a){a=k.getDefaultPortalFieldInfo(a);a.visible=c;return a}));g.fieldInfos=b;return g},getPortalFieldInfosWithoutShape:function(a,b){return h.filter(b,f.hitch(this,function(c){return"esriFieldTypeGeometry"!==k.getFieldInfoByFieldName(a.fields,c.fieldName).type}))},getPopupInfoByAttributes:function(a,b){var c=this.getDefaultPopupInfo(a,!1),g=[],e={},l;for(l in b){g.push(l);var d=k.getFieldInfoByFieldName(a.fields,l).type;if("esriFieldTypeSingle"===d||"esriFieldTypeDouble"===
d)d=b[l],null!==d&&void 0!==d&&(d=parseFloat(d),isNaN(d)||(d=d.toString().split("."),2===d.length&&(e[l]=d[1].length)));c.fieldInfos=h.map(c.fieldInfos,f.hitch(this,function(a){var c=a.fieldName;e.hasOwnProperty(c)&&(a.format.places=e[c]);return g.indexOf(c)}))}return c},upgradePopupToPopupInfo:function(a,b){var c=this.getDefaultPopupInfo(a,!1,!1);c.title=b.title||"";c.title=c.title.replace("${","{");if(b.fields){var g={};h.forEach(b.fields,f.hitch(this,function(a){g[a.name]=a}));h.forEach(c.fieldInfos,
f.hitch(this,function(a){var b=a.fieldName,d=g[b];d&&(a.label=d.alias||a.label,a.visible=!0,"image"===d.specialType&&(b="{"+b+"}",c.mediaInfos.push({title:"",type:"image",caption:a.label,value:{sourceURL:b,linkURL:b}})))}))}return c},isImageServiceLayer:function(a){return a.url&&-1<a.url.indexOf("/ImageServer")},isTable:function(a){return"Table"===a.type},getConfigWithValidDataSource:function(a){var b={queries:[]},c=n.getInstanceSync();b.queries=h.filter(a.queries,f.hitch(this,function(a){return(a=
a.webMapLayerId)?c.getLayerInfoById(a)?!0:!!c.getTableInfoById(a):!0}));return b},removePopupInfoUnsupportFields:function(a,b){var c=h.map(a.fields,f.hitch(this,function(a){return a.name}));b.fieldInfos&&0<b.fieldInfos.length&&(b.fieldInfos=h.filter(b.fieldInfos,f.hitch(this,function(a){return 0<=c.indexOf(a.fieldName)})))},overridePopupTemplateMethodGetAttachments:function(a,b,c){a.getAttachments=function(a){var e=new m;try{var f=a.attributes[c],d=b+"/"+f+"/attachments";p({url:d,content:{f:"json"},
callbackParamName:"callback"}).then(function(a){a=a.attachmentInfos;h.forEach(a,function(a){a.url=d+"/"+a.id;a.objectId=f});e.resolve(a)},function(a){e.reject(a)})}catch(k){console.error(k)}return e}}}});